
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>ScrollView.cpp</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2"> * Copyright 2004-2015, Axel Dörfler, axeld@pinc-software.de.</a>
<a name="ln3"> * Copyright 2009 Stephan Aßmus, superstippi@gmx.de.</a>
<a name="ln4"> * Copyright 2014-2015 Haiku, Inc. All rights reserved.</a>
<a name="ln5"> * Distributed under the terms of the MIT License.</a>
<a name="ln6"> *</a>
<a name="ln7"> * Authors:</a>
<a name="ln8"> *		Stephan Aßmus, superstippi@gmx.de</a>
<a name="ln9"> *		Axel Dörfler, axeld@pinc-software.de</a>
<a name="ln10"> *		John Scipione, jscpione@gmail.com</a>
<a name="ln11"> */</a>
<a name="ln12"> </a>
<a name="ln13"> </a>
<a name="ln14">#include &lt;ScrollView.h&gt;</a>
<a name="ln15"> </a>
<a name="ln16">#include &lt;ControlLook.h&gt;</a>
<a name="ln17">#include &lt;LayoutUtils.h&gt;</a>
<a name="ln18">#include &lt;Message.h&gt;</a>
<a name="ln19">#include &lt;Region.h&gt;</a>
<a name="ln20">#include &lt;Window.h&gt;</a>
<a name="ln21"> </a>
<a name="ln22">#include &lt;binary_compatibility/Interface.h&gt;</a>
<a name="ln23"> </a>
<a name="ln24"> </a>
<a name="ln25">static const float kFancyBorderSize = 2;</a>
<a name="ln26">static const float kPlainBorderSize = 1;</a>
<a name="ln27"> </a>
<a name="ln28"> </a>
<a name="ln29">BScrollView::BScrollView(const char* name, BView* target, uint32 resizingMode,</a>
<a name="ln30">	uint32 flags, bool horizontal, bool vertical, border_style border)</a>
<a name="ln31">	:</a>
<a name="ln32">	BView(_ComputeFrame(target, horizontal, vertical, border,</a>
<a name="ln33">		BControlLook::B_ALL_BORDERS), name, resizingMode,</a>
<a name="ln34">		_ModifyFlags(flags, target, border)),</a>
<a name="ln35">	fTarget(target),</a>
<a name="ln36">	fBorder(border)</a>
<a name="ln37">{</a>
<a name="ln38">	_Init(horizontal, vertical);</a>
<a name="ln39">}</a>
<a name="ln40"> </a>
<a name="ln41"> </a>
<a name="ln42">BScrollView::BScrollView(const char* name, BView* target, uint32 flags,</a>
<a name="ln43">	bool horizontal, bool vertical, border_style border)</a>
<a name="ln44">	:</a>
<a name="ln45">	BView(name, _ModifyFlags(flags, target, border)),</a>
<a name="ln46">	fTarget(target),</a>
<a name="ln47">	fBorder(border)</a>
<a name="ln48">{</a>
<a name="ln49">	_Init(horizontal, vertical);</a>
<a name="ln50">}</a>
<a name="ln51"> </a>
<a name="ln52"> </a>
<a name="ln53">BScrollView::BScrollView(BMessage* archive)</a>
<a name="ln54">	:</a>
<a name="ln55">	BView(archive),</a>
<a name="ln56">	fHighlighted(false)</a>
<a name="ln57">{</a>
<a name="ln58">	int32 border;</a>
<a name="ln59">	fBorder = archive-&gt;FindInt32(&quot;_style&quot;, &amp;border) == B_OK ?</a>
<a name="ln60">		(border_style)border : B_FANCY_BORDER;</a>
<a name="ln61"> </a>
<a name="ln62">	// in a shallow archive, we may not have a target anymore. We must</a>
<a name="ln63">	// be prepared for this case</a>
<a name="ln64"> </a>
<a name="ln65">	// don't confuse our scroll bars with our (eventual) target</a>
<a name="ln66">	int32 firstBar = 0;</a>
<a name="ln67">	if (!archive-&gt;FindBool(&quot;_no_target_&quot;)) {</a>
<a name="ln68">		fTarget = ChildAt(0);</a>
<a name="ln69">		firstBar++;</a>
<a name="ln70">	} else</a>
<a name="ln71">		fTarget = NULL;</a>
<a name="ln72"> </a>
<a name="ln73">	// search for our scroll bars</a>
<a name="ln74">	// This will not work for managed archives (when the layout kit is used).</a>
<a name="ln75">	// In that case the children are attached later, and we perform the search</a>
<a name="ln76">	// again in the AllUnarchived method.</a>
<a name="ln77"> </a>
<a name="ln78">	fHorizontalScrollBar = NULL;</a>
<a name="ln79">	fVerticalScrollBar = NULL;</a>
<a name="ln80"> </a>
<a name="ln81">	BView* view;</a>
<a name="ln82">	while ((view = ChildAt(firstBar++)) != NULL) {</a>
<a name="ln83">		BScrollBar *bar = dynamic_cast&lt;BScrollBar *&gt;(view);</a>
<a name="ln84">		if (bar == NULL)</a>
<a name="ln85">			continue;</a>
<a name="ln86"> </a>
<a name="ln87">		if (bar-&gt;Orientation() == B_HORIZONTAL)</a>
<a name="ln88">			fHorizontalScrollBar = bar;</a>
<a name="ln89">		else if (bar-&gt;Orientation() == B_VERTICAL)</a>
<a name="ln90">			fVerticalScrollBar = bar;</a>
<a name="ln91">	}</a>
<a name="ln92"> </a>
<a name="ln93">	fPreviousWidth = uint16(Bounds().Width());</a>
<a name="ln94">	fPreviousHeight = uint16(Bounds().Height());</a>
<a name="ln95"> </a>
<a name="ln96">}</a>
<a name="ln97"> </a>
<a name="ln98"> </a>
<a name="ln99">BScrollView::~BScrollView()</a>
<a name="ln100">{</a>
<a name="ln101">}</a>
<a name="ln102"> </a>
<a name="ln103"> </a>
<a name="ln104">// #pragma mark - Archiving</a>
<a name="ln105"> </a>
<a name="ln106"> </a>
<a name="ln107">BArchivable*</a>
<a name="ln108">BScrollView::Instantiate(BMessage* archive)</a>
<a name="ln109">{</a>
<a name="ln110">	if (validate_instantiation(archive, &quot;BScrollView&quot;))</a>
<a name="ln111">		return new BScrollView(archive);</a>
<a name="ln112"> </a>
<a name="ln113">	return NULL;</a>
<a name="ln114">}</a>
<a name="ln115"> </a>
<a name="ln116"> </a>
<a name="ln117">status_t</a>
<a name="ln118">BScrollView::Archive(BMessage* archive, bool deep) const</a>
<a name="ln119">{</a>
<a name="ln120">	status_t status = BView::Archive(archive, deep);</a>
<a name="ln121">	if (status != B_OK)</a>
<a name="ln122">		return status;</a>
<a name="ln123"> </a>
<a name="ln124">	// If this is a deep archive, the BView class will take care</a>
<a name="ln125">	// of our children.</a>
<a name="ln126"> </a>
<a name="ln127">	if (status == B_OK &amp;&amp; fBorder != B_FANCY_BORDER)</a>
<a name="ln128">		status = archive-&gt;AddInt32(&quot;_style&quot;, fBorder);</a>
<a name="ln129">	if (status == B_OK &amp;&amp; fTarget == NULL)</a>
<a name="ln130">		status = archive-&gt;AddBool(&quot;_no_target_&quot;, true);</a>
<a name="ln131"> </a>
<a name="ln132">	// The highlighted state is not archived, but since it is</a>
<a name="ln133">	// usually (or should be) used to indicate focus, this</a>
<a name="ln134">	// is probably the right thing to do.</a>
<a name="ln135"> </a>
<a name="ln136">	return status;</a>
<a name="ln137">}</a>
<a name="ln138"> </a>
<a name="ln139"> </a>
<a name="ln140">status_t</a>
<a name="ln141">BScrollView::AllUnarchived(const BMessage* archive)</a>
<a name="ln142">{</a>
<a name="ln143">	status_t result = BView::AllUnarchived(archive);</a>
<a name="ln144">	if (result != B_OK)</a>
<a name="ln145">		return result;</a>
<a name="ln146"> </a>
<a name="ln147">	// search for our scroll bars and target</a>
<a name="ln148">	int32 firstBar = 0;</a>
<a name="ln149">	BView* view;</a>
<a name="ln150">	while ((view = ChildAt(firstBar++)) != NULL) {</a>
<a name="ln151">		BScrollBar *bar = dynamic_cast&lt;BScrollBar *&gt;(view);</a>
<a name="ln152">		// We assume that the first non-scrollbar child view is the target.</a>
<a name="ln153">		// So the target view can't be a BScrollBar, but who would do that?</a>
<a name="ln154">		if (bar == NULL) {</a>
<a name="ln155">			// in a shallow archive, we may not have a target anymore. We must</a>
<a name="ln156">			// be prepared for this case</a>
<a name="ln157">			if (fTarget == NULL &amp;&amp; !archive-&gt;FindBool(&quot;_no_target_&quot;))</a>
<a name="ln158">				fTarget = view;</a>
<a name="ln159">			continue;</a>
<a name="ln160">		}</a>
<a name="ln161"> </a>
<a name="ln162">		if (bar-&gt;Orientation() == B_HORIZONTAL)</a>
<a name="ln163">			fHorizontalScrollBar = bar;</a>
<a name="ln164">		else if (bar-&gt;Orientation() == B_VERTICAL)</a>
<a name="ln165">			fVerticalScrollBar = bar;</a>
<a name="ln166">	}</a>
<a name="ln167"> </a>
<a name="ln168">	// Now connect the bars to the target, and make the target aware of them</a>
<a name="ln169">	if (fHorizontalScrollBar)</a>
<a name="ln170">		fHorizontalScrollBar-&gt;SetTarget(fTarget);</a>
<a name="ln171">	if (fVerticalScrollBar)</a>
<a name="ln172">		fVerticalScrollBar-&gt;SetTarget(fTarget);</a>
<a name="ln173"> </a>
<a name="ln174">	if (fTarget)</a>
<a name="ln175">		fTarget-&gt;TargetedByScrollView(this);</a>
<a name="ln176"> </a>
<a name="ln177">	fPreviousWidth = uint16(Bounds().Width());</a>
<a name="ln178">	fPreviousHeight = uint16(Bounds().Height());</a>
<a name="ln179"> </a>
<a name="ln180">	return B_OK;</a>
<a name="ln181">}</a>
<a name="ln182"> </a>
<a name="ln183"> </a>
<a name="ln184">// #pragma mark - Hook methods</a>
<a name="ln185"> </a>
<a name="ln186"> </a>
<a name="ln187">void</a>
<a name="ln188">BScrollView::AttachedToWindow()</a>
<a name="ln189">{</a>
<a name="ln190">	BView::AttachedToWindow();</a>
<a name="ln191"> </a>
<a name="ln192">	if ((fHorizontalScrollBar == NULL &amp;&amp; fVerticalScrollBar == NULL)</a>
<a name="ln193">		|| (fHorizontalScrollBar != NULL &amp;&amp; fVerticalScrollBar != NULL)</a>
<a name="ln194">		|| Window()-&gt;Look() != B_DOCUMENT_WINDOW_LOOK) {</a>
<a name="ln195">		return;</a>
<a name="ln196">	}</a>
<a name="ln197"> </a>
<a name="ln198">	// If we have only one bar, we need to check if we are in the</a>
<a name="ln199">	// bottom right edge of a window with the B_DOCUMENT_LOOK to</a>
<a name="ln200">	// adjust the size of the bar to acknowledge the resize knob.</a>
<a name="ln201"> </a>
<a name="ln202">	BRect bounds = ConvertToScreen(Bounds());</a>
<a name="ln203">	BRect windowBounds = Window()-&gt;Frame();</a>
<a name="ln204"> </a>
<a name="ln205">	if (bounds.right - _BorderSize() != windowBounds.right</a>
<a name="ln206">		|| bounds.bottom - _BorderSize() != windowBounds.bottom) {</a>
<a name="ln207">		return;</a>
<a name="ln208">	}</a>
<a name="ln209"> </a>
<a name="ln210">	if (fHorizontalScrollBar != NULL)</a>
<a name="ln211">		fHorizontalScrollBar-&gt;ResizeBy(-B_V_SCROLL_BAR_WIDTH, 0);</a>
<a name="ln212">	else if (fVerticalScrollBar != NULL)</a>
<a name="ln213">		fVerticalScrollBar-&gt;ResizeBy(0, -B_H_SCROLL_BAR_HEIGHT);</a>
<a name="ln214">}</a>
<a name="ln215"> </a>
<a name="ln216"> </a>
<a name="ln217">void</a>
<a name="ln218">BScrollView::DetachedFromWindow()</a>
<a name="ln219">{</a>
<a name="ln220">	BView::DetachedFromWindow();</a>
<a name="ln221">}</a>
<a name="ln222"> </a>
<a name="ln223"> </a>
<a name="ln224">void</a>
<a name="ln225">BScrollView::AllAttached()</a>
<a name="ln226">{</a>
<a name="ln227">	BView::AllAttached();</a>
<a name="ln228">}</a>
<a name="ln229"> </a>
<a name="ln230"> </a>
<a name="ln231">void</a>
<a name="ln232">BScrollView::AllDetached()</a>
<a name="ln233">{</a>
<a name="ln234">	BView::AllDetached();</a>
<a name="ln235">}</a>
<a name="ln236"> </a>
<a name="ln237"> </a>
<a name="ln238">void</a>
<a name="ln239">BScrollView::Draw(BRect updateRect)</a>
<a name="ln240">{</a>
<a name="ln241">	uint32 flags = 0;</a>
<a name="ln242">	if (fHighlighted &amp;&amp; Window()-&gt;IsActive())</a>
<a name="ln243">		flags |= BControlLook::B_FOCUSED;</a>
<a name="ln244"> </a>
<a name="ln245">	BRect rect(Bounds());</a>
<a name="ln246">	rgb_color base = ui_color(B_PANEL_BACKGROUND_COLOR);</a>
<a name="ln247"> </a>
<a name="ln248">	BRect verticalScrollBarFrame(0, 0, -1, -1);</a>
<a name="ln249">	if (fVerticalScrollBar)</a>
<a name="ln250">		verticalScrollBarFrame = fVerticalScrollBar-&gt;Frame();</a>
<a name="ln251"> </a>
<a name="ln252">	BRect horizontalScrollBarFrame(0, 0, -1, -1);</a>
<a name="ln253">	if (fHorizontalScrollBar)</a>
<a name="ln254">		horizontalScrollBarFrame = fHorizontalScrollBar-&gt;Frame();</a>
<a name="ln255"> </a>
<a name="ln256">	be_control_look-&gt;DrawScrollViewFrame(this, rect, updateRect,</a>
<a name="ln257">		verticalScrollBarFrame, horizontalScrollBarFrame, base, fBorder,</a>
<a name="ln258">		flags, fBorders);</a>
<a name="ln259">}</a>
<a name="ln260"> </a>
<a name="ln261"> </a>
<a name="ln262">void</a>
<a name="ln263">BScrollView::FrameMoved(BPoint newPosition)</a>
<a name="ln264">{</a>
<a name="ln265">	BView::FrameMoved(newPosition);</a>
<a name="ln266">}</a>
<a name="ln267"> </a>
<a name="ln268"> </a>
<a name="ln269">void</a>
<a name="ln270">BScrollView::FrameResized(float newWidth, float newHeight)</a>
<a name="ln271">{</a>
<a name="ln272">	BView::FrameResized(newWidth, newHeight);</a>
<a name="ln273"> </a>
<a name="ln274">	const BRect bounds = Bounds();</a>
<a name="ln275"> </a>
<a name="ln276">	if (fTarget != NULL &amp;&amp; (fTarget-&gt;Flags() &amp; B_SUPPORTS_LAYOUT) != 0</a>
<a name="ln277">			&amp;&amp; (fTarget-&gt;Flags() &amp; B_SCROLL_VIEW_AWARE) == 0) {</a>
<a name="ln278">		BSize size = fTarget-&gt;PreferredSize();</a>
<a name="ln279">		if (fHorizontalScrollBar != NULL) {</a>
<a name="ln280">			float delta = size.Width() - bounds.Width(),</a>
<a name="ln281">				proportion = bounds.Width() / size.Width();</a>
<a name="ln282">			if (delta &lt; 0)</a>
<a name="ln283">				delta = 0;</a>
<a name="ln284"> </a>
<a name="ln285">			fHorizontalScrollBar-&gt;SetRange(0, delta);</a>
<a name="ln286">			fHorizontalScrollBar-&gt;SetSteps(be_plain_font-&gt;Size() * 1.33,</a>
<a name="ln287">				bounds.Width());</a>
<a name="ln288">			fHorizontalScrollBar-&gt;SetProportion(proportion);</a>
<a name="ln289">		}</a>
<a name="ln290">		if (fVerticalScrollBar != NULL) {</a>
<a name="ln291">			float delta = size.Height() - bounds.Height(),</a>
<a name="ln292">				proportion = bounds.Height() / size.Height();</a>
<a name="ln293">			if (delta &lt; 0)</a>
<a name="ln294">				delta = 0;</a>
<a name="ln295"> </a>
<a name="ln296">			fVerticalScrollBar-&gt;SetRange(0, delta);</a>
<a name="ln297">			fVerticalScrollBar-&gt;SetSteps(be_plain_font-&gt;Size() * 1.33,</a>
<a name="ln298">				bounds.Height());</a>
<a name="ln299">			fVerticalScrollBar-&gt;SetProportion(proportion);</a>
<a name="ln300">		}</a>
<a name="ln301">	}</a>
<a name="ln302"> </a>
<a name="ln303">	if (fBorder == B_NO_BORDER)</a>
<a name="ln304">		return;</a>
<a name="ln305"> </a>
<a name="ln306">	float border = _BorderSize() - 1;</a>
<a name="ln307"> </a>
<a name="ln308">	if (fHorizontalScrollBar != NULL &amp;&amp; fVerticalScrollBar != NULL) {</a>
<a name="ln309">		BRect scrollCorner(bounds);</a>
<a name="ln310">		scrollCorner.left = min_c(</a>
<a name="ln311">			fPreviousWidth - fVerticalScrollBar-&gt;Frame().Height(),</a>
<a name="ln312">			fHorizontalScrollBar-&gt;Frame().right + 1);</a>
<a name="ln313">		scrollCorner.top = min_c(</a>
<a name="ln314">			fPreviousHeight - fHorizontalScrollBar-&gt;Frame().Width(),</a>
<a name="ln315">			fVerticalScrollBar-&gt;Frame().bottom + 1);</a>
<a name="ln316">		Invalidate(scrollCorner);</a>
<a name="ln317">	}</a>
<a name="ln318"> </a>
<a name="ln319">	// changes in newWidth</a>
<a name="ln320"> </a>
<a name="ln321">	if (bounds.Width() &gt; fPreviousWidth) {</a>
<a name="ln322">		// invalidate the region between the old and the new right border</a>
<a name="ln323">		BRect rect = bounds;</a>
<a name="ln324">		rect.left += fPreviousWidth - border;</a>
<a name="ln325">		rect.right--;</a>
<a name="ln326">		Invalidate(rect);</a>
<a name="ln327">	} else if (bounds.Width() &lt; fPreviousWidth) {</a>
<a name="ln328">		// invalidate the region of the new right border</a>
<a name="ln329">		BRect rect = bounds;</a>
<a name="ln330">		rect.left = rect.right - border;</a>
<a name="ln331">		Invalidate(rect);</a>
<a name="ln332">	}</a>
<a name="ln333"> </a>
<a name="ln334">	// changes in newHeight</a>
<a name="ln335"> </a>
<a name="ln336">	if (bounds.Height() &gt; fPreviousHeight) {</a>
<a name="ln337">		// invalidate the region between the old and the new bottom border</a>
<a name="ln338">		BRect rect = bounds;</a>
<a name="ln339">		rect.top += fPreviousHeight - border;</a>
<a name="ln340">		rect.bottom--;</a>
<a name="ln341">		Invalidate(rect);</a>
<a name="ln342">	} else if (bounds.Height() &lt; fPreviousHeight) {</a>
<a name="ln343">		// invalidate the region of the new bottom border</a>
<a name="ln344">		BRect rect = bounds;</a>
<a name="ln345">		rect.top = rect.bottom - border;</a>
<a name="ln346">		Invalidate(rect);</a>
<a name="ln347">	}</a>
<a name="ln348"> </a>
<a name="ln349">	fPreviousWidth = uint16(bounds.Width());</a>
<a name="ln350">	fPreviousHeight = uint16(bounds.Height());</a>
<a name="ln351">}</a>
<a name="ln352"> </a>
<a name="ln353"> </a>
<a name="ln354">void</a>
<a name="ln355">BScrollView::MessageReceived(BMessage* message)</a>
<a name="ln356">{</a>
<a name="ln357">	BView::MessageReceived(message);</a>
<a name="ln358">}</a>
<a name="ln359"> </a>
<a name="ln360"> </a>
<a name="ln361">void</a>
<a name="ln362">BScrollView::MouseDown(BPoint where)</a>
<a name="ln363">{</a>
<a name="ln364">	BView::MouseDown(where);</a>
<a name="ln365">}</a>
<a name="ln366"> </a>
<a name="ln367"> </a>
<a name="ln368">void</a>
<a name="ln369">BScrollView::MouseMoved(BPoint where, uint32 code,</a>
<a name="ln370">	const BMessage* dragMessage)</a>
<a name="ln371">{</a>
<a name="ln372">	BView::MouseMoved(where, code, dragMessage);</a>
<a name="ln373">}</a>
<a name="ln374"> </a>
<a name="ln375"> </a>
<a name="ln376">void</a>
<a name="ln377">BScrollView::MouseUp(BPoint where)</a>
<a name="ln378">{</a>
<a name="ln379">	BView::MouseUp(where);</a>
<a name="ln380">}</a>
<a name="ln381"> </a>
<a name="ln382"> </a>
<a name="ln383">void</a>
<a name="ln384">BScrollView::WindowActivated(bool active)</a>
<a name="ln385">{</a>
<a name="ln386">	if (fHighlighted)</a>
<a name="ln387">		Invalidate();</a>
<a name="ln388"> </a>
<a name="ln389">	BView::WindowActivated(active);</a>
<a name="ln390">}</a>
<a name="ln391"> </a>
<a name="ln392"> </a>
<a name="ln393">// #pragma mark - Size methods</a>
<a name="ln394"> </a>
<a name="ln395"> </a>
<a name="ln396">void</a>
<a name="ln397">BScrollView::GetPreferredSize(float* _width, float* _height)</a>
<a name="ln398">{</a>
<a name="ln399">	BSize size = PreferredSize();</a>
<a name="ln400"> </a>
<a name="ln401">	if (_width)</a>
<a name="ln402">		*_width = size.width;</a>
<a name="ln403"> </a>
<a name="ln404">	if (_height)</a>
<a name="ln405">		*_height = size.height;</a>
<a name="ln406">}</a>
<a name="ln407"> </a>
<a name="ln408"> </a>
<a name="ln409">void</a>
<a name="ln410">BScrollView::ResizeToPreferred()</a>
<a name="ln411">{</a>
<a name="ln412">	if (Window() == NULL)</a>
<a name="ln413">		return;</a>
<a name="ln414">	BView::ResizeToPreferred();</a>
<a name="ln415">}</a>
<a name="ln416"> </a>
<a name="ln417"> </a>
<a name="ln418">void</a>
<a name="ln419">BScrollView::MakeFocus(bool focus)</a>
<a name="ln420">{</a>
<a name="ln421">	BView::MakeFocus(focus);</a>
<a name="ln422">}</a>
<a name="ln423"> </a>
<a name="ln424"> </a>
<a name="ln425">BSize</a>
<a name="ln426">BScrollView::MinSize()</a>
<a name="ln427">{</a>
<a name="ln428">	BSize size = _ComputeSize(fTarget != NULL ? fTarget-&gt;MinSize()</a>
<a name="ln429">		: BSize(16, 16));</a>
<a name="ln430"> </a>
<a name="ln431">	return BLayoutUtils::ComposeSize(ExplicitMinSize(), size);</a>
<a name="ln432">}</a>
<a name="ln433"> </a>
<a name="ln434"> </a>
<a name="ln435">BSize</a>
<a name="ln436">BScrollView::MaxSize()</a>
<a name="ln437">{</a>
<a name="ln438">	BSize size = _ComputeSize(fTarget != NULL ? fTarget-&gt;MaxSize()</a>
<a name="ln439">		: BSize(B_SIZE_UNLIMITED, B_SIZE_UNLIMITED));</a>
<a name="ln440"> </a>
<a name="ln441">	return BLayoutUtils::ComposeSize(ExplicitMaxSize(), size);</a>
<a name="ln442">}</a>
<a name="ln443"> </a>
<a name="ln444"> </a>
<a name="ln445">BSize</a>
<a name="ln446">BScrollView::PreferredSize()</a>
<a name="ln447">{</a>
<a name="ln448">	BSize size = _ComputeSize(fTarget != NULL ? fTarget-&gt;PreferredSize()</a>
<a name="ln449">		: BSize(32, 32));</a>
<a name="ln450"> </a>
<a name="ln451">	return BLayoutUtils::ComposeSize(ExplicitPreferredSize(), size);</a>
<a name="ln452">}</a>
<a name="ln453"> </a>
<a name="ln454"> </a>
<a name="ln455">// #pragma mark - BScrollView methods</a>
<a name="ln456"> </a>
<a name="ln457"> </a>
<a name="ln458">BScrollBar*</a>
<a name="ln459">BScrollView::ScrollBar(orientation direction) const</a>
<a name="ln460">{</a>
<a name="ln461">	if (direction == B_HORIZONTAL)</a>
<a name="ln462">		return fHorizontalScrollBar;</a>
<a name="ln463"> </a>
<a name="ln464">	return fVerticalScrollBar;</a>
<a name="ln465">}</a>
<a name="ln466"> </a>
<a name="ln467"> </a>
<a name="ln468">void</a>
<a name="ln469">BScrollView::SetBorder(border_style border)</a>
<a name="ln470">{</a>
<a name="ln471">	if (fBorder == border)</a>
<a name="ln472">		return;</a>
<a name="ln473"> </a>
<a name="ln474">	if ((Flags() &amp; B_SUPPORTS_LAYOUT) != 0) {</a>
<a name="ln475">		fBorder = border;</a>
<a name="ln476">		SetFlags(_ModifyFlags(Flags(), fTarget, border));</a>
<a name="ln477"> </a>
<a name="ln478">		DoLayout();</a>
<a name="ln479">		Invalidate();</a>
<a name="ln480">		return;</a>
<a name="ln481">	}</a>
<a name="ln482"> </a>
<a name="ln483">	float offset = _BorderSize() - _BorderSize(border);</a>
<a name="ln484">	float resize = 2 * offset;</a>
<a name="ln485"> </a>
<a name="ln486">	float horizontalGap = 0, verticalGap = 0;</a>
<a name="ln487">	float change = 0;</a>
<a name="ln488">	if (border == B_NO_BORDER || fBorder == B_NO_BORDER) {</a>
<a name="ln489">		if (fHorizontalScrollBar != NULL)</a>
<a name="ln490">			verticalGap = border != B_NO_BORDER ? 1 : -1;</a>
<a name="ln491">		if (fVerticalScrollBar != NULL)</a>
<a name="ln492">			horizontalGap = border != B_NO_BORDER ? 1 : -1;</a>
<a name="ln493"> </a>
<a name="ln494">		change = border != B_NO_BORDER ? -1 : 1;</a>
<a name="ln495">		if (fHorizontalScrollBar == NULL || fVerticalScrollBar == NULL)</a>
<a name="ln496">			change *= 2;</a>
<a name="ln497">	}</a>
<a name="ln498"> </a>
<a name="ln499">	fBorder = border;</a>
<a name="ln500"> </a>
<a name="ln501">	int32 savedResizingMode = 0;</a>
<a name="ln502">	if (fTarget != NULL) {</a>
<a name="ln503">		savedResizingMode = fTarget-&gt;ResizingMode();</a>
<a name="ln504">		fTarget-&gt;SetResizingMode(B_FOLLOW_NONE);</a>
<a name="ln505">	}</a>
<a name="ln506"> </a>
<a name="ln507">	MoveBy(offset, offset);</a>
<a name="ln508">	ResizeBy(-resize - horizontalGap, -resize - verticalGap);</a>
<a name="ln509"> </a>
<a name="ln510">	if (fTarget != NULL) {</a>
<a name="ln511">		fTarget-&gt;MoveBy(-offset, -offset);</a>
<a name="ln512">		fTarget-&gt;SetResizingMode(savedResizingMode);</a>
<a name="ln513">	}</a>
<a name="ln514"> </a>
<a name="ln515">	if (fHorizontalScrollBar != NULL) {</a>
<a name="ln516">		fHorizontalScrollBar-&gt;MoveBy(-offset - verticalGap, offset + verticalGap);</a>
<a name="ln517">		fHorizontalScrollBar-&gt;ResizeBy(resize + horizontalGap - change, 0);</a>
<a name="ln518">	}</a>
<a name="ln519">	if (fVerticalScrollBar != NULL) {</a>
<a name="ln520">		fVerticalScrollBar-&gt;MoveBy(offset + horizontalGap, -offset - horizontalGap);</a>
<a name="ln521">		fVerticalScrollBar-&gt;ResizeBy(0, resize + verticalGap - change);</a>
<a name="ln522">	}</a>
<a name="ln523"> </a>
<a name="ln524">	SetFlags(_ModifyFlags(Flags(), fTarget, border));</a>
<a name="ln525">}</a>
<a name="ln526"> </a>
<a name="ln527"> </a>
<a name="ln528">border_style</a>
<a name="ln529">BScrollView::Border() const</a>
<a name="ln530">{</a>
<a name="ln531">	return fBorder;</a>
<a name="ln532">}</a>
<a name="ln533"> </a>
<a name="ln534"> </a>
<a name="ln535">void</a>
<a name="ln536">BScrollView::SetBorders(uint32 borders)</a>
<a name="ln537">{</a>
<a name="ln538">	if (fBorders == borders || (Flags() &amp; B_SUPPORTS_LAYOUT) == 0)</a>
<a name="ln539">		return;</a>
<a name="ln540"> </a>
<a name="ln541">	fBorders = borders;</a>
<a name="ln542">	DoLayout();</a>
<a name="ln543">	Invalidate();</a>
<a name="ln544">}</a>
<a name="ln545"> </a>
<a name="ln546"> </a>
<a name="ln547">uint32</a>
<a name="ln548">BScrollView::Borders() const</a>
<a name="ln549">{</a>
<a name="ln550">	return fBorders;</a>
<a name="ln551">}</a>
<a name="ln552"> </a>
<a name="ln553"> </a>
<a name="ln554">status_t</a>
<a name="ln555">BScrollView::SetBorderHighlighted(bool highlight)</a>
<a name="ln556">{</a>
<a name="ln557">	if (fHighlighted == highlight)</a>
<a name="ln558">		return B_OK;</a>
<a name="ln559"> </a>
<a name="ln560">	if (fBorder != B_FANCY_BORDER)</a>
<a name="ln561">		// highlighting only works for B_FANCY_BORDER</a>
<a name="ln562">		return B_ERROR;</a>
<a name="ln563"> </a>
<a name="ln564">	fHighlighted = highlight;</a>
<a name="ln565"> </a>
<a name="ln566">	if (fHorizontalScrollBar != NULL)</a>
<a name="ln567">		fHorizontalScrollBar-&gt;SetBorderHighlighted(highlight);</a>
<a name="ln568">	if (fVerticalScrollBar != NULL)</a>
<a name="ln569">		fVerticalScrollBar-&gt;SetBorderHighlighted(highlight);</a>
<a name="ln570"> </a>
<a name="ln571">	BRect bounds = Bounds();</a>
<a name="ln572">	bounds.InsetBy(1, 1);</a>
<a name="ln573"> </a>
<a name="ln574">	Invalidate(BRect(bounds.left, bounds.top, bounds.right, bounds.top));</a>
<a name="ln575">	Invalidate(BRect(bounds.left, bounds.top + 1, bounds.left,</a>
<a name="ln576">		bounds.bottom - 1));</a>
<a name="ln577">	Invalidate(BRect(bounds.right, bounds.top + 1, bounds.right,</a>
<a name="ln578">		bounds.bottom - 1));</a>
<a name="ln579">	Invalidate(BRect(bounds.left, bounds.bottom, bounds.right, bounds.bottom));</a>
<a name="ln580"> </a>
<a name="ln581">	return B_OK;</a>
<a name="ln582">}</a>
<a name="ln583"> </a>
<a name="ln584"> </a>
<a name="ln585">bool</a>
<a name="ln586">BScrollView::IsBorderHighlighted() const</a>
<a name="ln587">{</a>
<a name="ln588">	return fHighlighted;</a>
<a name="ln589">}</a>
<a name="ln590"> </a>
<a name="ln591"> </a>
<a name="ln592">void</a>
<a name="ln593">BScrollView::SetTarget(BView* target)</a>
<a name="ln594">{</a>
<a name="ln595">	if (fTarget == target)</a>
<a name="ln596">		return;</a>
<a name="ln597"> </a>
<a name="ln598">	if (fTarget != NULL) {</a>
<a name="ln599">		fTarget-&gt;TargetedByScrollView(NULL);</a>
<a name="ln600">		RemoveChild(fTarget);</a>
<a name="ln601"> </a>
<a name="ln602">		// we are not supposed to delete the view</a>
<a name="ln603">	}</a>
<a name="ln604"> </a>
<a name="ln605">	fTarget = target;</a>
<a name="ln606">	if (fHorizontalScrollBar != NULL)</a>
<a name="ln607">		fHorizontalScrollBar-&gt;SetTarget(target);</a>
<a name="ln608">	if (fVerticalScrollBar != NULL)</a>
<a name="ln609">		fVerticalScrollBar-&gt;SetTarget(target);</a>
<a name="ln610"> </a>
<a name="ln611">	if (target != NULL) {</a>
<a name="ln612">		float borderSize = _BorderSize();</a>
<a name="ln613">		target-&gt;MoveTo((fBorders &amp; BControlLook::B_LEFT_BORDER) != 0</a>
<a name="ln614">			? borderSize : 0, (fBorders &amp; BControlLook::B_TOP_BORDER) != 0</a>
<a name="ln615">				? borderSize : 0);</a>
<a name="ln616">		BRect innerFrame = _InnerFrame();</a>
<a name="ln617">		target-&gt;ResizeTo(innerFrame.Width() - 1, innerFrame.Height() - 1);</a>
<a name="ln618">		target-&gt;TargetedByScrollView(this);</a>
<a name="ln619"> </a>
<a name="ln620">		AddChild(target, ChildAt(0));</a>
<a name="ln621">			// This way, we are making sure that the target will</a>
<a name="ln622">			// be added top most in the list (which is important</a>
<a name="ln623">			// for unarchiving)</a>
<a name="ln624">	}</a>
<a name="ln625"> </a>
<a name="ln626">	SetFlags(_ModifyFlags(Flags(), fTarget, fBorder));</a>
<a name="ln627">}</a>
<a name="ln628"> </a>
<a name="ln629"> </a>
<a name="ln630">BView*</a>
<a name="ln631">BScrollView::Target() const</a>
<a name="ln632">{</a>
<a name="ln633">	return fTarget;</a>
<a name="ln634">}</a>
<a name="ln635"> </a>
<a name="ln636"> </a>
<a name="ln637">// #pragma mark - Scripting methods</a>
<a name="ln638"> </a>
<a name="ln639"> </a>
<a name="ln640"> </a>
<a name="ln641">BHandler*</a>
<a name="ln642">BScrollView::ResolveSpecifier(BMessage* message, int32 index,</a>
<a name="ln643">	BMessage* specifier, int32 what, const char* property)</a>
<a name="ln644">{</a>
<a name="ln645">	return BView::ResolveSpecifier(message, index, specifier, what, property);</a>
<a name="ln646">}</a>
<a name="ln647"> </a>
<a name="ln648"> </a>
<a name="ln649">status_t</a>
<a name="ln650">BScrollView::GetSupportedSuites(BMessage* message)</a>
<a name="ln651">{</a>
<a name="ln652">	return BView::GetSupportedSuites(message);</a>
<a name="ln653">}</a>
<a name="ln654"> </a>
<a name="ln655"> </a>
<a name="ln656">//	#pragma mark - Perform</a>
<a name="ln657"> </a>
<a name="ln658"> </a>
<a name="ln659">status_t</a>
<a name="ln660">BScrollView::Perform(perform_code code, void* _data)</a>
<a name="ln661">{</a>
<a name="ln662">	switch (code) {</a>
<a name="ln663">		case PERFORM_CODE_MIN_SIZE:</a>
<a name="ln664">			((perform_data_min_size*)_data)-&gt;return_value</a>
<a name="ln665">				= BScrollView::MinSize();</a>
<a name="ln666">			return B_OK;</a>
<a name="ln667"> </a>
<a name="ln668">		case PERFORM_CODE_MAX_SIZE:</a>
<a name="ln669">			((perform_data_max_size*)_data)-&gt;return_value</a>
<a name="ln670">				= BScrollView::MaxSize();</a>
<a name="ln671">			return B_OK;</a>
<a name="ln672"> </a>
<a name="ln673">		case PERFORM_CODE_PREFERRED_SIZE:</a>
<a name="ln674">			((perform_data_preferred_size*)_data)-&gt;return_value</a>
<a name="ln675">				= BScrollView::PreferredSize();</a>
<a name="ln676">			return B_OK;</a>
<a name="ln677"> </a>
<a name="ln678">		case PERFORM_CODE_LAYOUT_ALIGNMENT:</a>
<a name="ln679">			((perform_data_layout_alignment*)_data)-&gt;return_value</a>
<a name="ln680">				= BScrollView::LayoutAlignment();</a>
<a name="ln681">			return B_OK;</a>
<a name="ln682"> </a>
<a name="ln683">		case PERFORM_CODE_HAS_HEIGHT_FOR_WIDTH:</a>
<a name="ln684">			((perform_data_has_height_for_width*)_data)-&gt;return_value</a>
<a name="ln685">				= BScrollView::HasHeightForWidth();</a>
<a name="ln686">			return B_OK;</a>
<a name="ln687"> </a>
<a name="ln688">		case PERFORM_CODE_GET_HEIGHT_FOR_WIDTH:</a>
<a name="ln689">		{</a>
<a name="ln690">			perform_data_get_height_for_width* data</a>
<a name="ln691">				= (perform_data_get_height_for_width*)_data;</a>
<a name="ln692">			BScrollView::GetHeightForWidth(data-&gt;width, &amp;data-&gt;min, &amp;data-&gt;max,</a>
<a name="ln693">				&amp;data-&gt;preferred);</a>
<a name="ln694">			return B_OK;</a>
<a name="ln695">		}</a>
<a name="ln696"> </a>
<a name="ln697">		case PERFORM_CODE_SET_LAYOUT:</a>
<a name="ln698">		{</a>
<a name="ln699">			perform_data_set_layout* data = (perform_data_set_layout*)_data;</a>
<a name="ln700">			BScrollView::SetLayout(data-&gt;layout);</a>
<a name="ln701">			return B_OK;</a>
<a name="ln702">		}</a>
<a name="ln703"> </a>
<a name="ln704">		case PERFORM_CODE_LAYOUT_INVALIDATED:</a>
<a name="ln705">		{</a>
<a name="ln706">			perform_data_layout_invalidated* data</a>
<a name="ln707">				= (perform_data_layout_invalidated*)_data;</a>
<a name="ln708">			BScrollView::LayoutInvalidated(data-&gt;descendants);</a>
<a name="ln709">			return B_OK;</a>
<a name="ln710">		}</a>
<a name="ln711"> </a>
<a name="ln712">		case PERFORM_CODE_DO_LAYOUT:</a>
<a name="ln713">		{</a>
<a name="ln714">			BScrollView::DoLayout();</a>
<a name="ln715">			return B_OK;</a>
<a name="ln716">		}</a>
<a name="ln717">	}</a>
<a name="ln718"> </a>
<a name="ln719">	return BView::Perform(code, _data);</a>
<a name="ln720">}</a>
<a name="ln721"> </a>
<a name="ln722"> </a>
<a name="ln723">//	#pragma mark - Protected methods</a>
<a name="ln724"> </a>
<a name="ln725"> </a>
<a name="ln726">void</a>
<a name="ln727">BScrollView::LayoutInvalidated(bool descendants)</a>
<a name="ln728">{</a>
<a name="ln729">}</a>
<a name="ln730"> </a>
<a name="ln731"> </a>
<a name="ln732">void</a>
<a name="ln733">BScrollView::DoLayout()</a>
<a name="ln734">{</a>
<a name="ln735">	if ((Flags() &amp; B_SUPPORTS_LAYOUT) == 0)</a>
<a name="ln736">		return;</a>
<a name="ln737"> </a>
<a name="ln738">	// If the user set a layout, we let the base class version call its hook.</a>
<a name="ln739">	if (GetLayout() != NULL) {</a>
<a name="ln740">		BView::DoLayout();</a>
<a name="ln741">		return;</a>
<a name="ln742">	}</a>
<a name="ln743"> </a>
<a name="ln744">	BRect innerFrame = _InnerFrame();</a>
<a name="ln745"> </a>
<a name="ln746">	if (fTarget != NULL) {</a>
<a name="ln747">		fTarget-&gt;MoveTo(innerFrame.left, innerFrame.top);</a>
<a name="ln748">		fTarget-&gt;ResizeTo(innerFrame.Width(), innerFrame.Height());</a>
<a name="ln749"> </a>
<a name="ln750">		//BLayoutUtils::AlignInFrame(fTarget, fTarget-&gt;Bounds());</a>
<a name="ln751">	}</a>
<a name="ln752"> </a>
<a name="ln753">	_AlignScrollBars(fHorizontalScrollBar != NULL, fVerticalScrollBar != NULL,</a>
<a name="ln754">		innerFrame);</a>
<a name="ln755">}</a>
<a name="ln756"> </a>
<a name="ln757"> </a>
<a name="ln758">// #pragma mark - Private methods</a>
<a name="ln759"> </a>
<a name="ln760"> </a>
<a name="ln761">void</a>
<a name="ln762">BScrollView::_Init(bool horizontal, bool vertical)</a>
<a name="ln763">{</a>
<a name="ln764">	fHorizontalScrollBar = NULL;</a>
<a name="ln765">	fVerticalScrollBar = NULL;</a>
<a name="ln766">	fHighlighted = false;</a>
<a name="ln767">	fBorders = BControlLook::B_ALL_BORDERS;</a>
<a name="ln768"> </a>
<a name="ln769">	SetViewUIColor(B_PANEL_BACKGROUND_COLOR);</a>
<a name="ln770"> </a>
<a name="ln771">	if (horizontal) {</a>
<a name="ln772">		fHorizontalScrollBar = new BScrollBar(BRect(0, 0, 14, 14), &quot;_HSB_&quot;,</a>
<a name="ln773">			fTarget, 0, 1000, B_HORIZONTAL);</a>
<a name="ln774">		AddChild(fHorizontalScrollBar);</a>
<a name="ln775">	}</a>
<a name="ln776"> </a>
<a name="ln777">	if (vertical) {</a>
<a name="ln778">		fVerticalScrollBar = new BScrollBar(BRect(0, 0, 14, 14), &quot;_VSB_&quot;,</a>
<a name="ln779">			fTarget, 0, 1000, B_VERTICAL);</a>
<a name="ln780">		AddChild(fVerticalScrollBar);</a>
<a name="ln781">	}</a>
<a name="ln782"> </a>
<a name="ln783">	BRect targetFrame;</a>
<a name="ln784">	if (fTarget) {</a>
<a name="ln785">		// layout target and add it</a>
<a name="ln786">		fTarget-&gt;TargetedByScrollView(this);</a>
<a name="ln787">		fTarget-&gt;MoveTo(B_ORIGIN);</a>
<a name="ln788"> </a>
<a name="ln789">		if (fBorder != B_NO_BORDER)</a>
<a name="ln790">			fTarget-&gt;MoveBy(_BorderSize(), _BorderSize());</a>
<a name="ln791"> </a>
<a name="ln792">		AddChild(fTarget);</a>
<a name="ln793">		targetFrame = fTarget-&gt;Frame();</a>
<a name="ln794">	} else {</a>
<a name="ln795">		// no target specified</a>
<a name="ln796">		targetFrame = Bounds();</a>
<a name="ln797">		if (horizontal)</a>
<a name="ln798">			targetFrame.bottom -= B_H_SCROLL_BAR_HEIGHT + 1;</a>
<a name="ln799">		if (vertical)</a>
<a name="ln800">			targetFrame.right -= B_V_SCROLL_BAR_WIDTH + 1;</a>
<a name="ln801">		if (fBorder == B_FANCY_BORDER) {</a>
<a name="ln802">			targetFrame.bottom--;</a>
<a name="ln803">			targetFrame.right--;</a>
<a name="ln804">		}</a>
<a name="ln805">	}</a>
<a name="ln806"> </a>
<a name="ln807">	_AlignScrollBars(horizontal, vertical, targetFrame);</a>
<a name="ln808"> </a>
<a name="ln809">	fPreviousWidth = uint16(Bounds().Width());</a>
<a name="ln810">	fPreviousHeight = uint16(Bounds().Height());</a>
<a name="ln811">}</a>
<a name="ln812"> </a>
<a name="ln813"> </a>
<a name="ln814">float</a>
<a name="ln815">BScrollView::_BorderSize() const</a>
<a name="ln816">{</a>
<a name="ln817">	return _BorderSize(fBorder);</a>
<a name="ln818">}</a>
<a name="ln819"> </a>
<a name="ln820"> </a>
<a name="ln821">BRect</a>
<a name="ln822">BScrollView::_InnerFrame() const</a>
<a name="ln823">{</a>
<a name="ln824">	BRect frame = Bounds();</a>
<a name="ln825">	_InsetBorders(frame, fBorder, fBorders);</a>
<a name="ln826"> </a>
<a name="ln827">	float borderSize = _BorderSize();</a>
<a name="ln828"> </a>
<a name="ln829">	if (fHorizontalScrollBar != NULL) {</a>
<a name="ln830">		frame.bottom -= B_H_SCROLL_BAR_HEIGHT;</a>
<a name="ln831">		if (borderSize == 0)</a>
<a name="ln832">			frame.bottom--;</a>
<a name="ln833">	}</a>
<a name="ln834">	if (fVerticalScrollBar != NULL) {</a>
<a name="ln835">		frame.right -= B_V_SCROLL_BAR_WIDTH;</a>
<a name="ln836">		if (borderSize == 0)</a>
<a name="ln837">			frame.right--;</a>
<a name="ln838">	}</a>
<a name="ln839"> </a>
<a name="ln840">	return frame;</a>
<a name="ln841">}</a>
<a name="ln842"> </a>
<a name="ln843"> </a>
<a name="ln844">BSize</a>
<a name="ln845">BScrollView::_ComputeSize(BSize targetSize) const</a>
<a name="ln846">{</a>
<a name="ln847">	BRect frame = _ComputeFrame(</a>
<a name="ln848">		BRect(0, 0, targetSize.width, targetSize.height));</a>
<a name="ln849"> </a>
<a name="ln850">	return BSize(frame.Width(), frame.Height());</a>
<a name="ln851">}</a>
<a name="ln852"> </a>
<a name="ln853"> </a>
<a name="ln854">BRect</a>
<a name="ln855">BScrollView::_ComputeFrame(BRect targetRect) const</a>
<a name="ln856">{</a>
<a name="ln857">	return _ComputeFrame(targetRect, fHorizontalScrollBar != NULL,</a>
<a name="ln858">		fVerticalScrollBar != NULL, fBorder, fBorders);</a>
<a name="ln859">}</a>
<a name="ln860"> </a>
<a name="ln861"> </a>
<a name="ln862">void</a>
<a name="ln863">BScrollView::_AlignScrollBars(bool horizontal, bool vertical, BRect targetFrame)</a>
<a name="ln864">{</a>
<a name="ln865">	if (horizontal) {</a>
<a name="ln866">		BRect rect = targetFrame;</a>
<a name="ln867">		rect.top = rect.bottom + 1;</a>
<a name="ln868">		rect.bottom = rect.top + B_H_SCROLL_BAR_HEIGHT;</a>
<a name="ln869">		if (fBorder != B_NO_BORDER || vertical) {</a>
<a name="ln870">			// extend scrollbar so that it overlaps one pixel with vertical</a>
<a name="ln871">			// scrollbar</a>
<a name="ln872">			rect.right++;</a>
<a name="ln873">		}</a>
<a name="ln874"> </a>
<a name="ln875">		if (fBorder != B_NO_BORDER) {</a>
<a name="ln876">			// the scrollbar draws part of the surrounding frame on the left</a>
<a name="ln877">			rect.left--;</a>
<a name="ln878">		}</a>
<a name="ln879"> </a>
<a name="ln880">		fHorizontalScrollBar-&gt;MoveTo(rect.left, rect.top);</a>
<a name="ln881">		fHorizontalScrollBar-&gt;ResizeTo(rect.Width(), rect.Height());</a>
<a name="ln882">	}</a>
<a name="ln883"> </a>
<a name="ln884">	if (vertical) {</a>
<a name="ln885">		BRect rect = targetFrame;</a>
<a name="ln886">		rect.left = rect.right + 1;</a>
<a name="ln887">		rect.right = rect.left + B_V_SCROLL_BAR_WIDTH;</a>
<a name="ln888">		if (fBorder != B_NO_BORDER || horizontal) {</a>
<a name="ln889">			// extend scrollbar so that it overlaps one pixel with vertical</a>
<a name="ln890">			// scrollbar</a>
<a name="ln891">			rect.bottom++;</a>
<a name="ln892">		}</a>
<a name="ln893"> </a>
<a name="ln894">		if (fBorder != B_NO_BORDER) {</a>
<a name="ln895">			// the scrollbar draws part of the surrounding frame on the left</a>
<a name="ln896">			rect.top--;</a>
<a name="ln897">		}</a>
<a name="ln898"> </a>
<a name="ln899">		fVerticalScrollBar-&gt;MoveTo(rect.left, rect.top);</a>
<a name="ln900">		fVerticalScrollBar-&gt;ResizeTo(rect.Width(), rect.Height());</a>
<a name="ln901">	}</a>
<a name="ln902">}</a>
<a name="ln903"> </a>
<a name="ln904"> </a>
<a name="ln905">/*!	This static method is used to calculate the frame that the</a>
<a name="ln906">	ScrollView will cover depending on the frame of its target</a>
<a name="ln907">	and which border style is used.</a>
<a name="ln908">	It is used in the constructor and at other places.</a>
<a name="ln909">*/</a>
<a name="ln910">/*static*/ BRect</a>
<a name="ln911">BScrollView::_ComputeFrame(BRect frame, bool horizontal, bool vertical,</a>
<a name="ln912">	border_style border, uint32 borders)</a>
<a name="ln913">{</a>
<a name="ln914">	if (vertical)</a>
<a name="ln915">		frame.right += B_V_SCROLL_BAR_WIDTH;</a>
<a name="ln916">	if (horizontal)</a>
<a name="ln917">		frame.bottom += B_H_SCROLL_BAR_HEIGHT;</a>
<a name="ln918"> </a>
<a name="ln919">	_InsetBorders(frame, border, borders, true);</a>
<a name="ln920"> </a>
<a name="ln921">	if (_BorderSize(border) == 0) {</a>
<a name="ln922">		if (vertical)</a>
<a name="ln923">			frame.right++;</a>
<a name="ln924">		if (horizontal)</a>
<a name="ln925">			frame.bottom++;</a>
<a name="ln926">	}</a>
<a name="ln927"> </a>
<a name="ln928">	return frame;</a>
<a name="ln929">}</a>
<a name="ln930"> </a>
<a name="ln931"> </a>
<a name="ln932">/*static*/ BRect</a>
<a name="ln933">BScrollView::_ComputeFrame(BView *target, bool horizontal, bool vertical,</a>
<a name="ln934">	border_style border, uint32 borders)</a>
<a name="ln935">{</a>
<a name="ln936">	return _ComputeFrame(target != NULL ? target-&gt;Frame()</a>
<a name="ln937">		: BRect(0, 0, 16, 16), horizontal, vertical, border, borders);</a>
<a name="ln938">}</a>
<a name="ln939"> </a>
<a name="ln940"> </a>
<a name="ln941">/*! This method returns the size of the specified border.</a>
<a name="ln942">*/</a>
<a name="ln943">/*static*/ float</a>
<a name="ln944">BScrollView::_BorderSize(border_style border)</a>
<a name="ln945">{</a>
<a name="ln946">	if (border == B_FANCY_BORDER)</a>
<a name="ln947">		return kFancyBorderSize;</a>
<a name="ln948">	if (border == B_PLAIN_BORDER)</a>
<a name="ln949">		return kPlainBorderSize;</a>
<a name="ln950"> </a>
<a name="ln951">	return 0;</a>
<a name="ln952">}</a>
<a name="ln953"> </a>
<a name="ln954"> </a>
<a name="ln955">/*!	This method changes the &quot;flags&quot; argument as passed on to</a>
<a name="ln956">	the BView constructor.</a>
<a name="ln957">*/</a>
<a name="ln958">/*static*/ uint32</a>
<a name="ln959">BScrollView::_ModifyFlags(uint32 flags, BView* target, border_style border)</a>
<a name="ln960">{</a>
<a name="ln961">	if (target != NULL &amp;&amp; (target-&gt;Flags() &amp; B_SUPPORTS_LAYOUT) != 0</a>
<a name="ln962">			&amp;&amp; (target-&gt;Flags() &amp; B_SCROLL_VIEW_AWARE) == 0)</a>
<a name="ln963">		flags |= B_FRAME_EVENTS;</a>
<a name="ln964"> </a>
<a name="ln965">	// We either need B_FULL_UPDATE_ON_RESIZE or B_FRAME_EVENTS if we have</a>
<a name="ln966">	// to draw a border.</a>
<a name="ln967">	if (border != B_NO_BORDER) {</a>
<a name="ln968">		flags |= B_WILL_DRAW | ((flags &amp; B_FULL_UPDATE_ON_RESIZE) != 0 ?</a>
<a name="ln969">			0 : B_FRAME_EVENTS);</a>
<a name="ln970">	}</a>
<a name="ln971"> </a>
<a name="ln972">	return flags;</a>
<a name="ln973">}</a>
<a name="ln974"> </a>
<a name="ln975"> </a>
<a name="ln976">/*static*/ void</a>
<a name="ln977">BScrollView::_InsetBorders(BRect&amp; frame, border_style border, uint32 borders, bool expand)</a>
<a name="ln978">{</a>
<a name="ln979">	float borderSize = _BorderSize(border);</a>
<a name="ln980">	if (expand)</a>
<a name="ln981">		borderSize = -borderSize;</a>
<a name="ln982">	if ((borders &amp; BControlLook::B_LEFT_BORDER) != 0)</a>
<a name="ln983">		frame.left += borderSize;</a>
<a name="ln984">	if ((borders &amp; BControlLook::B_TOP_BORDER) != 0)</a>
<a name="ln985">		frame.top += borderSize;</a>
<a name="ln986">	if ((borders &amp; BControlLook::B_RIGHT_BORDER) != 0)</a>
<a name="ln987">		frame.right -= borderSize;</a>
<a name="ln988">	if ((borders &amp; BControlLook::B_BOTTOM_BORDER) != 0)</a>
<a name="ln989">		frame.bottom -= borderSize;</a>
<a name="ln990">}</a>
<a name="ln991"> </a>
<a name="ln992"> </a>
<a name="ln993">//	#pragma mark - FBC and forbidden</a>
<a name="ln994"> </a>
<a name="ln995"> </a>
<a name="ln996">BScrollView&amp;</a>
<a name="ln997">BScrollView::operator=(const BScrollView &amp;)</a>
<a name="ln998">{</a>
<a name="ln999">	return *this;</a>
<a name="ln1000">}</a>
<a name="ln1001"> </a>
<a name="ln1002"> </a>
<a name="ln1003">void BScrollView::_ReservedScrollView1() {}</a>
<a name="ln1004">void BScrollView::_ReservedScrollView2() {}</a>
<a name="ln1005">void BScrollView::_ReservedScrollView3() {}</a>
<a name="ln1006">void BScrollView::_ReservedScrollView4() {}</a>
<a name="ln1007"> </a>
<a name="ln1008"> </a>
<a name="ln1009">extern &quot;C&quot; void</a>
<a name="ln1010">B_IF_GCC_2(InvalidateLayout__11BScrollViewb,</a>
<a name="ln1011">	_ZN11BScrollView16InvalidateLayoutEb)(BScrollView* view, bool descendants)</a>
<a name="ln1012">{</a>
<a name="ln1013">	perform_data_layout_invalidated data;</a>
<a name="ln1014">	data.descendants = descendants;</a>
<a name="ln1015"> </a>
<a name="ln1016">	view-&gt;Perform(PERFORM_CODE_LAYOUT_INVALIDATED, &amp;data);</a>
<a name="ln1017">}</a>

</code></pre>
<div class="balloon" rel="53"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the constructor. Consider inspecting: fBorders, _reserved.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
