
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>unzip.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2">  Copyright (c) 1990-2002 Info-ZIP.  All rights reserved.</a>
<a name="ln3"> </a>
<a name="ln4">  See the accompanying file LICENSE, version 2000-Apr-09 or later</a>
<a name="ln5">  (the contents of which are also included in unzip.h) for terms of use.</a>
<a name="ln6">  If, for some reason, all these files are missing, the Info-ZIP license</a>
<a name="ln7">  also may be found at:  ftp://ftp.info-zip.org/pub/infozip/license.html</a>
<a name="ln8">*/</a>
<a name="ln9">/*---------------------------------------------------------------------------</a>
<a name="ln10"> </a>
<a name="ln11">  unzip.c</a>
<a name="ln12"> </a>
<a name="ln13">  UnZip - a zipfile extraction utility.  See below for make instructions, or</a>
<a name="ln14">  read the comments in Makefile and the various Contents files for more de-</a>
<a name="ln15">  tailed explanations.  To report a bug, send a *complete* description to</a>
<a name="ln16">  Zip-Bugs@lists.wku.edu; include machine type, operating system and ver-</a>
<a name="ln17">  sion, compiler and version, and reasonably detailed error messages or prob-</a>
<a name="ln18">  lem report.  To join Info-ZIP, see the instructions in README.</a>
<a name="ln19"> </a>
<a name="ln20">  UnZip 5.x is a greatly expanded and partially rewritten successor to 4.x,</a>
<a name="ln21">  which in turn was almost a complete rewrite of version 3.x.  For a detailed</a>
<a name="ln22">  revision history, see UnzpHist.zip at quest.jpl.nasa.gov.  For a list of</a>
<a name="ln23">  the many (near infinite) contributors, see &quot;CONTRIBS&quot; in the UnZip source</a>
<a name="ln24">  distribution.</a>
<a name="ln25"> </a>
<a name="ln26">  ---------------------------------------------------------------------------</a>
<a name="ln27"> </a>
<a name="ln28">  [from original zipinfo.c]</a>
<a name="ln29"> </a>
<a name="ln30">  This program reads great gobs of totally nifty information, including the</a>
<a name="ln31">  central directory stuff, from ZIP archives (&quot;zipfiles&quot; for short).  It</a>
<a name="ln32">  started as just a testbed for fooling with zipfiles, but at this point it</a>
<a name="ln33">  is actually a useful utility.  It also became the basis for the rewrite of</a>
<a name="ln34">  UnZip (3.16 -&gt; 4.0), using the central directory for processing rather than</a>
<a name="ln35">  the individual (local) file headers.</a>
<a name="ln36"> </a>
<a name="ln37">  As of ZipInfo v2.0 and UnZip v5.1, the two programs are combined into one.</a>
<a name="ln38">  If the executable is named &quot;unzip&quot; (or &quot;unzip.exe&quot;, depending), it behaves</a>
<a name="ln39">  like UnZip by default; if it is named &quot;zipinfo&quot; or &quot;ii&quot;, it behaves like</a>
<a name="ln40">  ZipInfo.  The ZipInfo behavior may also be triggered by use of unzip's -Z</a>
<a name="ln41">  option; for example, &quot;unzip -Z [zipinfo_options] archive.zip&quot;.</a>
<a name="ln42"> </a>
<a name="ln43">  Another dandy product from your buddies at Newtware!</a>
<a name="ln44"> </a>
<a name="ln45">  Author:  Greg Roelofs, newt@pobox.com, http://pobox.com/~newt/</a>
<a name="ln46">           23 August 1990 -&gt; April 1997</a>
<a name="ln47"> </a>
<a name="ln48">  ---------------------------------------------------------------------------</a>
<a name="ln49"> </a>
<a name="ln50">  Version:  unzip5??.{tar.Z | tar.gz | zip} for Unix, VMS, OS/2, MS-DOS, Amiga,</a>
<a name="ln51">              Atari, Windows 3.x/95/NT/CE, Macintosh, Human68K, Acorn RISC OS,</a>
<a name="ln52">              BeOS, SMS/QDOS, VM/CMS, MVS, AOS/VS, Tandem NSK, Theos and</a>
<a name="ln53">              TOPS-20.</a>
<a name="ln54"> </a>
<a name="ln55">  Copyrights:  see accompanying file &quot;LICENSE&quot; in UnZip source distribution.</a>
<a name="ln56">               (This software is free but NOT IN THE PUBLIC DOMAIN.)</a>
<a name="ln57"> </a>
<a name="ln58">  ---------------------------------------------------------------------------*/</a>
<a name="ln59"> </a>
<a name="ln60"> </a>
<a name="ln61"> </a>
<a name="ln62">#define __UNZIP_C       /* identifies this source module */</a>
<a name="ln63">#define UNZIP_INTERNAL</a>
<a name="ln64">#include &quot;unzip.h&quot;      /* includes, typedefs, macros, prototypes, etc. */</a>
<a name="ln65">#include &quot;crypt.h&quot;</a>
<a name="ln66">#include &quot;unzvers.h&quot;</a>
<a name="ln67"> </a>
<a name="ln68">#ifndef WINDLL          /* The WINDLL port uses windll/windll.c instead... */</a>
<a name="ln69"> </a>
<a name="ln70">/***************************/</a>
<a name="ln71">/* Local type declarations */</a>
<a name="ln72">/***************************/</a>
<a name="ln73"> </a>
<a name="ln74">#ifdef REENTRANT</a>
<a name="ln75">typedef struct _sign_info</a>
<a name="ln76">    {</a>
<a name="ln77">        struct _sign_info *previous;</a>
<a name="ln78">        void (*sighandler)(int);</a>
<a name="ln79">        int sigtype;</a>
<a name="ln80">    } savsigs_info;</a>
<a name="ln81">#endif</a>
<a name="ln82"> </a>
<a name="ln83">/*******************/</a>
<a name="ln84">/* Local Functions */</a>
<a name="ln85">/*******************/</a>
<a name="ln86"> </a>
<a name="ln87">#ifdef REENTRANT</a>
<a name="ln88">static int setsignalhandler OF((__GPRO__ savsigs_info **p_savedhandler_chain,</a>
<a name="ln89">                                int signal_type, void (*newhandler)(int)));</a>
<a name="ln90">#endif</a>
<a name="ln91">#ifndef SFX</a>
<a name="ln92">static void  show_version_info  OF((__GPRO));</a>
<a name="ln93">#endif</a>
<a name="ln94"> </a>
<a name="ln95"> </a>
<a name="ln96">/*************/</a>
<a name="ln97">/* Constants */</a>
<a name="ln98">/*************/</a>
<a name="ln99"> </a>
<a name="ln100">#include &quot;consts.h&quot;  /* all constant global variables are in here */</a>
<a name="ln101">                     /* (non-constant globals were moved to globals.c) */</a>
<a name="ln102"> </a>
<a name="ln103">/* constant local variables: */</a>
<a name="ln104"> </a>
<a name="ln105">#ifndef SFX</a>
<a name="ln106">   static ZCONST char Far EnvUnZip[] = ENV_UNZIP;</a>
<a name="ln107">   static ZCONST char Far EnvUnZip2[] = ENV_UNZIP2;</a>
<a name="ln108">   static ZCONST char Far EnvZipInfo[] = ENV_ZIPINFO;</a>
<a name="ln109">   static ZCONST char Far EnvZipInfo2[] = ENV_ZIPINFO2;</a>
<a name="ln110">#ifdef RISCOS</a>
<a name="ln111">   static ZCONST char Far EnvUnZipExts[] = ENV_UNZIPEXTS;</a>
<a name="ln112">#endif /* RISCOS */</a>
<a name="ln113">  static ZCONST char Far NoMemArguments[] =</a>
<a name="ln114">    &quot;envargs:  cannot get memory for arguments&quot;;</a>
<a name="ln115">#endif</a>
<a name="ln116"> </a>
<a name="ln117">#ifdef REENTRANT</a>
<a name="ln118">  static ZCONST char Far CantSaveSigHandler[] =</a>
<a name="ln119">    &quot;error:  cannot save signal handler settings\n&quot;;</a>
<a name="ln120">#endif</a>
<a name="ln121"> </a>
<a name="ln122">#if (!defined(SFX) || defined(SFX_EXDIR))</a>
<a name="ln123">   static ZCONST char Far NotExtracting[] =</a>
<a name="ln124">     &quot;caution:  not extracting; -d ignored\n&quot;;</a>
<a name="ln125">   static ZCONST char Far MustGiveExdir[] =</a>
<a name="ln126">     &quot;error:  must specify directory to which to extract with -d option\n&quot;;</a>
<a name="ln127">   static ZCONST char Far OnlyOneExdir[] =</a>
<a name="ln128">     &quot;error:  -d option used more than once (only one exdir allowed)\n&quot;;</a>
<a name="ln129">#endif</a>
<a name="ln130"> </a>
<a name="ln131">#if CRYPT</a>
<a name="ln132">   static ZCONST char Far MustGivePasswd[] =</a>
<a name="ln133">     &quot;error:  must give decryption password with -P option\n&quot;;</a>
<a name="ln134">#endif</a>
<a name="ln135"> </a>
<a name="ln136">#ifndef SFX</a>
<a name="ln137">   static ZCONST char Far Zfirst[] =</a>
<a name="ln138">   &quot;error:  -Z must be first option for ZipInfo mode (check UNZIP variable?)\n&quot;;</a>
<a name="ln139">#endif</a>
<a name="ln140">static ZCONST char Far InvalidOptionsMsg[] = &quot;error:\</a>
<a name="ln141">  -fn or any combination of -c, -l, -p, -t, -u and -v options invalid\n&quot;;</a>
<a name="ln142">static ZCONST char Far IgnoreOOptionMsg[] =</a>
<a name="ln143">  &quot;caution:  both -n and -o specified; ignoring -o\n&quot;;</a>
<a name="ln144"> </a>
<a name="ln145">/* usage() strings */</a>
<a name="ln146">#ifndef SFX</a>
<a name="ln147">#ifdef VMS</a>
<a name="ln148">   static ZCONST char Far Example3[] = &quot;vms.c&quot;;</a>
<a name="ln149">   static ZCONST char Far Example2[] = &quot;  unzip\</a>
<a name="ln150"> \&quot;-V\&quot; foo \&quot;Bar\&quot; =&gt; must quote uppercase options and filenames in VMS\n&quot;;</a>
<a name="ln151">#else /* !VMS */</a>
<a name="ln152">   static ZCONST char Far Example3[] = &quot;ReadMe&quot;;</a>
<a name="ln153">#ifdef RISCOS</a>
<a name="ln154">   static ZCONST char Far Example2[] =</a>
<a name="ln155">&quot;  unzip foo -d RAM:$   =&gt; extract all files from foo into RAMDisc\n&quot;;</a>
<a name="ln156">#else /* !RISCOS */</a>
<a name="ln157">#if (defined(OS2) || (defined(DOS_FLX_OS2_W32) &amp;&amp; defined(MORE)))</a>
<a name="ln158">   static ZCONST char Far Example2[] =</a>
<a name="ln159">     &quot;&quot;;                /* no room:  too many local3[] items */</a>
<a name="ln160">#else /* !OS2 */</a>
<a name="ln161">#ifdef MACOS</a>
<a name="ln162">   static ZCONST char Far Example2[] = &quot;&quot;; /* not needed */</a>
<a name="ln163">#else /* !MACOS */</a>
<a name="ln164">   static ZCONST char Far Example2[] = &quot; \</a>
<a name="ln165"> unzip -p foo | more  =&gt; send contents of foo.zip via pipe into program more\n&quot;;</a>
<a name="ln166">#endif /* ?MACOS */</a>
<a name="ln167">#endif /* ?OS2 */</a>
<a name="ln168">#endif /* ?RISCOS */</a>
<a name="ln169">#endif /* ?VMS */</a>
<a name="ln170"> </a>
<a name="ln171">/* local1[]:  command options */</a>
<a name="ln172">#if (defined(DLL) &amp;&amp; defined(API_DOC))</a>
<a name="ln173">   static ZCONST char Far local1[] =</a>
<a name="ln174">     &quot;  -A  print extended help for API functions&quot;;</a>
<a name="ln175">#else /* !(DLL &amp;&amp; API_DOC) */</a>
<a name="ln176">   static ZCONST char Far local1[] = &quot;&quot;;</a>
<a name="ln177">#endif /* ?(DLL &amp;&amp; API_DOC) */</a>
<a name="ln178"> </a>
<a name="ln179">/* local2[] and local3[]:  modifier options */</a>
<a name="ln180">#ifdef DOS_FLX_H68_OS2_W32</a>
<a name="ln181">#ifdef FLEXOS</a>
<a name="ln182">   static ZCONST char Far local2[] = &quot;&quot;;</a>
<a name="ln183">#else</a>
<a name="ln184">   static ZCONST char Far local2[] =</a>
<a name="ln185">     &quot; -$  label removables (-$$ =&gt; fixed disks)&quot;;</a>
<a name="ln186">#endif</a>
<a name="ln187">#ifdef OS2</a>
<a name="ln188">#ifdef MORE</a>
<a name="ln189">   static ZCONST char Far local3[] = &quot;\</a>
<a name="ln190">  -X  restore ACLs if supported              -s  spaces in filenames =&gt; '_'\n\</a>
<a name="ln191">                                             -M  pipe through \&quot;more\&quot; pager\n&quot;;</a>
<a name="ln192">#else</a>
<a name="ln193">   static ZCONST char Far local3[] = &quot; \</a>
<a name="ln194"> -X  restore ACLs if supported              -s  spaces in filenames =&gt; '_'\n\n&quot;;</a>
<a name="ln195">#endif /* ?MORE */</a>
<a name="ln196">#else /* !OS2 */</a>
<a name="ln197">#ifdef WIN32</a>
<a name="ln198">#ifdef NTSD_EAS</a>
<a name="ln199">#ifdef MORE</a>
<a name="ln200">   static ZCONST char Far local3[] = &quot;\</a>
<a name="ln201">  -X  restore ACLs (-XX =&gt; use privileges)   -s  spaces in filenames =&gt; '_'\n\</a>
<a name="ln202">                                             -M  pipe through \&quot;more\&quot; pager\n&quot;;</a>
<a name="ln203">#else</a>
<a name="ln204">   static ZCONST char Far local3[] = &quot; \</a>
<a name="ln205"> -X  restore ACLs (-XX =&gt; use privileges)   -s  spaces in filenames =&gt; '_'\n\n&quot;;</a>
<a name="ln206">#endif /* ?MORE */</a>
<a name="ln207">#else /* !NTSD_EAS */</a>
<a name="ln208">#ifdef MORE</a>
<a name="ln209">   static ZCONST char Far local3[] = &quot;\</a>
<a name="ln210">  -M  pipe through \&quot;more\&quot; pager            \</a>
<a name="ln211">  -s  spaces in filenames =&gt; '_'\n\n&quot;;</a>
<a name="ln212">#else</a>
<a name="ln213">   static ZCONST char Far local3[] = &quot; \</a>
<a name="ln214">                                            -s  spaces in filenames =&gt; '_'\n\n&quot;;</a>
<a name="ln215">#endif /* ?MORE */</a>
<a name="ln216">#endif /* ?NTSD_EAS */</a>
<a name="ln217">#else /* !WIN32 */</a>
<a name="ln218">#ifdef MORE</a>
<a name="ln219">   static ZCONST char Far local3[] = &quot;  -\</a>
<a name="ln220">M  pipe through \&quot;more\&quot; pager              -s  spaces in filenames =&gt; '_'\n\n&quot;;</a>
<a name="ln221">#else</a>
<a name="ln222">   static ZCONST char Far local3[] = &quot;\</a>
<a name="ln223">                                             -s  spaces in filenames =&gt; '_'\n&quot;;</a>
<a name="ln224">#endif</a>
<a name="ln225">#endif /* ?WIN32 */</a>
<a name="ln226">#endif /* ?OS2 || ?WIN32 */</a>
<a name="ln227">#else /* !DOS_FLX_OS2_W32 */</a>
<a name="ln228">#ifdef VMS</a>
<a name="ln229">   static ZCONST char Far local2[] = &quot;\&quot;-X\&quot; restore owner/protection info&quot;;</a>
<a name="ln230">#ifdef MORE</a>
<a name="ln231">   static ZCONST char Far local3[] = &quot;  \</a>
<a name="ln232">                                          \&quot;-M\&quot; pipe through \&quot;more\&quot; pager\n&quot;;</a>
<a name="ln233">#else</a>
<a name="ln234">   static ZCONST char Far local3[] = &quot;\n&quot;;</a>
<a name="ln235">#endif</a>
<a name="ln236">#else /* !VMS */</a>
<a name="ln237">#ifdef BEO_UNX</a>
<a name="ln238">   static ZCONST char Far local2[] = &quot; -X  restore UID/GID info&quot;;</a>
<a name="ln239">#ifdef MORE</a>
<a name="ln240">   static ZCONST char Far local3[] = &quot;\</a>
<a name="ln241">                                             -M  pipe through \&quot;more\&quot; pager\n&quot;;</a>
<a name="ln242">#else</a>
<a name="ln243">   static ZCONST char Far local3[] = &quot;\n&quot;;</a>
<a name="ln244">#endif</a>
<a name="ln245">#else /* !BEO_UNX */</a>
<a name="ln246">#ifdef TANDEM</a>
<a name="ln247">   static ZCONST char Far local2[] = &quot; -X  restore Tandem User ID&quot;;</a>
<a name="ln248">#ifdef MORE</a>
<a name="ln249">   static ZCONST char Far local3[] = &quot;\</a>
<a name="ln250">  -b  create 'C' (180) text files            -M  pipe through \&quot;more\&quot; pager\n&quot;;</a>
<a name="ln251">#else</a>
<a name="ln252">   static ZCONST char Far local3[] = &quot; -b  create 'C' (180) text files\n&quot;;</a>
<a name="ln253">#endif</a>
<a name="ln254">#else /* !TANDEM */</a>
<a name="ln255">#ifdef AMIGA</a>
<a name="ln256">   static ZCONST char Far local2[] = &quot; -N  restore comments as filenotes&quot;;</a>
<a name="ln257">#ifdef MORE</a>
<a name="ln258">   static ZCONST char Far local3[] = &quot; \</a>
<a name="ln259">                                            -M  pipe through \&quot;more\&quot; pager\n&quot;;</a>
<a name="ln260">#else</a>
<a name="ln261">   static ZCONST char Far local3[] = &quot;\n&quot;;</a>
<a name="ln262">#endif</a>
<a name="ln263">#else /* !AMIGA */</a>
<a name="ln264">#ifdef MACOS</a>
<a name="ln265">   static ZCONST char Far local2[] = &quot; -E  show Mac info during extraction&quot;;</a>
<a name="ln266">   static ZCONST char Far local3[] = &quot; \</a>
<a name="ln267"> -i  ignore filenames in mac extra info     -J  junk (ignore) Mac extra info\n\</a>
<a name="ln268">\n&quot;;</a>
<a name="ln269">#else /* !MACOS */</a>
<a name="ln270">#ifdef MORE</a>
<a name="ln271">   static ZCONST char Far local2[] = &quot; -M  pipe through \&quot;more\&quot; pager&quot;;</a>
<a name="ln272">   static ZCONST char Far local3[] = &quot;\n&quot;;</a>
<a name="ln273">#else</a>
<a name="ln274">   static ZCONST char Far local2[] = &quot;&quot;;   /* Atari, Mac, CMS/MVS etc. */</a>
<a name="ln275">   static ZCONST char Far local3[] = &quot;&quot;;</a>
<a name="ln276">#endif</a>
<a name="ln277">#endif /* ?MACOS */</a>
<a name="ln278">#endif /* ?AMIGA */</a>
<a name="ln279">#endif /* ?TANDEM */</a>
<a name="ln280">#endif /* ?BEO_UNX */</a>
<a name="ln281">#endif /* ?VMS */</a>
<a name="ln282">#endif /* ?DOS_FLX_OS2_W32 */</a>
<a name="ln283">#endif /* !SFX */</a>
<a name="ln284"> </a>
<a name="ln285">#ifndef NO_ZIPINFO</a>
<a name="ln286">#ifdef VMS</a>
<a name="ln287">   static ZCONST char Far ZipInfoExample[] = &quot;* or % (e.g., \&quot;*font-%.zip\&quot;)&quot;;</a>
<a name="ln288">#else</a>
<a name="ln289">   static ZCONST char Far ZipInfoExample[] = &quot;*, ?, [] (e.g., \&quot;[a-j]*.zip\&quot;)&quot;;</a>
<a name="ln290">#endif</a>
<a name="ln291"> </a>
<a name="ln292">static ZCONST char Far ZipInfoUsageLine1[] = &quot;\</a>
<a name="ln293">ZipInfo %d.%d%d%s of %s, by Greg Roelofs and the Info-ZIP group.\n\</a>
<a name="ln294">\n\</a>
<a name="ln295">List name, date/time, attribute, size, compression method, etc., about files\n\</a>
<a name="ln296">in list (excluding those in xlist) contained in the specified .zip archive(s).\</a>
<a name="ln297">\n\&quot;file[.zip]\&quot; may be a wildcard name containing %s.\n\n\</a>
<a name="ln298">   usage:  zipinfo [-12smlvChMtTz] file[.zip] [list...] [-x xlist...]\n\</a>
<a name="ln299">      or:  unzip %s-Z%s [-12smlvChMtTz] file[.zip] [list...] [-x xlist...]\n&quot;;</a>
<a name="ln300"> </a>
<a name="ln301">static ZCONST char Far ZipInfoUsageLine2[] = &quot;\nmain\</a>
<a name="ln302"> listing-format options:             -s  short Unix \&quot;ls -l\&quot; format (def.)\n\</a>
<a name="ln303">  -1  filenames ONLY, one per line       -m  medium Unix \&quot;ls -l\&quot; format\n\</a>
<a name="ln304">  -2  just filenames but allow -h/-t/-z  -l  long Unix \&quot;ls -l\&quot; format\n\</a>
<a name="ln305">                                         -v  verbose, multi-page format\n&quot;;</a>
<a name="ln306"> </a>
<a name="ln307">static ZCONST char Far ZipInfoUsageLine3[] = &quot;miscellaneous options:\n\</a>
<a name="ln308">  -h  print header line       -t  print totals for listed files or for all\n\</a>
<a name="ln309">  -z  print zipfile comment  %c-T%c print file times in sortable decimal format\</a>
<a name="ln310">\n %c-C%c be case-insensitive   %s\</a>
<a name="ln311">  -x  exclude filenames that follow from listing\n&quot;;</a>
<a name="ln312">#ifdef MORE</a>
<a name="ln313">#ifdef VMS</a>
<a name="ln314">   static ZCONST char Far ZipInfoUsageLine4[] =</a>
<a name="ln315">     &quot; \&quot;-M\&quot; page output through built-in \&quot;more\&quot;\n&quot;;</a>
<a name="ln316">#else</a>
<a name="ln317">   static ZCONST char Far ZipInfoUsageLine4[] =</a>
<a name="ln318">     &quot;  -M  page output through built-in \&quot;more\&quot;\n&quot;;</a>
<a name="ln319">#endif</a>
<a name="ln320">#else /* !MORE */</a>
<a name="ln321">   static ZCONST char Far ZipInfoUsageLine4[] = &quot;&quot;;</a>
<a name="ln322">#endif /* ?MORE */</a>
<a name="ln323">#endif /* !NO_ZIPINFO */</a>
<a name="ln324"> </a>
<a name="ln325">#ifdef BETA</a>
<a name="ln326">#  ifdef VMSCLI</a>
<a name="ln327">   /* BetaVersion[] is also used in vms/cmdline.c:  do not make it static */</a>
<a name="ln328">     ZCONST char Far BetaVersion[] = &quot;%s\</a>
<a name="ln329">        THIS IS STILL A BETA VERSION OF UNZIP%s -- DO NOT DISTRIBUTE.\n\n&quot;;</a>
<a name="ln330">#  else</a>
<a name="ln331">     static ZCONST char Far BetaVersion[] = &quot;%s\</a>
<a name="ln332">        THIS IS STILL A BETA VERSION OF UNZIP%s -- DO NOT DISTRIBUTE.\n\n&quot;;</a>
<a name="ln333">#  endif</a>
<a name="ln334">#endif</a>
<a name="ln335"> </a>
<a name="ln336">#ifdef SFX</a>
<a name="ln337">#  ifdef VMSCLI</a>
<a name="ln338">   /* UnzipSFXBanner[] is also used in vms/cmdline.c:  do not make it static */</a>
<a name="ln339">     ZCONST char Far UnzipSFXBanner[] =</a>
<a name="ln340">#  else</a>
<a name="ln341">     static ZCONST char Far UnzipSFXBanner[] =</a>
<a name="ln342">#  endif</a>
<a name="ln343">     &quot;UnZipSFX %d.%d%d%s of %s, by Info-ZIP (Zip-Bugs@lists.wku.edu).\n&quot;;</a>
<a name="ln344">#  ifdef SFX_EXDIR</a>
<a name="ln345">     static ZCONST char Far UnzipSFXOpts[] =</a>
<a name="ln346">    &quot;Valid options are -tfupcz and -d &lt;exdir&gt;; modifiers are -abjnoqCL%sV%s.\n&quot;;</a>
<a name="ln347">#  else</a>
<a name="ln348">     static ZCONST char Far UnzipSFXOpts[] =</a>
<a name="ln349">       &quot;Valid options are -tfupcz; modifiers are -abjnoqCL%sV%s.\n&quot;;</a>
<a name="ln350">#  endif</a>
<a name="ln351">#else /* !SFX */</a>
<a name="ln352">   static ZCONST char Far CompileOptions[] =</a>
<a name="ln353">     &quot;UnZip special compilation options:\n&quot;;</a>
<a name="ln354">   static ZCONST char Far CompileOptFormat[] = &quot;\t%s\n&quot;;</a>
<a name="ln355">   static ZCONST char Far EnvOptions[] =</a>
<a name="ln356">     &quot;\nUnZip and ZipInfo environment options:\n&quot;;</a>
<a name="ln357">   static ZCONST char Far EnvOptFormat[] = &quot;%16s:  %s\n&quot;;</a>
<a name="ln358">   static ZCONST char Far None[] = &quot;[none]&quot;;</a>
<a name="ln359">#  ifdef ACORN_FTYPE_NFS</a>
<a name="ln360">     static ZCONST char Far AcornFtypeNFS[] = &quot;ACORN_FTYPE_NFS&quot;;</a>
<a name="ln361">#  endif</a>
<a name="ln362">#  ifdef ASM_CRC</a>
<a name="ln363">     static ZCONST char Far AsmCRC[] = &quot;ASM_CRC&quot;;</a>
<a name="ln364">#  endif</a>
<a name="ln365">#  ifdef ASM_INFLATECODES</a>
<a name="ln366">     static ZCONST char Far AsmInflateCodes[] = &quot;ASM_INFLATECODES&quot;;</a>
<a name="ln367">#  endif</a>
<a name="ln368">#  ifdef CHECK_VERSIONS</a>
<a name="ln369">     static ZCONST char Far Check_Versions[] = &quot;CHECK_VERSIONS&quot;;</a>
<a name="ln370">#  endif</a>
<a name="ln371">#  ifdef COPYRIGHT_CLEAN</a>
<a name="ln372">     static ZCONST char Far Copyright_Clean[] =</a>
<a name="ln373">     &quot;COPYRIGHT_CLEAN (PKZIP 0.9x unreducing method not supported)&quot;;</a>
<a name="ln374">#  endif</a>
<a name="ln375">#  ifdef DEBUG</a>
<a name="ln376">     static ZCONST char Far UDebug[] = &quot;DEBUG&quot;;</a>
<a name="ln377">#  endif</a>
<a name="ln378">#  ifdef DEBUG_TIME</a>
<a name="ln379">     static ZCONST char Far DebugTime[] = &quot;DEBUG_TIME&quot;;</a>
<a name="ln380">#  endif</a>
<a name="ln381">#  ifdef DLL</a>
<a name="ln382">     static ZCONST char Far Dll[] = &quot;DLL&quot;;</a>
<a name="ln383">#  endif</a>
<a name="ln384">#  ifdef DOSWILD</a>
<a name="ln385">     static ZCONST char Far DosWild[] = &quot;DOSWILD&quot;;</a>
<a name="ln386">#  endif</a>
<a name="ln387">#  ifdef LZW_CLEAN</a>
<a name="ln388">     static ZCONST char Far LZW_Clean[] =</a>
<a name="ln389">     &quot;LZW_CLEAN (PKZIP/Zip 1.x unshrinking method not supported)&quot;;</a>
<a name="ln390">#  endif</a>
<a name="ln391">#  ifndef MORE</a>
<a name="ln392">     static ZCONST char Far No_More[] = &quot;NO_MORE&quot;;</a>
<a name="ln393">#  endif</a>
<a name="ln394">#  ifdef NO_ZIPINFO</a>
<a name="ln395">     static ZCONST char Far No_ZipInfo[] = &quot;NO_ZIPINFO&quot;;</a>
<a name="ln396">#  endif</a>
<a name="ln397">#  ifdef NTSD_EAS</a>
<a name="ln398">     static ZCONST char Far NTSDExtAttrib[] = &quot;NTSD_EAS&quot;;</a>
<a name="ln399">#  endif</a>
<a name="ln400">#  ifdef OLD_THEOS_EXTRA</a>
<a name="ln401">     static ZCONST char Far OldTheosExtra[] =</a>
<a name="ln402">     &quot;OLD_THEOS_EXTRA (handle also old Theos port extra field)&quot;;</a>
<a name="ln403">#  endif</a>
<a name="ln404">#  ifdef OS2_EAS</a>
<a name="ln405">     static ZCONST char Far OS2ExtAttrib[] = &quot;OS2_EAS&quot;;</a>
<a name="ln406">#  endif</a>
<a name="ln407">#  ifdef QLZIP</a>
<a name="ln408">     static ZCONST char Far SMSExFldOnUnix[] = &quot;QLZIP&quot;;</a>
<a name="ln409">#  endif</a>
<a name="ln410">#  ifdef REENTRANT</a>
<a name="ln411">     static ZCONST char Far Reentrant[] = &quot;REENTRANT&quot;;</a>
<a name="ln412">#  endif</a>
<a name="ln413">#  ifdef REGARGS</a>
<a name="ln414">     static ZCONST char Far RegArgs[] = &quot;REGARGS&quot;;</a>
<a name="ln415">#  endif</a>
<a name="ln416">#  ifdef RETURN_CODES</a>
<a name="ln417">     static ZCONST char Far Return_Codes[] = &quot;RETURN_CODES&quot;;</a>
<a name="ln418">#  endif</a>
<a name="ln419">#  ifdef SET_DIR_ATTRIB</a>
<a name="ln420">     static ZCONST char Far SetDirAttrib[] = &quot;SET_DIR_ATTRIB&quot;;</a>
<a name="ln421">#  endif</a>
<a name="ln422">#  ifdef TIMESTAMP</a>
<a name="ln423">     static ZCONST char Far TimeStamp[] = &quot;TIMESTAMP&quot;;</a>
<a name="ln424">#  endif</a>
<a name="ln425">#  ifdef UNIXBACKUP</a>
<a name="ln426">     static ZCONST char Far UnixBackup[] = &quot;UNIXBACKUP&quot;;</a>
<a name="ln427">#  endif</a>
<a name="ln428">#  ifdef USE_EF_UT_TIME</a>
<a name="ln429">     static ZCONST char Far Use_EF_UT_time[] = &quot;USE_EF_UT_TIME&quot;;</a>
<a name="ln430">#  endif</a>
<a name="ln431">#  ifndef LZW_CLEAN</a>
<a name="ln432">     static ZCONST char Far Use_Unshrink[] =</a>
<a name="ln433">     &quot;USE_UNSHRINK (PKZIP/Zip 1.x unshrinking method supported)&quot;;</a>
<a name="ln434">#  endif</a>
<a name="ln435">#  ifndef COPYRIGHT_CLEAN</a>
<a name="ln436">     static ZCONST char Far Use_Smith_Code[] =</a>
<a name="ln437">     &quot;USE_SMITH_CODE (PKZIP 0.9x unreducing method supported)&quot;;</a>
<a name="ln438">#  endif</a>
<a name="ln439">#  ifdef USE_DEFLATE64</a>
<a name="ln440">     static ZCONST char Far Use_Deflate64[] =</a>
<a name="ln441">     &quot;USE_DEFLATE64 (PKZIP 4.x Deflate64(tm) supported)&quot;;</a>
<a name="ln442">#  endif</a>
<a name="ln443">#  ifdef MULT_VOLUME</a>
<a name="ln444">     static ZCONST char Far Use_MultiVol[] =</a>
<a name="ln445">     &quot;MULT_VOLUME (multi-volume archives supported)&quot;;</a>
<a name="ln446">#  endif</a>
<a name="ln447">#  if (defined(__DJGPP__) &amp;&amp; (__DJGPP__ &gt;= 2))</a>
<a name="ln448">#    ifdef USE_DJGPP_ENV</a>
<a name="ln449">       static ZCONST char Far Use_DJGPP_Env[] = &quot;USE_DJGPP_ENV&quot;;</a>
<a name="ln450">#    endif</a>
<a name="ln451">#    ifdef USE_DJGPP_GLOB</a>
<a name="ln452">       static ZCONST char Far Use_DJGPP_Glob[] = &quot;USE_DJGPP_GLOB&quot;;</a>
<a name="ln453">#    endif</a>
<a name="ln454">#  endif /* __DJGPP__ &amp;&amp; (__DJGPP__ &gt;= 2) */</a>
<a name="ln455">#  ifdef USE_VFAT</a>
<a name="ln456">     static ZCONST char Far Use_VFAT_support[] = &quot;USE_VFAT&quot;;</a>
<a name="ln457">#  endif</a>
<a name="ln458">#  ifdef USE_ZLIB</a>
<a name="ln459">     static ZCONST char Far UseZlib[] =</a>
<a name="ln460">     &quot;USE_ZLIB (compiled with version %s; using version %s)&quot;;</a>
<a name="ln461">#  endif</a>
<a name="ln462">#  ifdef VMS_TEXT_CONV</a>
<a name="ln463">     static ZCONST char Far VmsTextConv[] = &quot;VMS_TEXT_CONV&quot;;</a>
<a name="ln464">#  endif</a>
<a name="ln465">#  ifdef VMSCLI</a>
<a name="ln466">     static ZCONST char Far VmsCLI[] = &quot;VMSCLI&quot;;</a>
<a name="ln467">#  endif</a>
<a name="ln468">#  ifdef VMSWILD</a>
<a name="ln469">     static ZCONST char Far VmsWild[] = &quot;VMSWILD&quot;;</a>
<a name="ln470">#  endif</a>
<a name="ln471">#  ifdef WILD_STOP_AT_DIR</a>
<a name="ln472">     static ZCONST char Far WildStopAtDir[] = &quot;WILD_STOP_AT_DIR&quot;;</a>
<a name="ln473">#  endif</a>
<a name="ln474">#  if CRYPT</a>
<a name="ln475">#    ifdef PASSWD_FROM_STDIN</a>
<a name="ln476">       static ZCONST char Far PasswdStdin[] = &quot;PASSWD_FROM_STDIN&quot;;</a>
<a name="ln477">#    endif</a>
<a name="ln478">     static ZCONST char Far Decryption[] =</a>
<a name="ln479">       &quot;\t[decryption, version %d.%d%s of %s]\n&quot;;</a>
<a name="ln480">     static ZCONST char Far CryptDate[] = CR_VERSION_DATE;</a>
<a name="ln481">#  endif</a>
<a name="ln482">#  ifndef __RSXNT__</a>
<a name="ln483">#    ifdef __EMX__</a>
<a name="ln484">       static ZCONST char Far EnvEMX[] = &quot;EMX&quot;;</a>
<a name="ln485">       static ZCONST char Far EnvEMXOPT[] = &quot;EMXOPT&quot;;</a>
<a name="ln486">#    endif</a>
<a name="ln487">#    if (defined(__GO32__) &amp;&amp; (!defined(__DJGPP__) || (__DJGPP__ &lt; 2)))</a>
<a name="ln488">       static ZCONST char Far EnvGO32[] = &quot;GO32&quot;;</a>
<a name="ln489">       static ZCONST char Far EnvGO32TMP[] = &quot;GO32TMP&quot;;</a>
<a name="ln490">#    endif</a>
<a name="ln491">#  endif /* !__RSXNT__ */</a>
<a name="ln492"> </a>
<a name="ln493">#ifdef VMS</a>
<a name="ln494">/* UnzipUsageLine1[] is also used in vms/cmdline.c:  do not make it static */</a>
<a name="ln495">   ZCONST char Far UnzipUsageLine1[] = &quot;\</a>
<a name="ln496">UnZip %d.%d%d%s of %s, by Info-ZIP.  For more details see: unzip -v.\n\n&quot;;</a>
<a name="ln497">#ifdef COPYRIGHT_CLEAN</a>
<a name="ln498">   static ZCONST char Far UnzipUsageLine1v[] = &quot;\</a>
<a name="ln499">UnZip %d.%d%d%s of %s, by Info-ZIP.  Maintained by C. Spieler.  Send\n\</a>
<a name="ln500">bug reports to the authors at Zip-Bugs@lists.wku.edu; see README for details.\</a>
<a name="ln501">\n\n&quot;;</a>
<a name="ln502">#else</a>
<a name="ln503">   static ZCONST char Far UnzipUsageLine1v[] = &quot;\</a>
<a name="ln504">UnZip %d.%d%d%s of %s, by Info-ZIP.  UnReduce (c) 1989 by S. H. Smith.\n\</a>
<a name="ln505">Send bug reports to authors at Zip-Bugs@lists.wku.edu; see README for details.\</a>
<a name="ln506">\n\n&quot;;</a>
<a name="ln507">#endif /* ?COPYRIGHT_CLEAN */</a>
<a name="ln508">#else /* !VMS */</a>
<a name="ln509">#ifdef COPYRIGHT_CLEAN</a>
<a name="ln510">   static ZCONST char Far UnzipUsageLine1[] = &quot;\</a>
<a name="ln511">UnZip %d.%d%d%s of %s, by Info-ZIP.  Maintained by C. Spieler.  Send\n\</a>
<a name="ln512">bug reports to the authors at Zip-Bugs@lists.wku.edu; see README for details.\</a>
<a name="ln513">\n\n&quot;;</a>
<a name="ln514">#else</a>
<a name="ln515">   static ZCONST char Far UnzipUsageLine1[] = &quot;\</a>
<a name="ln516">UnZip %d.%d%d%s of %s, by Info-ZIP.  UnReduce (c) 1989 by S. H. Smith.\n\</a>
<a name="ln517">Send bug reports to authors at Zip-Bugs@lists.wku.edu; see README for details.\</a>
<a name="ln518">\n\n&quot;;</a>
<a name="ln519">#endif /* ?COPYRIGHT_CLEAN */</a>
<a name="ln520">#define UnzipUsageLine1v        UnzipUsageLine1</a>
<a name="ln521">#endif /* ?VMS */</a>
<a name="ln522"> </a>
<a name="ln523">static ZCONST char Far UnzipUsageLine2v[] = &quot;\</a>
<a name="ln524">Latest sources and executables are at ftp://ftp.info-zip.org/pub/infozip/ ;\</a>
<a name="ln525">\nsee ftp://ftp.info-zip.org/pub/infozip/UnZip.html for other sites.\</a>
<a name="ln526">\n\n&quot;;</a>
<a name="ln527"> </a>
<a name="ln528">#ifdef MACOS</a>
<a name="ln529">static ZCONST char Far UnzipUsageLine2[] = &quot;\</a>
<a name="ln530">Usage: unzip %s[-opts[modifiers]] file[.zip] [list] [-d exdir]\n \</a>
<a name="ln531"> Default action is to extract files in list, to exdir;\n\</a>
<a name="ln532">  file[.zip] may be a wildcard.  %s\n&quot;;</a>
<a name="ln533">#else /* !MACOS */</a>
<a name="ln534">#ifdef VM_CMS</a>
<a name="ln535">static ZCONST char Far UnzipUsageLine2[] = &quot;\</a>
<a name="ln536">Usage: unzip %s[-opts[modifiers]] file[.zip] [list] [-x xlist] [-d fm]\n \</a>
<a name="ln537"> Default action is to extract files in list, except those in xlist, to disk fm;\</a>
<a name="ln538">\n  file[.zip] may be a wildcard.  %s\n&quot;;</a>
<a name="ln539">#else /* !VM_CMS */</a>
<a name="ln540">static ZCONST char Far UnzipUsageLine2[] = &quot;\</a>
<a name="ln541">Usage: unzip %s[-opts[modifiers]] file[.zip] [list] [-x xlist] [-d exdir]\n \</a>
<a name="ln542"> Default action is to extract files in list, except those in xlist, to exdir;\n\</a>
<a name="ln543">  file[.zip] may be a wildcard.  %s\n&quot;;</a>
<a name="ln544">#endif /* ?VM_CMS */</a>
<a name="ln545">#endif /* ?MACOS */</a>
<a name="ln546"> </a>
<a name="ln547">#ifdef NO_ZIPINFO</a>
<a name="ln548">#  define ZIPINFO_MODE_OPTION  &quot;&quot;</a>
<a name="ln549">   static ZCONST char Far ZipInfoMode[] =</a>
<a name="ln550">     &quot;(ZipInfo mode is disabled in this version.)&quot;;</a>
<a name="ln551">#else</a>
<a name="ln552">#  define ZIPINFO_MODE_OPTION  &quot;[-Z] &quot;</a>
<a name="ln553">#  ifdef VMS</a>
<a name="ln554">     static ZCONST char Far ZipInfoMode[] =</a>
<a name="ln555">       &quot;\&quot;-Z\&quot; =&gt; ZipInfo mode (`unzip \&quot;-Z\&quot;' for usage).&quot;;</a>
<a name="ln556">#  else</a>
<a name="ln557">     static ZCONST char Far ZipInfoMode[] =</a>
<a name="ln558">       &quot;-Z =&gt; ZipInfo mode (\&quot;unzip -Z\&quot; for usage).&quot;;</a>
<a name="ln559">#  endif</a>
<a name="ln560">#endif /* ?NO_ZIPINFO */</a>
<a name="ln561"> </a>
<a name="ln562">#ifdef VMS</a>
<a name="ln563">   static ZCONST char Far VMSusageLine2b[] = &quot;\</a>
<a name="ln564">=&gt; define foreign command symbol in LOGIN.COM:  $ unzip :== $dev:[dir]unzip.exe\</a>
<a name="ln565">\n&quot;;</a>
<a name="ln566">#endif</a>
<a name="ln567"> </a>
<a name="ln568">#ifdef MACOS</a>
<a name="ln569">static ZCONST char Far UnzipUsageLine3[] = &quot;\n\</a>
<a name="ln570">  -d  extract files into exdir               -l  list files (short format)\n\</a>
<a name="ln571">  -f  freshen existing files, create none    -t  test compressed archive data\n\</a>
<a name="ln572">  -u  update files, create if necessary      -z  display archive comment\n\</a>
<a name="ln573">%s\n&quot;;</a>
<a name="ln574">#else /* !MACOS */</a>
<a name="ln575">#ifdef VM_CMS</a>
<a name="ln576">static ZCONST char Far UnzipUsageLine3[] = &quot;\n\</a>
<a name="ln577">  -p  extract files to pipe, no messages     -l  list files (short format)\n\</a>
<a name="ln578">  -f  freshen existing files, create none    -t  test compressed archive data\n\</a>
<a name="ln579">  -u  update files, create if necessary      -z  display archive comment\n\</a>
<a name="ln580">  -x  exclude files that follow (in xlist)   -d  extract files onto disk fm\n\</a>
<a name="ln581">%s\n&quot;;</a>
<a name="ln582">#else /* !VM_CMS */</a>
<a name="ln583">static ZCONST char Far UnzipUsageLine3[] = &quot;\n\</a>
<a name="ln584">  -p  extract files to pipe, no messages     -l  list files (short format)\n\</a>
<a name="ln585">  -f  freshen existing files, create none    -t  test compressed archive data\n\</a>
<a name="ln586">  -u  update files, create if necessary      -z  display archive comment\n\</a>
<a name="ln587">  -x  exclude files that follow (in xlist)   -d  extract files into exdir\n\</a>
<a name="ln588">%s\n&quot;;</a>
<a name="ln589">#endif /* ?VM_CMS */</a>
<a name="ln590">#endif /* ?MACOS */</a>
<a name="ln591"> </a>
<a name="ln592">static ZCONST char Far UnzipUsageLine4[] = &quot;\</a>
<a name="ln593">modifiers:                                   -q  quiet mode (-qq =&gt; quieter)\n\</a>
<a name="ln594">  -n  never overwrite existing files         -a  auto-convert any text files\n\</a>
<a name="ln595">  -o  overwrite files WITHOUT prompting      -aa treat ALL files as text\n \</a>
<a name="ln596"> -j  junk paths (do not make directories)   -v  be verbose/print version info\n\</a>
<a name="ln597"> %c-C%c match filenames case-insensitively    %c-L%c make (some) names \</a>
<a name="ln598">lowercase\n %-42s %c-V%c retain VMS version numbers\n%s&quot;;</a>
<a name="ln599"> </a>
<a name="ln600">static ZCONST char Far UnzipUsageLine5[] = &quot;\</a>
<a name="ln601">Examples (see unzip.txt for more info):\n\</a>
<a name="ln602">  unzip data1 -x joe   =&gt; extract all files except joe from zipfile data1.zip\n\</a>
<a name="ln603">%s\</a>
<a name="ln604">  unzip -fo foo %-6s =&gt; quietly replace existing %s if archive file newer\n&quot;;</a>
<a name="ln605">#endif /* ?SFX */</a>
<a name="ln606"> </a>
<a name="ln607"> </a>
<a name="ln608"> </a>
<a name="ln609"> </a>
<a name="ln610"> </a>
<a name="ln611">/*****************************/</a>
<a name="ln612">/*  main() / UzpMain() stub  */</a>
<a name="ln613">/*****************************/</a>
<a name="ln614"> </a>
<a name="ln615">int MAIN(argc, argv)   /* return PK-type error code (except under VMS) */</a>
<a name="ln616">    int argc;</a>
<a name="ln617">    char *argv[];</a>
<a name="ln618">{</a>
<a name="ln619">    int r;</a>
<a name="ln620"> </a>
<a name="ln621">    CONSTRUCTGLOBALS();</a>
<a name="ln622">    r = unzip(__G__ argc, argv);</a>
<a name="ln623">    DESTROYGLOBALS();</a>
<a name="ln624">    RETURN(r);</a>
<a name="ln625">}</a>
<a name="ln626"> </a>
<a name="ln627"> </a>
<a name="ln628"> </a>
<a name="ln629"> </a>
<a name="ln630">/*******************************/</a>
<a name="ln631">/*  Primary UnZip entry point  */</a>
<a name="ln632">/*******************************/</a>
<a name="ln633"> </a>
<a name="ln634">int unzip(__G__ argc, argv)</a>
<a name="ln635">    __GDEF</a>
<a name="ln636">    int argc;</a>
<a name="ln637">    char *argv[];</a>
<a name="ln638">{</a>
<a name="ln639">#ifndef NO_ZIPINFO</a>
<a name="ln640">    char *p;</a>
<a name="ln641">#endif</a>
<a name="ln642">#ifdef DOS_FLX_H68_NLM_OS2_W32</a>
<a name="ln643">    int i;</a>
<a name="ln644">#endif</a>
<a name="ln645">    int retcode, error=FALSE;</a>
<a name="ln646">#ifdef REENTRANT</a>
<a name="ln647">    savsigs_info *oldsighandlers = NULL;</a>
<a name="ln648">#   define SET_SIGHANDLER(sigtype, newsighandler) \</a>
<a name="ln649">      if ((retcode = setsignalhandler(__G__ &amp;oldsighandlers, (sigtype), \</a>
<a name="ln650">                                      (newsighandler))) &gt; PK_WARN) \</a>
<a name="ln651">          goto cleanup_and_exit</a>
<a name="ln652">#else</a>
<a name="ln653">#   define SET_SIGHANDLER(sigtype, newsighandler) \</a>
<a name="ln654">      signal((sigtype), (newsighandler))</a>
<a name="ln655">#endif</a>
<a name="ln656"> </a>
<a name="ln657">    SETLOCALE(LC_CTYPE,&quot;&quot;);</a>
<a name="ln658"> </a>
<a name="ln659">#if (defined(__IBMC__) &amp;&amp; defined(__DEBUG_ALLOC__))</a>
<a name="ln660">    extern void DebugMalloc(void);</a>
<a name="ln661"> </a>
<a name="ln662">    atexit(DebugMalloc);</a>
<a name="ln663">#endif</a>
<a name="ln664"> </a>
<a name="ln665">#ifdef MALLOC_WORK</a>
<a name="ln666">    /* The following (rather complex) expression determines the allocation</a>
<a name="ln667">       size of the decompression work area.  It simulates what the</a>
<a name="ln668">       combined &quot;union&quot; and &quot;struct&quot; declaration of the &quot;static&quot; work</a>
<a name="ln669">       area reservation achieves automatically at compile time.</a>
<a name="ln670">       Any decent compiler should evaluate this expression completely at</a>
<a name="ln671">       compile time and provide constants to the zcalloc() call.</a>
<a name="ln672">       (For better readability, some subexpressions are encapsulated</a>
<a name="ln673">       in temporarly defined macros.)</a>
<a name="ln674">     */</a>
<a name="ln675">#   define UZ_SLIDE_CHUNK (sizeof(shrint)+sizeof(uch)+sizeof(uch))</a>
<a name="ln676">#   define UZ_NUMOF_CHUNKS \</a>
<a name="ln677">      (unsigned)(((WSIZE+UZ_SLIDE_CHUNK-1)/UZ_SLIDE_CHUNK &gt; HSIZE) ? \</a>
<a name="ln678">                 (WSIZE+UZ_SLIDE_CHUNK-1)/UZ_SLIDE_CHUNK : HSIZE)</a>
<a name="ln679">    G.area.Slide = (uch *)zcalloc(UZ_NUMOF_CHUNKS, UZ_SLIDE_CHUNK);</a>
<a name="ln680">#   undef UZ_SLIDE_CHUNK</a>
<a name="ln681">#   undef UZ_NUMOF_CHUNKS</a>
<a name="ln682">    G.area.shrink.Parent = (shrint *)G.area.Slide;</a>
<a name="ln683">    G.area.shrink.value = G.area.Slide + (sizeof(shrint)*(HSIZE));</a>
<a name="ln684">    G.area.shrink.Stack = G.area.Slide +</a>
<a name="ln685">                           (sizeof(shrint) + sizeof(uch))*(HSIZE);</a>
<a name="ln686">#endif</a>
<a name="ln687"> </a>
<a name="ln688">/*---------------------------------------------------------------------------</a>
<a name="ln689">    Set signal handler for restoring echo, warn of zipfile corruption, etc.</a>
<a name="ln690">  ---------------------------------------------------------------------------*/</a>
<a name="ln691"> </a>
<a name="ln692">#ifdef SIGINT</a>
<a name="ln693">    SET_SIGHANDLER(SIGINT, handler);</a>
<a name="ln694">#endif</a>
<a name="ln695">#ifdef SIGTERM                 /* some systems really have no SIGTERM */</a>
<a name="ln696">    SET_SIGHANDLER(SIGTERM, handler);</a>
<a name="ln697">#endif</a>
<a name="ln698">#ifdef SIGBUS</a>
<a name="ln699">    SET_SIGHANDLER(SIGBUS, handler);</a>
<a name="ln700">#endif</a>
<a name="ln701">#ifdef SIGSEGV</a>
<a name="ln702">    SET_SIGHANDLER(SIGSEGV, handler);</a>
<a name="ln703">#endif</a>
<a name="ln704"> </a>
<a name="ln705">#if (defined(WIN32) &amp;&amp; defined(__RSXNT__))</a>
<a name="ln706">    for (i = 0 ; i &lt; argc; i++) {</a>
<a name="ln707">       _ISO_INTERN(argv[i]);</a>
<a name="ln708">    }</a>
<a name="ln709">#endif</a>
<a name="ln710"> </a>
<a name="ln711">/*---------------------------------------------------------------------------</a>
<a name="ln712">    Macintosh initialization code.</a>
<a name="ln713">  ---------------------------------------------------------------------------*/</a>
<a name="ln714"> </a>
<a name="ln715">#ifdef MACOS</a>
<a name="ln716">    {</a>
<a name="ln717">        int a;</a>
<a name="ln718"> </a>
<a name="ln719">        for (a = 0;  a &lt; 4;  ++a)</a>
<a name="ln720">            G.rghCursor[a] = GetCursor(a+128);</a>
<a name="ln721">        G.giCursor = 0;</a>
<a name="ln722">    }</a>
<a name="ln723">#endif</a>
<a name="ln724"> </a>
<a name="ln725">/*---------------------------------------------------------------------------</a>
<a name="ln726">    NetWare initialization code.</a>
<a name="ln727">  ---------------------------------------------------------------------------*/</a>
<a name="ln728"> </a>
<a name="ln729">#ifdef NLM</a>
<a name="ln730">    InitUnZipConsole();</a>
<a name="ln731">#endif</a>
<a name="ln732"> </a>
<a name="ln733">/*---------------------------------------------------------------------------</a>
<a name="ln734">    Acorn RISC OS initialization code.</a>
<a name="ln735">  ---------------------------------------------------------------------------*/</a>
<a name="ln736"> </a>
<a name="ln737">#ifdef RISCOS</a>
<a name="ln738">    set_prefix();</a>
<a name="ln739">#endif</a>
<a name="ln740"> </a>
<a name="ln741">/*---------------------------------------------------------------------------</a>
<a name="ln742">    Theos initialization code.</a>
<a name="ln743">  ---------------------------------------------------------------------------*/</a>
<a name="ln744"> </a>
<a name="ln745">#ifdef THEOS</a>
<a name="ln746">    /* The easiest way found to force creation of libraries when selected</a>
<a name="ln747">     * members are to be unzipped. Explicitely add libraries names to the</a>
<a name="ln748">     * arguments list before the first member of the library.</a>
<a name="ln749">     */</a>
<a name="ln750">    if (! _setargv(&amp;argc, &amp;argv)) {</a>
<a name="ln751">        Info(slide, 0x401, ((char *)slide, &quot;cannot process argv\n&quot;));</a>
<a name="ln752">        retcode = PK_MEM;</a>
<a name="ln753">        goto cleanup_and_exit;</a>
<a name="ln754">    }</a>
<a name="ln755">#endif</a>
<a name="ln756"> </a>
<a name="ln757">/*---------------------------------------------------------------------------</a>
<a name="ln758">    First figure out if we're running in UnZip mode or ZipInfo mode, and put</a>
<a name="ln759">    the appropriate environment-variable options into the queue.  Then rip</a>
<a name="ln760">    through any command-line options lurking about...</a>
<a name="ln761">  ---------------------------------------------------------------------------*/</a>
<a name="ln762"> </a>
<a name="ln763">#ifdef SFX</a>
<a name="ln764">    G.argv0 = argv[0];</a>
<a name="ln765">#if (defined(OS2) || defined(WIN32))</a>
<a name="ln766">    G.zipfn = GetLoadPath(__G);/* non-MSC NT puts path into G.filename[] */</a>
<a name="ln767">#else</a>
<a name="ln768">    G.zipfn = G.argv0;</a>
<a name="ln769">#endif</a>
<a name="ln770"> </a>
<a name="ln771">#ifdef VMSCLI</a>
<a name="ln772">    {</a>
<a name="ln773">        ulg status = vms_unzip_cmdline(&amp;argc, &amp;argv);</a>
<a name="ln774">        if (!(status &amp; 1)) {</a>
<a name="ln775">            retcode = (int)status;</a>
<a name="ln776">            goto cleanup_and_exit;</a>
<a name="ln777">        }</a>
<a name="ln778">    }</a>
<a name="ln779">#endif /* VMSCLI */</a>
<a name="ln780"> </a>
<a name="ln781">    uO.zipinfo_mode = FALSE;</a>
<a name="ln782">    error = uz_opts(__G__ &amp;argc, &amp;argv);   /* UnZipSFX call only */</a>
<a name="ln783"> </a>
<a name="ln784">#else /* !SFX */</a>
<a name="ln785"> </a>
<a name="ln786">#ifdef RISCOS</a>
<a name="ln787">    /* get the extensions to swap from environment */</a>
<a name="ln788">    getRISCOSexts(ENV_UNZIPEXTS);</a>
<a name="ln789">#endif</a>
<a name="ln790"> </a>
<a name="ln791">#ifdef MSDOS</a>
<a name="ln792">    /* extract MKS extended argument list from environment (before envargs!) */</a>
<a name="ln793">    mksargs(&amp;argc, &amp;argv);</a>
<a name="ln794">#endif</a>
<a name="ln795"> </a>
<a name="ln796">#ifdef VMSCLI</a>
<a name="ln797">    {</a>
<a name="ln798">        ulg status = vms_unzip_cmdline(&amp;argc, &amp;argv);</a>
<a name="ln799">        if (!(status &amp; 1)) {</a>
<a name="ln800">            retcode = (int)status;</a>
<a name="ln801">            goto cleanup_and_exit;</a>
<a name="ln802">        }</a>
<a name="ln803">    }</a>
<a name="ln804">#endif /* VMSCLI */</a>
<a name="ln805"> </a>
<a name="ln806">    G.noargs = (argc == 1);   /* no options, no zipfile, no anything */</a>
<a name="ln807"> </a>
<a name="ln808">#ifndef NO_ZIPINFO</a>
<a name="ln809">    for (p = argv[0] + strlen(argv[0]); p &gt;= argv[0]; --p) {</a>
<a name="ln810">        if (*p == DIR_END</a>
<a name="ln811">#ifdef DIR_END2</a>
<a name="ln812">            || *p == DIR_END2</a>
<a name="ln813">#endif</a>
<a name="ln814">           )</a>
<a name="ln815">            break;</a>
<a name="ln816">    }</a>
<a name="ln817">    ++p;</a>
<a name="ln818"> </a>
<a name="ln819">#ifdef THEOS</a>
<a name="ln820">    if (strncmp(p, &quot;ZIPINFO.&quot;,8) == 0 || strstr(p, &quot;.ZIPINFO:&quot;) != NULL ||</a>
<a name="ln821">        strncmp(p, &quot;II.&quot;,3) == 0 || strstr(p, &quot;.II:&quot;) != NULL ||</a>
<a name="ln822">#else</a>
<a name="ln823">    if (STRNICMP(p, LoadFarStringSmall(Zipnfo), 7) == 0 ||</a>
<a name="ln824">        STRNICMP(p, &quot;ii&quot;, 2) == 0 ||</a>
<a name="ln825">#endif</a>
<a name="ln826">        (argc &gt; 1 &amp;&amp; strncmp(argv[1], &quot;-Z&quot;, 2) == 0))</a>
<a name="ln827">    {</a>
<a name="ln828">        uO.zipinfo_mode = TRUE;</a>
<a name="ln829">        if ((error = envargs(&amp;argc, &amp;argv, LoadFarStringSmall(EnvZipInfo),</a>
<a name="ln830">                             LoadFarStringSmall2(EnvZipInfo2))) != PK_OK)</a>
<a name="ln831">            perror(LoadFarString(NoMemArguments));</a>
<a name="ln832">        else</a>
<a name="ln833">            error = zi_opts(__G__ &amp;argc, &amp;argv);</a>
<a name="ln834">    } else</a>
<a name="ln835">#endif /* NO_ZIPINFO */</a>
<a name="ln836">    {</a>
<a name="ln837">        uO.zipinfo_mode = FALSE;</a>
<a name="ln838">        if ((error = envargs(&amp;argc, &amp;argv, LoadFarStringSmall(EnvUnZip),</a>
<a name="ln839">                             LoadFarStringSmall2(EnvUnZip2))) != PK_OK)</a>
<a name="ln840">            perror(LoadFarString(NoMemArguments));</a>
<a name="ln841">        else</a>
<a name="ln842">            error = uz_opts(__G__ &amp;argc, &amp;argv);</a>
<a name="ln843">    }</a>
<a name="ln844"> </a>
<a name="ln845">#endif /* ?SFX */</a>
<a name="ln846"> </a>
<a name="ln847">    if ((argc &lt; 0) || error) {</a>
<a name="ln848">        retcode = error;</a>
<a name="ln849">        goto cleanup_and_exit;</a>
<a name="ln850">    }</a>
<a name="ln851"> </a>
<a name="ln852">/*---------------------------------------------------------------------------</a>
<a name="ln853">    Now get the zipfile name from the command line and then process any re-</a>
<a name="ln854">    maining options and file specifications.</a>
<a name="ln855">  ---------------------------------------------------------------------------*/</a>
<a name="ln856"> </a>
<a name="ln857">#ifdef DOS_FLX_H68_NLM_OS2_W32</a>
<a name="ln858">    /* convert MSDOS-style 'backward slash' directory separators to Unix-style</a>
<a name="ln859">     * 'forward slashes' for user's convenience (include zipfile name itself)</a>
<a name="ln860">     */</a>
<a name="ln861">#ifdef SFX</a>
<a name="ln862">    for (G.pfnames = argv, i = argc;  i &gt; 0;  --i) {</a>
<a name="ln863">#else</a>
<a name="ln864">    /* argc does not include the zipfile specification */</a>
<a name="ln865">    for (G.pfnames = argv, i = argc+1;  i &gt; 0;  --i) {</a>
<a name="ln866">#endif</a>
<a name="ln867">#ifdef __human68k__</a>
<a name="ln868">        extern char *_toslash(char *);</a>
<a name="ln869">        _toslash(*G.pfnames);</a>
<a name="ln870">#else /* !__human68k__ */</a>
<a name="ln871">        char *q;</a>
<a name="ln872"> </a>
<a name="ln873">        for (q = *G.pfnames;  *q;  ++q)</a>
<a name="ln874">            if (*q == '\\')</a>
<a name="ln875">                *q = '/';</a>
<a name="ln876">        ++G.pfnames;</a>
<a name="ln877">#endif /* ?__human68k__ */</a>
<a name="ln878">    }</a>
<a name="ln879">#endif /* DOS_FLX_H68_NLM_OS2_W32 */</a>
<a name="ln880"> </a>
<a name="ln881">#ifndef SFX</a>
<a name="ln882">    G.wildzipfn = *argv++;</a>
<a name="ln883">#endif</a>
<a name="ln884"> </a>
<a name="ln885">#if (defined(SFX) &amp;&amp; !defined(SFX_EXDIR)) /* only check for -x */</a>
<a name="ln886"> </a>
<a name="ln887">    G.filespecs = argc;</a>
<a name="ln888">    G.xfilespecs = 0;</a>
<a name="ln889"> </a>
<a name="ln890">    if (argc &gt; 0) {</a>
<a name="ln891">        char **pp = argv-1;</a>
<a name="ln892"> </a>
<a name="ln893">        G.pfnames = argv;</a>
<a name="ln894">        while (*++pp)</a>
<a name="ln895">            if (strcmp(*pp, &quot;-x&quot;) == 0) {</a>
<a name="ln896">                if (pp &gt; argv) {</a>
<a name="ln897">                    *pp = 0;              /* terminate G.pfnames */</a>
<a name="ln898">                    G.filespecs = pp - G.pfnames;</a>
<a name="ln899">                } else {</a>
<a name="ln900">                    G.pfnames = (char **)fnames;  /* defaults */</a>
<a name="ln901">                    G.filespecs = 0;</a>
<a name="ln902">                }</a>
<a name="ln903">                G.pxnames = pp + 1;      /* excluded-names ptr: _after_ -x */</a>
<a name="ln904">                G.xfilespecs = argc - G.filespecs - 1;</a>
<a name="ln905">                break;                    /* skip rest of args */</a>
<a name="ln906">            }</a>
<a name="ln907">        G.process_all_files = FALSE;</a>
<a name="ln908">    } else</a>
<a name="ln909">        G.process_all_files = TRUE;      /* for speed */</a>
<a name="ln910"> </a>
<a name="ln911">#else /* !SFX || SFX_EXDIR */             /* check for -x or -d */</a>
<a name="ln912"> </a>
<a name="ln913">    G.filespecs = argc;</a>
<a name="ln914">    G.xfilespecs = 0;</a>
<a name="ln915"> </a>
<a name="ln916">    if (argc &gt; 0) {</a>
<a name="ln917">        int in_files=FALSE, in_xfiles=FALSE;</a>
<a name="ln918">        char **pp = argv-1;</a>
<a name="ln919"> </a>
<a name="ln920">        G.process_all_files = FALSE;</a>
<a name="ln921">        G.pfnames = argv;</a>
<a name="ln922">        while (*++pp) {</a>
<a name="ln923">            Trace((stderr, &quot;pp - argv = %d\n&quot;, pp-argv));</a>
<a name="ln924">#ifdef CMS_MVS</a>
<a name="ln925">            if (!uO.exdir &amp;&amp; STRNICMP(*pp, &quot;-d&quot;, 2) == 0) {</a>
<a name="ln926">#else</a>
<a name="ln927">            if (!uO.exdir &amp;&amp; strncmp(*pp, &quot;-d&quot;, 2) == 0) {</a>
<a name="ln928">#endif</a>
<a name="ln929">                int firstarg = (pp == argv);</a>
<a name="ln930"> </a>
<a name="ln931">                uO.exdir = (*pp) + 2;</a>
<a name="ln932">                if (in_files) {      /* ... zipfile ... -d exdir ... */</a>
<a name="ln933">                    *pp = (char *)NULL;         /* terminate G.pfnames */</a>
<a name="ln934">                    G.filespecs = pp - G.pfnames;</a>
<a name="ln935">                    in_files = FALSE;</a>
<a name="ln936">                } else if (in_xfiles) {</a>
<a name="ln937">                    *pp = (char *)NULL;         /* terminate G.pxnames */</a>
<a name="ln938">                    G.xfilespecs = pp - G.pxnames;</a>
<a name="ln939">                    /* &quot;... -x xlist -d exdir&quot;:  nothing left */</a>
<a name="ln940">                }</a>
<a name="ln941">                /* first check for &quot;-dexdir&quot;, then for &quot;-d exdir&quot; */</a>
<a name="ln942">                if (*uO.exdir == '\0') {</a>
<a name="ln943">                    if (*++pp)</a>
<a name="ln944">                        uO.exdir = *pp;</a>
<a name="ln945">                    else {</a>
<a name="ln946">                        Info(slide, 0x401, ((char *)slide,</a>
<a name="ln947">                          LoadFarString(MustGiveExdir)));</a>
<a name="ln948">                        /* don't extract here by accident */</a>
<a name="ln949">                        retcode = PK_PARAM;</a>
<a name="ln950">                        goto cleanup_and_exit;</a>
<a name="ln951">                    }</a>
<a name="ln952">                }</a>
<a name="ln953">                if (firstarg) { /* ... zipfile -d exdir ... */</a>
<a name="ln954">                    if (pp[1]) {</a>
<a name="ln955">                        G.pfnames = pp + 1;  /* argv+2 */</a>
<a name="ln956">                        G.filespecs = argc - (G.pfnames-argv);  /* for now... */</a>
<a name="ln957">                    } else {</a>
<a name="ln958">                        G.process_all_files = TRUE;</a>
<a name="ln959">                        G.pfnames = (char **)fnames;  /* GRR: necessary? */</a>
<a name="ln960">                        G.filespecs = 0;     /* GRR: necessary? */</a>
<a name="ln961">                        break;</a>
<a name="ln962">                    }</a>
<a name="ln963">                }</a>
<a name="ln964">            } else if (!in_xfiles) {</a>
<a name="ln965">                if (strcmp(*pp, &quot;-x&quot;) == 0) {</a>
<a name="ln966">                    in_xfiles = TRUE;</a>
<a name="ln967">                    if (pp == G.pfnames) {</a>
<a name="ln968">                        G.pfnames = (char **)fnames;  /* defaults */</a>
<a name="ln969">                        G.filespecs = 0;</a>
<a name="ln970">                    } else if (in_files) {</a>
<a name="ln971">                        *pp = 0;                   /* terminate G.pfnames */</a>
<a name="ln972">                        G.filespecs = pp - G.pfnames;  /* adjust count */</a>
<a name="ln973">                        in_files = FALSE;</a>
<a name="ln974">                    }</a>
<a name="ln975">                    G.pxnames = pp + 1; /* excluded-names ptr starts after -x */</a>
<a name="ln976">                    G.xfilespecs = argc - (G.pxnames-argv);  /* anything left */</a>
<a name="ln977">                } else</a>
<a name="ln978">                    in_files = TRUE;</a>
<a name="ln979">            }</a>
<a name="ln980">        }</a>
<a name="ln981">    } else</a>
<a name="ln982">        G.process_all_files = TRUE;      /* for speed */</a>
<a name="ln983"> </a>
<a name="ln984">    if (uO.exdir != (char *)NULL &amp;&amp; !G.extract_flag)    /* -d ignored */</a>
<a name="ln985">        Info(slide, 0x401, ((char *)slide, LoadFarString(NotExtracting)));</a>
<a name="ln986">#endif /* ?(SFX &amp;&amp; !SFX_EXDIR) */</a>
<a name="ln987"> </a>
<a name="ln988">/*---------------------------------------------------------------------------</a>
<a name="ln989">    Okey dokey, we have everything we need to get started.  Let's roll.</a>
<a name="ln990">  ---------------------------------------------------------------------------*/</a>
<a name="ln991"> </a>
<a name="ln992">    retcode = process_zipfiles(__G);</a>
<a name="ln993"> </a>
<a name="ln994">cleanup_and_exit:</a>
<a name="ln995">#ifdef REENTRANT</a>
<a name="ln996">    /* restore all signal handlers back to their state at function entry */</a>
<a name="ln997">    while (oldsighandlers != NULL) {</a>
<a name="ln998">        savsigs_info *thissigsav = oldsighandlers;</a>
<a name="ln999"> </a>
<a name="ln1000">        signal(thissigsav-&gt;sigtype, thissigsav-&gt;sighandler);</a>
<a name="ln1001">        oldsighandlers = thissigsav-&gt;previous;</a>
<a name="ln1002">        free(thissigsav);</a>
<a name="ln1003">    }</a>
<a name="ln1004">#endif</a>
<a name="ln1005">#if (defined(MALLOC_WORK) &amp;&amp; !defined(REENTRANT))</a>
<a name="ln1006">    if (G.area.Slide != (uch *)NULL) {</a>
<a name="ln1007">        free(G.area.Slide);</a>
<a name="ln1008">        G.area.Slide = (uch *)NULL;</a>
<a name="ln1009">    }</a>
<a name="ln1010">#endif</a>
<a name="ln1011">    return(retcode);</a>
<a name="ln1012"> </a>
<a name="ln1013">} /* end main()/unzip() */</a>
<a name="ln1014"> </a>
<a name="ln1015"> </a>
<a name="ln1016"> </a>
<a name="ln1017"> </a>
<a name="ln1018"> </a>
<a name="ln1019">#ifdef REENTRANT</a>
<a name="ln1020">/*******************************/</a>
<a name="ln1021">/* Function setsignalhandler() */</a>
<a name="ln1022">/*******************************/</a>
<a name="ln1023"> </a>
<a name="ln1024">static int setsignalhandler(__G__ p_savedhandler_chain, signal_type,</a>
<a name="ln1025">                            newhandler)</a>
<a name="ln1026">    __GDEF</a>
<a name="ln1027">    savsigs_info **p_savedhandler_chain;</a>
<a name="ln1028">    int signal_type;</a>
<a name="ln1029">    void (*newhandler)(int);</a>
<a name="ln1030">{</a>
<a name="ln1031">    savsigs_info *savsig;</a>
<a name="ln1032"> </a>
<a name="ln1033">    savsig = malloc(sizeof(savsigs_info));</a>
<a name="ln1034">    if (savsig == NULL) {</a>
<a name="ln1035">        /* error message and break */</a>
<a name="ln1036">        Info(slide, 0x401, ((char *)slide, LoadFarString(CantSaveSigHandler)));</a>
<a name="ln1037">        return PK_MEM;</a>
<a name="ln1038">    }</a>
<a name="ln1039">    savsig-&gt;sigtype = signal_type;</a>
<a name="ln1040">    savsig-&gt;sighandler = signal(SIGINT, newhandler);</a>
<a name="ln1041">    if (savsig-&gt;sighandler == SIG_ERR) {</a>
<a name="ln1042">        free(savsig);</a>
<a name="ln1043">    } else {</a>
<a name="ln1044">        savsig-&gt;previous = *p_savedhandler_chain;</a>
<a name="ln1045">        *p_savedhandler_chain = savsig;</a>
<a name="ln1046">    }</a>
<a name="ln1047">    return PK_OK;</a>
<a name="ln1048"> </a>
<a name="ln1049">} /* end function setsignalhandler() */</a>
<a name="ln1050"> </a>
<a name="ln1051">#endif /* REENTRANT */</a>
<a name="ln1052"> </a>
<a name="ln1053"> </a>
<a name="ln1054"> </a>
<a name="ln1055"> </a>
<a name="ln1056"> </a>
<a name="ln1057">/**********************/</a>
<a name="ln1058">/* Function uz_opts() */</a>
<a name="ln1059">/**********************/</a>
<a name="ln1060"> </a>
<a name="ln1061">int uz_opts(__G__ pargc, pargv)</a>
<a name="ln1062">    __GDEF</a>
<a name="ln1063">    int *pargc;</a>
<a name="ln1064">    char ***pargv;</a>
<a name="ln1065">{</a>
<a name="ln1066">    char **argv, *s;</a>
<a name="ln1067">    int argc, c, error=FALSE, negative=0;</a>
<a name="ln1068"> </a>
<a name="ln1069"> </a>
<a name="ln1070">    argc = *pargc;</a>
<a name="ln1071">    argv = *pargv;</a>
<a name="ln1072"> </a>
<a name="ln1073">    while (++argv, (--argc &gt; 0 &amp;&amp; *argv != NULL &amp;&amp; **argv == '-')) {</a>
<a name="ln1074">        s = *argv + 1;</a>
<a name="ln1075">        while ((c = *s++) != 0) {    /* &quot;!= 0&quot;:  prevent Turbo C warning */</a>
<a name="ln1076">#ifdef CMS_MVS</a>
<a name="ln1077">            switch (tolower(c))</a>
<a name="ln1078">#else</a>
<a name="ln1079">            switch (c)</a>
<a name="ln1080">#endif</a>
<a name="ln1081">            {</a>
<a name="ln1082">                case ('-'):</a>
<a name="ln1083">                    ++negative;</a>
<a name="ln1084">                    break;</a>
<a name="ln1085">#ifdef RISCOS</a>
<a name="ln1086">                case ('/'):</a>
<a name="ln1087">                    if (negative) {   /* negative not allowed with -/ swap */</a>
<a name="ln1088">                        Info(slide, 0x401, ((char *)slide,</a>
<a name="ln1089">                          &quot;error:  must give extensions list&quot;));</a>
<a name="ln1090">                        return(PK_PARAM);  /* don't extract here by accident */</a>
<a name="ln1091">                    }</a>
<a name="ln1092">                    exts2swap = s; /* override Unzip$Exts */</a>
<a name="ln1093">                    s += strlen(s);</a>
<a name="ln1094">                    break;</a>
<a name="ln1095">#endif</a>
<a name="ln1096">                case ('a'):</a>
<a name="ln1097">                    if (negative) {</a>
<a name="ln1098">                        uO.aflag = MAX(uO.aflag-negative,0);</a>
<a name="ln1099">                        negative = 0;</a>
<a name="ln1100">                    } else</a>
<a name="ln1101">                        ++uO.aflag;</a>
<a name="ln1102">                    break;</a>
<a name="ln1103">#if (defined(DLL) &amp;&amp; defined(API_DOC))</a>
<a name="ln1104">                case ('A'):    /* extended help for API */</a>
<a name="ln1105">                    APIhelp(__G__ argc, argv);</a>
<a name="ln1106">                    *pargc = -1;  /* signal to exit successfully */</a>
<a name="ln1107">                    return 0;</a>
<a name="ln1108">#endif</a>
<a name="ln1109">                case ('b'):</a>
<a name="ln1110">                    if (negative) {</a>
<a name="ln1111">#if (defined(TANDEM) || defined(VMS))</a>
<a name="ln1112">                        uO.bflag = MAX(uO.bflag-negative,0);</a>
<a name="ln1113">#endif</a>
<a name="ln1114">                        negative = 0;   /* do nothing:  &quot;-b&quot; is default */</a>
<a name="ln1115">                    } else {</a>
<a name="ln1116">#ifdef VMS</a>
<a name="ln1117">                        if (uO.aflag == 0)</a>
<a name="ln1118">                           ++uO.bflag;</a>
<a name="ln1119">#endif</a>
<a name="ln1120">#ifdef TANDEM</a>
<a name="ln1121">                        ++uO.bflag;</a>
<a name="ln1122">#endif</a>
<a name="ln1123">                        uO.aflag = 0;</a>
<a name="ln1124">                    }</a>
<a name="ln1125">                    break;</a>
<a name="ln1126">#ifdef UNIXBACKUP</a>
<a name="ln1127">                case ('B'): /* -B: back up existing files */</a>
<a name="ln1128">                    if (negative)</a>
<a name="ln1129">                        uO.B_flag = FALSE, negative = 0;</a>
<a name="ln1130">                    else</a>
<a name="ln1131">                        uO.B_flag = TRUE;</a>
<a name="ln1132">                    break;</a>
<a name="ln1133">#endif</a>
<a name="ln1134">                case ('c'):</a>
<a name="ln1135">                    if (negative) {</a>
<a name="ln1136">                        uO.cflag = FALSE, negative = 0;</a>
<a name="ln1137">#ifdef NATIVE</a>
<a name="ln1138">                        uO.aflag = 0;</a>
<a name="ln1139">#endif</a>
<a name="ln1140">                    } else {</a>
<a name="ln1141">                        uO.cflag = TRUE;</a>
<a name="ln1142">#ifdef NATIVE</a>
<a name="ln1143">                        uO.aflag = 2;   /* so you can read it on the screen */</a>
<a name="ln1144">#endif</a>
<a name="ln1145">#ifdef DLL</a>
<a name="ln1146">                        if (G.redirect_text)</a>
<a name="ln1147">                            G.redirect_data = 2;</a>
<a name="ln1148">#endif</a>
<a name="ln1149">                    }</a>
<a name="ln1150">                    break;</a>
<a name="ln1151">#ifndef CMS_MVS</a>
<a name="ln1152">                case ('C'):    /* -C:  match filenames case-insensitively */</a>
<a name="ln1153">                    if (negative)</a>
<a name="ln1154">                        uO.C_flag = FALSE, negative = 0;</a>
<a name="ln1155">                    else</a>
<a name="ln1156">                        uO.C_flag = TRUE;</a>
<a name="ln1157">                    break;</a>
<a name="ln1158">#endif /* !CMS_MVS */</a>
<a name="ln1159">#if (!defined(SFX) || defined(SFX_EXDIR))</a>
<a name="ln1160">                case ('d'):</a>
<a name="ln1161">                    if (negative) {   /* negative not allowed with -d exdir */</a>
<a name="ln1162">                        Info(slide, 0x401, ((char *)slide,</a>
<a name="ln1163">                          LoadFarString(MustGiveExdir)));</a>
<a name="ln1164">                        return(PK_PARAM);  /* don't extract here by accident */</a>
<a name="ln1165">                    }</a>
<a name="ln1166">                    if (uO.exdir != (char *)NULL) {</a>
<a name="ln1167">                        Info(slide, 0x401, ((char *)slide,</a>
<a name="ln1168">                          LoadFarString(OnlyOneExdir)));</a>
<a name="ln1169">                        return(PK_PARAM);    /* GRR:  stupid restriction? */</a>
<a name="ln1170">                    } else {</a>
<a name="ln1171">                        /* first check for &quot;-dexdir&quot;, then for &quot;-d exdir&quot; */</a>
<a name="ln1172">                        uO.exdir = s;</a>
<a name="ln1173">                        if (*uO.exdir == '\0') {</a>
<a name="ln1174">                            if (argc &gt; 1) {</a>
<a name="ln1175">                                --argc;</a>
<a name="ln1176">                                uO.exdir = *++argv;</a>
<a name="ln1177">                                if (*uO.exdir == '-') {</a>
<a name="ln1178">                                    Info(slide, 0x401, ((char *)slide,</a>
<a name="ln1179">                                      LoadFarString(MustGiveExdir)));</a>
<a name="ln1180">                                    return(PK_PARAM);</a>
<a name="ln1181">                                }</a>
<a name="ln1182">                                /* else uO.exdir points at extraction dir */</a>
<a name="ln1183">                            } else {</a>
<a name="ln1184">                                Info(slide, 0x401, ((char *)slide,</a>
<a name="ln1185">                                  LoadFarString(MustGiveExdir)));</a>
<a name="ln1186">                                return(PK_PARAM);</a>
<a name="ln1187">                            }</a>
<a name="ln1188">                        }</a>
<a name="ln1189">                        /* uO.exdir now points at extraction dir (-dexdir or</a>
<a name="ln1190">                         *  -d exdir); point s at end of exdir to avoid mis-</a>
<a name="ln1191">                         *  interpretation of exdir characters as more options</a>
<a name="ln1192">                         */</a>
<a name="ln1193">                        if (*s != 0)</a>
<a name="ln1194">                            while (*++s != 0)</a>
<a name="ln1195">                                ;</a>
<a name="ln1196">                    }</a>
<a name="ln1197">                    break;</a>
<a name="ln1198">#endif /* !SFX || SFX_EXDIR */</a>
<a name="ln1199">                case ('e'):    /* just ignore -e, -x options (extract) */</a>
<a name="ln1200">                    break;</a>
<a name="ln1201">#ifdef MACOS</a>
<a name="ln1202">                case ('E'): /* -E [MacOS] display Mac e.f. when restoring */</a>
<a name="ln1203">                    if( negative ) {</a>
<a name="ln1204">                        uO.E_flag = FALSE, negative = 0;</a>
<a name="ln1205">                    } else {</a>
<a name="ln1206">                        uO.E_flag = TRUE;</a>
<a name="ln1207">                    }</a>
<a name="ln1208">                    break;</a>
<a name="ln1209">#endif /* MACOS */</a>
<a name="ln1210">                case ('f'):    /* &quot;freshen&quot; (extract only newer files) */</a>
<a name="ln1211">                    if (negative)</a>
<a name="ln1212">                        uO.fflag = uO.uflag = FALSE, negative = 0;</a>
<a name="ln1213">                    else</a>
<a name="ln1214">                        uO.fflag = uO.uflag = TRUE;</a>
<a name="ln1215">                    break;</a>
<a name="ln1216">#if (defined(RISCOS) || defined(ACORN_FTYPE_NFS))</a>
<a name="ln1217">                case ('F'):    /* Acorn filetype &amp; NFS extension handling */</a>
<a name="ln1218">                    if (negative)</a>
<a name="ln1219">                        uO.acorn_nfs_ext = FALSE, negative = 0;</a>
<a name="ln1220">                    else</a>
<a name="ln1221">                        uO.acorn_nfs_ext = TRUE;</a>
<a name="ln1222">                    break;</a>
<a name="ln1223">#endif /* RISCOS || ACORN_FTYPE_NFS */</a>
<a name="ln1224">                case ('h'):    /* just print help message and quit */</a>
<a name="ln1225">                    *pargc = -1;</a>
<a name="ln1226">                    return USAGE(PK_OK);</a>
<a name="ln1227">#ifdef MACOS</a>
<a name="ln1228">                case ('i'): /* -i [MacOS] ignore filenames stored in Mac ef */</a>
<a name="ln1229">                    if( negative ) {</a>
<a name="ln1230">                        uO.i_flag = FALSE, negative = 0;</a>
<a name="ln1231">                    } else {</a>
<a name="ln1232">                        uO.i_flag = TRUE;</a>
<a name="ln1233">                    }</a>
<a name="ln1234">                    break;</a>
<a name="ln1235">#endif  /* MACOS */</a>
<a name="ln1236">                case ('j'):    /* junk pathnames/directory structure */</a>
<a name="ln1237">                    if (negative)</a>
<a name="ln1238">                        uO.jflag = FALSE, negative = 0;</a>
<a name="ln1239">                    else</a>
<a name="ln1240">                        uO.jflag = TRUE;</a>
<a name="ln1241">                    break;</a>
<a name="ln1242">#if ((defined(__BEOS__) || defined(__HAIKU__)) || defined(MACOS) || defined(HAS_JUNK_EXTRA_FIELD_OPTION))</a>
<a name="ln1243">                case ('J'):    /* Junk BeOS or MacOS file attributes */</a>
<a name="ln1244">                    if( negative ) {</a>
<a name="ln1245">                        uO.J_flag = FALSE, negative = 0;</a>
<a name="ln1246">                    } else {</a>
<a name="ln1247">                        uO.J_flag = TRUE;</a>
<a name="ln1248">                    }</a>
<a name="ln1249">                    break;</a>
<a name="ln1250">#endif /* __BEOS__ || MACOS */</a>
<a name="ln1251">#ifndef SFX</a>
<a name="ln1252">                case ('l'):</a>
<a name="ln1253">                    if (negative) {</a>
<a name="ln1254">                        uO.vflag = MAX(uO.vflag-negative,0);</a>
<a name="ln1255">                        negative = 0;</a>
<a name="ln1256">                    } else</a>
<a name="ln1257">                        ++uO.vflag;</a>
<a name="ln1258">                    break;</a>
<a name="ln1259">#endif /* !SFX */</a>
<a name="ln1260">#ifndef CMS_MVS</a>
<a name="ln1261">                case ('L'):    /* convert (some) filenames to lowercase */</a>
<a name="ln1262">                    if (negative) {</a>
<a name="ln1263">                        uO.L_flag = MAX(uO.L_flag-negative,0);</a>
<a name="ln1264">                        negative = 0;</a>
<a name="ln1265">                    } else</a>
<a name="ln1266">                        ++uO.L_flag;</a>
<a name="ln1267">                    break;</a>
<a name="ln1268">#endif /* !CMS_MVS */</a>
<a name="ln1269">#ifdef MORE</a>
<a name="ln1270">#ifdef CMS_MVS</a>
<a name="ln1271">                case ('m'):</a>
<a name="ln1272">#endif</a>
<a name="ln1273">                case ('M'):    /* send all screen output through &quot;more&quot; fn. */</a>
<a name="ln1274">/* GRR:  eventually check for numerical argument =&gt; height */</a>
<a name="ln1275">                    if (negative)</a>
<a name="ln1276">                        G.M_flag = FALSE, negative = 0;</a>
<a name="ln1277">                    else</a>
<a name="ln1278">                        G.M_flag = TRUE;</a>
<a name="ln1279">                    break;</a>
<a name="ln1280">#endif /* MORE */</a>
<a name="ln1281">                case ('n'):    /* don't overwrite any files */</a>
<a name="ln1282">                    if (negative)</a>
<a name="ln1283">                        uO.overwrite_none = FALSE, negative = 0;</a>
<a name="ln1284">                    else</a>
<a name="ln1285">                        uO.overwrite_none = TRUE;</a>
<a name="ln1286">                    break;</a>
<a name="ln1287">#ifdef AMIGA</a>
<a name="ln1288">                case ('N'):    /* restore comments as filenotes */</a>
<a name="ln1289">                    if (negative)</a>
<a name="ln1290">                        uO.N_flag = FALSE, negative = 0;</a>
<a name="ln1291">                    else</a>
<a name="ln1292">                        uO.N_flag = TRUE;</a>
<a name="ln1293">                    break;</a>
<a name="ln1294">#endif /* AMIGA */</a>
<a name="ln1295">                case ('o'):    /* OK to overwrite files without prompting */</a>
<a name="ln1296">                    if (negative) {</a>
<a name="ln1297">                        uO.overwrite_all = MAX(uO.overwrite_all-negative,0);</a>
<a name="ln1298">                        negative = 0;</a>
<a name="ln1299">                    } else</a>
<a name="ln1300">                        ++uO.overwrite_all;</a>
<a name="ln1301">                    break;</a>
<a name="ln1302">                case ('p'):    /* pipes:  extract to stdout, no messages */</a>
<a name="ln1303">                    if (negative) {</a>
<a name="ln1304">                        uO.cflag = FALSE;</a>
<a name="ln1305">                        uO.qflag = MAX(uO.qflag-999,0);</a>
<a name="ln1306">                        negative = 0;</a>
<a name="ln1307">                    } else {</a>
<a name="ln1308">                        uO.cflag = TRUE;</a>
<a name="ln1309">                        uO.qflag += 999;</a>
<a name="ln1310">                    }</a>
<a name="ln1311">                    break;</a>
<a name="ln1312">#if CRYPT</a>
<a name="ln1313">                /* GRR:  yes, this is highly insecure, but dozens of people</a>
<a name="ln1314">                 * have pestered us for this, so here we go... */</a>
<a name="ln1315">                case ('P'):</a>
<a name="ln1316">                    if (negative) {   /* negative not allowed with -P passwd */</a>
<a name="ln1317">                        Info(slide, 0x401, ((char *)slide,</a>
<a name="ln1318">                          LoadFarString(MustGivePasswd)));</a>
<a name="ln1319">                        return(PK_PARAM);  /* don't extract here by accident */</a>
<a name="ln1320">                    }</a>
<a name="ln1321">                    if (uO.pwdarg != (char *)NULL) {</a>
<a name="ln1322">/*</a>
<a name="ln1323">                        GRR:  eventually support multiple passwords?</a>
<a name="ln1324">                        Info(slide, 0x401, ((char *)slide,</a>
<a name="ln1325">                          LoadFarString(OnlyOnePasswd)));</a>
<a name="ln1326">                        return(PK_PARAM);</a>
<a name="ln1327"> */</a>
<a name="ln1328">                    } else {</a>
<a name="ln1329">                        /* first check for &quot;-Ppasswd&quot;, then for &quot;-P passwd&quot; */</a>
<a name="ln1330">                        uO.pwdarg = s;</a>
<a name="ln1331">                        if (*uO.pwdarg == '\0') {</a>
<a name="ln1332">                            if (argc &gt; 1) {</a>
<a name="ln1333">                                --argc;</a>
<a name="ln1334">                                uO.pwdarg = *++argv;</a>
<a name="ln1335">                                if (*uO.pwdarg == '-') {</a>
<a name="ln1336">                                    Info(slide, 0x401, ((char *)slide,</a>
<a name="ln1337">                                      LoadFarString(MustGivePasswd)));</a>
<a name="ln1338">                                    return(PK_PARAM);</a>
<a name="ln1339">                                }</a>
<a name="ln1340">                                /* else pwdarg points at decryption password */</a>
<a name="ln1341">                            } else {</a>
<a name="ln1342">                                Info(slide, 0x401, ((char *)slide,</a>
<a name="ln1343">                                  LoadFarString(MustGivePasswd)));</a>
<a name="ln1344">                                return(PK_PARAM);</a>
<a name="ln1345">                            }</a>
<a name="ln1346">                        }</a>
<a name="ln1347">                        /* pwdarg now points at decryption password (-Ppasswd or</a>
<a name="ln1348">                         *  -P passwd); point s at end of passwd to avoid mis-</a>
<a name="ln1349">                         *  interpretation of passwd characters as more options</a>
<a name="ln1350">                         */</a>
<a name="ln1351">                        if (*s != 0)</a>
<a name="ln1352">                            while (*++s != 0)</a>
<a name="ln1353">                                ;</a>
<a name="ln1354">                    }</a>
<a name="ln1355">                    break;</a>
<a name="ln1356">#endif /* CRYPT */</a>
<a name="ln1357">                case ('q'):    /* quiet:  fewer comments/messages */</a>
<a name="ln1358">                    if (negative) {</a>
<a name="ln1359">                        uO.qflag = MAX(uO.qflag-negative,0);</a>
<a name="ln1360">                        negative = 0;</a>
<a name="ln1361">                    } else</a>
<a name="ln1362">                        ++uO.qflag;</a>
<a name="ln1363">                    break;</a>
<a name="ln1364">#ifdef QDOS</a>
<a name="ln1365">                case ('Q'):   /* QDOS flags */</a>
<a name="ln1366">                    qlflag ^= strtol(s, &amp;s, 10);</a>
<a name="ln1367">                    break;    /* we XOR this as we can config qlflags */</a>
<a name="ln1368">#endif</a>
<a name="ln1369">#ifdef DOS_FLX_NLM_OS2_W32</a>
<a name="ln1370">                case ('s'):    /* spaces in filenames:  allow by default */</a>
<a name="ln1371">                    if (negative)</a>
<a name="ln1372">                        uO.sflag = FALSE, negative = 0;</a>
<a name="ln1373">                    else</a>
<a name="ln1374">                        uO.sflag = TRUE;</a>
<a name="ln1375">                    break;</a>
<a name="ln1376">#endif /* DOS_FLX_NLM_OS2_W32 */</a>
<a name="ln1377">                case ('t'):</a>
<a name="ln1378">                    if (negative)</a>
<a name="ln1379">                        uO.tflag = FALSE, negative = 0;</a>
<a name="ln1380">                    else</a>
<a name="ln1381">                        uO.tflag = TRUE;</a>
<a name="ln1382">                    break;</a>
<a name="ln1383">#ifdef TIMESTAMP</a>
<a name="ln1384">                case ('T'):</a>
<a name="ln1385">                    if (negative)</a>
<a name="ln1386">                        uO.T_flag = FALSE, negative = 0;</a>
<a name="ln1387">                    else</a>
<a name="ln1388">                        uO.T_flag = TRUE;</a>
<a name="ln1389">                    break;</a>
<a name="ln1390">#endif</a>
<a name="ln1391">                case ('u'):    /* update (extract only new and newer files) */</a>
<a name="ln1392">                    if (negative)</a>
<a name="ln1393">                        uO.uflag = FALSE, negative = 0;</a>
<a name="ln1394">                    else</a>
<a name="ln1395">                        uO.uflag = TRUE;</a>
<a name="ln1396">                    break;</a>
<a name="ln1397">#ifndef CMS_MVS</a>
<a name="ln1398">                case ('U'):    /* obsolete; to be removed in version 6.0 */</a>
<a name="ln1399">                    if (negative)</a>
<a name="ln1400">                        uO.L_flag = TRUE, negative = 0;</a>
<a name="ln1401">                    else</a>
<a name="ln1402">                        uO.L_flag = FALSE;</a>
<a name="ln1403">                    break;</a>
<a name="ln1404">#endif /* !CMS_MVS */</a>
<a name="ln1405">#ifndef SFX</a>
<a name="ln1406">                case ('v'):    /* verbose */</a>
<a name="ln1407">                    if (negative) {</a>
<a name="ln1408">                        uO.vflag = MAX(uO.vflag-negative,0);</a>
<a name="ln1409">                        negative = 0;</a>
<a name="ln1410">                    } else if (uO.vflag)</a>
<a name="ln1411">                        ++uO.vflag;</a>
<a name="ln1412">                    else</a>
<a name="ln1413">                        uO.vflag = 2;</a>
<a name="ln1414">                    break;</a>
<a name="ln1415">#endif /* !SFX */</a>
<a name="ln1416">#ifndef CMS_MVS</a>
<a name="ln1417">                case ('V'):    /* Version (retain VMS/DEC-20 file versions) */</a>
<a name="ln1418">                    if (negative)</a>
<a name="ln1419">                        uO.V_flag = FALSE, negative = 0;</a>
<a name="ln1420">                    else</a>
<a name="ln1421">                        uO.V_flag = TRUE;</a>
<a name="ln1422">                    break;</a>
<a name="ln1423">#endif /* !CMS_MVS */</a>
<a name="ln1424">                case ('x'):    /* extract:  default */</a>
<a name="ln1425">#ifdef SFX</a>
<a name="ln1426">                    /* when 'x' is the only option in this argument, and the</a>
<a name="ln1427">                     * next arg is not an option, assume this initiates an</a>
<a name="ln1428">                     * exclusion list (-x xlist):  terminate option-scanning</a>
<a name="ln1429">                     * and leave uz_opts with argv still pointing to &quot;-x&quot;;</a>
<a name="ln1430">                     * the xlist is processed later</a>
<a name="ln1431">                     */</a>
<a name="ln1432">                    if (s - argv[0] == 2 &amp;&amp; *s == '\0' &amp;&amp;</a>
<a name="ln1433">                        argc &gt; 1 &amp;&amp; argv[1][0] != '-') {</a>
<a name="ln1434">                        /* break out of nested loops without &quot;++argv;--argc&quot; */</a>
<a name="ln1435">                        goto opts_done;</a>
<a name="ln1436">                    }</a>
<a name="ln1437">#endif /* SFX */</a>
<a name="ln1438">                    break;</a>
<a name="ln1439">#if (defined(RESTORE_UIDGID) || defined(RESTORE_ACL))</a>
<a name="ln1440">                case ('X'):   /* restore owner/protection info (need privs?) */</a>
<a name="ln1441">                    if (negative) {</a>
<a name="ln1442">                        uO.X_flag = MAX(uO.X_flag-negative,0);</a>
<a name="ln1443">                        negative = 0;</a>
<a name="ln1444">                    } else</a>
<a name="ln1445">                        ++uO.X_flag;</a>
<a name="ln1446">                    break;</a>
<a name="ln1447">#endif /* RESTORE_UIDGID || RESTORE_ACL */</a>
<a name="ln1448">                case ('z'):    /* display only the archive comment */</a>
<a name="ln1449">                    if (negative) {</a>
<a name="ln1450">                        uO.zflag = MAX(uO.zflag-negative,0);</a>
<a name="ln1451">                        negative = 0;</a>
<a name="ln1452">                    } else</a>
<a name="ln1453">                        ++uO.zflag;</a>
<a name="ln1454">                    break;</a>
<a name="ln1455">#ifndef SFX</a>
<a name="ln1456">                case ('Z'):    /* should have been first option (ZipInfo) */</a>
<a name="ln1457">                    Info(slide, 0x401, ((char *)slide, LoadFarString(Zfirst)));</a>
<a name="ln1458">                    error = TRUE;</a>
<a name="ln1459">                    break;</a>
<a name="ln1460">#endif /* !SFX */</a>
<a name="ln1461">#ifdef DOS_H68_OS2_W32</a>
<a name="ln1462">                case ('$'):</a>
<a name="ln1463">                    if (negative) {</a>
<a name="ln1464">                        uO.volflag = MAX(uO.volflag-negative,0);</a>
<a name="ln1465">                        negative = 0;</a>
<a name="ln1466">                    } else</a>
<a name="ln1467">                        ++uO.volflag;</a>
<a name="ln1468">                    break;</a>
<a name="ln1469">#endif /* DOS_H68_OS2_W32 */</a>
<a name="ln1470">#if (!defined(RISCOS) &amp;&amp; !defined(CMS_MVS) &amp;&amp; !defined(TANDEM))</a>
<a name="ln1471">                case (':'):</a>
<a name="ln1472">                    if (negative) {</a>
<a name="ln1473">                        uO.ddotflag = MAX(uO.ddotflag-negative,0);</a>
<a name="ln1474">                        negative = 0;</a>
<a name="ln1475">                    } else</a>
<a name="ln1476">                        ++uO.ddotflag;</a>
<a name="ln1477">                    break;</a>
<a name="ln1478">#endif /* !RISCOS &amp;&amp; !CMS_MVS &amp;&amp; !TANDEM */</a>
<a name="ln1479">                default:</a>
<a name="ln1480">                    error = TRUE;</a>
<a name="ln1481">                    break;</a>
<a name="ln1482"> </a>
<a name="ln1483">            } /* end switch */</a>
<a name="ln1484">        } /* end while (not end of argument string) */</a>
<a name="ln1485">    } /* end while (not done with switches) */</a>
<a name="ln1486"> </a>
<a name="ln1487">/*---------------------------------------------------------------------------</a>
<a name="ln1488">    Check for nonsensical combinations of options.</a>
<a name="ln1489">  ---------------------------------------------------------------------------*/</a>
<a name="ln1490"> </a>
<a name="ln1491">#ifdef SFX</a>
<a name="ln1492">opts_done:  /* yes, very ugly...but only used by UnZipSFX with -x xlist */</a>
<a name="ln1493">#endif</a>
<a name="ln1494"> </a>
<a name="ln1495">    if ((uO.cflag &amp;&amp; uO.tflag) || (uO.cflag &amp;&amp; uO.uflag) ||</a>
<a name="ln1496">        (uO.tflag &amp;&amp; uO.uflag) || (uO.fflag &amp;&amp; uO.overwrite_none))</a>
<a name="ln1497">    {</a>
<a name="ln1498">        Info(slide, 0x401, ((char *)slide, LoadFarString(InvalidOptionsMsg)));</a>
<a name="ln1499">        error = TRUE;</a>
<a name="ln1500">    }</a>
<a name="ln1501">    if (uO.aflag &gt; 2)</a>
<a name="ln1502">        uO.aflag = 2;</a>
<a name="ln1503">#ifdef VMS</a>
<a name="ln1504">    if (uO.bflag &gt; 2)</a>
<a name="ln1505">        uO.bflag = 2;</a>
<a name="ln1506">#endif</a>
<a name="ln1507">    if (uO.overwrite_all &amp;&amp; uO.overwrite_none) {</a>
<a name="ln1508">        Info(slide, 0x401, ((char *)slide, LoadFarString(IgnoreOOptionMsg)));</a>
<a name="ln1509">        uO.overwrite_all = FALSE;</a>
<a name="ln1510">    }</a>
<a name="ln1511">#ifdef MORE</a>
<a name="ln1512">    if (G.M_flag &amp;&amp; !isatty(1))  /* stdout redirected: &quot;more&quot; func. useless */</a>
<a name="ln1513">        G.M_flag = 0;</a>
<a name="ln1514">#endif</a>
<a name="ln1515"> </a>
<a name="ln1516">#ifdef SFX</a>
<a name="ln1517">    if (error)</a>
<a name="ln1518">#else</a>
<a name="ln1519">    if ((argc-- == 0) || error)</a>
<a name="ln1520">#endif</a>
<a name="ln1521">    {</a>
<a name="ln1522">        *pargc = argc;</a>
<a name="ln1523">        *pargv = argv;</a>
<a name="ln1524">#ifndef SFX</a>
<a name="ln1525">        if (uO.vflag &gt;= 2 &amp;&amp; argc == -1) {              /* &quot;unzip -v&quot; */</a>
<a name="ln1526">            show_version_info(__G);</a>
<a name="ln1527">            return PK_OK;</a>
<a name="ln1528">        }</a>
<a name="ln1529">        if (!G.noargs &amp;&amp; !error)</a>
<a name="ln1530">            error = PK_PARAM;   /* had options (not -h or -v) but no zipfile */</a>
<a name="ln1531">#endif /* !SFX */</a>
<a name="ln1532">        return USAGE(error);</a>
<a name="ln1533">    }</a>
<a name="ln1534"> </a>
<a name="ln1535">#ifdef SFX</a>
<a name="ln1536">    /* print our banner unless we're being fairly quiet */</a>
<a name="ln1537">    if (uO.qflag &lt; 2)</a>
<a name="ln1538">        Info(slide, error? 1 : 0, ((char *)slide, LoadFarString(UnzipSFXBanner),</a>
<a name="ln1539">          UZ_MAJORVER, UZ_MINORVER, UZ_PATCHLEVEL, UZ_BETALEVEL,</a>
<a name="ln1540">          LoadFarStringSmall(VersionDate)));</a>
<a name="ln1541">#ifdef BETA</a>
<a name="ln1542">    /* always print the beta warning:  no unauthorized distribution!! */</a>
<a name="ln1543">    Info(slide, error? 1 : 0, ((char *)slide, LoadFarString(BetaVersion), &quot;\n&quot;,</a>
<a name="ln1544">      &quot;SFX&quot;));</a>
<a name="ln1545">#endif</a>
<a name="ln1546">#endif /* SFX */</a>
<a name="ln1547"> </a>
<a name="ln1548">    if (uO.cflag || uO.tflag || uO.vflag || uO.zflag</a>
<a name="ln1549">#ifdef TIMESTAMP</a>
<a name="ln1550">                                                     || uO.T_flag</a>
<a name="ln1551">#endif</a>
<a name="ln1552">                                                                 )</a>
<a name="ln1553">        G.extract_flag = FALSE;</a>
<a name="ln1554">    else</a>
<a name="ln1555">        G.extract_flag = TRUE;</a>
<a name="ln1556"> </a>
<a name="ln1557">    *pargc = argc;</a>
<a name="ln1558">    *pargv = argv;</a>
<a name="ln1559">    return PK_OK;</a>
<a name="ln1560"> </a>
<a name="ln1561">} /* end function uz_opts() */</a>
<a name="ln1562"> </a>
<a name="ln1563"> </a>
<a name="ln1564"> </a>
<a name="ln1565"> </a>
<a name="ln1566">/********************/</a>
<a name="ln1567">/* Function usage() */</a>
<a name="ln1568">/********************/</a>
<a name="ln1569"> </a>
<a name="ln1570">#ifdef SFX</a>
<a name="ln1571">#  ifdef VMS</a>
<a name="ln1572">#    define LOCAL &quot;X.  Quote uppercase options&quot;</a>
<a name="ln1573">#  endif</a>
<a name="ln1574">#  ifdef UNIX</a>
<a name="ln1575">#    define LOCAL &quot;X&quot;</a>
<a name="ln1576">#  endif</a>
<a name="ln1577">#  ifdef DOS_OS2_W32</a>
<a name="ln1578">#    define LOCAL &quot;s$&quot;</a>
<a name="ln1579">#  endif</a>
<a name="ln1580">#  if (defined(FLEXOS) || defined(NLM))</a>
<a name="ln1581">#    define LOCAL &quot;s&quot;</a>
<a name="ln1582">#  endif</a>
<a name="ln1583">#  ifdef AMIGA</a>
<a name="ln1584">#    define LOCAL &quot;N&quot;</a>
<a name="ln1585">#  endif</a>
<a name="ln1586">   /* Default for all other systems: */</a>
<a name="ln1587">#  ifndef LOCAL</a>
<a name="ln1588">#    define LOCAL &quot;&quot;</a>
<a name="ln1589">#  endif</a>
<a name="ln1590"> </a>
<a name="ln1591">#  ifdef MORE</a>
<a name="ln1592">#    define SFXOPT1 &quot;M&quot;</a>
<a name="ln1593">#  else</a>
<a name="ln1594">#    define SFXOPT1 &quot;&quot;</a>
<a name="ln1595">#  endif</a>
<a name="ln1596"> </a>
<a name="ln1597">int usage(__G__ error)   /* return PK-type error code */</a>
<a name="ln1598">    __GDEF</a>
<a name="ln1599">    int error;</a>
<a name="ln1600">{</a>
<a name="ln1601">    Info(slide, error? 1 : 0, ((char *)slide, LoadFarString(UnzipSFXBanner),</a>
<a name="ln1602">      UZ_MAJORVER, UZ_MINORVER, UZ_PATCHLEVEL, UZ_BETALEVEL,</a>
<a name="ln1603">      LoadFarStringSmall(VersionDate)));</a>
<a name="ln1604">    Info(slide, error? 1 : 0, ((char *)slide, LoadFarString(UnzipSFXOpts),</a>
<a name="ln1605">      SFXOPT1, LOCAL));</a>
<a name="ln1606">#ifdef BETA</a>
<a name="ln1607">    Info(slide, error? 1 : 0, ((char *)slide, LoadFarString(BetaVersion), &quot;\n&quot;,</a>
<a name="ln1608">      &quot;SFX&quot;));</a>
<a name="ln1609">#endif</a>
<a name="ln1610"> </a>
<a name="ln1611">    if (error)</a>
<a name="ln1612">        return PK_PARAM;</a>
<a name="ln1613">    else</a>
<a name="ln1614">        return PK_COOL;     /* just wanted usage screen: no error */</a>
<a name="ln1615"> </a>
<a name="ln1616">} /* end function usage() */</a>
<a name="ln1617"> </a>
<a name="ln1618"> </a>
<a name="ln1619"> </a>
<a name="ln1620"> </a>
<a name="ln1621"> </a>
<a name="ln1622">#else /* !SFX */</a>
<a name="ln1623">#  ifdef VMS</a>
<a name="ln1624">#    define QUOT '\&quot;'</a>
<a name="ln1625">#    define QUOTS &quot;\&quot;&quot;</a>
<a name="ln1626">#  else</a>
<a name="ln1627">#    define QUOT ' '</a>
<a name="ln1628">#    define QUOTS &quot;&quot;</a>
<a name="ln1629">#  endif</a>
<a name="ln1630"> </a>
<a name="ln1631">int usage(__G__ error)   /* return PK-type error code */</a>
<a name="ln1632">    __GDEF</a>
<a name="ln1633">    int error;</a>
<a name="ln1634">{</a>
<a name="ln1635">    int flag = (error? 1 : 0);</a>
<a name="ln1636"> </a>
<a name="ln1637"> </a>
<a name="ln1638">/*---------------------------------------------------------------------------</a>
<a name="ln1639">    Print either ZipInfo usage or UnZip usage, depending on incantation.</a>
<a name="ln1640">    (Strings must be no longer than 512 bytes for Turbo C, apparently.)</a>
<a name="ln1641">  ---------------------------------------------------------------------------*/</a>
<a name="ln1642"> </a>
<a name="ln1643">    if (uO.zipinfo_mode) {</a>
<a name="ln1644"> </a>
<a name="ln1645">#ifndef NO_ZIPINFO</a>
<a name="ln1646"> </a>
<a name="ln1647">        Info(slide, flag, ((char *)slide, LoadFarString(ZipInfoUsageLine1),</a>
<a name="ln1648">          ZI_MAJORVER, ZI_MINORVER, UZ_PATCHLEVEL, UZ_BETALEVEL,</a>
<a name="ln1649">          LoadFarStringSmall(VersionDate),</a>
<a name="ln1650">          LoadFarStringSmall2(ZipInfoExample), QUOTS,QUOTS));</a>
<a name="ln1651">        Info(slide, flag, ((char *)slide, LoadFarString(ZipInfoUsageLine2)));</a>
<a name="ln1652">        Info(slide, flag, ((char *)slide, LoadFarString(ZipInfoUsageLine3),</a>
<a name="ln1653">          QUOT,QUOT, QUOT,QUOT, LoadFarStringSmall(ZipInfoUsageLine4)));</a>
<a name="ln1654">#ifdef VMS</a>
<a name="ln1655">        Info(slide, flag, ((char *)slide, &quot;\nRemember that non-lowercase\</a>
<a name="ln1656"> filespecs must be quoted in VMS (e.g., \&quot;Makefile\&quot;).\n&quot;));</a>
<a name="ln1657">#endif</a>
<a name="ln1658"> </a>
<a name="ln1659">#endif /* !NO_ZIPINFO */</a>
<a name="ln1660"> </a>
<a name="ln1661">    } else {   /* UnZip mode */</a>
<a name="ln1662"> </a>
<a name="ln1663">        Info(slide, flag, ((char *)slide, LoadFarString(UnzipUsageLine1),</a>
<a name="ln1664">          UZ_MAJORVER, UZ_MINORVER, UZ_PATCHLEVEL, UZ_BETALEVEL,</a>
<a name="ln1665">          LoadFarStringSmall(VersionDate)));</a>
<a name="ln1666">#ifdef BETA</a>
<a name="ln1667">        Info(slide, flag, ((char *)slide, LoadFarString(BetaVersion), &quot;&quot;, &quot;&quot;));</a>
<a name="ln1668">#endif</a>
<a name="ln1669"> </a>
<a name="ln1670">        Info(slide, flag, ((char *)slide, LoadFarString(UnzipUsageLine2),</a>
<a name="ln1671">          ZIPINFO_MODE_OPTION, LoadFarStringSmall(ZipInfoMode)));</a>
<a name="ln1672">#ifdef VMS</a>
<a name="ln1673">        if (!error)  /* maybe no command-line tail found; show extra help */</a>
<a name="ln1674">            Info(slide, flag, ((char *)slide, LoadFarString(VMSusageLine2b)));</a>
<a name="ln1675">#endif</a>
<a name="ln1676"> </a>
<a name="ln1677">        Info(slide, flag, ((char *)slide, LoadFarString(UnzipUsageLine3),</a>
<a name="ln1678">          LoadFarStringSmall(local1)));</a>
<a name="ln1679"> </a>
<a name="ln1680">        Info(slide, flag, ((char *)slide, LoadFarString(UnzipUsageLine4),</a>
<a name="ln1681">          QUOT,QUOT, QUOT,QUOT, LoadFarStringSmall(local2), QUOT,QUOT,</a>
<a name="ln1682">          LoadFarStringSmall2(local3)));</a>
<a name="ln1683"> </a>
<a name="ln1684">        /* This is extra work for SMALL_MEM, but it will work since</a>
<a name="ln1685">         * LoadFarStringSmall2 uses the same buffer.  Remember, this</a>
<a name="ln1686">         * is a hack. */</a>
<a name="ln1687">        Info(slide, flag, ((char *)slide, LoadFarString(UnzipUsageLine5),</a>
<a name="ln1688">          LoadFarStringSmall(Example2), LoadFarStringSmall2(Example3),</a>
<a name="ln1689">          LoadFarStringSmall2(Example3)));</a>
<a name="ln1690"> </a>
<a name="ln1691">    } /* end if (uO.zipinfo_mode) */</a>
<a name="ln1692"> </a>
<a name="ln1693">    if (error)</a>
<a name="ln1694">        return PK_PARAM;</a>
<a name="ln1695">    else</a>
<a name="ln1696">        return PK_COOL;     /* just wanted usage screen: no error */</a>
<a name="ln1697"> </a>
<a name="ln1698">} /* end function usage() */</a>
<a name="ln1699"> </a>
<a name="ln1700">#endif /* ?SFX */</a>
<a name="ln1701"> </a>
<a name="ln1702"> </a>
<a name="ln1703"> </a>
<a name="ln1704"> </a>
<a name="ln1705">#ifndef SFX</a>
<a name="ln1706"> </a>
<a name="ln1707">/********************************/</a>
<a name="ln1708">/* Function show_version_info() */</a>
<a name="ln1709">/********************************/</a>
<a name="ln1710"> </a>
<a name="ln1711">static void show_version_info(__G)</a>
<a name="ln1712">    __GDEF</a>
<a name="ln1713">{</a>
<a name="ln1714">    if (uO.qflag &gt; 3)                           /* &quot;unzip -vqqqq&quot; */</a>
<a name="ln1715">        Info(slide, 0, ((char *)slide, &quot;%d\n&quot;,</a>
<a name="ln1716">          (UZ_MAJORVER*100 + UZ_MINORVER*10 + UZ_PATCHLEVEL)));</a>
<a name="ln1717">    else {</a>
<a name="ln1718">        char *envptr, *getenv();</a>
<a name="ln1719">        int numopts = 0;</a>
<a name="ln1720"> </a>
<a name="ln1721">        Info(slide, 0, ((char *)slide, LoadFarString(UnzipUsageLine1v),</a>
<a name="ln1722">          UZ_MAJORVER, UZ_MINORVER, UZ_PATCHLEVEL, UZ_BETALEVEL,</a>
<a name="ln1723">          LoadFarStringSmall(VersionDate)));</a>
<a name="ln1724">        Info(slide, 0, ((char *)slide,</a>
<a name="ln1725">          LoadFarString(UnzipUsageLine2v)));</a>
<a name="ln1726">        version(__G);</a>
<a name="ln1727">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptions)));</a>
<a name="ln1728">#ifdef ACORN_FTYPE_NFS</a>
<a name="ln1729">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1730">          LoadFarStringSmall(AcornFtypeNFS)));</a>
<a name="ln1731">        ++numopts;</a>
<a name="ln1732">#endif</a>
<a name="ln1733">#ifdef ASM_CRC</a>
<a name="ln1734">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1735">          LoadFarStringSmall(AsmCRC)));</a>
<a name="ln1736">        ++numopts;</a>
<a name="ln1737">#endif</a>
<a name="ln1738">#ifdef ASM_INFLATECODES</a>
<a name="ln1739">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1740">          LoadFarStringSmall(AsmInflateCodes)));</a>
<a name="ln1741">        ++numopts;</a>
<a name="ln1742">#endif</a>
<a name="ln1743">#ifdef CHECK_VERSIONS</a>
<a name="ln1744">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1745">          LoadFarStringSmall(Check_Versions)));</a>
<a name="ln1746">        ++numopts;</a>
<a name="ln1747">#endif</a>
<a name="ln1748">#ifdef COPYRIGHT_CLEAN</a>
<a name="ln1749">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1750">          LoadFarStringSmall(Copyright_Clean)));</a>
<a name="ln1751">        ++numopts;</a>
<a name="ln1752">#endif</a>
<a name="ln1753">#ifdef DEBUG</a>
<a name="ln1754">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1755">          LoadFarStringSmall(UDebug)));</a>
<a name="ln1756">        ++numopts;</a>
<a name="ln1757">#endif</a>
<a name="ln1758">#ifdef DEBUG_TIME</a>
<a name="ln1759">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1760">          LoadFarStringSmall(DebugTime)));</a>
<a name="ln1761">        ++numopts;</a>
<a name="ln1762">#endif</a>
<a name="ln1763">#ifdef DLL</a>
<a name="ln1764">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1765">          LoadFarStringSmall(Dll)));</a>
<a name="ln1766">        ++numopts;</a>
<a name="ln1767">#endif</a>
<a name="ln1768">#ifdef DOSWILD</a>
<a name="ln1769">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1770">          LoadFarStringSmall(DosWild)));</a>
<a name="ln1771">        ++numopts;</a>
<a name="ln1772">#endif</a>
<a name="ln1773">#ifdef LZW_CLEAN</a>
<a name="ln1774">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1775">          LoadFarStringSmall(LZW_Clean)));</a>
<a name="ln1776">        ++numopts;</a>
<a name="ln1777">#endif</a>
<a name="ln1778">#ifndef MORE</a>
<a name="ln1779">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1780">          LoadFarStringSmall(No_More)));</a>
<a name="ln1781">        ++numopts;</a>
<a name="ln1782">#endif</a>
<a name="ln1783">#ifdef NO_ZIPINFO</a>
<a name="ln1784">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1785">          LoadFarStringSmall(No_ZipInfo)));</a>
<a name="ln1786">        ++numopts;</a>
<a name="ln1787">#endif</a>
<a name="ln1788">#ifdef NTSD_EAS</a>
<a name="ln1789">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1790">          LoadFarStringSmall(NTSDExtAttrib)));</a>
<a name="ln1791">        ++numopts;</a>
<a name="ln1792">#endif</a>
<a name="ln1793">#ifdef OLD_THEOS_EXTRA</a>
<a name="ln1794">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1795">          LoadFarStringSmall(OldTheosExtra)));</a>
<a name="ln1796">        ++numopts;</a>
<a name="ln1797">#endif</a>
<a name="ln1798">#ifdef OS2_EAS</a>
<a name="ln1799">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1800">          LoadFarStringSmall(OS2ExtAttrib)));</a>
<a name="ln1801">        ++numopts;</a>
<a name="ln1802">#endif</a>
<a name="ln1803">#ifdef QLZIP</a>
<a name="ln1804">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1805">          LoadFarStringSmall(SMSExFldOnUnix)));</a>
<a name="ln1806">        ++numopts;</a>
<a name="ln1807">#endif</a>
<a name="ln1808">#ifdef REENTRANT</a>
<a name="ln1809">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1810">          LoadFarStringSmall(Reentrant)));</a>
<a name="ln1811">        ++numopts;</a>
<a name="ln1812">#endif</a>
<a name="ln1813">#ifdef REGARGS</a>
<a name="ln1814">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1815">          LoadFarStringSmall(RegArgs)));</a>
<a name="ln1816">        ++numopts;</a>
<a name="ln1817">#endif</a>
<a name="ln1818">#ifdef RETURN_CODES</a>
<a name="ln1819">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1820">          LoadFarStringSmall(Return_Codes)));</a>
<a name="ln1821">        ++numopts;</a>
<a name="ln1822">#endif</a>
<a name="ln1823">#ifdef SET_DIR_ATTRIB</a>
<a name="ln1824">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1825">          LoadFarStringSmall(SetDirAttrib)));</a>
<a name="ln1826">        ++numopts;</a>
<a name="ln1827">#endif</a>
<a name="ln1828">#ifdef TIMESTAMP</a>
<a name="ln1829">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1830">          LoadFarStringSmall(TimeStamp)));</a>
<a name="ln1831">        ++numopts;</a>
<a name="ln1832">#endif</a>
<a name="ln1833">#ifdef UNIXBACKUP</a>
<a name="ln1834">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1835">          LoadFarStringSmall(UnixBackup)));</a>
<a name="ln1836">        ++numopts;</a>
<a name="ln1837">#endif</a>
<a name="ln1838">#ifdef USE_EF_UT_TIME</a>
<a name="ln1839">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1840">          LoadFarStringSmall(Use_EF_UT_time)));</a>
<a name="ln1841">        ++numopts;</a>
<a name="ln1842">#endif</a>
<a name="ln1843">#ifndef COPYRIGHT_CLEAN</a>
<a name="ln1844">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1845">          LoadFarStringSmall(Use_Smith_Code)));</a>
<a name="ln1846">        ++numopts;</a>
<a name="ln1847">#endif</a>
<a name="ln1848">#ifndef LZW_CLEAN</a>
<a name="ln1849">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1850">          LoadFarStringSmall(Use_Unshrink)));</a>
<a name="ln1851">        ++numopts;</a>
<a name="ln1852">#endif</a>
<a name="ln1853">#ifdef USE_DEFLATE64</a>
<a name="ln1854">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1855">          LoadFarStringSmall(Use_Deflate64)));</a>
<a name="ln1856">        ++numopts;</a>
<a name="ln1857">#endif</a>
<a name="ln1858">#ifdef MULT_VOLUME</a>
<a name="ln1859">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1860">          LoadFarStringSmall(Use_MultiVol)));</a>
<a name="ln1861">        ++numopts;</a>
<a name="ln1862">#endif</a>
<a name="ln1863">#  if (defined(__DJGPP__) &amp;&amp; (__DJGPP__ &gt;= 2))</a>
<a name="ln1864">#    ifdef USE_DJGPP_ENV</a>
<a name="ln1865">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1866">          LoadFarStringSmall(Use_DJGPP_Env)));</a>
<a name="ln1867">        ++numopts;</a>
<a name="ln1868">#    endif</a>
<a name="ln1869">#    ifdef USE_DJGPP_GLOB</a>
<a name="ln1870">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1871">          LoadFarStringSmall(Use_DJGPP_Glob)));</a>
<a name="ln1872">        ++numopts;</a>
<a name="ln1873">#    endif</a>
<a name="ln1874">#  endif /* __DJGPP__ &amp;&amp; (__DJGPP__ &gt;= 2) */</a>
<a name="ln1875">#ifdef USE_VFAT</a>
<a name="ln1876">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1877">          LoadFarStringSmall(Use_VFAT_support)));</a>
<a name="ln1878">        ++numopts;</a>
<a name="ln1879">#endif</a>
<a name="ln1880">#ifdef USE_ZLIB</a>
<a name="ln1881">        sprintf((char *)(slide+256), LoadFarStringSmall(UseZlib),</a>
<a name="ln1882">          ZLIB_VERSION, zlib_version);</a>
<a name="ln1883">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1884">          (char *)(slide+256)));</a>
<a name="ln1885">        ++numopts;</a>
<a name="ln1886">#endif</a>
<a name="ln1887">#ifdef VMS_TEXT_CONV</a>
<a name="ln1888">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1889">          LoadFarStringSmall(VmsTextConv)));</a>
<a name="ln1890">        ++numopts;</a>
<a name="ln1891">#endif</a>
<a name="ln1892">#ifdef VMSCLI</a>
<a name="ln1893">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1894">          LoadFarStringSmall(VmsCLI)));</a>
<a name="ln1895">        ++numopts;</a>
<a name="ln1896">#endif</a>
<a name="ln1897">#ifdef VMSWILD</a>
<a name="ln1898">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1899">          LoadFarStringSmall(VmsWild)));</a>
<a name="ln1900">        ++numopts;</a>
<a name="ln1901">#endif</a>
<a name="ln1902">#ifdef WILD_STOP_AT_DIR</a>
<a name="ln1903">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1904">          LoadFarStringSmall(WildStopAtDir)));</a>
<a name="ln1905">        ++numopts;</a>
<a name="ln1906">#endif</a>
<a name="ln1907">#if CRYPT</a>
<a name="ln1908"># ifdef PASSWD_FROM_STDIN</a>
<a name="ln1909">        Info(slide, 0, ((char *)slide, LoadFarString(CompileOptFormat),</a>
<a name="ln1910">          LoadFarStringSmall(PasswdStdin)));</a>
<a name="ln1911"># endif</a>
<a name="ln1912">        Info(slide, 0, ((char *)slide, LoadFarString(Decryption),</a>
<a name="ln1913">          CR_MAJORVER, CR_MINORVER, CR_BETA_VER,</a>
<a name="ln1914">          LoadFarStringSmall(CryptDate)));</a>
<a name="ln1915">        ++numopts;</a>
<a name="ln1916">#endif /* CRYPT */</a>
<a name="ln1917">        if (numopts == 0)</a>
<a name="ln1918">            Info(slide, 0, ((char *)slide,</a>
<a name="ln1919">              LoadFarString(CompileOptFormat),</a>
<a name="ln1920">              LoadFarStringSmall(None)));</a>
<a name="ln1921"> </a>
<a name="ln1922">        Info(slide, 0, ((char *)slide, LoadFarString(EnvOptions)));</a>
<a name="ln1923">        envptr = getenv(LoadFarStringSmall(EnvUnZip));</a>
<a name="ln1924">        Info(slide, 0, ((char *)slide, LoadFarString(EnvOptFormat),</a>
<a name="ln1925">          LoadFarStringSmall(EnvUnZip),</a>
<a name="ln1926">          (envptr == (char *)NULL || *envptr == 0)?</a>
<a name="ln1927">          LoadFarStringSmall2(None) : envptr));</a>
<a name="ln1928">        envptr = getenv(LoadFarStringSmall(EnvUnZip2));</a>
<a name="ln1929">        Info(slide, 0, ((char *)slide, LoadFarString(EnvOptFormat),</a>
<a name="ln1930">          LoadFarStringSmall(EnvUnZip2),</a>
<a name="ln1931">          (envptr == (char *)NULL || *envptr == 0)?</a>
<a name="ln1932">          LoadFarStringSmall2(None) : envptr));</a>
<a name="ln1933">        envptr = getenv(LoadFarStringSmall(EnvZipInfo));</a>
<a name="ln1934">        Info(slide, 0, ((char *)slide, LoadFarString(EnvOptFormat),</a>
<a name="ln1935">          LoadFarStringSmall(EnvZipInfo),</a>
<a name="ln1936">          (envptr == (char *)NULL || *envptr == 0)?</a>
<a name="ln1937">          LoadFarStringSmall2(None) : envptr));</a>
<a name="ln1938">        envptr = getenv(LoadFarStringSmall(EnvZipInfo2));</a>
<a name="ln1939">        Info(slide, 0, ((char *)slide, LoadFarString(EnvOptFormat),</a>
<a name="ln1940">          LoadFarStringSmall(EnvZipInfo2),</a>
<a name="ln1941">          (envptr == (char *)NULL || *envptr == 0)?</a>
<a name="ln1942">          LoadFarStringSmall2(None) : envptr));</a>
<a name="ln1943">#ifndef __RSXNT__</a>
<a name="ln1944">#ifdef __EMX__</a>
<a name="ln1945">        envptr = getenv(LoadFarStringSmall(EnvEMX));</a>
<a name="ln1946">        Info(slide, 0, ((char *)slide, LoadFarString(EnvOptFormat),</a>
<a name="ln1947">          LoadFarStringSmall(EnvEMX),</a>
<a name="ln1948">          (envptr == (char *)NULL || *envptr == 0)?</a>
<a name="ln1949">          LoadFarStringSmall2(None) : envptr));</a>
<a name="ln1950">        envptr = getenv(LoadFarStringSmall(EnvEMXOPT));</a>
<a name="ln1951">        Info(slide, 0, ((char *)slide, LoadFarString(EnvOptFormat),</a>
<a name="ln1952">          LoadFarStringSmall(EnvEMXOPT),</a>
<a name="ln1953">          (envptr == (char *)NULL || *envptr == 0)?</a>
<a name="ln1954">          LoadFarStringSmall2(None) : envptr));</a>
<a name="ln1955">#endif /* __EMX__ */</a>
<a name="ln1956">#if (defined(__GO32__) &amp;&amp; (!defined(__DJGPP__) || (__DJGPP__ &lt; 2)))</a>
<a name="ln1957">        envptr = getenv(LoadFarStringSmall(EnvGO32));</a>
<a name="ln1958">        Info(slide, 0, ((char *)slide, LoadFarString(EnvOptFormat),</a>
<a name="ln1959">          LoadFarStringSmall(EnvGO32),</a>
<a name="ln1960">          (envptr == (char *)NULL || *envptr == 0)?</a>
<a name="ln1961">          LoadFarStringSmall2(None) : envptr));</a>
<a name="ln1962">        envptr = getenv(LoadFarStringSmall(EnvGO32TMP));</a>
<a name="ln1963">        Info(slide, 0, ((char *)slide, LoadFarString(EnvOptFormat),</a>
<a name="ln1964">          LoadFarStringSmall(EnvGO32TMP),</a>
<a name="ln1965">          (envptr == (char *)NULL || *envptr == 0)?</a>
<a name="ln1966">          LoadFarStringSmall2(None) : envptr));</a>
<a name="ln1967">#endif /* __GO32__ &amp;&amp; !(__DJGPP__ &gt;= 2) */</a>
<a name="ln1968">#endif /* !__RSXNT__ */</a>
<a name="ln1969">#ifdef RISCOS</a>
<a name="ln1970">        envptr = getenv(LoadFarStringSmall(EnvUnZipExts));</a>
<a name="ln1971">        Info(slide, 0, ((char *)slide, LoadFarString(EnvOptFormat),</a>
<a name="ln1972">          LoadFarStringSmall(EnvUnZipExts),</a>
<a name="ln1973">          (envptr == (char *)NULL || *envptr == 0)?</a>
<a name="ln1974">          LoadFarStringSmall2(None) : envptr));</a>
<a name="ln1975">#endif /* RISCOS */</a>
<a name="ln1976">    }</a>
<a name="ln1977">} /* end function show_version() */</a>
<a name="ln1978"> </a>
<a name="ln1979">#endif /* !SFX */</a>
<a name="ln1980">#endif /* !WINDLL */</a>

</code></pre>
<div class="balloon" rel="1917"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v547/" target="_blank">V547</a> Expression 'numopts == 0' is always false.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
