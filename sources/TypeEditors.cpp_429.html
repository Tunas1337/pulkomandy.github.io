
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>TypeEditors.cpp</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2"> * Copyright 2004-2008, Axel DÃ¶rfler, axeld@pinc-software.de. All rights reserved.</a>
<a name="ln3"> * Distributed under the terms of the MIT License.</a>
<a name="ln4"> */</a>
<a name="ln5"> </a>
<a name="ln6"> </a>
<a name="ln7">#include &quot;TypeEditors.h&quot;</a>
<a name="ln8">#include &quot;DataEditor.h&quot;</a>
<a name="ln9"> </a>
<a name="ln10">#include &lt;stdio.h&gt;</a>
<a name="ln11">#include &lt;stdlib.h&gt;</a>
<a name="ln12"> </a>
<a name="ln13">#include &lt;Alert.h&gt;</a>
<a name="ln14">#include &lt;Autolock.h&gt;</a>
<a name="ln15">#include &lt;Bitmap.h&gt;</a>
<a name="ln16">#include &lt;Catalog.h&gt;</a>
<a name="ln17">#include &lt;IconUtils.h&gt;</a>
<a name="ln18">#include &lt;LayoutBuilder.h&gt;</a>
<a name="ln19">#include &lt;Locale.h&gt;</a>
<a name="ln20">#include &lt;MenuField.h&gt;</a>
<a name="ln21">#include &lt;MenuItem.h&gt;</a>
<a name="ln22">#include &lt;Mime.h&gt;</a>
<a name="ln23">#include &lt;PopUpMenu.h&gt;</a>
<a name="ln24">#include &lt;ScrollBar.h&gt;</a>
<a name="ln25">#include &lt;ScrollView.h&gt;</a>
<a name="ln26">#include &lt;Slider.h&gt;</a>
<a name="ln27">#include &lt;String.h&gt;</a>
<a name="ln28">#include &lt;StringView.h&gt;</a>
<a name="ln29">#include &lt;TextControl.h&gt;</a>
<a name="ln30">#include &lt;TextView.h&gt;</a>
<a name="ln31">#include &lt;TranslationUtils.h&gt;</a>
<a name="ln32">#include &lt;TranslatorFormats.h&gt;</a>
<a name="ln33"> </a>
<a name="ln34"> </a>
<a name="ln35">#undef B_TRANSLATION_CONTEXT</a>
<a name="ln36">#define B_TRANSLATION_CONTEXT &quot;TypeEditors&quot;</a>
<a name="ln37"> </a>
<a name="ln38">static const uint32 kMsgValueChanged = 'vlch';</a>
<a name="ln39">static const uint32 kMsgScaleChanged = 'scch';</a>
<a name="ln40">static const uint32 kMimeTypeItem = 'miti';</a>
<a name="ln41"> </a>
<a name="ln42"> </a>
<a name="ln43">class StringEditor : public TypeEditorView {</a>
<a name="ln44">	public:</a>
<a name="ln45">		StringEditor(DataEditor&amp; editor);</a>
<a name="ln46"> </a>
<a name="ln47">		virtual void AttachedToWindow();</a>
<a name="ln48">		virtual void DetachedFromWindow();</a>
<a name="ln49">		virtual void MessageReceived(BMessage* message);</a>
<a name="ln50"> </a>
<a name="ln51">		virtual void CommitChanges();</a>
<a name="ln52"> </a>
<a name="ln53">	private:</a>
<a name="ln54">		void _UpdateText();</a>
<a name="ln55"> </a>
<a name="ln56">		BTextView*		fTextView;</a>
<a name="ln57">		BString			fPreviousText;</a>
<a name="ln58">};</a>
<a name="ln59"> </a>
<a name="ln60"> </a>
<a name="ln61">class MimeTypeEditor : public TypeEditorView {</a>
<a name="ln62">	public:</a>
<a name="ln63">		MimeTypeEditor(BRect rect, DataEditor&amp; editor);</a>
<a name="ln64"> </a>
<a name="ln65">		virtual void AttachedToWindow();</a>
<a name="ln66">		virtual void DetachedFromWindow();</a>
<a name="ln67">		virtual void MessageReceived(BMessage* message);</a>
<a name="ln68"> </a>
<a name="ln69">		virtual void CommitChanges();</a>
<a name="ln70">		virtual bool TypeMatches();</a>
<a name="ln71"> </a>
<a name="ln72">	private:</a>
<a name="ln73">		void _UpdateText();</a>
<a name="ln74"> </a>
<a name="ln75">		BTextControl*	fTextControl;</a>
<a name="ln76">		BString			fPreviousText;</a>
<a name="ln77">};</a>
<a name="ln78"> </a>
<a name="ln79"> </a>
<a name="ln80">class NumberEditor : public TypeEditorView {</a>
<a name="ln81">	public:</a>
<a name="ln82">		NumberEditor(BRect rect, DataEditor&amp; editor);</a>
<a name="ln83"> </a>
<a name="ln84">		virtual void AttachedToWindow();</a>
<a name="ln85">		virtual void DetachedFromWindow();</a>
<a name="ln86">		virtual void MessageReceived(BMessage* message);</a>
<a name="ln87"> </a>
<a name="ln88">		virtual void CommitChanges();</a>
<a name="ln89">		virtual bool TypeMatches();</a>
<a name="ln90"> </a>
<a name="ln91">	private:</a>
<a name="ln92">		void _UpdateText();</a>
<a name="ln93">		const char* _TypeLabel();</a>
<a name="ln94">		status_t _Format(char* buffer);</a>
<a name="ln95">		size_t _Size();</a>
<a name="ln96"> </a>
<a name="ln97">		BTextControl*	fTextControl;</a>
<a name="ln98">		BString			fPreviousText;</a>
<a name="ln99">};</a>
<a name="ln100"> </a>
<a name="ln101"> </a>
<a name="ln102">class BooleanEditor : public TypeEditorView {</a>
<a name="ln103">	public:</a>
<a name="ln104">		BooleanEditor(BRect rect, DataEditor&amp; editor);</a>
<a name="ln105"> </a>
<a name="ln106">		virtual void AttachedToWindow();</a>
<a name="ln107">		virtual void DetachedFromWindow();</a>
<a name="ln108">		virtual void MessageReceived(BMessage* message);</a>
<a name="ln109"> </a>
<a name="ln110">		virtual void CommitChanges();</a>
<a name="ln111">		virtual bool TypeMatches();</a>
<a name="ln112"> </a>
<a name="ln113">	private:</a>
<a name="ln114">		void _UpdateMenuField();</a>
<a name="ln115"> </a>
<a name="ln116">		BMenuItem*		fFalseMenuItem;</a>
<a name="ln117">		BMenuItem*		fTrueMenuItem;</a>
<a name="ln118">};</a>
<a name="ln119"> </a>
<a name="ln120"> </a>
<a name="ln121">class ImageView : public TypeEditorView {</a>
<a name="ln122">	public:</a>
<a name="ln123">		ImageView(DataEditor &amp;editor);</a>
<a name="ln124">		virtual ~ImageView();</a>
<a name="ln125"> </a>
<a name="ln126">		virtual void AttachedToWindow();</a>
<a name="ln127">		virtual void DetachedFromWindow();</a>
<a name="ln128">		virtual void MessageReceived(BMessage *message);</a>
<a name="ln129">		virtual void Draw(BRect updateRect);</a>
<a name="ln130"> </a>
<a name="ln131">	private:</a>
<a name="ln132">		void _UpdateImage();</a>
<a name="ln133"> </a>
<a name="ln134">		BBitmap*		fBitmap;</a>
<a name="ln135">		BStringView*	fDescriptionView;</a>
<a name="ln136">		BSlider*		fScaleSlider;</a>
<a name="ln137">};</a>
<a name="ln138"> </a>
<a name="ln139"> </a>
<a name="ln140">class MessageView : public TypeEditorView {</a>
<a name="ln141">	public:</a>
<a name="ln142">		MessageView(BRect rect, DataEditor&amp; editor);</a>
<a name="ln143">		virtual ~MessageView();</a>
<a name="ln144"> </a>
<a name="ln145">		virtual void AttachedToWindow();</a>
<a name="ln146">		virtual void DetachedFromWindow();</a>
<a name="ln147">		virtual void MessageReceived(BMessage* message);</a>
<a name="ln148"> </a>
<a name="ln149">		void SetTo(BMessage&amp; message);</a>
<a name="ln150"> </a>
<a name="ln151">	private:</a>
<a name="ln152">		BString _TypeToString(type_code type);</a>
<a name="ln153">		void _UpdateMessage();</a>
<a name="ln154"> </a>
<a name="ln155">		BTextView*		fTextView;</a>
<a name="ln156">};</a>
<a name="ln157"> </a>
<a name="ln158"> </a>
<a name="ln159">//	#pragma mark - TypeEditorView</a>
<a name="ln160"> </a>
<a name="ln161"> </a>
<a name="ln162">TypeEditorView::TypeEditorView(BRect rect, const char *name,</a>
<a name="ln163">		uint32 resizingMode, uint32 flags, DataEditor&amp; editor)</a>
<a name="ln164">	: BView(rect, name, resizingMode, flags),</a>
<a name="ln165">	fEditor(editor)</a>
<a name="ln166">{</a>
<a name="ln167">}</a>
<a name="ln168"> </a>
<a name="ln169"> </a>
<a name="ln170">TypeEditorView::TypeEditorView(const char *name, uint32 flags,</a>
<a name="ln171">		DataEditor&amp; editor)</a>
<a name="ln172">	: BView(name, flags),</a>
<a name="ln173">	fEditor(editor)</a>
<a name="ln174">{</a>
<a name="ln175">}</a>
<a name="ln176"> </a>
<a name="ln177"> </a>
<a name="ln178">TypeEditorView::~TypeEditorView()</a>
<a name="ln179">{</a>
<a name="ln180">}</a>
<a name="ln181"> </a>
<a name="ln182"> </a>
<a name="ln183">void</a>
<a name="ln184">TypeEditorView::CommitChanges()</a>
<a name="ln185">{</a>
<a name="ln186">	// the default just does nothing here</a>
<a name="ln187">}</a>
<a name="ln188"> </a>
<a name="ln189"> </a>
<a name="ln190">bool</a>
<a name="ln191">TypeEditorView::TypeMatches()</a>
<a name="ln192">{</a>
<a name="ln193">	// the default is to accept anything that easily fits into memory</a>
<a name="ln194"> </a>
<a name="ln195">	system_info info;</a>
<a name="ln196">	get_system_info(&amp;info);</a>
<a name="ln197"> </a>
<a name="ln198">	return uint64(fEditor.FileSize()) / B_PAGE_SIZE &lt; info.max_pages / 2;</a>
<a name="ln199">}</a>
<a name="ln200"> </a>
<a name="ln201"> </a>
<a name="ln202">//	#pragma mark - StringEditor</a>
<a name="ln203"> </a>
<a name="ln204"> </a>
<a name="ln205">StringEditor::StringEditor(DataEditor&amp; editor)</a>
<a name="ln206">	: TypeEditorView(B_TRANSLATE(&quot;String editor&quot;), 0, editor)</a>
<a name="ln207">{</a>
<a name="ln208">	SetViewUIColor(B_PANEL_BACKGROUND_COLOR);</a>
<a name="ln209">	SetLayout(new BGroupLayout(B_VERTICAL));</a>
<a name="ln210"> </a>
<a name="ln211">	BStringView *stringView = new BStringView(B_EMPTY_STRING,</a>
<a name="ln212">		B_TRANSLATE(&quot;Contents:&quot;));</a>
<a name="ln213">	stringView-&gt;ResizeToPreferred();</a>
<a name="ln214">	AddChild(stringView);</a>
<a name="ln215"> </a>
<a name="ln216">	fTextView = new BTextView(B_EMPTY_STRING, B_WILL_DRAW);</a>
<a name="ln217"> </a>
<a name="ln218">	BScrollView* scrollView = new BScrollView(&quot;scroller&quot;, fTextView,</a>
<a name="ln219">		B_WILL_DRAW, true, true);</a>
<a name="ln220">	AddChild(scrollView);</a>
<a name="ln221">}</a>
<a name="ln222"> </a>
<a name="ln223"> </a>
<a name="ln224">void</a>
<a name="ln225">StringEditor::_UpdateText()</a>
<a name="ln226">{</a>
<a name="ln227">	BAutolock locker(fEditor);</a>
<a name="ln228"> </a>
<a name="ln229">	size_t viewSize = fEditor.ViewSize();</a>
<a name="ln230">	// that may need some more memory...</a>
<a name="ln231">	if ((off_t)viewSize &lt; fEditor.FileSize())</a>
<a name="ln232">		fEditor.SetViewSize(fEditor.FileSize());</a>
<a name="ln233"> </a>
<a name="ln234">	const char *buffer;</a>
<a name="ln235">	if (fEditor.GetViewBuffer((const uint8 **)&amp;buffer) == B_OK) {</a>
<a name="ln236">		fTextView-&gt;SetText(buffer);</a>
<a name="ln237">		fPreviousText.SetTo(buffer);</a>
<a name="ln238">	}</a>
<a name="ln239"> </a>
<a name="ln240">	// restore old view size</a>
<a name="ln241">	fEditor.SetViewSize(viewSize);</a>
<a name="ln242">}</a>
<a name="ln243"> </a>
<a name="ln244"> </a>
<a name="ln245">void</a>
<a name="ln246">StringEditor::CommitChanges()</a>
<a name="ln247">{</a>
<a name="ln248">	if (fPreviousText != fTextView-&gt;Text()) {</a>
<a name="ln249">		fEditor.Replace(0, (const uint8 *)fTextView-&gt;Text(),</a>
<a name="ln250">			fTextView-&gt;TextLength() + 1);</a>
<a name="ln251">	}</a>
<a name="ln252">}</a>
<a name="ln253"> </a>
<a name="ln254"> </a>
<a name="ln255">void</a>
<a name="ln256">StringEditor::AttachedToWindow()</a>
<a name="ln257">{</a>
<a name="ln258">	fEditor.StartWatching(this);</a>
<a name="ln259"> </a>
<a name="ln260">	_UpdateText();</a>
<a name="ln261">}</a>
<a name="ln262"> </a>
<a name="ln263"> </a>
<a name="ln264">void</a>
<a name="ln265">StringEditor::DetachedFromWindow()</a>
<a name="ln266">{</a>
<a name="ln267">	fEditor.StopWatching(this);</a>
<a name="ln268"> </a>
<a name="ln269">	CommitChanges();</a>
<a name="ln270">}</a>
<a name="ln271"> </a>
<a name="ln272"> </a>
<a name="ln273">void</a>
<a name="ln274">StringEditor::MessageReceived(BMessage *message)</a>
<a name="ln275">{</a>
<a name="ln276">	BView::MessageReceived(message);</a>
<a name="ln277">}</a>
<a name="ln278"> </a>
<a name="ln279"> </a>
<a name="ln280">//	#pragma mark - MimeTypeEditor</a>
<a name="ln281"> </a>
<a name="ln282"> </a>
<a name="ln283">MimeTypeEditor::MimeTypeEditor(BRect rect, DataEditor&amp; editor)</a>
<a name="ln284">	: TypeEditorView(rect, B_TRANSLATE(&quot;MIME type editor&quot;), B_FOLLOW_LEFT_RIGHT, 0, editor)</a>
<a name="ln285">{</a>
<a name="ln286">	SetViewUIColor(B_PANEL_BACKGROUND_COLOR);</a>
<a name="ln287"> </a>
<a name="ln288">	fTextControl = new BTextControl(rect.InsetByCopy(5, 5), B_EMPTY_STRING,</a>
<a name="ln289">		B_TRANSLATE(&quot;MIME type:&quot;), NULL, new BMessage(kMsgValueChanged), B_FOLLOW_ALL);</a>
<a name="ln290">	fTextControl-&gt;SetDivider(StringWidth(fTextControl-&gt;Label()) + 8);</a>
<a name="ln291"> </a>
<a name="ln292">	float width, height;</a>
<a name="ln293">	fTextControl-&gt;GetPreferredSize(&amp;width, &amp;height);</a>
<a name="ln294">	fTextControl-&gt;ResizeTo(rect.Width() - 10, height);</a>
<a name="ln295"> </a>
<a name="ln296">	ResizeTo(rect.Width(), height + 10);</a>
<a name="ln297"> </a>
<a name="ln298">	AddChild(fTextControl);</a>
<a name="ln299">}</a>
<a name="ln300"> </a>
<a name="ln301"> </a>
<a name="ln302">void</a>
<a name="ln303">MimeTypeEditor::_UpdateText()</a>
<a name="ln304">{</a>
<a name="ln305">	BAutolock locker(fEditor);</a>
<a name="ln306"> </a>
<a name="ln307">	const char* mimeType;</a>
<a name="ln308">	if (fEditor.GetViewBuffer((const uint8 **)&amp;mimeType) == B_OK) {</a>
<a name="ln309">		fTextControl-&gt;SetText(mimeType);</a>
<a name="ln310">		fPreviousText.SetTo(mimeType);</a>
<a name="ln311">	}</a>
<a name="ln312">}</a>
<a name="ln313"> </a>
<a name="ln314"> </a>
<a name="ln315">void</a>
<a name="ln316">MimeTypeEditor::CommitChanges()</a>
<a name="ln317">{</a>
<a name="ln318">	if (fPreviousText != fTextControl-&gt;Text()) {</a>
<a name="ln319">		fEditor.Replace(0, (const uint8*)fTextControl-&gt;Text(),</a>
<a name="ln320">			strlen(fTextControl-&gt;Text()) + 1);</a>
<a name="ln321">	}</a>
<a name="ln322">}</a>
<a name="ln323"> </a>
<a name="ln324"> </a>
<a name="ln325">bool</a>
<a name="ln326">MimeTypeEditor::TypeMatches()</a>
<a name="ln327">{</a>
<a name="ln328">	// TODO: check contents?</a>
<a name="ln329">	return fEditor.FileSize() &lt;= B_MIME_TYPE_LENGTH;</a>
<a name="ln330">}</a>
<a name="ln331"> </a>
<a name="ln332"> </a>
<a name="ln333">void</a>
<a name="ln334">MimeTypeEditor::AttachedToWindow()</a>
<a name="ln335">{</a>
<a name="ln336">	fTextControl-&gt;SetTarget(this);</a>
<a name="ln337">	fEditor.StartWatching(this);</a>
<a name="ln338"> </a>
<a name="ln339">	_UpdateText();</a>
<a name="ln340">}</a>
<a name="ln341"> </a>
<a name="ln342"> </a>
<a name="ln343">void</a>
<a name="ln344">MimeTypeEditor::DetachedFromWindow()</a>
<a name="ln345">{</a>
<a name="ln346">	fEditor.StopWatching(this);</a>
<a name="ln347"> </a>
<a name="ln348">	CommitChanges();</a>
<a name="ln349">}</a>
<a name="ln350"> </a>
<a name="ln351"> </a>
<a name="ln352">void</a>
<a name="ln353">MimeTypeEditor::MessageReceived(BMessage *message)</a>
<a name="ln354">{</a>
<a name="ln355">	switch (message-&gt;what) {</a>
<a name="ln356">		case kMsgValueChanged:</a>
<a name="ln357">			fEditor.Replace(0, (const uint8 *)fTextControl-&gt;Text(),</a>
<a name="ln358">				strlen(fTextControl-&gt;Text()) + 1);</a>
<a name="ln359">			break;</a>
<a name="ln360"> </a>
<a name="ln361">		case kMsgDataEditorUpdate:</a>
<a name="ln362">			_UpdateText();</a>
<a name="ln363">			break;</a>
<a name="ln364"> </a>
<a name="ln365">		default:</a>
<a name="ln366">			BView::MessageReceived(message);</a>
<a name="ln367">	}</a>
<a name="ln368">}</a>
<a name="ln369"> </a>
<a name="ln370"> </a>
<a name="ln371">//	#pragma mark - NumberEditor</a>
<a name="ln372"> </a>
<a name="ln373"> </a>
<a name="ln374">NumberEditor::NumberEditor(BRect rect, DataEditor &amp;editor)</a>
<a name="ln375">	: TypeEditorView(rect, B_TRANSLATE(&quot;Number editor&quot;), B_FOLLOW_LEFT_RIGHT, 0, editor)</a>
<a name="ln376">{</a>
<a name="ln377">	SetViewUIColor(B_PANEL_BACKGROUND_COLOR);</a>
<a name="ln378"> </a>
<a name="ln379">	fTextControl = new BTextControl(rect.InsetByCopy(5, 5), B_EMPTY_STRING,</a>
<a name="ln380">		_TypeLabel(), NULL, new BMessage(kMsgValueChanged), B_FOLLOW_ALL);</a>
<a name="ln381">	fTextControl-&gt;SetDivider(StringWidth(fTextControl-&gt;Label()) + 8);</a>
<a name="ln382">	fTextControl-&gt;SetAlignment(B_ALIGN_RIGHT, B_ALIGN_RIGHT);</a>
<a name="ln383">	ResizeTo(rect.Width(), 30);</a>
<a name="ln384"> </a>
<a name="ln385">	AddChild(fTextControl);</a>
<a name="ln386">}</a>
<a name="ln387"> </a>
<a name="ln388"> </a>
<a name="ln389">void</a>
<a name="ln390">NumberEditor::_UpdateText()</a>
<a name="ln391">{</a>
<a name="ln392">	if (fEditor.Lock()) {</a>
<a name="ln393">		const char* number;</a>
<a name="ln394">		if (fEditor.GetViewBuffer((const uint8**)&amp;number) == B_OK) {</a>
<a name="ln395">			char buffer[64];</a>
<a name="ln396">			char format[16];</a>
<a name="ln397">			switch (fEditor.Type()) {</a>
<a name="ln398">				case B_FLOAT_TYPE:</a>
<a name="ln399">				{</a>
<a name="ln400">					float value = *(float*)number;</a>
<a name="ln401">					snprintf(buffer, sizeof(buffer), &quot;%g&quot;, value);</a>
<a name="ln402">					break;</a>
<a name="ln403">				}</a>
<a name="ln404">				case B_DOUBLE_TYPE:</a>
<a name="ln405">				{</a>
<a name="ln406">					double value = *(double *)number;</a>
<a name="ln407">					snprintf(buffer, sizeof(buffer), &quot;%g&quot;, value);</a>
<a name="ln408">					break;</a>
<a name="ln409">				}</a>
<a name="ln410">				case B_SSIZE_T_TYPE:</a>
<a name="ln411">				case B_INT8_TYPE:</a>
<a name="ln412">				case B_INT16_TYPE:</a>
<a name="ln413">				case B_INT32_TYPE:</a>
<a name="ln414">				case B_INT64_TYPE:</a>
<a name="ln415">				case B_OFF_T_TYPE:</a>
<a name="ln416">				{</a>
<a name="ln417">					_Format(format);</a>
<a name="ln418">					switch (_Size()) {</a>
<a name="ln419">						case 1:</a>
<a name="ln420">						{</a>
<a name="ln421">							int8 value = *(int8 *)number;</a>
<a name="ln422">							snprintf(buffer, sizeof(buffer), format, value);</a>
<a name="ln423">							break;</a>
<a name="ln424">						}</a>
<a name="ln425">						case 2:</a>
<a name="ln426">						{</a>
<a name="ln427">							int16 value = *(int16 *)number;</a>
<a name="ln428">							snprintf(buffer, sizeof(buffer), format, value);</a>
<a name="ln429">							break;</a>
<a name="ln430">						}</a>
<a name="ln431">						case 4:</a>
<a name="ln432">						{</a>
<a name="ln433">							int32 value = *(int32 *)number;</a>
<a name="ln434">							snprintf(buffer, sizeof(buffer), format, value);</a>
<a name="ln435">							break;</a>
<a name="ln436">						}</a>
<a name="ln437">						case 8:</a>
<a name="ln438">						{</a>
<a name="ln439">							int64 value = *(int64 *)number;</a>
<a name="ln440">							snprintf(buffer, sizeof(buffer), format, value);</a>
<a name="ln441">							break;</a>
<a name="ln442">						}</a>
<a name="ln443">					}</a>
<a name="ln444">					break;</a>
<a name="ln445">				}</a>
<a name="ln446"> </a>
<a name="ln447">				default:</a>
<a name="ln448">				{</a>
<a name="ln449">					_Format(format);</a>
<a name="ln450">					switch (_Size()) {</a>
<a name="ln451">						case 1:</a>
<a name="ln452">						{</a>
<a name="ln453">							uint8 value = *(uint8 *)number;</a>
<a name="ln454">							snprintf(buffer, sizeof(buffer), format, value);</a>
<a name="ln455">							break;</a>
<a name="ln456">						}</a>
<a name="ln457">						case 2:</a>
<a name="ln458">						{</a>
<a name="ln459">							uint16 value = *(uint16 *)number;</a>
<a name="ln460">							snprintf(buffer, sizeof(buffer), format, value);</a>
<a name="ln461">							break;</a>
<a name="ln462">						}</a>
<a name="ln463">						case 4:</a>
<a name="ln464">						{</a>
<a name="ln465">							uint32 value = *(uint32 *)number;</a>
<a name="ln466">							snprintf(buffer, sizeof(buffer), format, value);</a>
<a name="ln467">							break;</a>
<a name="ln468">						}</a>
<a name="ln469">						case 8:</a>
<a name="ln470">						{</a>
<a name="ln471">							uint64 value = *(uint64 *)number;</a>
<a name="ln472">							snprintf(buffer, sizeof(buffer), format, value);</a>
<a name="ln473">							break;</a>
<a name="ln474">						}</a>
<a name="ln475">					}</a>
<a name="ln476">					break;</a>
<a name="ln477">				}</a>
<a name="ln478">			}</a>
<a name="ln479">			fTextControl-&gt;SetText(buffer);</a>
<a name="ln480">			fPreviousText.SetTo(buffer);</a>
<a name="ln481">		}</a>
<a name="ln482"> </a>
<a name="ln483">		fEditor.Unlock();</a>
<a name="ln484">	}</a>
<a name="ln485">}</a>
<a name="ln486"> </a>
<a name="ln487"> </a>
<a name="ln488">bool</a>
<a name="ln489">NumberEditor::TypeMatches()</a>
<a name="ln490">{</a>
<a name="ln491">	return fEditor.FileSize() &gt;= (off_t)_Size();</a>
<a name="ln492">		// we only look at as many bytes we need to</a>
<a name="ln493">}</a>
<a name="ln494"> </a>
<a name="ln495"> </a>
<a name="ln496">void</a>
<a name="ln497">NumberEditor::CommitChanges()</a>
<a name="ln498">{</a>
<a name="ln499">	if (fPreviousText == fTextControl-&gt;Text())</a>
<a name="ln500">		return;</a>
<a name="ln501"> </a>
<a name="ln502">	const char *number = fTextControl-&gt;Text();</a>
<a name="ln503">	uint8 buffer[8];</a>
<a name="ln504"> </a>
<a name="ln505">	switch (fEditor.Type()) {</a>
<a name="ln506">		case B_FLOAT_TYPE:</a>
<a name="ln507">		{</a>
<a name="ln508">			float value = strtod(number, NULL);</a>
<a name="ln509">			*(float *)buffer = value;</a>
<a name="ln510">			break;</a>
<a name="ln511">		}</a>
<a name="ln512">		case B_DOUBLE_TYPE:</a>
<a name="ln513">		{</a>
<a name="ln514">			double value = strtod(number, NULL);</a>
<a name="ln515">			*(double *)buffer = value;</a>
<a name="ln516">			break;</a>
<a name="ln517">		}</a>
<a name="ln518">		case B_INT8_TYPE:</a>
<a name="ln519">		{</a>
<a name="ln520">			int64 value = strtoll(number, NULL, 0);</a>
<a name="ln521">			if (value &gt; CHAR_MAX)</a>
<a name="ln522">				value = CHAR_MAX;</a>
<a name="ln523">			else if (value &lt; CHAR_MIN)</a>
<a name="ln524">				value = CHAR_MIN;</a>
<a name="ln525">			*(int8 *)buffer = (int8)value;</a>
<a name="ln526">			break;</a>
<a name="ln527">		}</a>
<a name="ln528">		case B_UINT8_TYPE:</a>
<a name="ln529">		{</a>
<a name="ln530">			int64 value = strtoull(number, NULL, 0);</a>
<a name="ln531">			if (value &gt; UCHAR_MAX)</a>
<a name="ln532">				value = UCHAR_MAX;</a>
<a name="ln533">			*(uint8 *)buffer = (uint8)value;</a>
<a name="ln534">			break;</a>
<a name="ln535">		}</a>
<a name="ln536">		case B_INT16_TYPE:</a>
<a name="ln537">		{</a>
<a name="ln538">			int64 value = strtoll(number, NULL, 0);</a>
<a name="ln539">			if (value &gt; SHRT_MAX)</a>
<a name="ln540">				value = SHRT_MAX;</a>
<a name="ln541">			else if (value &lt; SHRT_MIN)</a>
<a name="ln542">				value = SHRT_MIN;</a>
<a name="ln543">			*(int16 *)buffer = (int16)value;</a>
<a name="ln544">			break;</a>
<a name="ln545">		}</a>
<a name="ln546">		case B_UINT16_TYPE:</a>
<a name="ln547">		{</a>
<a name="ln548">			int64 value = strtoull(number, NULL, 0);</a>
<a name="ln549">			if (value &gt; USHRT_MAX)</a>
<a name="ln550">				value = USHRT_MAX;</a>
<a name="ln551">			*(uint16 *)buffer = (uint16)value;</a>
<a name="ln552">			break;</a>
<a name="ln553">		}</a>
<a name="ln554">		case B_INT32_TYPE:</a>
<a name="ln555">		case B_SSIZE_T_TYPE:</a>
<a name="ln556">		{</a>
<a name="ln557">			int64 value = strtoll(number, NULL, 0);</a>
<a name="ln558">			if (value &gt; LONG_MAX)</a>
<a name="ln559">				value = LONG_MAX;</a>
<a name="ln560">			else if (value &lt; LONG_MIN)</a>
<a name="ln561">				value = LONG_MIN;</a>
<a name="ln562">			*(int32 *)buffer = (int32)value;</a>
<a name="ln563">			break;</a>
<a name="ln564">		}</a>
<a name="ln565">		case B_UINT32_TYPE:</a>
<a name="ln566">		case B_SIZE_T_TYPE:</a>
<a name="ln567">		case B_POINTER_TYPE:</a>
<a name="ln568">		{</a>
<a name="ln569">			uint64 value = strtoull(number, NULL, 0);</a>
<a name="ln570">			if (value &gt; ULONG_MAX)</a>
<a name="ln571">				value = ULONG_MAX;</a>
<a name="ln572">			*(uint32 *)buffer = (uint32)value;</a>
<a name="ln573">			break;</a>
<a name="ln574">		}</a>
<a name="ln575">		case B_INT64_TYPE:</a>
<a name="ln576">		case B_OFF_T_TYPE:</a>
<a name="ln577">		{</a>
<a name="ln578">			int64 value = strtoll(number, NULL, 0);</a>
<a name="ln579">			*(int64 *)buffer = value;</a>
<a name="ln580">			break;</a>
<a name="ln581">		}</a>
<a name="ln582">		case B_UINT64_TYPE:</a>
<a name="ln583">		{</a>
<a name="ln584">			uint64 value = strtoull(number, NULL, 0);</a>
<a name="ln585">			*(uint64 *)buffer = value;</a>
<a name="ln586">			break;</a>
<a name="ln587">		}</a>
<a name="ln588">		default:</a>
<a name="ln589">			return;</a>
<a name="ln590">	}</a>
<a name="ln591"> </a>
<a name="ln592">	fEditor.Replace(0, buffer, _Size());</a>
<a name="ln593">	fPreviousText.SetTo((char *)buffer);</a>
<a name="ln594">}</a>
<a name="ln595"> </a>
<a name="ln596"> </a>
<a name="ln597">const char*</a>
<a name="ln598">NumberEditor::_TypeLabel()</a>
<a name="ln599">{</a>
<a name="ln600">	switch (fEditor.Type()) {</a>
<a name="ln601">		case B_INT8_TYPE:</a>
<a name="ln602">			return B_TRANSLATE(&quot;8 bit signed value:&quot;);</a>
<a name="ln603">		case B_UINT8_TYPE:</a>
<a name="ln604">			return B_TRANSLATE(&quot;8 bit unsigned value:&quot;);</a>
<a name="ln605">		case B_INT16_TYPE:</a>
<a name="ln606">			return B_TRANSLATE(&quot;16 bit signed value:&quot;);</a>
<a name="ln607">		case B_UINT16_TYPE:</a>
<a name="ln608">			return B_TRANSLATE(&quot;16 bit unsigned value:&quot;);</a>
<a name="ln609">		case B_INT32_TYPE:</a>
<a name="ln610">			return B_TRANSLATE(&quot;32 bit signed value:&quot;);</a>
<a name="ln611">		case B_UINT32_TYPE:</a>
<a name="ln612">			return B_TRANSLATE(&quot;32 bit unsigned value:&quot;);</a>
<a name="ln613">		case B_INT64_TYPE:</a>
<a name="ln614">			return B_TRANSLATE(&quot;64 bit signed value:&quot;);</a>
<a name="ln615">		case B_UINT64_TYPE:</a>
<a name="ln616">			return B_TRANSLATE(&quot;64 bit unsigned value:&quot;);</a>
<a name="ln617">		case B_FLOAT_TYPE:</a>
<a name="ln618">			return B_TRANSLATE(&quot;Floating-point value:&quot;);</a>
<a name="ln619">		case B_DOUBLE_TYPE:</a>
<a name="ln620">			return B_TRANSLATE(&quot;Double precision floating-point value:&quot;);</a>
<a name="ln621">		case B_SSIZE_T_TYPE:</a>
<a name="ln622">			return B_TRANSLATE(&quot;32 bit size or status:&quot;);</a>
<a name="ln623">		case B_SIZE_T_TYPE:</a>
<a name="ln624">			return B_TRANSLATE(&quot;32 bit unsigned size:&quot;);</a>
<a name="ln625">		case B_OFF_T_TYPE:</a>
<a name="ln626">			return B_TRANSLATE(&quot;64 bit signed offset:&quot;);</a>
<a name="ln627">		case B_POINTER_TYPE:</a>
<a name="ln628">			return B_TRANSLATE(&quot;32 bit unsigned pointer:&quot;);</a>
<a name="ln629">		default:</a>
<a name="ln630">			return B_TRANSLATE(&quot;Number:&quot;);</a>
<a name="ln631">	}</a>
<a name="ln632">}</a>
<a name="ln633"> </a>
<a name="ln634"> </a>
<a name="ln635">size_t</a>
<a name="ln636">NumberEditor::_Size()</a>
<a name="ln637">{</a>
<a name="ln638">	switch (fEditor.Type()) {</a>
<a name="ln639">		case B_INT8_TYPE:</a>
<a name="ln640">		case B_UINT8_TYPE:</a>
<a name="ln641">			return 1;</a>
<a name="ln642">		case B_INT16_TYPE:</a>
<a name="ln643">		case B_UINT16_TYPE:</a>
<a name="ln644">			return 2;</a>
<a name="ln645">		case B_SSIZE_T_TYPE:</a>
<a name="ln646">		case B_INT32_TYPE:</a>
<a name="ln647">		case B_SIZE_T_TYPE:</a>
<a name="ln648">		case B_POINTER_TYPE:</a>
<a name="ln649">		case B_UINT32_TYPE:</a>
<a name="ln650">			return 4;</a>
<a name="ln651">		case B_INT64_TYPE:</a>
<a name="ln652">		case B_OFF_T_TYPE:</a>
<a name="ln653">		case B_UINT64_TYPE:</a>
<a name="ln654">			return 8;</a>
<a name="ln655">		case B_FLOAT_TYPE:</a>
<a name="ln656">			return 4;</a>
<a name="ln657">		case B_DOUBLE_TYPE:</a>
<a name="ln658">			return 8;</a>
<a name="ln659"> </a>
<a name="ln660">		default:</a>
<a name="ln661">			return 0;</a>
<a name="ln662">	}</a>
<a name="ln663">}</a>
<a name="ln664"> </a>
<a name="ln665"> </a>
<a name="ln666">status_t</a>
<a name="ln667">NumberEditor::_Format(char *buffer)</a>
<a name="ln668">{</a>
<a name="ln669">	switch (fEditor.Type()) {</a>
<a name="ln670">		case B_INT8_TYPE:</a>
<a name="ln671">			strcpy(buffer, &quot;%hd&quot;);</a>
<a name="ln672">			return B_OK;</a>
<a name="ln673">		case B_UINT8_TYPE:</a>
<a name="ln674">			strcpy(buffer, &quot;%hu&quot;);</a>
<a name="ln675">			return B_OK;</a>
<a name="ln676">		case B_INT16_TYPE:</a>
<a name="ln677">			strcpy(buffer, &quot;%hd&quot;);</a>
<a name="ln678">			return B_OK;</a>
<a name="ln679">		case B_UINT16_TYPE:</a>
<a name="ln680">			strcpy(buffer, &quot;%hu&quot;);</a>
<a name="ln681">			return B_OK;</a>
<a name="ln682">		case B_SSIZE_T_TYPE:</a>
<a name="ln683">		case B_INT32_TYPE:</a>
<a name="ln684">			strcpy(buffer, &quot;%ld&quot;);</a>
<a name="ln685">			return B_OK;</a>
<a name="ln686">		case B_SIZE_T_TYPE:</a>
<a name="ln687">		case B_POINTER_TYPE:</a>
<a name="ln688">		case B_UINT32_TYPE:</a>
<a name="ln689">			strcpy(buffer, &quot;%lu&quot;);</a>
<a name="ln690">			return B_OK;</a>
<a name="ln691">		case B_INT64_TYPE:</a>
<a name="ln692">		case B_OFF_T_TYPE:</a>
<a name="ln693">			strcpy(buffer, &quot;%Ld&quot;);</a>
<a name="ln694">			return B_OK;</a>
<a name="ln695">		case B_UINT64_TYPE:</a>
<a name="ln696">			strcpy(buffer, &quot;%Lu&quot;);</a>
<a name="ln697">			return B_OK;</a>
<a name="ln698">		case B_FLOAT_TYPE:</a>
<a name="ln699">			strcpy(buffer, &quot;%g&quot;);</a>
<a name="ln700">			return B_OK;</a>
<a name="ln701">		case B_DOUBLE_TYPE:</a>
<a name="ln702">			strcpy(buffer, &quot;%lg&quot;);</a>
<a name="ln703">			return B_OK;</a>
<a name="ln704"> </a>
<a name="ln705">		default:</a>
<a name="ln706">			return B_ERROR;</a>
<a name="ln707">	}</a>
<a name="ln708">}</a>
<a name="ln709"> </a>
<a name="ln710"> </a>
<a name="ln711">void</a>
<a name="ln712">NumberEditor::AttachedToWindow()</a>
<a name="ln713">{</a>
<a name="ln714">	fTextControl-&gt;SetTarget(this);</a>
<a name="ln715">	fEditor.StartWatching(this);</a>
<a name="ln716"> </a>
<a name="ln717">	_UpdateText();</a>
<a name="ln718">}</a>
<a name="ln719"> </a>
<a name="ln720"> </a>
<a name="ln721">void</a>
<a name="ln722">NumberEditor::DetachedFromWindow()</a>
<a name="ln723">{</a>
<a name="ln724">	fEditor.StopWatching(this);</a>
<a name="ln725"> </a>
<a name="ln726">	CommitChanges();</a>
<a name="ln727">}</a>
<a name="ln728"> </a>
<a name="ln729"> </a>
<a name="ln730">void</a>
<a name="ln731">NumberEditor::MessageReceived(BMessage *message)</a>
<a name="ln732">{</a>
<a name="ln733">	switch (message-&gt;what) {</a>
<a name="ln734">		case kMsgValueChanged:</a>
<a name="ln735">			CommitChanges();</a>
<a name="ln736">			break;</a>
<a name="ln737">		case kMsgDataEditorUpdate:</a>
<a name="ln738">			_UpdateText();</a>
<a name="ln739">			break;</a>
<a name="ln740"> </a>
<a name="ln741">		default:</a>
<a name="ln742">			BView::MessageReceived(message);</a>
<a name="ln743">	}</a>
<a name="ln744">}</a>
<a name="ln745"> </a>
<a name="ln746"> </a>
<a name="ln747">//	#pragma mark - BooleanEditor</a>
<a name="ln748"> </a>
<a name="ln749"> </a>
<a name="ln750">BooleanEditor::BooleanEditor(BRect rect, DataEditor &amp;editor)</a>
<a name="ln751">	: TypeEditorView(rect, B_TRANSLATE(&quot;Boolean editor&quot;), B_FOLLOW_NONE, 0, editor)</a>
<a name="ln752">{</a>
<a name="ln753">	SetViewUIColor(B_PANEL_BACKGROUND_COLOR);</a>
<a name="ln754"> </a>
<a name="ln755">	BPopUpMenu *menu = new BPopUpMenu(&quot;bool&quot;);</a>
<a name="ln756">	BMessage *message;</a>
<a name="ln757">	menu-&gt;AddItem(fFalseMenuItem = new BMenuItem(&quot;false&quot;,</a>
<a name="ln758">		new BMessage(kMsgValueChanged)));</a>
<a name="ln759">	menu-&gt;AddItem(fTrueMenuItem = new BMenuItem(&quot;true&quot;,</a>
<a name="ln760">		message = new BMessage(kMsgValueChanged)));</a>
<a name="ln761">	message-&gt;AddInt8(&quot;value&quot;, 1);</a>
<a name="ln762"> </a>
<a name="ln763">	BMenuField *menuField = new BMenuField(rect.InsetByCopy(5, 5),</a>
<a name="ln764">		B_EMPTY_STRING, B_TRANSLATE(&quot;Boolean value:&quot;), menu, B_FOLLOW_LEFT_RIGHT);</a>
<a name="ln765">	menuField-&gt;SetDivider(StringWidth(menuField-&gt;Label()) + 8);</a>
<a name="ln766">	menuField-&gt;ResizeToPreferred();</a>
<a name="ln767">	ResizeTo(menuField-&gt;Bounds().Width() + 10,</a>
<a name="ln768">		menuField-&gt;Bounds().Height() + 10);</a>
<a name="ln769"> </a>
<a name="ln770">	_UpdateMenuField();</a>
<a name="ln771"> </a>
<a name="ln772">	AddChild(menuField);</a>
<a name="ln773">}</a>
<a name="ln774"> </a>
<a name="ln775"> </a>
<a name="ln776">bool</a>
<a name="ln777">BooleanEditor::TypeMatches()</a>
<a name="ln778">{</a>
<a name="ln779">	// we accept everything: we just look at the first byte, anyway</a>
<a name="ln780">	return true;</a>
<a name="ln781">}</a>
<a name="ln782"> </a>
<a name="ln783"> </a>
<a name="ln784">void</a>
<a name="ln785">BooleanEditor::_UpdateMenuField()</a>
<a name="ln786">{</a>
<a name="ln787">	if (fEditor.FileSize() != 1)</a>
<a name="ln788">		return;</a>
<a name="ln789"> </a>
<a name="ln790">	if (fEditor.Lock()) {</a>
<a name="ln791">		const char *buffer;</a>
<a name="ln792">		if (fEditor.GetViewBuffer((const uint8 **)&amp;buffer) == B_OK)</a>
<a name="ln793">			(buffer[0] != 0 ? fTrueMenuItem : fFalseMenuItem)-&gt;SetMarked(true);</a>
<a name="ln794"> </a>
<a name="ln795">		fEditor.Unlock();</a>
<a name="ln796">	}</a>
<a name="ln797">}</a>
<a name="ln798"> </a>
<a name="ln799"> </a>
<a name="ln800">void</a>
<a name="ln801">BooleanEditor::CommitChanges()</a>
<a name="ln802">{</a>
<a name="ln803">	// we're commiting the changes as they happen</a>
<a name="ln804">}</a>
<a name="ln805"> </a>
<a name="ln806"> </a>
<a name="ln807">void</a>
<a name="ln808">BooleanEditor::AttachedToWindow()</a>
<a name="ln809">{</a>
<a name="ln810">	fTrueMenuItem-&gt;SetTarget(this);</a>
<a name="ln811">	fFalseMenuItem-&gt;SetTarget(this);</a>
<a name="ln812"> </a>
<a name="ln813">	fEditor.StartWatching(this);</a>
<a name="ln814">}</a>
<a name="ln815"> </a>
<a name="ln816"> </a>
<a name="ln817">void</a>
<a name="ln818">BooleanEditor::DetachedFromWindow()</a>
<a name="ln819">{</a>
<a name="ln820">	fEditor.StopWatching(this);</a>
<a name="ln821">}</a>
<a name="ln822"> </a>
<a name="ln823"> </a>
<a name="ln824">void</a>
<a name="ln825">BooleanEditor::MessageReceived(BMessage *message)</a>
<a name="ln826">{</a>
<a name="ln827">	switch (message-&gt;what) {</a>
<a name="ln828">		case kMsgValueChanged:</a>
<a name="ln829">		{</a>
<a name="ln830">			uint8 boolean = message-&gt;FindInt8(&quot;value&quot;);</a>
<a name="ln831">			fEditor.Replace(0, (const uint8 *)&amp;boolean, 1);</a>
<a name="ln832">			break;</a>
<a name="ln833">		}</a>
<a name="ln834">		case kMsgDataEditorUpdate:</a>
<a name="ln835">			_UpdateMenuField();</a>
<a name="ln836">			break;</a>
<a name="ln837"> </a>
<a name="ln838">		default:</a>
<a name="ln839">			BView::MessageReceived(message);</a>
<a name="ln840">	}</a>
<a name="ln841">}</a>
<a name="ln842"> </a>
<a name="ln843"> </a>
<a name="ln844">//	#pragma mark - ImageView</a>
<a name="ln845"> </a>
<a name="ln846"> </a>
<a name="ln847">ImageView::ImageView(DataEditor &amp;editor)</a>
<a name="ln848">	: TypeEditorView(B_TRANSLATE_COMMENT(&quot;Image view&quot;, &quot;Image means here a &quot;</a>
<a name="ln849">		&quot;picture file, not a disk image.&quot;),</a>
<a name="ln850">		B_WILL_DRAW | B_FULL_UPDATE_ON_RESIZE, editor),</a>
<a name="ln851">	fBitmap(NULL),</a>
<a name="ln852">	fScaleSlider(NULL)</a>
<a name="ln853">{</a>
<a name="ln854">	if (editor.Type() == B_MINI_ICON_TYPE</a>
<a name="ln855">		|| editor.Type() == B_LARGE_ICON_TYPE</a>
<a name="ln856">#ifdef HAIKU_TARGET_PLATFORM_HAIKU</a>
<a name="ln857">		|| editor.Type() == B_VECTOR_ICON_TYPE</a>
<a name="ln858">#endif</a>
<a name="ln859">		)</a>
<a name="ln860">		SetName(B_TRANSLATE(&quot;Icon view&quot;));</a>
<a name="ln861"> </a>
<a name="ln862">	fDescriptionView = new BStringView(&quot;&quot;,</a>
<a name="ln863">		B_TRANSLATE_COMMENT(&quot;Could not read image&quot;, &quot;Image means &quot;</a>
<a name="ln864">		&quot;here a picture file, not a disk image.&quot;));</a>
<a name="ln865">	fDescriptionView-&gt;SetAlignment(B_ALIGN_CENTER);</a>
<a name="ln866"> </a>
<a name="ln867">	if (editor.Type() == B_VECTOR_ICON_TYPE) {</a>
<a name="ln868">		// vector icon</a>
<a name="ln869">		fScaleSlider = new BSlider(&quot;&quot;, NULL,</a>
<a name="ln870">			new BMessage(kMsgScaleChanged), 2, 32, B_HORIZONTAL);</a>
<a name="ln871">		fScaleSlider-&gt;SetModificationMessage(new BMessage(kMsgScaleChanged));</a>
<a name="ln872">		fScaleSlider-&gt;ResizeToPreferred();</a>
<a name="ln873">		fScaleSlider-&gt;SetValue(8);</a>
<a name="ln874">		fScaleSlider-&gt;SetHashMarks(B_HASH_MARKS_BOTH);</a>
<a name="ln875">		fScaleSlider-&gt;SetHashMarkCount(15);</a>
<a name="ln876"> </a>
<a name="ln877">		BLayoutBuilder::Group&lt;&gt;(this, B_HORIZONTAL)</a>
<a name="ln878">			.SetInsets(B_USE_WINDOW_SPACING, 256, B_USE_WINDOW_SPACING,</a>
<a name="ln879">				B_H_SCROLL_BAR_HEIGHT) // Leave space for the icon</a>
<a name="ln880">			.AddGlue()</a>
<a name="ln881">			.AddGroup(B_VERTICAL)</a>
<a name="ln882">				.Add(fDescriptionView)</a>
<a name="ln883">				.Add(fScaleSlider)</a>
<a name="ln884">			.End()</a>
<a name="ln885">			.AddGlue();</a>
<a name="ln886">	} else {</a>
<a name="ln887">		BLayoutBuilder::Group&lt;&gt;(this, B_HORIZONTAL)</a>
<a name="ln888">			.SetInsets(B_USE_WINDOW_SPACING, 256, B_USE_WINDOW_SPACING,</a>
<a name="ln889">				B_USE_WINDOW_SPACING) // Leave space for the icon</a>
<a name="ln890">			.AddGlue()</a>
<a name="ln891">			.Add(fDescriptionView)</a>
<a name="ln892">			.AddGlue();</a>
<a name="ln893">	}</a>
<a name="ln894">}</a>
<a name="ln895"> </a>
<a name="ln896"> </a>
<a name="ln897">ImageView::~ImageView()</a>
<a name="ln898">{</a>
<a name="ln899">	delete fBitmap;</a>
<a name="ln900">}</a>
<a name="ln901"> </a>
<a name="ln902"> </a>
<a name="ln903">void</a>
<a name="ln904">ImageView::AttachedToWindow()</a>
<a name="ln905">{</a>
<a name="ln906">	if (Parent() != NULL)</a>
<a name="ln907">		SetViewColor(Parent()-&gt;ViewColor());</a>
<a name="ln908">	else</a>
<a name="ln909">		SetViewUIColor(B_PANEL_BACKGROUND_COLOR);</a>
<a name="ln910"> </a>
<a name="ln911">	fEditor.StartWatching(this);</a>
<a name="ln912">	if (fScaleSlider != NULL)</a>
<a name="ln913">		fScaleSlider-&gt;SetTarget(this);</a>
<a name="ln914"> </a>
<a name="ln915">	_UpdateImage();</a>
<a name="ln916">}</a>
<a name="ln917"> </a>
<a name="ln918"> </a>
<a name="ln919">void</a>
<a name="ln920">ImageView::DetachedFromWindow()</a>
<a name="ln921">{</a>
<a name="ln922">	fEditor.StopWatching(this);</a>
<a name="ln923">}</a>
<a name="ln924"> </a>
<a name="ln925"> </a>
<a name="ln926">void</a>
<a name="ln927">ImageView::MessageReceived(BMessage *message)</a>
<a name="ln928">{</a>
<a name="ln929">	switch (message-&gt;what) {</a>
<a name="ln930">		case kMsgDataEditorUpdate:</a>
<a name="ln931">			_UpdateImage();</a>
<a name="ln932">			break;</a>
<a name="ln933"> </a>
<a name="ln934">		case kMsgScaleChanged:</a>
<a name="ln935">			_UpdateImage();</a>
<a name="ln936">			break;</a>
<a name="ln937"> </a>
<a name="ln938">		default:</a>
<a name="ln939">			BView::MessageReceived(message);</a>
<a name="ln940">	}</a>
<a name="ln941">}</a>
<a name="ln942"> </a>
<a name="ln943"> </a>
<a name="ln944">void</a>
<a name="ln945">ImageView::Draw(BRect updateRect)</a>
<a name="ln946">{</a>
<a name="ln947">	if (fBitmap != NULL) {</a>
<a name="ln948">		SetDrawingMode(B_OP_ALPHA);</a>
<a name="ln949">		DrawBitmap(fBitmap, BPoint((Bounds().Width() - fBitmap-&gt;Bounds().Width()) / 2, 0));</a>
<a name="ln950">		SetDrawingMode(B_OP_COPY);</a>
<a name="ln951">	}</a>
<a name="ln952">}</a>
<a name="ln953"> </a>
<a name="ln954"> </a>
<a name="ln955">void</a>
<a name="ln956">ImageView::_UpdateImage()</a>
<a name="ln957">{</a>
<a name="ln958">	// ToDo: add scroller if necessary?!</a>
<a name="ln959"> </a>
<a name="ln960">	BAutolock locker(fEditor);</a>
<a name="ln961"> </a>
<a name="ln962">	// we need all the data...</a>
<a name="ln963"> </a>
<a name="ln964">	size_t viewSize = fEditor.ViewSize();</a>
<a name="ln965">	// that may need some more memory...</a>
<a name="ln966">	if ((off_t)viewSize &lt; fEditor.FileSize())</a>
<a name="ln967">		fEditor.SetViewSize(fEditor.FileSize());</a>
<a name="ln968"> </a>
<a name="ln969">	const char *data;</a>
<a name="ln970">	if (fEditor.GetViewBuffer((const uint8 **)&amp;data) != B_OK) {</a>
<a name="ln971">		fEditor.SetViewSize(viewSize);</a>
<a name="ln972">		return;</a>
<a name="ln973">	}</a>
<a name="ln974"> </a>
<a name="ln975">	if (fBitmap != NULL &amp;&amp; (fEditor.Type() == B_MINI_ICON_TYPE</a>
<a name="ln976">			|| fEditor.Type() == B_LARGE_ICON_TYPE)) {</a>
<a name="ln977">		// optimize icon update...</a>
<a name="ln978">		fBitmap-&gt;SetBits(data, fEditor.FileSize(), 0, B_CMAP8);</a>
<a name="ln979">		fEditor.SetViewSize(viewSize);</a>
<a name="ln980">		return;</a>
<a name="ln981">	}</a>
<a name="ln982">#ifdef HAIKU_TARGET_PLATFORM_HAIKU</a>
<a name="ln983">	if (fBitmap != NULL &amp;&amp; fEditor.Type() == B_VECTOR_ICON_TYPE</a>
<a name="ln984">		&amp;&amp; fScaleSlider-&gt;Value() * 8 - 1 == fBitmap-&gt;Bounds().Width()) {</a>
<a name="ln985">		if (BIconUtils::GetVectorIcon((const uint8 *)data,</a>
<a name="ln986">				(size_t)fEditor.FileSize(), fBitmap) == B_OK) {</a>
<a name="ln987">			fEditor.SetViewSize(viewSize);</a>
<a name="ln988">			return;</a>
<a name="ln989">		}</a>
<a name="ln990">	}</a>
<a name="ln991">#endif</a>
<a name="ln992"> </a>
<a name="ln993">	delete fBitmap;</a>
<a name="ln994">	fBitmap = NULL;</a>
<a name="ln995"> </a>
<a name="ln996">	switch (fEditor.Type()) {</a>
<a name="ln997">		case B_MINI_ICON_TYPE:</a>
<a name="ln998">			fBitmap = new BBitmap(BRect(0, 0, 15, 15), B_CMAP8);</a>
<a name="ln999">			if (fBitmap-&gt;InitCheck() == B_OK)</a>
<a name="ln1000">				fBitmap-&gt;SetBits(data, fEditor.FileSize(), 0, B_CMAP8);</a>
<a name="ln1001">			break;</a>
<a name="ln1002">		case B_LARGE_ICON_TYPE:</a>
<a name="ln1003">			fBitmap = new BBitmap(BRect(0, 0, 31, 31), B_CMAP8);</a>
<a name="ln1004">			if (fBitmap-&gt;InitCheck() == B_OK)</a>
<a name="ln1005">				fBitmap-&gt;SetBits(data, fEditor.FileSize(), 0, B_CMAP8);</a>
<a name="ln1006">			break;</a>
<a name="ln1007">#ifdef HAIKU_TARGET_PLATFORM_HAIKU</a>
<a name="ln1008">		case B_VECTOR_ICON_TYPE:</a>
<a name="ln1009">			fBitmap = new BBitmap(BRect(0, 0, fScaleSlider-&gt;Value() * 8 - 1,</a>
<a name="ln1010">				fScaleSlider-&gt;Value() * 8 - 1), B_RGB32);</a>
<a name="ln1011">			if (fBitmap-&gt;InitCheck() != B_OK</a>
<a name="ln1012">				|| BIconUtils::GetVectorIcon((const uint8 *)data,</a>
<a name="ln1013">					(size_t)fEditor.FileSize(), fBitmap) != B_OK) {</a>
<a name="ln1014">				delete fBitmap;</a>
<a name="ln1015">				fBitmap = NULL;</a>
<a name="ln1016">			}</a>
<a name="ln1017">			break;</a>
<a name="ln1018">#endif</a>
<a name="ln1019">		case B_PNG_FORMAT:</a>
<a name="ln1020">		{</a>
<a name="ln1021">			BMemoryIO stream(data, fEditor.FileSize());</a>
<a name="ln1022">			fBitmap = BTranslationUtils::GetBitmap(&amp;stream);</a>
<a name="ln1023">			break;</a>
<a name="ln1024">		}</a>
<a name="ln1025">		case B_MESSAGE_TYPE:</a>
<a name="ln1026">		{</a>
<a name="ln1027">			BMessage message;</a>
<a name="ln1028">			// ToDo: this could be problematic if the data is not large</a>
<a name="ln1029">			//		enough to contain the message...</a>
<a name="ln1030">			if (message.Unflatten(data) == B_OK)</a>
<a name="ln1031">				fBitmap = new BBitmap(&amp;message);</a>
<a name="ln1032">			break;</a>
<a name="ln1033">		}</a>
<a name="ln1034">	}</a>
<a name="ln1035"> </a>
<a name="ln1036">	// Update the bitmap description. If no image can be displayed,</a>
<a name="ln1037">	// we will show our &quot;unsupported&quot; message</a>
<a name="ln1038"> </a>
<a name="ln1039">	if (fBitmap != NULL &amp;&amp; fBitmap-&gt;InitCheck() != B_OK) {</a>
<a name="ln1040">		delete fBitmap;</a>
<a name="ln1041">		fBitmap = NULL;</a>
<a name="ln1042">	}</a>
<a name="ln1043"> </a>
<a name="ln1044">	if (fBitmap != NULL) {</a>
<a name="ln1045">		char buffer[256];</a>
<a name="ln1046">		const char *type = B_TRANSLATE(&quot;Unknown type&quot;);</a>
<a name="ln1047">		switch (fEditor.Type()) {</a>
<a name="ln1048">			case B_MINI_ICON_TYPE:</a>
<a name="ln1049">			case B_LARGE_ICON_TYPE:</a>
<a name="ln1050">#ifdef HAIKU_TARGET_PLATFORM_HAIKU</a>
<a name="ln1051">			case B_VECTOR_ICON_TYPE:</a>
<a name="ln1052">#endif</a>
<a name="ln1053">				type = B_TRANSLATE(&quot;Icon&quot;);</a>
<a name="ln1054">				break;</a>
<a name="ln1055">			case B_PNG_FORMAT:</a>
<a name="ln1056">				type = B_TRANSLATE(&quot;PNG format&quot;);</a>
<a name="ln1057">				break;</a>
<a name="ln1058">			case B_MESSAGE_TYPE:</a>
<a name="ln1059">				type = B_TRANSLATE(&quot;Flattened bitmap&quot;);</a>
<a name="ln1060">				break;</a>
<a name="ln1061">			default:</a>
<a name="ln1062">				break;</a>
<a name="ln1063">		}</a>
<a name="ln1064">		const char *colorSpace;</a>
<a name="ln1065">		switch (fBitmap-&gt;ColorSpace()) {</a>
<a name="ln1066">			case B_GRAY1:</a>
<a name="ln1067">			case B_GRAY8:</a>
<a name="ln1068">				colorSpace = B_TRANSLATE(&quot;Grayscale&quot;);</a>
<a name="ln1069">				break;</a>
<a name="ln1070">			case B_CMAP8:</a>
<a name="ln1071">				colorSpace = B_TRANSLATE(&quot;8 bit palette&quot;);</a>
<a name="ln1072">				break;</a>
<a name="ln1073">			case B_RGB32:</a>
<a name="ln1074">			case B_RGBA32:</a>
<a name="ln1075">			case B_RGB32_BIG:</a>
<a name="ln1076">			case B_RGBA32_BIG:</a>
<a name="ln1077">				colorSpace = B_TRANSLATE(&quot;32 bit&quot;);</a>
<a name="ln1078">				break;</a>
<a name="ln1079">			case B_RGB15:</a>
<a name="ln1080">			case B_RGBA15:</a>
<a name="ln1081">			case B_RGB15_BIG:</a>
<a name="ln1082">			case B_RGBA15_BIG:</a>
<a name="ln1083">				colorSpace = B_TRANSLATE(&quot;15 bit&quot;);</a>
<a name="ln1084">				break;</a>
<a name="ln1085">			case B_RGB16:</a>
<a name="ln1086">			case B_RGB16_BIG:</a>
<a name="ln1087">				colorSpace = B_TRANSLATE(&quot;16 bit&quot;);</a>
<a name="ln1088">				break;</a>
<a name="ln1089">			default:</a>
<a name="ln1090">				colorSpace = B_TRANSLATE(&quot;Unknown format&quot;);</a>
<a name="ln1091">				break;</a>
<a name="ln1092">		}</a>
<a name="ln1093">		snprintf(buffer, sizeof(buffer), &quot;%s, %g x %g, %s&quot;, type,</a>
<a name="ln1094">			fBitmap-&gt;Bounds().Width() + 1, fBitmap-&gt;Bounds().Height() + 1,</a>
<a name="ln1095">			colorSpace);</a>
<a name="ln1096">		fDescriptionView-&gt;SetText(buffer);</a>
<a name="ln1097">	} else</a>
<a name="ln1098">		fDescriptionView-&gt;SetText(B_TRANSLATE_COMMENT(&quot;Could not read image&quot;,</a>
<a name="ln1099">			&quot;Image means here a picture file, not a disk image.&quot;));</a>
<a name="ln1100"> </a>
<a name="ln1101">	if (fBitmap != NULL) {</a>
<a name="ln1102">		if (fScaleSlider != NULL) {</a>
<a name="ln1103">			if (fScaleSlider-&gt;IsHidden())</a>
<a name="ln1104">				fScaleSlider-&gt;Show();</a>
<a name="ln1105">		}</a>
<a name="ln1106">	} else if (fScaleSlider != NULL &amp;&amp; !fScaleSlider-&gt;IsHidden())</a>
<a name="ln1107">		fScaleSlider-&gt;Hide();</a>
<a name="ln1108"> </a>
<a name="ln1109">	Invalidate();</a>
<a name="ln1110"> </a>
<a name="ln1111">	// restore old view size</a>
<a name="ln1112">	fEditor.SetViewSize(viewSize);</a>
<a name="ln1113">}</a>
<a name="ln1114"> </a>
<a name="ln1115"> </a>
<a name="ln1116">//	#pragma mark - MessageView</a>
<a name="ln1117"> </a>
<a name="ln1118"> </a>
<a name="ln1119">MessageView::MessageView(BRect rect, DataEditor &amp;editor)</a>
<a name="ln1120">	: TypeEditorView(rect, B_TRANSLATE(&quot;Message View&quot;), B_FOLLOW_ALL, 0, editor)</a>
<a name="ln1121">{</a>
<a name="ln1122">	SetViewUIColor(B_PANEL_BACKGROUND_COLOR);</a>
<a name="ln1123"> </a>
<a name="ln1124">	rect = Bounds().InsetByCopy(10, 10);</a>
<a name="ln1125">	rect.right -= B_V_SCROLL_BAR_WIDTH;</a>
<a name="ln1126">	rect.bottom -= B_H_SCROLL_BAR_HEIGHT;</a>
<a name="ln1127"> </a>
<a name="ln1128">	fTextView = new BTextView(rect, B_EMPTY_STRING,</a>
<a name="ln1129">		rect.OffsetToCopy(B_ORIGIN).InsetByCopy(5, 5),</a>
<a name="ln1130">		B_FOLLOW_ALL, B_WILL_DRAW);</a>
<a name="ln1131">	fTextView-&gt;SetViewUIColor(ViewUIColor());</a>
<a name="ln1132">	fTextView-&gt;SetLowUIColor(ViewUIColor());</a>
<a name="ln1133"> </a>
<a name="ln1134">	BScrollView *scrollView = new BScrollView(&quot;scroller&quot;, fTextView,</a>
<a name="ln1135">		B_FOLLOW_ALL, B_WILL_DRAW, true, true);</a>
<a name="ln1136">	AddChild(scrollView);</a>
<a name="ln1137">}</a>
<a name="ln1138"> </a>
<a name="ln1139"> </a>
<a name="ln1140">MessageView::~MessageView()</a>
<a name="ln1141">{</a>
<a name="ln1142">}</a>
<a name="ln1143"> </a>
<a name="ln1144"> </a>
<a name="ln1145">BString</a>
<a name="ln1146">MessageView::_TypeToString(type_code type)</a>
<a name="ln1147">{</a>
<a name="ln1148">	// TODO: move this to a utility function (it's a copy from something</a>
<a name="ln1149">	// similar in ProbeView.cpp)</a>
<a name="ln1150">	char text[32];</a>
<a name="ln1151">	for (int32 i = 0; i &lt; 4; i++) {</a>
<a name="ln1152">		text[i] = type &gt;&gt; (24 - 8 * i);</a>
<a name="ln1153">		if (text[i] &lt; ' ' || text[i] == 0x7f) {</a>
<a name="ln1154">			snprintf(text, sizeof(text), &quot;0x%04&quot; B_PRIx32, type);</a>
<a name="ln1155">			break;</a>
<a name="ln1156">		} else if (i == 3)</a>
<a name="ln1157">			text[4] = '\0';</a>
<a name="ln1158">	}</a>
<a name="ln1159"> </a>
<a name="ln1160">	return BString(text);</a>
<a name="ln1161">}</a>
<a name="ln1162"> </a>
<a name="ln1163"> </a>
<a name="ln1164">void</a>
<a name="ln1165">MessageView::SetTo(BMessage&amp; message)</a>
<a name="ln1166">{</a>
<a name="ln1167">	// TODO: when we have a real column list/tree view, redo this using</a>
<a name="ln1168">	// it with nice editors as well.</a>
<a name="ln1169"> </a>
<a name="ln1170">	fTextView-&gt;SetText(&quot;&quot;);</a>
<a name="ln1171"> </a>
<a name="ln1172">	char text[512];</a>
<a name="ln1173">	snprintf(text, sizeof(text), B_TRANSLATE_COMMENT(&quot;what: '%.4s'\n\n&quot;,</a>
<a name="ln1174">		&quot;'What' is a message specifier that defines the type of the message.&quot;),</a>
<a name="ln1175">		(char*)&amp;message.what);</a>
<a name="ln1176">	fTextView-&gt;Insert(text);</a>
<a name="ln1177"> </a>
<a name="ln1178">	type_code type;</a>
<a name="ln1179">	int32 count;</a>
<a name="ln1180">#ifdef HAIKU_TARGET_PLATFORM_DANO</a>
<a name="ln1181">	const</a>
<a name="ln1182">#endif</a>
<a name="ln1183">	char* name;</a>
<a name="ln1184">	for (int32 i = 0; message.GetInfo(B_ANY_TYPE, i, &amp;name, &amp;type, &amp;count)</a>
<a name="ln1185">			== B_OK; i++) {</a>
<a name="ln1186">		snprintf(text, sizeof(text), &quot;%s\t&quot;, _TypeToString(type).String());</a>
<a name="ln1187">		fTextView-&gt;Insert(text);</a>
<a name="ln1188"> </a>
<a name="ln1189">		text_run_array array;</a>
<a name="ln1190">		array.count = 1;</a>
<a name="ln1191">		array.runs[0].offset = 0;</a>
<a name="ln1192">		array.runs[0].font.SetFace(B_BOLD_FACE);</a>
<a name="ln1193">		array.runs[0].color = (rgb_color){0, 0, 0, 255};</a>
<a name="ln1194"> </a>
<a name="ln1195">		fTextView-&gt;Insert(name, &amp;array);</a>
<a name="ln1196"> </a>
<a name="ln1197">		array.runs[0].font = be_plain_font;</a>
<a name="ln1198">		fTextView-&gt;Insert(&quot;\n&quot;, &amp;array);</a>
<a name="ln1199"> </a>
<a name="ln1200">		for (int32 j = 0; j &lt; count; j++) {</a>
<a name="ln1201">			const char* data;</a>
<a name="ln1202">			ssize_t size;</a>
<a name="ln1203">			if (message.FindData(name, type, j, (const void**)&amp;data, &amp;size)</a>
<a name="ln1204">					!= B_OK)</a>
<a name="ln1205">				continue;</a>
<a name="ln1206"> </a>
<a name="ln1207">			text[0] = '\0';</a>
<a name="ln1208"> </a>
<a name="ln1209">			switch (type) {</a>
<a name="ln1210">				case B_INT64_TYPE:</a>
<a name="ln1211">					snprintf(text, sizeof(text), &quot;%&quot; B_PRId64, *(int64*)data);</a>
<a name="ln1212">					break;</a>
<a name="ln1213">				case B_UINT64_TYPE:</a>
<a name="ln1214">					snprintf(text, sizeof(text), &quot;%&quot; B_PRIu64, *(uint64*)data);</a>
<a name="ln1215">					break;</a>
<a name="ln1216">				case B_INT32_TYPE:</a>
<a name="ln1217">					snprintf(text, sizeof(text), &quot;%&quot; B_PRId32, *(int32*)data);</a>
<a name="ln1218">					break;</a>
<a name="ln1219">				case B_UINT32_TYPE:</a>
<a name="ln1220">					snprintf(text, sizeof(text), &quot;%&quot; B_PRIu32, *(uint32*)data);</a>
<a name="ln1221">					break;</a>
<a name="ln1222">				case B_BOOL_TYPE:</a>
<a name="ln1223">					if (*(uint8*)data)</a>
<a name="ln1224">						strcpy(text, &quot;true&quot;);</a>
<a name="ln1225">					else</a>
<a name="ln1226">						strcpy(text, &quot;false&quot;);</a>
<a name="ln1227">					break;</a>
<a name="ln1228">				case B_STRING_TYPE:</a>
<a name="ln1229">				case B_MIME_STRING_TYPE:</a>
<a name="ln1230">				{</a>
<a name="ln1231">					snprintf(text, sizeof(text), &quot;%s&quot;, data);</a>
<a name="ln1232">					break;</a>
<a name="ln1233">				}</a>
<a name="ln1234">			}</a>
<a name="ln1235"> </a>
<a name="ln1236">			if (text[0]) {</a>
<a name="ln1237">				fTextView-&gt;Insert(&quot;\t\t&quot;);</a>
<a name="ln1238">				if (count &gt; 1) {</a>
<a name="ln1239">					char index[16];</a>
<a name="ln1240">					snprintf(index, sizeof(index), &quot;%&quot; B_PRId32 &quot;.\t&quot;, j);</a>
<a name="ln1241">					fTextView-&gt;Insert(index);</a>
<a name="ln1242">				}</a>
<a name="ln1243">				fTextView-&gt;Insert(text);</a>
<a name="ln1244">				fTextView-&gt;Insert(&quot;\n&quot;);</a>
<a name="ln1245">			}</a>
<a name="ln1246">		}</a>
<a name="ln1247">	}</a>
<a name="ln1248">}</a>
<a name="ln1249"> </a>
<a name="ln1250"> </a>
<a name="ln1251">void</a>
<a name="ln1252">MessageView::_UpdateMessage()</a>
<a name="ln1253">{</a>
<a name="ln1254">	BAutolock locker(fEditor);</a>
<a name="ln1255"> </a>
<a name="ln1256">	size_t viewSize = fEditor.ViewSize();</a>
<a name="ln1257">	// that may need some more memory...</a>
<a name="ln1258">	if ((off_t)viewSize &lt; fEditor.FileSize())</a>
<a name="ln1259">		fEditor.SetViewSize(fEditor.FileSize());</a>
<a name="ln1260"> </a>
<a name="ln1261">	const char *buffer;</a>
<a name="ln1262">	if (fEditor.GetViewBuffer((const uint8 **)&amp;buffer) == B_OK) {</a>
<a name="ln1263">		BMessage message;</a>
<a name="ln1264">		message.Unflatten(buffer);</a>
<a name="ln1265">		SetTo(message);</a>
<a name="ln1266">	}</a>
<a name="ln1267"> </a>
<a name="ln1268">	// restore old view size</a>
<a name="ln1269">	fEditor.SetViewSize(viewSize);</a>
<a name="ln1270">}</a>
<a name="ln1271"> </a>
<a name="ln1272"> </a>
<a name="ln1273">void</a>
<a name="ln1274">MessageView::AttachedToWindow()</a>
<a name="ln1275">{</a>
<a name="ln1276">	fEditor.StartWatching(this);</a>
<a name="ln1277"> </a>
<a name="ln1278">	_UpdateMessage();</a>
<a name="ln1279">}</a>
<a name="ln1280"> </a>
<a name="ln1281"> </a>
<a name="ln1282">void</a>
<a name="ln1283">MessageView::DetachedFromWindow()</a>
<a name="ln1284">{</a>
<a name="ln1285">	fEditor.StopWatching(this);</a>
<a name="ln1286">}</a>
<a name="ln1287"> </a>
<a name="ln1288"> </a>
<a name="ln1289">void</a>
<a name="ln1290">MessageView::MessageReceived(BMessage* message)</a>
<a name="ln1291">{</a>
<a name="ln1292">	BView::MessageReceived(message);</a>
<a name="ln1293">}</a>
<a name="ln1294"> </a>
<a name="ln1295"> </a>
<a name="ln1296">//	#pragma mark -</a>
<a name="ln1297"> </a>
<a name="ln1298"> </a>
<a name="ln1299">TypeEditorView*</a>
<a name="ln1300">GetTypeEditorFor(BRect rect, DataEditor&amp; editor)</a>
<a name="ln1301">{</a>
<a name="ln1302">	switch (editor.Type()) {</a>
<a name="ln1303">		case B_STRING_TYPE:</a>
<a name="ln1304">			return new StringEditor(editor);</a>
<a name="ln1305">		case B_MIME_STRING_TYPE:</a>
<a name="ln1306">			return new MimeTypeEditor(rect, editor);</a>
<a name="ln1307">		case B_BOOL_TYPE:</a>
<a name="ln1308">			return new BooleanEditor(rect, editor);</a>
<a name="ln1309">		case B_INT8_TYPE:</a>
<a name="ln1310">		case B_UINT8_TYPE:</a>
<a name="ln1311">		case B_INT16_TYPE:</a>
<a name="ln1312">		case B_UINT16_TYPE:</a>
<a name="ln1313">		case B_INT32_TYPE:</a>
<a name="ln1314">		case B_UINT32_TYPE:</a>
<a name="ln1315">		case B_INT64_TYPE:</a>
<a name="ln1316">		case B_UINT64_TYPE:</a>
<a name="ln1317">		case B_FLOAT_TYPE:</a>
<a name="ln1318">		case B_DOUBLE_TYPE:</a>
<a name="ln1319">		case B_SSIZE_T_TYPE:</a>
<a name="ln1320">		case B_SIZE_T_TYPE:</a>
<a name="ln1321">		case B_OFF_T_TYPE:</a>
<a name="ln1322">		case B_POINTER_TYPE:</a>
<a name="ln1323">			return new NumberEditor(rect, editor);</a>
<a name="ln1324">		case B_MESSAGE_TYPE:</a>
<a name="ln1325">			// TODO: check for archived bitmaps!!!</a>
<a name="ln1326">			return new MessageView(rect, editor);</a>
<a name="ln1327">		case B_MINI_ICON_TYPE:</a>
<a name="ln1328">		case B_LARGE_ICON_TYPE:</a>
<a name="ln1329">		case B_PNG_FORMAT:</a>
<a name="ln1330">#ifdef HAIKU_TARGET_PLATFORM_HAIKU</a>
<a name="ln1331">		case B_VECTOR_ICON_TYPE:</a>
<a name="ln1332">#endif</a>
<a name="ln1333">			return new ImageView(editor);</a>
<a name="ln1334">	}</a>
<a name="ln1335"> </a>
<a name="ln1336">	return NULL;</a>
<a name="ln1337">}</a>
<a name="ln1338"> </a>
<a name="ln1339"> </a>
<a name="ln1340">status_t</a>
<a name="ln1341">GetNthTypeEditor(int32 index, const char** _name)</a>
<a name="ln1342">{</a>
<a name="ln1343">	static const char* kEditors[] = {</a>
<a name="ln1344">		B_TRANSLATE_COMMENT(&quot;Text&quot;, &quot;This is the type of editor&quot;),</a>
<a name="ln1345">		B_TRANSLATE_COMMENT(&quot;Number&quot;, &quot;This is the type of editor&quot;),</a>
<a name="ln1346">		B_TRANSLATE_COMMENT(&quot;Boolean&quot;, &quot;This is the type of editor&quot;),</a>
<a name="ln1347">		B_TRANSLATE_COMMENT(&quot;Message&quot;, &quot;This is the type of view&quot;),</a>
<a name="ln1348">		B_TRANSLATE_COMMENT(&quot;Image&quot;, &quot;This is the type of view&quot;)</a>
<a name="ln1349">	};</a>
<a name="ln1350"> </a>
<a name="ln1351">	if (index &lt; 0 || index &gt;= int32(sizeof(kEditors) / sizeof(kEditors[0])))</a>
<a name="ln1352">		return B_BAD_VALUE;</a>
<a name="ln1353"> </a>
<a name="ln1354">	*_name = kEditors[index];</a>
<a name="ln1355">	return B_OK;</a>
<a name="ln1356">}</a>
<a name="ln1357"> </a>
<a name="ln1358"> </a>
<a name="ln1359">TypeEditorView*</a>
<a name="ln1360">GetTypeEditorAt(int32 index, BRect rect, DataEditor&amp; editor)</a>
<a name="ln1361">{</a>
<a name="ln1362">	TypeEditorView* view = NULL;</a>
<a name="ln1363"> </a>
<a name="ln1364">	switch (index) {</a>
<a name="ln1365">		case 0:</a>
<a name="ln1366">			view = new StringEditor(editor);</a>
<a name="ln1367">			break;</a>
<a name="ln1368">		case 1:</a>
<a name="ln1369">			view = new NumberEditor(rect, editor);</a>
<a name="ln1370">			break;</a>
<a name="ln1371">		case 2:</a>
<a name="ln1372">			view = new BooleanEditor(rect, editor);</a>
<a name="ln1373">			break;</a>
<a name="ln1374">		case 3:</a>
<a name="ln1375">			view = new MessageView(rect, editor);</a>
<a name="ln1376">			break;</a>
<a name="ln1377">		case 4:</a>
<a name="ln1378">			view = new ImageView(editor);</a>
<a name="ln1379">			break;</a>
<a name="ln1380"> </a>
<a name="ln1381">		default:</a>
<a name="ln1382">			return NULL;</a>
<a name="ln1383">	}</a>
<a name="ln1384"> </a>
<a name="ln1385">	if (view == NULL)</a>
<a name="ln1386">		return NULL;</a>
<a name="ln1387"> </a>
<a name="ln1388">	if (!view-&gt;TypeMatches()) {</a>
<a name="ln1389">		delete view;</a>
<a name="ln1390">		return NULL;</a>
<a name="ln1391">	}</a>
<a name="ln1392"> </a>
<a name="ln1393">	return view;</a>
<a name="ln1394">}</a>
<a name="ln1395"> </a>

</code></pre>
<div class="balloon" rel="1124"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v763/" target="_blank">V763</a> Parameter 'rect' is always rewritten in function body before being used.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
