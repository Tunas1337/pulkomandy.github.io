
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>UserlandRequestHandler.cpp</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2"> * Copyright 2001-2009, Ingo Weinhold, ingo_weinhold@gmx.de.</a>
<a name="ln3"> * Distributed under the terms of the MIT License.</a>
<a name="ln4"> */</a>
<a name="ln5"> </a>
<a name="ln6">#include &quot;UserlandRequestHandler.h&quot;</a>
<a name="ln7"> </a>
<a name="ln8">#include &lt;algorithm&gt;</a>
<a name="ln9"> </a>
<a name="ln10">#include &lt;util/KMessage.h&gt;</a>
<a name="ln11"> </a>
<a name="ln12">#include &lt;Notifications.h&gt;</a>
<a name="ln13"> </a>
<a name="ln14">#include &quot;AutoDeleter.h&quot;</a>
<a name="ln15">#include &quot;Compatibility.h&quot;</a>
<a name="ln16">#include &quot;Debug.h&quot;</a>
<a name="ln17">#include &quot;FileSystem.h&quot;</a>
<a name="ln18">#include &quot;IORequestInfo.h&quot;</a>
<a name="ln19">#include &quot;RequestPort.h&quot;</a>
<a name="ln20">#include &quot;Requests.h&quot;</a>
<a name="ln21">#include &quot;RequestThread.h&quot;</a>
<a name="ln22">#include &quot;SingleReplyRequestHandler.h&quot;</a>
<a name="ln23">#include &quot;Volume.h&quot;</a>
<a name="ln24"> </a>
<a name="ln25"> </a>
<a name="ln26">// constructor</a>
<a name="ln27">UserlandRequestHandler::UserlandRequestHandler(FileSystem* fileSystem)</a>
<a name="ln28">	: RequestHandler(),</a>
<a name="ln29">	  fFileSystem(fileSystem),</a>
<a name="ln30">	  fExpectReply(false),</a>
<a name="ln31">	  fExpectedReply(0)</a>
<a name="ln32">{</a>
<a name="ln33">}</a>
<a name="ln34"> </a>
<a name="ln35">// constructor</a>
<a name="ln36">UserlandRequestHandler::UserlandRequestHandler(FileSystem* fileSystem,</a>
<a name="ln37">	uint32 expectedReply)</a>
<a name="ln38">	: RequestHandler(),</a>
<a name="ln39">	  fFileSystem(fileSystem),</a>
<a name="ln40">	  fExpectReply(true),</a>
<a name="ln41">	  fExpectedReply(expectedReply)</a>
<a name="ln42">{</a>
<a name="ln43">}</a>
<a name="ln44"> </a>
<a name="ln45">// destructor</a>
<a name="ln46">UserlandRequestHandler::~UserlandRequestHandler()</a>
<a name="ln47">{</a>
<a name="ln48">}</a>
<a name="ln49"> </a>
<a name="ln50">// HandleRequest</a>
<a name="ln51">status_t</a>
<a name="ln52">UserlandRequestHandler::HandleRequest(Request* request)</a>
<a name="ln53">{</a>
<a name="ln54">	if (fExpectReply &amp;&amp; request-&gt;GetType() == fExpectedReply) {</a>
<a name="ln55">		fDone = true;</a>
<a name="ln56">		return B_OK;</a>
<a name="ln57">	}</a>
<a name="ln58"> </a>
<a name="ln59">	switch (request-&gt;GetType()) {</a>
<a name="ln60">		// FS</a>
<a name="ln61">		case MOUNT_VOLUME_REQUEST:</a>
<a name="ln62">			return _HandleRequest((MountVolumeRequest*)request);</a>
<a name="ln63">		case UNMOUNT_VOLUME_REQUEST:</a>
<a name="ln64">			return _HandleRequest((UnmountVolumeRequest*)request);</a>
<a name="ln65">		case SYNC_VOLUME_REQUEST:</a>
<a name="ln66">			return _HandleRequest((SyncVolumeRequest*)request);</a>
<a name="ln67">		case READ_FS_INFO_REQUEST:</a>
<a name="ln68">			return _HandleRequest((ReadFSInfoRequest*)request);</a>
<a name="ln69">		case WRITE_FS_INFO_REQUEST:</a>
<a name="ln70">			return _HandleRequest((WriteFSInfoRequest*)request);</a>
<a name="ln71"> </a>
<a name="ln72">		// vnodes</a>
<a name="ln73">		case LOOKUP_REQUEST:</a>
<a name="ln74">			return _HandleRequest((LookupRequest*)request);</a>
<a name="ln75">		case GET_VNODE_NAME_REQUEST:</a>
<a name="ln76">			return _HandleRequest((GetVNodeNameRequest*)request);</a>
<a name="ln77">		case READ_VNODE_REQUEST:</a>
<a name="ln78">			return _HandleRequest((ReadVNodeRequest*)request);</a>
<a name="ln79">		case WRITE_VNODE_REQUEST:</a>
<a name="ln80">			return _HandleRequest((WriteVNodeRequest*)request);</a>
<a name="ln81">		case FS_REMOVE_VNODE_REQUEST:</a>
<a name="ln82">			return _HandleRequest((FSRemoveVNodeRequest*)request);</a>
<a name="ln83"> </a>
<a name="ln84">		// asynchronous I/O</a>
<a name="ln85">		case DO_IO_REQUEST:</a>
<a name="ln86">			return _HandleRequest((DoIORequest*)request);</a>
<a name="ln87">		case CANCEL_IO_REQUEST:</a>
<a name="ln88">			return _HandleRequest((CancelIORequest*)request);</a>
<a name="ln89">		case ITERATIVE_IO_GET_VECS_REQUEST:</a>
<a name="ln90">			return _HandleRequest((IterativeIOGetVecsRequest*)request);</a>
<a name="ln91">		case ITERATIVE_IO_FINISHED_REQUEST:</a>
<a name="ln92">			return _HandleRequest((IterativeIOFinishedRequest*)request);</a>
<a name="ln93"> </a>
<a name="ln94">		// nodes</a>
<a name="ln95">		case IOCTL_REQUEST:</a>
<a name="ln96">			return _HandleRequest((IOCtlRequest*)request);</a>
<a name="ln97">		case SET_FLAGS_REQUEST:</a>
<a name="ln98">			return _HandleRequest((SetFlagsRequest*)request);</a>
<a name="ln99">		case SELECT_REQUEST:</a>
<a name="ln100">			return _HandleRequest((SelectRequest*)request);</a>
<a name="ln101">		case DESELECT_REQUEST:</a>
<a name="ln102">			return _HandleRequest((DeselectRequest*)request);</a>
<a name="ln103">		case FSYNC_REQUEST:</a>
<a name="ln104">			return _HandleRequest((FSyncRequest*)request);</a>
<a name="ln105">		case READ_SYMLINK_REQUEST:</a>
<a name="ln106">			return _HandleRequest((ReadSymlinkRequest*)request);</a>
<a name="ln107">		case CREATE_SYMLINK_REQUEST:</a>
<a name="ln108">			return _HandleRequest((CreateSymlinkRequest*)request);</a>
<a name="ln109">		case LINK_REQUEST:</a>
<a name="ln110">			return _HandleRequest((LinkRequest*)request);</a>
<a name="ln111">		case UNLINK_REQUEST:</a>
<a name="ln112">			return _HandleRequest((UnlinkRequest*)request);</a>
<a name="ln113">		case RENAME_REQUEST:</a>
<a name="ln114">			return _HandleRequest((RenameRequest*)request);</a>
<a name="ln115">		case ACCESS_REQUEST:</a>
<a name="ln116">			return _HandleRequest((AccessRequest*)request);</a>
<a name="ln117">		case READ_STAT_REQUEST:</a>
<a name="ln118">			return _HandleRequest((ReadStatRequest*)request);</a>
<a name="ln119">		case WRITE_STAT_REQUEST:</a>
<a name="ln120">			return _HandleRequest((WriteStatRequest*)request);</a>
<a name="ln121"> </a>
<a name="ln122">		// files</a>
<a name="ln123">		case CREATE_REQUEST:</a>
<a name="ln124">			return _HandleRequest((CreateRequest*)request);</a>
<a name="ln125">		case OPEN_REQUEST:</a>
<a name="ln126">			return _HandleRequest((OpenRequest*)request);</a>
<a name="ln127">		case CLOSE_REQUEST:</a>
<a name="ln128">			return _HandleRequest((CloseRequest*)request);</a>
<a name="ln129">		case FREE_COOKIE_REQUEST:</a>
<a name="ln130">			return _HandleRequest((FreeCookieRequest*)request);</a>
<a name="ln131">		case READ_REQUEST:</a>
<a name="ln132">			return _HandleRequest((ReadRequest*)request);</a>
<a name="ln133">		case WRITE_REQUEST:</a>
<a name="ln134">			return _HandleRequest((WriteRequest*)request);</a>
<a name="ln135"> </a>
<a name="ln136">		// directories</a>
<a name="ln137">		case CREATE_DIR_REQUEST:</a>
<a name="ln138">			return _HandleRequest((CreateDirRequest*)request);</a>
<a name="ln139">		case REMOVE_DIR_REQUEST:</a>
<a name="ln140">			return _HandleRequest((RemoveDirRequest*)request);</a>
<a name="ln141">		case OPEN_DIR_REQUEST:</a>
<a name="ln142">			return _HandleRequest((OpenDirRequest*)request);</a>
<a name="ln143">		case CLOSE_DIR_REQUEST:</a>
<a name="ln144">			return _HandleRequest((CloseDirRequest*)request);</a>
<a name="ln145">		case FREE_DIR_COOKIE_REQUEST:</a>
<a name="ln146">			return _HandleRequest((FreeDirCookieRequest*)request);</a>
<a name="ln147">		case READ_DIR_REQUEST:</a>
<a name="ln148">			return _HandleRequest((ReadDirRequest*)request);</a>
<a name="ln149">		case REWIND_DIR_REQUEST:</a>
<a name="ln150">			return _HandleRequest((RewindDirRequest*)request);</a>
<a name="ln151"> </a>
<a name="ln152">		// attribute directories</a>
<a name="ln153">		case OPEN_ATTR_DIR_REQUEST:</a>
<a name="ln154">			return _HandleRequest((OpenAttrDirRequest*)request);</a>
<a name="ln155">		case CLOSE_ATTR_DIR_REQUEST:</a>
<a name="ln156">			return _HandleRequest((CloseAttrDirRequest*)request);</a>
<a name="ln157">		case FREE_ATTR_DIR_COOKIE_REQUEST:</a>
<a name="ln158">			return _HandleRequest((FreeAttrDirCookieRequest*)request);</a>
<a name="ln159">		case READ_ATTR_DIR_REQUEST:</a>
<a name="ln160">			return _HandleRequest((ReadAttrDirRequest*)request);</a>
<a name="ln161">		case REWIND_ATTR_DIR_REQUEST:</a>
<a name="ln162">			return _HandleRequest((RewindAttrDirRequest*)request);</a>
<a name="ln163"> </a>
<a name="ln164">		// attributes</a>
<a name="ln165">		case CREATE_ATTR_REQUEST:</a>
<a name="ln166">			return _HandleRequest((CreateAttrRequest*)request);</a>
<a name="ln167">		case OPEN_ATTR_REQUEST:</a>
<a name="ln168">			return _HandleRequest((OpenAttrRequest*)request);</a>
<a name="ln169">		case CLOSE_ATTR_REQUEST:</a>
<a name="ln170">			return _HandleRequest((CloseAttrRequest*)request);</a>
<a name="ln171">		case FREE_ATTR_COOKIE_REQUEST:</a>
<a name="ln172">			return _HandleRequest((FreeAttrCookieRequest*)request);</a>
<a name="ln173">		case READ_ATTR_REQUEST:</a>
<a name="ln174">			return _HandleRequest((ReadAttrRequest*)request);</a>
<a name="ln175">		case WRITE_ATTR_REQUEST:</a>
<a name="ln176">			return _HandleRequest((WriteAttrRequest*)request);</a>
<a name="ln177">		case READ_ATTR_STAT_REQUEST:</a>
<a name="ln178">			return _HandleRequest((ReadAttrStatRequest*)request);</a>
<a name="ln179">		case WRITE_ATTR_STAT_REQUEST:</a>
<a name="ln180">			return _HandleRequest((WriteAttrStatRequest*)request);</a>
<a name="ln181">		case RENAME_ATTR_REQUEST:</a>
<a name="ln182">			return _HandleRequest((RenameAttrRequest*)request);</a>
<a name="ln183">		case REMOVE_ATTR_REQUEST:</a>
<a name="ln184">			return _HandleRequest((RemoveAttrRequest*)request);</a>
<a name="ln185"> </a>
<a name="ln186">		// indices</a>
<a name="ln187">		case OPEN_INDEX_DIR_REQUEST:</a>
<a name="ln188">			return _HandleRequest((OpenIndexDirRequest*)request);</a>
<a name="ln189">		case CLOSE_INDEX_DIR_REQUEST:</a>
<a name="ln190">			return _HandleRequest((CloseIndexDirRequest*)request);</a>
<a name="ln191">		case FREE_INDEX_DIR_COOKIE_REQUEST:</a>
<a name="ln192">			return _HandleRequest((FreeIndexDirCookieRequest*)request);</a>
<a name="ln193">		case READ_INDEX_DIR_REQUEST:</a>
<a name="ln194">			return _HandleRequest((ReadIndexDirRequest*)request);</a>
<a name="ln195">		case REWIND_INDEX_DIR_REQUEST:</a>
<a name="ln196">			return _HandleRequest((RewindIndexDirRequest*)request);</a>
<a name="ln197">		case CREATE_INDEX_REQUEST:</a>
<a name="ln198">			return _HandleRequest((CreateIndexRequest*)request);</a>
<a name="ln199">		case REMOVE_INDEX_REQUEST:</a>
<a name="ln200">			return _HandleRequest((RemoveIndexRequest*)request);</a>
<a name="ln201">		case READ_INDEX_STAT_REQUEST:</a>
<a name="ln202">			return _HandleRequest((ReadIndexStatRequest*)request);</a>
<a name="ln203"> </a>
<a name="ln204">		// queries</a>
<a name="ln205">		case OPEN_QUERY_REQUEST:</a>
<a name="ln206">			return _HandleRequest((OpenQueryRequest*)request);</a>
<a name="ln207">		case CLOSE_QUERY_REQUEST:</a>
<a name="ln208">			return _HandleRequest((CloseQueryRequest*)request);</a>
<a name="ln209">		case FREE_QUERY_COOKIE_REQUEST:</a>
<a name="ln210">			return _HandleRequest((FreeQueryCookieRequest*)request);</a>
<a name="ln211">		case READ_QUERY_REQUEST:</a>
<a name="ln212">			return _HandleRequest((ReadQueryRequest*)request);</a>
<a name="ln213">		case REWIND_QUERY_REQUEST:</a>
<a name="ln214">			return _HandleRequest((RewindQueryRequest*)request);</a>
<a name="ln215"> </a>
<a name="ln216">		// node monitoring</a>
<a name="ln217">		case NODE_MONITORING_EVENT_REQUEST:</a>
<a name="ln218">			return _HandleRequest((NodeMonitoringEventRequest*)request);</a>
<a name="ln219">	}</a>
<a name="ln220">PRINT((&quot;UserlandRequestHandler::HandleRequest(): unexpected request: %lu\n&quot;,</a>
<a name="ln221">request-&gt;GetType()));</a>
<a name="ln222">	return B_BAD_DATA;</a>
<a name="ln223">}</a>
<a name="ln224"> </a>
<a name="ln225"> </a>
<a name="ln226">// #pragma mark - FS</a>
<a name="ln227"> </a>
<a name="ln228"> </a>
<a name="ln229">// _HandleRequest</a>
<a name="ln230">status_t</a>
<a name="ln231">UserlandRequestHandler::_HandleRequest(MountVolumeRequest* request)</a>
<a name="ln232">{</a>
<a name="ln233">	// check and execute the request</a>
<a name="ln234">	status_t result = B_OK;</a>
<a name="ln235"> </a>
<a name="ln236">	// if the device path is relative, make it absolute by appending the</a>
<a name="ln237">	// provided CWD</a>
<a name="ln238">	const char* device = (const char*)request-&gt;device.GetData();</a>
<a name="ln239">	char stackDevice[B_PATH_NAME_LENGTH];</a>
<a name="ln240">	if (result == B_OK) {</a>
<a name="ln241">		if (device &amp;&amp; device[0] != '/') {</a>
<a name="ln242">			if (const char* cwd = (const char*)request-&gt;cwd.GetData()) {</a>
<a name="ln243">				int32 deviceLen = strlen(device);</a>
<a name="ln244">				int32 cwdLen = strlen(cwd);</a>
<a name="ln245">				if (cwdLen + 1 + deviceLen &lt; (int32)sizeof(stackDevice)) {</a>
<a name="ln246">					strcpy(stackDevice, cwd);</a>
<a name="ln247">					strcat(stackDevice, &quot;/&quot;);</a>
<a name="ln248">					strcat(stackDevice, device);</a>
<a name="ln249">					device = stackDevice;</a>
<a name="ln250">				} else</a>
<a name="ln251">					result = B_NAME_TOO_LONG;</a>
<a name="ln252">			} else</a>
<a name="ln253">				result = B_BAD_VALUE;</a>
<a name="ln254">		}</a>
<a name="ln255">	}</a>
<a name="ln256"> </a>
<a name="ln257">	// create the volume</a>
<a name="ln258">	Volume* volume = NULL;</a>
<a name="ln259">	if (result == B_OK)</a>
<a name="ln260">		result = fFileSystem-&gt;CreateVolume(&amp;volume, request-&gt;nsid);</a>
<a name="ln261"> </a>
<a name="ln262">	// mount it</a>
<a name="ln263">	ino_t rootID;</a>
<a name="ln264">	if (result == B_OK) {</a>
<a name="ln265">		RequestThreadContext context(volume, request);</a>
<a name="ln266">		result = volume-&gt;Mount(device, request-&gt;flags,</a>
<a name="ln267">			(const char*)request-&gt;parameters.GetData(), &amp;rootID);</a>
<a name="ln268">		if (result != B_OK)</a>
<a name="ln269">			fFileSystem-&gt;DeleteVolume(volume);</a>
<a name="ln270">	}</a>
<a name="ln271">	if (result != B_OK)</a>
<a name="ln272">		volume = NULL;</a>
<a name="ln273"> </a>
<a name="ln274">	// prepare the reply</a>
<a name="ln275">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln276">	MountVolumeReply* reply;</a>
<a name="ln277">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln278">	if (error != B_OK)</a>
<a name="ln279">		RETURN_ERROR(error);</a>
<a name="ln280">	reply-&gt;error = result;</a>
<a name="ln281">	reply-&gt;volume = volume;</a>
<a name="ln282">	reply-&gt;rootID = rootID;</a>
<a name="ln283">	if (volume != NULL)</a>
<a name="ln284">		volume-&gt;GetCapabilities(reply-&gt;capabilities);</a>
<a name="ln285"> </a>
<a name="ln286">	// send the reply</a>
<a name="ln287">	return _SendReply(allocator, false);</a>
<a name="ln288">}</a>
<a name="ln289"> </a>
<a name="ln290">// _HandleRequest</a>
<a name="ln291">status_t</a>
<a name="ln292">UserlandRequestHandler::_HandleRequest(UnmountVolumeRequest* request)</a>
<a name="ln293">{</a>
<a name="ln294">	// check and execute the request</a>
<a name="ln295">	status_t result = B_BAD_VALUE;</a>
<a name="ln296">	if (Volume* volume = (Volume*)request-&gt;volume) {</a>
<a name="ln297">		RequestThreadContext context(volume, request);</a>
<a name="ln298">		result = volume-&gt;Unmount();</a>
<a name="ln299">		fFileSystem-&gt;DeleteVolume(volume);</a>
<a name="ln300">	}</a>
<a name="ln301"> </a>
<a name="ln302">	// prepare the reply</a>
<a name="ln303">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln304">	UnmountVolumeReply* reply;</a>
<a name="ln305">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln306">	if (error != B_OK)</a>
<a name="ln307">		RETURN_ERROR(error);</a>
<a name="ln308">	reply-&gt;error = result;</a>
<a name="ln309"> </a>
<a name="ln310">	// send the reply</a>
<a name="ln311">	return _SendReply(allocator, false);</a>
<a name="ln312">}</a>
<a name="ln313"> </a>
<a name="ln314">// _HandleRequest</a>
<a name="ln315">status_t</a>
<a name="ln316">UserlandRequestHandler::_HandleRequest(SyncVolumeRequest* request)</a>
<a name="ln317">{</a>
<a name="ln318">	// check and execute the request</a>
<a name="ln319">	status_t result = B_OK;</a>
<a name="ln320">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln321">	if (!volume)</a>
<a name="ln322">		result = B_BAD_VALUE;</a>
<a name="ln323">	if (result == B_OK) {</a>
<a name="ln324">		RequestThreadContext context(volume, request);</a>
<a name="ln325">		result = volume-&gt;Sync();</a>
<a name="ln326">	}</a>
<a name="ln327">	// prepare the reply</a>
<a name="ln328">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln329">	SyncVolumeReply* reply;</a>
<a name="ln330">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln331">	if (error != B_OK)</a>
<a name="ln332">		RETURN_ERROR(error);</a>
<a name="ln333">	reply-&gt;error = result;</a>
<a name="ln334"> </a>
<a name="ln335">	// send the reply</a>
<a name="ln336">	return _SendReply(allocator, false);</a>
<a name="ln337">}</a>
<a name="ln338"> </a>
<a name="ln339">// _HandleRequest</a>
<a name="ln340">status_t</a>
<a name="ln341">UserlandRequestHandler::_HandleRequest(ReadFSInfoRequest* request)</a>
<a name="ln342">{</a>
<a name="ln343">	// check and execute the request</a>
<a name="ln344">	status_t result = B_OK;</a>
<a name="ln345">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln346">	if (!volume)</a>
<a name="ln347">		result = B_BAD_VALUE;</a>
<a name="ln348">	fs_info info;</a>
<a name="ln349">	if (result == B_OK) {</a>
<a name="ln350">		RequestThreadContext context(volume, request);</a>
<a name="ln351">		result = volume-&gt;ReadFSInfo(&amp;info);</a>
<a name="ln352">	}</a>
<a name="ln353">	// prepare the reply</a>
<a name="ln354">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln355">	ReadFSInfoReply* reply;</a>
<a name="ln356">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln357">	if (error != B_OK)</a>
<a name="ln358">		RETURN_ERROR(error);</a>
<a name="ln359">	reply-&gt;error = result;</a>
<a name="ln360">	reply-&gt;info = info;</a>
<a name="ln361"> </a>
<a name="ln362">	// send the reply</a>
<a name="ln363">	return _SendReply(allocator, false);</a>
<a name="ln364">}</a>
<a name="ln365"> </a>
<a name="ln366">// _HandleRequest</a>
<a name="ln367">status_t</a>
<a name="ln368">UserlandRequestHandler::_HandleRequest(WriteFSInfoRequest* request)</a>
<a name="ln369">{</a>
<a name="ln370">	// check and execute the request</a>
<a name="ln371">	status_t result = B_OK;</a>
<a name="ln372">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln373">	if (!volume)</a>
<a name="ln374">		result = B_BAD_VALUE;</a>
<a name="ln375">	if (result == B_OK) {</a>
<a name="ln376">		RequestThreadContext context(volume, request);</a>
<a name="ln377">		result = volume-&gt;WriteFSInfo(&amp;request-&gt;info, request-&gt;mask);</a>
<a name="ln378">	}</a>
<a name="ln379"> </a>
<a name="ln380">	// prepare the reply</a>
<a name="ln381">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln382">	WriteFSInfoReply* reply;</a>
<a name="ln383">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln384">	if (error != B_OK)</a>
<a name="ln385">		RETURN_ERROR(error);</a>
<a name="ln386">	reply-&gt;error = result;</a>
<a name="ln387"> </a>
<a name="ln388">	// send the reply</a>
<a name="ln389">	return _SendReply(allocator, false);</a>
<a name="ln390">}</a>
<a name="ln391"> </a>
<a name="ln392"> </a>
<a name="ln393">// #pragma mark - vnodes</a>
<a name="ln394"> </a>
<a name="ln395"> </a>
<a name="ln396">// _HandleRequest</a>
<a name="ln397">status_t</a>
<a name="ln398">UserlandRequestHandler::_HandleRequest(LookupRequest* request)</a>
<a name="ln399">{</a>
<a name="ln400">	// check and execute the request</a>
<a name="ln401">	status_t result = B_OK;</a>
<a name="ln402">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln403">	if (!volume)</a>
<a name="ln404">		result = B_BAD_VALUE;</a>
<a name="ln405"> </a>
<a name="ln406">	ino_t vnid = 0;</a>
<a name="ln407">	if (result == B_OK) {</a>
<a name="ln408">		RequestThreadContext context(volume, request);</a>
<a name="ln409">		result = volume-&gt;Lookup(request-&gt;node,</a>
<a name="ln410">			(const char*)request-&gt;entryName.GetData(), &amp;vnid);</a>
<a name="ln411">	}</a>
<a name="ln412"> </a>
<a name="ln413">	// prepare the reply</a>
<a name="ln414">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln415">	LookupReply* reply;</a>
<a name="ln416">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln417">	if (error != B_OK)</a>
<a name="ln418">		RETURN_ERROR(error);</a>
<a name="ln419"> </a>
<a name="ln420">	reply-&gt;vnid = vnid;</a>
<a name="ln421">	reply-&gt;error = result;</a>
<a name="ln422"> </a>
<a name="ln423">	// send the reply</a>
<a name="ln424">	return _SendReply(allocator, false);</a>
<a name="ln425">}</a>
<a name="ln426"> </a>
<a name="ln427">// _HandleRequest</a>
<a name="ln428">status_t</a>
<a name="ln429">UserlandRequestHandler::_HandleRequest(GetVNodeNameRequest* request)</a>
<a name="ln430">{</a>
<a name="ln431">	// check and execute the request</a>
<a name="ln432">	status_t result = B_OK;</a>
<a name="ln433">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln434">	if (!volume)</a>
<a name="ln435">		result = B_BAD_VALUE;</a>
<a name="ln436"> </a>
<a name="ln437">	void* node = request-&gt;node;</a>
<a name="ln438">	size_t bufferSize = request-&gt;size;</a>
<a name="ln439"> </a>
<a name="ln440">	// allocate the reply</a>
<a name="ln441">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln442">	GetVNodeNameReply* reply;</a>
<a name="ln443">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln444">	if (error != B_OK)</a>
<a name="ln445">		RETURN_ERROR(error);</a>
<a name="ln446">	char* buffer;</a>
<a name="ln447">	if (result == B_OK) {</a>
<a name="ln448">		result = allocator.AllocateAddress(reply-&gt;buffer, bufferSize, 1,</a>
<a name="ln449">			(void**)&amp;buffer, true);</a>
<a name="ln450">	}</a>
<a name="ln451"> </a>
<a name="ln452">	// execute the request</a>
<a name="ln453">	if (result == B_OK) {</a>
<a name="ln454">		RequestThreadContext context(volume, request);</a>
<a name="ln455">		result = volume-&gt;GetVNodeName(node, buffer, bufferSize);</a>
<a name="ln456">	}</a>
<a name="ln457"> </a>
<a name="ln458">	// reconstruct the reply, in case it has been overwritten</a>
<a name="ln459">	reply = new(reply) GetVNodeNameReply;</a>
<a name="ln460"> </a>
<a name="ln461">	// send the reply</a>
<a name="ln462">	reply-&gt;error = result;</a>
<a name="ln463">	return _SendReply(allocator, (result == B_OK));</a>
<a name="ln464">}</a>
<a name="ln465"> </a>
<a name="ln466">// _HandleRequest</a>
<a name="ln467">status_t</a>
<a name="ln468">UserlandRequestHandler::_HandleRequest(ReadVNodeRequest* request)</a>
<a name="ln469">{</a>
<a name="ln470">	// check and execute the request</a>
<a name="ln471">	status_t result = B_OK;</a>
<a name="ln472">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln473">	if (!volume)</a>
<a name="ln474">		result = B_BAD_VALUE;</a>
<a name="ln475"> </a>
<a name="ln476">	void* node;</a>
<a name="ln477">	int type;</a>
<a name="ln478">	uint32 flags;</a>
<a name="ln479">	FSVNodeCapabilities capabilities;</a>
<a name="ln480">	if (result == B_OK) {</a>
<a name="ln481">		RequestThreadContext context(volume, request);</a>
<a name="ln482">		result = volume-&gt;ReadVNode(request-&gt;vnid, request-&gt;reenter, &amp;node,</a>
<a name="ln483">			&amp;type, &amp;flags, &amp;capabilities);</a>
<a name="ln484">	}</a>
<a name="ln485"> </a>
<a name="ln486">	// prepare the reply</a>
<a name="ln487">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln488">	ReadVNodeReply* reply;</a>
<a name="ln489">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln490">	if (error != B_OK)</a>
<a name="ln491">		RETURN_ERROR(error);</a>
<a name="ln492"> </a>
<a name="ln493">	reply-&gt;error = result;</a>
<a name="ln494">	reply-&gt;node = node;</a>
<a name="ln495">	reply-&gt;type = type;</a>
<a name="ln496">	reply-&gt;flags = flags;</a>
<a name="ln497">	reply-&gt;capabilities = capabilities;</a>
<a name="ln498"> </a>
<a name="ln499">	// send the reply</a>
<a name="ln500">	return _SendReply(allocator, false);</a>
<a name="ln501">}</a>
<a name="ln502"> </a>
<a name="ln503">// _HandleRequest</a>
<a name="ln504">status_t</a>
<a name="ln505">UserlandRequestHandler::_HandleRequest(WriteVNodeRequest* request)</a>
<a name="ln506">{</a>
<a name="ln507">	// check and execute the request</a>
<a name="ln508">	status_t result = B_OK;</a>
<a name="ln509">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln510">	if (!volume)</a>
<a name="ln511">		result = B_BAD_VALUE;</a>
<a name="ln512"> </a>
<a name="ln513">	if (result == B_OK) {</a>
<a name="ln514">		RequestThreadContext context(volume, request);</a>
<a name="ln515">		result = volume-&gt;WriteVNode(request-&gt;node, request-&gt;reenter);</a>
<a name="ln516">	}</a>
<a name="ln517"> </a>
<a name="ln518">	// prepare the reply</a>
<a name="ln519">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln520">	WriteVNodeReply* reply;</a>
<a name="ln521">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln522">	if (error != B_OK)</a>
<a name="ln523">		RETURN_ERROR(error);</a>
<a name="ln524"> </a>
<a name="ln525">	reply-&gt;error = result;</a>
<a name="ln526"> </a>
<a name="ln527">	// send the reply</a>
<a name="ln528">	return _SendReply(allocator, false);</a>
<a name="ln529">}</a>
<a name="ln530"> </a>
<a name="ln531">// _HandleRequest</a>
<a name="ln532">status_t</a>
<a name="ln533">UserlandRequestHandler::_HandleRequest(FSRemoveVNodeRequest* request)</a>
<a name="ln534">{</a>
<a name="ln535">	// check and execute the request</a>
<a name="ln536">	status_t result = B_OK;</a>
<a name="ln537">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln538">	if (!volume)</a>
<a name="ln539">		result = B_BAD_VALUE;</a>
<a name="ln540"> </a>
<a name="ln541">	if (result == B_OK) {</a>
<a name="ln542">		RequestThreadContext context(volume, request);</a>
<a name="ln543">		result = volume-&gt;RemoveVNode(request-&gt;node, request-&gt;reenter);</a>
<a name="ln544">	}</a>
<a name="ln545"> </a>
<a name="ln546">	// prepare the reply</a>
<a name="ln547">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln548">	FSRemoveVNodeReply* reply;</a>
<a name="ln549">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln550">	if (error != B_OK)</a>
<a name="ln551">		RETURN_ERROR(error);</a>
<a name="ln552"> </a>
<a name="ln553">	reply-&gt;error = result;</a>
<a name="ln554"> </a>
<a name="ln555">	// send the reply</a>
<a name="ln556">	return _SendReply(allocator, false);</a>
<a name="ln557">}</a>
<a name="ln558"> </a>
<a name="ln559"> </a>
<a name="ln560">// #pragma mark - asynchronous I/O</a>
<a name="ln561"> </a>
<a name="ln562"> </a>
<a name="ln563">status_t</a>
<a name="ln564">UserlandRequestHandler::_HandleRequest(DoIORequest* request)</a>
<a name="ln565">{</a>
<a name="ln566">	// check and execute the request</a>
<a name="ln567">	status_t result = B_OK;</a>
<a name="ln568">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln569">	if (!volume)</a>
<a name="ln570">		result = B_BAD_VALUE;</a>
<a name="ln571"> </a>
<a name="ln572">	if (result == B_OK) {</a>
<a name="ln573">		RequestThreadContext context(volume, request);</a>
<a name="ln574">		IORequestInfo requestInfo(request-&gt;request, request-&gt;isWrite,</a>
<a name="ln575">			request-&gt;offset, request-&gt;length, request-&gt;isVIP);</a>
<a name="ln576">		result = volume-&gt;DoIO(request-&gt;node, request-&gt;fileCookie, requestInfo);</a>
<a name="ln577">	}</a>
<a name="ln578"> </a>
<a name="ln579">	// prepare the reply</a>
<a name="ln580">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln581">	DoIOReply* reply;</a>
<a name="ln582">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln583">	if (error != B_OK)</a>
<a name="ln584">		RETURN_ERROR(error);</a>
<a name="ln585"> </a>
<a name="ln586">	reply-&gt;error = result;</a>
<a name="ln587"> </a>
<a name="ln588">	// send the reply</a>
<a name="ln589">	return _SendReply(allocator, false);</a>
<a name="ln590">}</a>
<a name="ln591"> </a>
<a name="ln592"> </a>
<a name="ln593">status_t</a>
<a name="ln594">UserlandRequestHandler::_HandleRequest(CancelIORequest* request)</a>
<a name="ln595">{</a>
<a name="ln596">	// check and execute the request</a>
<a name="ln597">	status_t result = B_OK;</a>
<a name="ln598">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln599">	if (!volume)</a>
<a name="ln600">		result = B_BAD_VALUE;</a>
<a name="ln601"> </a>
<a name="ln602">	if (result == B_OK) {</a>
<a name="ln603">		RequestThreadContext context(volume, request);</a>
<a name="ln604">		result = volume-&gt;CancelIO(request-&gt;node, request-&gt;fileCookie,</a>
<a name="ln605">			request-&gt;request);</a>
<a name="ln606">	}</a>
<a name="ln607"> </a>
<a name="ln608">	// prepare the reply</a>
<a name="ln609">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln610">	CancelIOReply* reply;</a>
<a name="ln611">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln612">	if (error != B_OK)</a>
<a name="ln613">		RETURN_ERROR(error);</a>
<a name="ln614"> </a>
<a name="ln615">	reply-&gt;error = result;</a>
<a name="ln616"> </a>
<a name="ln617">	// send the reply</a>
<a name="ln618">	return _SendReply(allocator, false);</a>
<a name="ln619">}</a>
<a name="ln620"> </a>
<a name="ln621"> </a>
<a name="ln622">// _HandleRequest</a>
<a name="ln623">status_t</a>
<a name="ln624">UserlandRequestHandler::_HandleRequest(IterativeIOGetVecsRequest* request)</a>
<a name="ln625">{</a>
<a name="ln626">	// check and execute the request</a>
<a name="ln627">	status_t result = B_OK;</a>
<a name="ln628">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln629">	if (!volume)</a>
<a name="ln630">		result = B_BAD_VALUE;</a>
<a name="ln631"> </a>
<a name="ln632">	file_io_vec vecs[IterativeIOGetVecsReply::MAX_VECS];</a>
<a name="ln633">	size_t vecCount = IterativeIOGetVecsReply::MAX_VECS;</a>
<a name="ln634">	if (result == B_OK) {</a>
<a name="ln635">		RequestThreadContext context(volume, request);</a>
<a name="ln636">		result = volume-&gt;IterativeIOGetVecs(request-&gt;cookie, request-&gt;request,</a>
<a name="ln637">			request-&gt;offset, request-&gt;size, vecs, &amp;vecCount);</a>
<a name="ln638">		if (result == B_OK) {</a>
<a name="ln639">			vecCount = std::min(vecCount,</a>
<a name="ln640">				(size_t)IterativeIOGetVecsReply::MAX_VECS);</a>
<a name="ln641">		}</a>
<a name="ln642">	}</a>
<a name="ln643"> </a>
<a name="ln644">	// prepare the reply</a>
<a name="ln645">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln646">	IterativeIOGetVecsReply* reply;</a>
<a name="ln647">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln648">	if (error != B_OK)</a>
<a name="ln649">		RETURN_ERROR(error);</a>
<a name="ln650"> </a>
<a name="ln651">	reply-&gt;error = result;</a>
<a name="ln652">	if (result == B_OK) {</a>
<a name="ln653">		memcpy(reply-&gt;vecs, vecs, vecCount * sizeof(file_io_vec));</a>
<a name="ln654">		reply-&gt;vecCount = vecCount;</a>
<a name="ln655">	} else</a>
<a name="ln656">		reply-&gt;vecCount = 0;</a>
<a name="ln657"> </a>
<a name="ln658">	// send the reply</a>
<a name="ln659">	return _SendReply(allocator, false);</a>
<a name="ln660">}</a>
<a name="ln661"> </a>
<a name="ln662"> </a>
<a name="ln663">// _HandleRequest</a>
<a name="ln664">status_t</a>
<a name="ln665">UserlandRequestHandler::_HandleRequest(IterativeIOFinishedRequest* request)</a>
<a name="ln666">{</a>
<a name="ln667">	// check and execute the request</a>
<a name="ln668">	status_t result = B_OK;</a>
<a name="ln669">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln670">	if (!volume)</a>
<a name="ln671">		result = B_BAD_VALUE;</a>
<a name="ln672"> </a>
<a name="ln673">	if (result == B_OK) {</a>
<a name="ln674">		RequestThreadContext context(volume, request);</a>
<a name="ln675">		result = volume-&gt;IterativeIOFinished(request-&gt;cookie, request-&gt;request,</a>
<a name="ln676">			request-&gt;status, request-&gt;partialTransfer,</a>
<a name="ln677">			request-&gt;bytesTransferred);</a>
<a name="ln678">	}</a>
<a name="ln679"> </a>
<a name="ln680">	// prepare the reply</a>
<a name="ln681">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln682">	IterativeIOFinishedReply* reply;</a>
<a name="ln683">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln684">	if (error != B_OK)</a>
<a name="ln685">		RETURN_ERROR(error);</a>
<a name="ln686"> </a>
<a name="ln687">	reply-&gt;error = result;</a>
<a name="ln688"> </a>
<a name="ln689">	// send the reply</a>
<a name="ln690">	return _SendReply(allocator, false);</a>
<a name="ln691">}</a>
<a name="ln692"> </a>
<a name="ln693"> </a>
<a name="ln694">// #pragma mark - nodes</a>
<a name="ln695"> </a>
<a name="ln696"> </a>
<a name="ln697">// _HandleRequest</a>
<a name="ln698">status_t</a>
<a name="ln699">UserlandRequestHandler::_HandleRequest(IOCtlRequest* request)</a>
<a name="ln700">{</a>
<a name="ln701">	// get the request parameters</a>
<a name="ln702">	status_t result = B_OK;</a>
<a name="ln703">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln704">	if (!volume)</a>
<a name="ln705">		result = B_BAD_VALUE;</a>
<a name="ln706"> </a>
<a name="ln707">	void* buffer = request-&gt;bufferParameter;</a>
<a name="ln708">	size_t len = request-&gt;lenParameter;</a>
<a name="ln709">	bool isBuffer = request-&gt;isBuffer;</a>
<a name="ln710">	int32 bufferSize = 0;</a>
<a name="ln711">	int32 writeSize = request-&gt;writeSize;</a>
<a name="ln712">	if (isBuffer) {</a>
<a name="ln713">		buffer = request-&gt;buffer.GetData();</a>
<a name="ln714">		bufferSize = request-&gt;buffer.GetSize();</a>
<a name="ln715">	}</a>
<a name="ln716"> </a>
<a name="ln717">	// allocate the reply</a>
<a name="ln718">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln719">	IOCtlReply* reply;</a>
<a name="ln720">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln721">	if (error != B_OK)</a>
<a name="ln722">		RETURN_ERROR(error);</a>
<a name="ln723"> </a>
<a name="ln724">	// allocate the writable buffer for the call</a>
<a name="ln725">	void* writeBuffer = NULL;</a>
<a name="ln726">	if (result == B_OK &amp;&amp; isBuffer &amp;&amp; writeSize &gt; 0) {</a>
<a name="ln727">		if (writeSize &lt; bufferSize)</a>
<a name="ln728">			writeSize = bufferSize;</a>
<a name="ln729">		result = allocator.AllocateAddress(reply-&gt;buffer, writeSize, 8,</a>
<a name="ln730">			(void**)&amp;writeBuffer, true);</a>
<a name="ln731">		if (result == B_OK &amp;&amp; bufferSize &gt; 0)</a>
<a name="ln732">			memcpy(writeBuffer, buffer, bufferSize);</a>
<a name="ln733">		buffer = writeBuffer;</a>
<a name="ln734">	}</a>
<a name="ln735"> </a>
<a name="ln736">	// execute the request</a>
<a name="ln737">	status_t ioctlError = B_OK;</a>
<a name="ln738">	if (result == B_OK) {</a>
<a name="ln739">		RequestThreadContext context(volume, request);</a>
<a name="ln740">		ioctlError = volume-&gt;IOCtl(request-&gt;node, request-&gt;fileCookie,</a>
<a name="ln741">			request-&gt;command, buffer, len);</a>
<a name="ln742">	}</a>
<a name="ln743"> </a>
<a name="ln744">	// reconstruct the reply, in case it has been overwritten</a>
<a name="ln745">	reply = new(reply) IOCtlReply;</a>
<a name="ln746"> </a>
<a name="ln747">	// send the reply</a>
<a name="ln748">	reply-&gt;error = result;</a>
<a name="ln749">	reply-&gt;ioctlError = ioctlError;</a>
<a name="ln750">	return _SendReply(allocator, (result == B_OK &amp;&amp; writeBuffer));</a>
<a name="ln751">}</a>
<a name="ln752"> </a>
<a name="ln753">// _HandleRequest</a>
<a name="ln754">status_t</a>
<a name="ln755">UserlandRequestHandler::_HandleRequest(SetFlagsRequest* request)</a>
<a name="ln756">{</a>
<a name="ln757">	// check and execute the request</a>
<a name="ln758">	status_t result = B_OK;</a>
<a name="ln759">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln760">	if (!volume)</a>
<a name="ln761">		result = B_BAD_VALUE;</a>
<a name="ln762"> </a>
<a name="ln763">	if (result == B_OK) {</a>
<a name="ln764">		RequestThreadContext context(volume, request);</a>
<a name="ln765">		result = volume-&gt;SetFlags(request-&gt;node, request-&gt;fileCookie,</a>
<a name="ln766">			request-&gt;flags);</a>
<a name="ln767">	}</a>
<a name="ln768"> </a>
<a name="ln769">	// prepare the reply</a>
<a name="ln770">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln771">	SetFlagsReply* reply;</a>
<a name="ln772">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln773">	if (error != B_OK)</a>
<a name="ln774">		RETURN_ERROR(error);</a>
<a name="ln775"> </a>
<a name="ln776">	reply-&gt;error = result;</a>
<a name="ln777"> </a>
<a name="ln778">	// send the reply</a>
<a name="ln779">	return _SendReply(allocator, false);</a>
<a name="ln780">}</a>
<a name="ln781"> </a>
<a name="ln782">// _HandleRequest</a>
<a name="ln783">status_t</a>
<a name="ln784">UserlandRequestHandler::_HandleRequest(SelectRequest* request)</a>
<a name="ln785">{</a>
<a name="ln786">	// check and execute the request</a>
<a name="ln787">	status_t result = B_OK;</a>
<a name="ln788">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln789">	if (!volume)</a>
<a name="ln790">		result = B_BAD_VALUE;</a>
<a name="ln791"> </a>
<a name="ln792">	if (result == B_OK) {</a>
<a name="ln793">		RequestThreadContext context(volume, request);</a>
<a name="ln794">		result = volume-&gt;Select(request-&gt;node, request-&gt;fileCookie,</a>
<a name="ln795">			request-&gt;event, request-&gt;sync);</a>
<a name="ln796">	}</a>
<a name="ln797"> </a>
<a name="ln798">	// prepare the reply</a>
<a name="ln799">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln800">	SelectReply* reply;</a>
<a name="ln801">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln802">	if (error != B_OK)</a>
<a name="ln803">		RETURN_ERROR(error);</a>
<a name="ln804"> </a>
<a name="ln805">	reply-&gt;error = result;</a>
<a name="ln806"> </a>
<a name="ln807">	// send the reply</a>
<a name="ln808">	return _SendReply(allocator, false);</a>
<a name="ln809">}</a>
<a name="ln810"> </a>
<a name="ln811">// _HandleRequest</a>
<a name="ln812">status_t</a>
<a name="ln813">UserlandRequestHandler::_HandleRequest(DeselectRequest* request)</a>
<a name="ln814">{</a>
<a name="ln815">	// check and execute the request</a>
<a name="ln816">	status_t result = B_OK;</a>
<a name="ln817">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln818">	if (!volume)</a>
<a name="ln819">		result = B_BAD_VALUE;</a>
<a name="ln820"> </a>
<a name="ln821">	if (result == B_OK) {</a>
<a name="ln822">		RequestThreadContext context(volume, request);</a>
<a name="ln823">		result = volume-&gt;Deselect(request-&gt;node, request-&gt;fileCookie,</a>
<a name="ln824">			request-&gt;event, request-&gt;sync);</a>
<a name="ln825">	}</a>
<a name="ln826"> </a>
<a name="ln827">	// prepare the reply</a>
<a name="ln828">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln829">	DeselectReply* reply;</a>
<a name="ln830">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln831">	if (error != B_OK)</a>
<a name="ln832">		RETURN_ERROR(error);</a>
<a name="ln833"> </a>
<a name="ln834">	reply-&gt;error = result;</a>
<a name="ln835"> </a>
<a name="ln836">	// send the reply</a>
<a name="ln837">	return _SendReply(allocator, false);</a>
<a name="ln838">}</a>
<a name="ln839"> </a>
<a name="ln840">// _HandleRequest</a>
<a name="ln841">status_t</a>
<a name="ln842">UserlandRequestHandler::_HandleRequest(FSyncRequest* request)</a>
<a name="ln843">{</a>
<a name="ln844">	// check and execute the request</a>
<a name="ln845">	status_t result = B_OK;</a>
<a name="ln846">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln847">	if (!volume)</a>
<a name="ln848">		result = B_BAD_VALUE;</a>
<a name="ln849"> </a>
<a name="ln850">	if (result == B_OK) {</a>
<a name="ln851">		RequestThreadContext context(volume, request);</a>
<a name="ln852">		result = volume-&gt;FSync(request-&gt;node);</a>
<a name="ln853">	}</a>
<a name="ln854"> </a>
<a name="ln855">	// prepare the reply</a>
<a name="ln856">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln857">	FSyncReply* reply;</a>
<a name="ln858">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln859">	if (error != B_OK)</a>
<a name="ln860">		RETURN_ERROR(error);</a>
<a name="ln861"> </a>
<a name="ln862">	reply-&gt;error = result;</a>
<a name="ln863"> </a>
<a name="ln864">	// send the reply</a>
<a name="ln865">	return _SendReply(allocator, false);</a>
<a name="ln866">}</a>
<a name="ln867"> </a>
<a name="ln868">// _HandleRequest</a>
<a name="ln869">status_t</a>
<a name="ln870">UserlandRequestHandler::_HandleRequest(ReadSymlinkRequest* request)</a>
<a name="ln871">{</a>
<a name="ln872">	// check and execute the request</a>
<a name="ln873">	status_t result = B_OK;</a>
<a name="ln874">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln875">	if (!volume)</a>
<a name="ln876">		result = B_BAD_VALUE;</a>
<a name="ln877"> </a>
<a name="ln878">	void* node = request-&gt;node;</a>
<a name="ln879">	size_t bufferSize = request-&gt;size;</a>
<a name="ln880"> </a>
<a name="ln881">	// allocate the reply</a>
<a name="ln882">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln883">	ReadSymlinkReply* reply;</a>
<a name="ln884">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln885">	if (error != B_OK)</a>
<a name="ln886">		RETURN_ERROR(error);</a>
<a name="ln887">	char* buffer;</a>
<a name="ln888">	if (result == B_OK) {</a>
<a name="ln889">		result = allocator.AllocateAddress(reply-&gt;buffer, bufferSize, 1,</a>
<a name="ln890">			(void**)&amp;buffer, true);</a>
<a name="ln891">	}</a>
<a name="ln892"> </a>
<a name="ln893">	// execute the request</a>
<a name="ln894">	size_t bytesRead;</a>
<a name="ln895">	if (result == B_OK) {</a>
<a name="ln896">		RequestThreadContext context(volume, request);</a>
<a name="ln897">		result = volume-&gt;ReadSymlink(node, buffer, bufferSize, &amp;bytesRead);</a>
<a name="ln898">	}</a>
<a name="ln899"> </a>
<a name="ln900">	// reconstruct the reply, in case it has been overwritten</a>
<a name="ln901">	reply = new(reply) ReadSymlinkReply;</a>
<a name="ln902"> </a>
<a name="ln903">	// send the reply</a>
<a name="ln904">	reply-&gt;error = result;</a>
<a name="ln905">	reply-&gt;bytesRead = bytesRead;</a>
<a name="ln906">	return _SendReply(allocator, (result == B_OK));</a>
<a name="ln907">}</a>
<a name="ln908"> </a>
<a name="ln909">// _HandleRequest</a>
<a name="ln910">status_t</a>
<a name="ln911">UserlandRequestHandler::_HandleRequest(CreateSymlinkRequest* request)</a>
<a name="ln912">{</a>
<a name="ln913">	// check and execute the request</a>
<a name="ln914">	status_t result = B_OK;</a>
<a name="ln915">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln916">	if (!volume)</a>
<a name="ln917">		result = B_BAD_VALUE;</a>
<a name="ln918"> </a>
<a name="ln919">	if (result == B_OK) {</a>
<a name="ln920">		RequestThreadContext context(volume, request);</a>
<a name="ln921">		result = volume-&gt;CreateSymlink(request-&gt;node,</a>
<a name="ln922">			(const char*)request-&gt;name.GetData(),</a>
<a name="ln923">			(const char*)request-&gt;target.GetData(), request-&gt;mode);</a>
<a name="ln924">	}</a>
<a name="ln925"> </a>
<a name="ln926">	// prepare the reply</a>
<a name="ln927">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln928">	CreateSymlinkReply* reply;</a>
<a name="ln929">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln930">	if (error != B_OK)</a>
<a name="ln931">		RETURN_ERROR(error);</a>
<a name="ln932"> </a>
<a name="ln933">	reply-&gt;error = result;</a>
<a name="ln934"> </a>
<a name="ln935">	// send the reply</a>
<a name="ln936">	return _SendReply(allocator, false);</a>
<a name="ln937">}</a>
<a name="ln938"> </a>
<a name="ln939">// _HandleRequest</a>
<a name="ln940">status_t</a>
<a name="ln941">UserlandRequestHandler::_HandleRequest(LinkRequest* request)</a>
<a name="ln942">{</a>
<a name="ln943">	// check and execute the request</a>
<a name="ln944">	status_t result = B_OK;</a>
<a name="ln945">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln946">	if (!volume)</a>
<a name="ln947">		result = B_BAD_VALUE;</a>
<a name="ln948"> </a>
<a name="ln949">	if (result == B_OK) {</a>
<a name="ln950">		RequestThreadContext context(volume, request);</a>
<a name="ln951">		result = volume-&gt;Link(request-&gt;node,</a>
<a name="ln952">			(const char*)request-&gt;name.GetData(), request-&gt;target);</a>
<a name="ln953">	}</a>
<a name="ln954"> </a>
<a name="ln955">	// prepare the reply</a>
<a name="ln956">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln957">	LinkReply* reply;</a>
<a name="ln958">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln959">	if (error != B_OK)</a>
<a name="ln960">		RETURN_ERROR(error);</a>
<a name="ln961"> </a>
<a name="ln962">	reply-&gt;error = result;</a>
<a name="ln963"> </a>
<a name="ln964">	// send the reply</a>
<a name="ln965">	return _SendReply(allocator, false);</a>
<a name="ln966">}</a>
<a name="ln967"> </a>
<a name="ln968">// _HandleRequest</a>
<a name="ln969">status_t</a>
<a name="ln970">UserlandRequestHandler::_HandleRequest(UnlinkRequest* request)</a>
<a name="ln971">{</a>
<a name="ln972">	// check and execute the request</a>
<a name="ln973">	status_t result = B_OK;</a>
<a name="ln974">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln975">	if (!volume)</a>
<a name="ln976">		result = B_BAD_VALUE;</a>
<a name="ln977"> </a>
<a name="ln978">	if (result == B_OK) {</a>
<a name="ln979">		RequestThreadContext context(volume, request);</a>
<a name="ln980">		result = volume-&gt;Unlink(request-&gt;node,</a>
<a name="ln981">			(const char*)request-&gt;name.GetData());</a>
<a name="ln982">	}</a>
<a name="ln983"> </a>
<a name="ln984">	// prepare the reply</a>
<a name="ln985">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln986">	UnlinkReply* reply;</a>
<a name="ln987">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln988">	if (error != B_OK)</a>
<a name="ln989">		RETURN_ERROR(error);</a>
<a name="ln990"> </a>
<a name="ln991">	reply-&gt;error = result;</a>
<a name="ln992"> </a>
<a name="ln993">	// send the reply</a>
<a name="ln994">	return _SendReply(allocator, false);</a>
<a name="ln995">}</a>
<a name="ln996"> </a>
<a name="ln997">// _HandleRequest</a>
<a name="ln998">status_t</a>
<a name="ln999">UserlandRequestHandler::_HandleRequest(RenameRequest* request)</a>
<a name="ln1000">{</a>
<a name="ln1001">	// check and execute the request</a>
<a name="ln1002">	status_t result = B_OK;</a>
<a name="ln1003">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1004">	if (!volume)</a>
<a name="ln1005">		result = B_BAD_VALUE;</a>
<a name="ln1006"> </a>
<a name="ln1007">	if (result == B_OK) {</a>
<a name="ln1008">		RequestThreadContext context(volume, request);</a>
<a name="ln1009">		result = volume-&gt;Rename(request-&gt;oldDir,</a>
<a name="ln1010">			(const char*)request-&gt;oldName.GetData(), request-&gt;newDir,</a>
<a name="ln1011">			(const char*)request-&gt;newName.GetData());</a>
<a name="ln1012">	}</a>
<a name="ln1013"> </a>
<a name="ln1014">	// prepare the reply</a>
<a name="ln1015">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1016">	RenameReply* reply;</a>
<a name="ln1017">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1018">	if (error != B_OK)</a>
<a name="ln1019">		RETURN_ERROR(error);</a>
<a name="ln1020"> </a>
<a name="ln1021">	reply-&gt;error = result;</a>
<a name="ln1022"> </a>
<a name="ln1023">	// send the reply</a>
<a name="ln1024">	return _SendReply(allocator, false);</a>
<a name="ln1025">}</a>
<a name="ln1026"> </a>
<a name="ln1027">// _HandleRequest</a>
<a name="ln1028">status_t</a>
<a name="ln1029">UserlandRequestHandler::_HandleRequest(AccessRequest* request)</a>
<a name="ln1030">{</a>
<a name="ln1031">	// check and execute the request</a>
<a name="ln1032">	status_t result = B_OK;</a>
<a name="ln1033">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1034">	if (!volume)</a>
<a name="ln1035">		result = B_BAD_VALUE;</a>
<a name="ln1036"> </a>
<a name="ln1037">	if (result == B_OK) {</a>
<a name="ln1038">		RequestThreadContext context(volume, request);</a>
<a name="ln1039">		result = volume-&gt;Access(request-&gt;node, request-&gt;mode);</a>
<a name="ln1040">	}</a>
<a name="ln1041"> </a>
<a name="ln1042">	// prepare the reply</a>
<a name="ln1043">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1044">	AccessReply* reply;</a>
<a name="ln1045">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1046">	if (error != B_OK)</a>
<a name="ln1047">		RETURN_ERROR(error);</a>
<a name="ln1048"> </a>
<a name="ln1049">	reply-&gt;error = result;</a>
<a name="ln1050"> </a>
<a name="ln1051">	// send the reply</a>
<a name="ln1052">	return _SendReply(allocator, false);</a>
<a name="ln1053">}</a>
<a name="ln1054"> </a>
<a name="ln1055">// _HandleRequest</a>
<a name="ln1056">status_t</a>
<a name="ln1057">UserlandRequestHandler::_HandleRequest(ReadStatRequest* request)</a>
<a name="ln1058">{</a>
<a name="ln1059">	// check and execute the request</a>
<a name="ln1060">	status_t result = B_OK;</a>
<a name="ln1061">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1062">	if (!volume)</a>
<a name="ln1063">		result = B_BAD_VALUE;</a>
<a name="ln1064"> </a>
<a name="ln1065">	struct stat st;</a>
<a name="ln1066">	if (result == B_OK) {</a>
<a name="ln1067">		RequestThreadContext context(volume, request);</a>
<a name="ln1068">		result = volume-&gt;ReadStat(request-&gt;node, &amp;st);</a>
<a name="ln1069">	}</a>
<a name="ln1070"> </a>
<a name="ln1071">	// prepare the reply</a>
<a name="ln1072">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1073">	ReadStatReply* reply;</a>
<a name="ln1074">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1075">	if (error != B_OK)</a>
<a name="ln1076">		RETURN_ERROR(error);</a>
<a name="ln1077"> </a>
<a name="ln1078">	reply-&gt;error = result;</a>
<a name="ln1079">	reply-&gt;st = st;</a>
<a name="ln1080"> </a>
<a name="ln1081">	// send the reply</a>
<a name="ln1082">	return _SendReply(allocator, false);</a>
<a name="ln1083">}</a>
<a name="ln1084"> </a>
<a name="ln1085">// _HandleRequest</a>
<a name="ln1086">status_t</a>
<a name="ln1087">UserlandRequestHandler::_HandleRequest(WriteStatRequest* request)</a>
<a name="ln1088">{</a>
<a name="ln1089">	// check and execute the request</a>
<a name="ln1090">	status_t result = B_OK;</a>
<a name="ln1091">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1092">	if (!volume)</a>
<a name="ln1093">		result = B_BAD_VALUE;</a>
<a name="ln1094"> </a>
<a name="ln1095">	if (result == B_OK) {</a>
<a name="ln1096">		RequestThreadContext context(volume, request);</a>
<a name="ln1097">		result = volume-&gt;WriteStat(request-&gt;node, &amp;request-&gt;st, request-&gt;mask);</a>
<a name="ln1098">	}</a>
<a name="ln1099"> </a>
<a name="ln1100">	// prepare the reply</a>
<a name="ln1101">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1102">	WriteStatReply* reply;</a>
<a name="ln1103">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1104">	if (error != B_OK)</a>
<a name="ln1105">		RETURN_ERROR(error);</a>
<a name="ln1106"> </a>
<a name="ln1107">	reply-&gt;error = result;</a>
<a name="ln1108"> </a>
<a name="ln1109">	// send the reply</a>
<a name="ln1110">	return _SendReply(allocator, false);</a>
<a name="ln1111">}</a>
<a name="ln1112"> </a>
<a name="ln1113"> </a>
<a name="ln1114">// #pragma mark - files</a>
<a name="ln1115"> </a>
<a name="ln1116"> </a>
<a name="ln1117">// _HandleRequest</a>
<a name="ln1118">status_t</a>
<a name="ln1119">UserlandRequestHandler::_HandleRequest(CreateRequest* request)</a>
<a name="ln1120">{</a>
<a name="ln1121">	// check and execute the request</a>
<a name="ln1122">	status_t result = B_OK;</a>
<a name="ln1123">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1124">	if (!volume)</a>
<a name="ln1125">		result = B_BAD_VALUE;</a>
<a name="ln1126"> </a>
<a name="ln1127">	ino_t vnid;</a>
<a name="ln1128">	void* fileCookie;</a>
<a name="ln1129">	if (result == B_OK) {</a>
<a name="ln1130">		RequestThreadContext context(volume, request);</a>
<a name="ln1131">		result = volume-&gt;Create(request-&gt;node,</a>
<a name="ln1132">			(const char*)request-&gt;name.GetData(), request-&gt;openMode,</a>
<a name="ln1133">			request-&gt;mode, &amp;fileCookie, &amp;vnid);</a>
<a name="ln1134">	}</a>
<a name="ln1135"> </a>
<a name="ln1136">	// prepare the reply</a>
<a name="ln1137">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1138">	CreateReply* reply;</a>
<a name="ln1139">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1140">	if (error != B_OK)</a>
<a name="ln1141">		RETURN_ERROR(error);</a>
<a name="ln1142"> </a>
<a name="ln1143">	reply-&gt;error = result;</a>
<a name="ln1144">	reply-&gt;vnid = vnid;</a>
<a name="ln1145">	reply-&gt;fileCookie = fileCookie;</a>
<a name="ln1146"> </a>
<a name="ln1147">	// send the reply</a>
<a name="ln1148">	return _SendReply(allocator, false);</a>
<a name="ln1149">}</a>
<a name="ln1150"> </a>
<a name="ln1151">// _HandleRequest</a>
<a name="ln1152">status_t</a>
<a name="ln1153">UserlandRequestHandler::_HandleRequest(OpenRequest* request)</a>
<a name="ln1154">{</a>
<a name="ln1155">	// check and execute the request</a>
<a name="ln1156">	status_t result = B_OK;</a>
<a name="ln1157">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1158">	if (!volume)</a>
<a name="ln1159">		result = B_BAD_VALUE;</a>
<a name="ln1160"> </a>
<a name="ln1161">	void* fileCookie;</a>
<a name="ln1162">	if (result == B_OK) {</a>
<a name="ln1163">		RequestThreadContext context(volume, request);</a>
<a name="ln1164">		result = volume-&gt;Open(request-&gt;node, request-&gt;openMode, &amp;fileCookie);</a>
<a name="ln1165">	}</a>
<a name="ln1166"> </a>
<a name="ln1167">	// prepare the reply</a>
<a name="ln1168">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1169">	OpenReply* reply;</a>
<a name="ln1170">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1171">	if (error != B_OK)</a>
<a name="ln1172">		RETURN_ERROR(error);</a>
<a name="ln1173"> </a>
<a name="ln1174">	reply-&gt;error = result;</a>
<a name="ln1175">	reply-&gt;fileCookie = fileCookie;</a>
<a name="ln1176"> </a>
<a name="ln1177">	// send the reply</a>
<a name="ln1178">	return _SendReply(allocator, false);</a>
<a name="ln1179">}</a>
<a name="ln1180"> </a>
<a name="ln1181">// _HandleRequest</a>
<a name="ln1182">status_t</a>
<a name="ln1183">UserlandRequestHandler::_HandleRequest(CloseRequest* request)</a>
<a name="ln1184">{</a>
<a name="ln1185">	// check and execute the request</a>
<a name="ln1186">	status_t result = B_OK;</a>
<a name="ln1187">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1188">	if (!volume)</a>
<a name="ln1189">		result = B_BAD_VALUE;</a>
<a name="ln1190"> </a>
<a name="ln1191">	if (result == B_OK) {</a>
<a name="ln1192">		RequestThreadContext context(volume, request);</a>
<a name="ln1193">		result = volume-&gt;Close(request-&gt;node, request-&gt;fileCookie);</a>
<a name="ln1194">	}</a>
<a name="ln1195"> </a>
<a name="ln1196">	// prepare the reply</a>
<a name="ln1197">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1198">	CloseReply* reply;</a>
<a name="ln1199">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1200">	if (error != B_OK)</a>
<a name="ln1201">		RETURN_ERROR(error);</a>
<a name="ln1202"> </a>
<a name="ln1203">	reply-&gt;error = result;</a>
<a name="ln1204"> </a>
<a name="ln1205">	// send the reply</a>
<a name="ln1206">	return _SendReply(allocator, false);</a>
<a name="ln1207">}</a>
<a name="ln1208"> </a>
<a name="ln1209">// _HandleRequest</a>
<a name="ln1210">status_t</a>
<a name="ln1211">UserlandRequestHandler::_HandleRequest(FreeCookieRequest* request)</a>
<a name="ln1212">{</a>
<a name="ln1213">	// check and execute the request</a>
<a name="ln1214">	status_t result = B_OK;</a>
<a name="ln1215">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1216">	if (!volume)</a>
<a name="ln1217">		result = B_BAD_VALUE;</a>
<a name="ln1218"> </a>
<a name="ln1219">	if (result == B_OK) {</a>
<a name="ln1220">		RequestThreadContext context(volume, request);</a>
<a name="ln1221">		result = volume-&gt;FreeCookie(request-&gt;node, request-&gt;fileCookie);</a>
<a name="ln1222">	}</a>
<a name="ln1223"> </a>
<a name="ln1224">	// prepare the reply</a>
<a name="ln1225">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1226">	FreeCookieReply* reply;</a>
<a name="ln1227">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1228">	if (error != B_OK)</a>
<a name="ln1229">		RETURN_ERROR(error);</a>
<a name="ln1230"> </a>
<a name="ln1231">	reply-&gt;error = result;</a>
<a name="ln1232"> </a>
<a name="ln1233">	// send the reply</a>
<a name="ln1234">	return _SendReply(allocator, false);</a>
<a name="ln1235">}</a>
<a name="ln1236"> </a>
<a name="ln1237">// _HandleRequest</a>
<a name="ln1238">status_t</a>
<a name="ln1239">UserlandRequestHandler::_HandleRequest(ReadRequest* request)</a>
<a name="ln1240">{</a>
<a name="ln1241">	// check and execute the request</a>
<a name="ln1242">	status_t result = B_OK;</a>
<a name="ln1243">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1244">	if (!volume)</a>
<a name="ln1245">		result = B_BAD_VALUE;</a>
<a name="ln1246"> </a>
<a name="ln1247">	void* node = request-&gt;node;</a>
<a name="ln1248">	void* fileCookie = request-&gt;fileCookie;</a>
<a name="ln1249">	off_t pos = request-&gt;pos;</a>
<a name="ln1250">	size_t size = request-&gt;size;</a>
<a name="ln1251"> </a>
<a name="ln1252">	// allocate the reply</a>
<a name="ln1253">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1254">	ReadReply* reply;</a>
<a name="ln1255">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1256">	if (error != B_OK)</a>
<a name="ln1257">		RETURN_ERROR(error);</a>
<a name="ln1258"> </a>
<a name="ln1259">	void* buffer;</a>
<a name="ln1260">	if (result == B_OK) {</a>
<a name="ln1261">		result = allocator.AllocateAddress(reply-&gt;buffer, size, 1, &amp;buffer,</a>
<a name="ln1262">			true);</a>
<a name="ln1263">	}</a>
<a name="ln1264"> </a>
<a name="ln1265">	// execute the request</a>
<a name="ln1266">	size_t bytesRead;</a>
<a name="ln1267">	if (result == B_OK) {</a>
<a name="ln1268">		RequestThreadContext context(volume, request);</a>
<a name="ln1269">		result = volume-&gt;Read(node, fileCookie, pos, buffer, size, &amp;bytesRead);</a>
<a name="ln1270">	}</a>
<a name="ln1271"> </a>
<a name="ln1272">	// reconstruct the reply, in case it has been overwritten</a>
<a name="ln1273">	reply = new(reply) ReadReply;</a>
<a name="ln1274"> </a>
<a name="ln1275">	// send the reply</a>
<a name="ln1276">	reply-&gt;error = result;</a>
<a name="ln1277">	reply-&gt;bytesRead = bytesRead;</a>
<a name="ln1278">	return _SendReply(allocator, (result == B_OK));</a>
<a name="ln1279">}</a>
<a name="ln1280"> </a>
<a name="ln1281">// _HandleRequest</a>
<a name="ln1282">status_t</a>
<a name="ln1283">UserlandRequestHandler::_HandleRequest(WriteRequest* request)</a>
<a name="ln1284">{</a>
<a name="ln1285">	// check and execute the request</a>
<a name="ln1286">	status_t result = B_OK;</a>
<a name="ln1287">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1288">	if (!volume)</a>
<a name="ln1289">		result = B_BAD_VALUE;</a>
<a name="ln1290"> </a>
<a name="ln1291">	size_t bytesWritten;</a>
<a name="ln1292">	if (result == B_OK) {</a>
<a name="ln1293">		RequestThreadContext context(volume, request);</a>
<a name="ln1294">		result = volume-&gt;Write(request-&gt;node, request-&gt;fileCookie,</a>
<a name="ln1295">			request-&gt;pos, request-&gt;buffer.GetData(), request-&gt;buffer.GetSize(),</a>
<a name="ln1296">			&amp;bytesWritten);</a>
<a name="ln1297">	}</a>
<a name="ln1298"> </a>
<a name="ln1299">	// prepare the reply</a>
<a name="ln1300">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1301">	WriteReply* reply;</a>
<a name="ln1302">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1303">	if (error != B_OK)</a>
<a name="ln1304">		RETURN_ERROR(error);</a>
<a name="ln1305"> </a>
<a name="ln1306">	reply-&gt;error = result;</a>
<a name="ln1307">	reply-&gt;bytesWritten = bytesWritten;</a>
<a name="ln1308"> </a>
<a name="ln1309">	// send the reply</a>
<a name="ln1310">	return _SendReply(allocator, false);</a>
<a name="ln1311">}</a>
<a name="ln1312"> </a>
<a name="ln1313"> </a>
<a name="ln1314">// #pragma mark - directories</a>
<a name="ln1315"> </a>
<a name="ln1316"> </a>
<a name="ln1317">// _HandleRequest</a>
<a name="ln1318">status_t</a>
<a name="ln1319">UserlandRequestHandler::_HandleRequest(CreateDirRequest* request)</a>
<a name="ln1320">{</a>
<a name="ln1321">	// check and execute the request</a>
<a name="ln1322">	status_t result = B_OK;</a>
<a name="ln1323">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1324">	if (!volume)</a>
<a name="ln1325">		result = B_BAD_VALUE;</a>
<a name="ln1326"> </a>
<a name="ln1327">	if (result == B_OK) {</a>
<a name="ln1328">		RequestThreadContext context(volume, request);</a>
<a name="ln1329">		result = volume-&gt;CreateDir(request-&gt;node,</a>
<a name="ln1330">			(const char*)request-&gt;name.GetData(), request-&gt;mode);</a>
<a name="ln1331">	}</a>
<a name="ln1332"> </a>
<a name="ln1333">	// prepare the reply</a>
<a name="ln1334">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1335">	CreateDirReply* reply;</a>
<a name="ln1336">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1337">	if (error != B_OK)</a>
<a name="ln1338">		RETURN_ERROR(error);</a>
<a name="ln1339"> </a>
<a name="ln1340">	reply-&gt;error = result;</a>
<a name="ln1341"> </a>
<a name="ln1342">	// send the reply</a>
<a name="ln1343">	return _SendReply(allocator, false);</a>
<a name="ln1344">}</a>
<a name="ln1345"> </a>
<a name="ln1346">// _HandleRequest</a>
<a name="ln1347">status_t</a>
<a name="ln1348">UserlandRequestHandler::_HandleRequest(RemoveDirRequest* request)</a>
<a name="ln1349">{</a>
<a name="ln1350">	// check and execute the request</a>
<a name="ln1351">	status_t result = B_OK;</a>
<a name="ln1352">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1353">	if (!volume)</a>
<a name="ln1354">		result = B_BAD_VALUE;</a>
<a name="ln1355"> </a>
<a name="ln1356">	if (result == B_OK) {</a>
<a name="ln1357">		RequestThreadContext context(volume, request);</a>
<a name="ln1358">		result = volume-&gt;RemoveDir(request-&gt;node,</a>
<a name="ln1359">			(const char*)request-&gt;name.GetData());</a>
<a name="ln1360">	}</a>
<a name="ln1361"> </a>
<a name="ln1362">	// prepare the reply</a>
<a name="ln1363">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1364">	RemoveDirReply* reply;</a>
<a name="ln1365">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1366">	if (error != B_OK)</a>
<a name="ln1367">		RETURN_ERROR(error);</a>
<a name="ln1368"> </a>
<a name="ln1369">	reply-&gt;error = result;</a>
<a name="ln1370"> </a>
<a name="ln1371">	// send the reply</a>
<a name="ln1372">	return _SendReply(allocator, false);</a>
<a name="ln1373">}</a>
<a name="ln1374"> </a>
<a name="ln1375">// _HandleRequest</a>
<a name="ln1376">status_t</a>
<a name="ln1377">UserlandRequestHandler::_HandleRequest(OpenDirRequest* request)</a>
<a name="ln1378">{</a>
<a name="ln1379">	// check and execute the request</a>
<a name="ln1380">	status_t result = B_OK;</a>
<a name="ln1381">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1382">	if (!volume)</a>
<a name="ln1383">		result = B_BAD_VALUE;</a>
<a name="ln1384"> </a>
<a name="ln1385">	void* dirCookie = NULL;</a>
<a name="ln1386">	if (result == B_OK) {</a>
<a name="ln1387">		RequestThreadContext context(volume, request);</a>
<a name="ln1388">		result = volume-&gt;OpenDir(request-&gt;node, &amp;dirCookie);</a>
<a name="ln1389">	}</a>
<a name="ln1390"> </a>
<a name="ln1391">	// prepare the reply</a>
<a name="ln1392">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1393">	OpenDirReply* reply;</a>
<a name="ln1394">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1395">	if (error != B_OK)</a>
<a name="ln1396">		RETURN_ERROR(error);</a>
<a name="ln1397"> </a>
<a name="ln1398">	reply-&gt;error = result;</a>
<a name="ln1399">	reply-&gt;dirCookie = dirCookie;</a>
<a name="ln1400"> </a>
<a name="ln1401">	// send the reply</a>
<a name="ln1402">	return _SendReply(allocator, false);</a>
<a name="ln1403">}</a>
<a name="ln1404"> </a>
<a name="ln1405">// _HandleRequest</a>
<a name="ln1406">status_t</a>
<a name="ln1407">UserlandRequestHandler::_HandleRequest(CloseDirRequest* request)</a>
<a name="ln1408">{</a>
<a name="ln1409">	// check and execute the request</a>
<a name="ln1410">	status_t result = B_OK;</a>
<a name="ln1411">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1412">	if (!volume)</a>
<a name="ln1413">		result = B_BAD_VALUE;</a>
<a name="ln1414"> </a>
<a name="ln1415">	if (result == B_OK) {</a>
<a name="ln1416">		RequestThreadContext context(volume, request);</a>
<a name="ln1417">		result = volume-&gt;CloseDir(request-&gt;node, request-&gt;dirCookie);</a>
<a name="ln1418">	}</a>
<a name="ln1419"> </a>
<a name="ln1420">	// prepare the reply</a>
<a name="ln1421">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1422">	CloseDirReply* reply;</a>
<a name="ln1423">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1424">	if (error != B_OK)</a>
<a name="ln1425">		RETURN_ERROR(error);</a>
<a name="ln1426"> </a>
<a name="ln1427">	reply-&gt;error = result;</a>
<a name="ln1428"> </a>
<a name="ln1429">	// send the reply</a>
<a name="ln1430">	return _SendReply(allocator, false);</a>
<a name="ln1431">}</a>
<a name="ln1432"> </a>
<a name="ln1433">// _HandleRequest</a>
<a name="ln1434">status_t</a>
<a name="ln1435">UserlandRequestHandler::_HandleRequest(FreeDirCookieRequest* request)</a>
<a name="ln1436">{</a>
<a name="ln1437">	// check and execute the request</a>
<a name="ln1438">	status_t result = B_OK;</a>
<a name="ln1439">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1440">	if (!volume)</a>
<a name="ln1441">		result = B_BAD_VALUE;</a>
<a name="ln1442"> </a>
<a name="ln1443">	if (result == B_OK) {</a>
<a name="ln1444">		RequestThreadContext context(volume, request);</a>
<a name="ln1445">		result = volume-&gt;FreeDirCookie(request-&gt;node, request-&gt;dirCookie);</a>
<a name="ln1446">	}</a>
<a name="ln1447"> </a>
<a name="ln1448">	// prepare the reply</a>
<a name="ln1449">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1450">	FreeDirCookieReply* reply;</a>
<a name="ln1451">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1452">	if (error != B_OK)</a>
<a name="ln1453">		RETURN_ERROR(error);</a>
<a name="ln1454"> </a>
<a name="ln1455">	reply-&gt;error = result;</a>
<a name="ln1456"> </a>
<a name="ln1457">	// send the reply</a>
<a name="ln1458">	return _SendReply(allocator, false);</a>
<a name="ln1459">}</a>
<a name="ln1460"> </a>
<a name="ln1461">// _HandleRequest</a>
<a name="ln1462">status_t</a>
<a name="ln1463">UserlandRequestHandler::_HandleRequest(ReadDirRequest* request)</a>
<a name="ln1464">{</a>
<a name="ln1465">	// check the request</a>
<a name="ln1466">	status_t result = B_OK;</a>
<a name="ln1467">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1468">	if (!volume)</a>
<a name="ln1469">		result = B_BAD_VALUE;</a>
<a name="ln1470"> </a>
<a name="ln1471">	void* node = request-&gt;node;</a>
<a name="ln1472">	void* dirCookie = request-&gt;dirCookie;</a>
<a name="ln1473">	size_t bufferSize = request-&gt;bufferSize;</a>
<a name="ln1474">	uint32 count = request-&gt;count;</a>
<a name="ln1475"> </a>
<a name="ln1476">	// allocate the reply</a>
<a name="ln1477">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1478">	ReadDirReply* reply;</a>
<a name="ln1479">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1480">	if (error != B_OK)</a>
<a name="ln1481">		RETURN_ERROR(error);</a>
<a name="ln1482"> </a>
<a name="ln1483">	void* buffer;</a>
<a name="ln1484">	if (result == B_OK) {</a>
<a name="ln1485">		result = allocator.AllocateAddress(reply-&gt;buffer, bufferSize, 1,</a>
<a name="ln1486">			&amp;buffer, true);</a>
<a name="ln1487">	}</a>
<a name="ln1488"> </a>
<a name="ln1489">	// execute the request</a>
<a name="ln1490">	uint32 countRead;</a>
<a name="ln1491">	if (result == B_OK) {</a>
<a name="ln1492">		RequestThreadContext context(volume, request);</a>
<a name="ln1493">		result = volume-&gt;ReadDir(node, dirCookie, buffer, bufferSize, count,</a>
<a name="ln1494">			&amp;countRead);</a>
<a name="ln1495">	}</a>
<a name="ln1496"> </a>
<a name="ln1497">D(</a>
<a name="ln1498">if (result == B_OK &amp;&amp; countRead &gt; 0) {</a>
<a name="ln1499">	dirent* entry = (dirent*)buffer;</a>
<a name="ln1500">	PRINT((&quot;  entry: d_dev: %ld, d_pdev: %ld, d_ino: %Ld, d_pino: %Ld, &quot;</a>
<a name="ln1501">		&quot;d_reclen: %hu, d_name: %.32s\n&quot;,</a>
<a name="ln1502">		entry-&gt;d_dev, entry-&gt;d_pdev, entry-&gt;d_ino, entry-&gt;d_pino,</a>
<a name="ln1503">		entry-&gt;d_reclen, entry-&gt;d_name));</a>
<a name="ln1504">}</a>
<a name="ln1505">)</a>
<a name="ln1506"> </a>
<a name="ln1507">	// reconstruct the reply, in case it has been overwritten</a>
<a name="ln1508">	reply = new(reply) ReadDirReply;</a>
<a name="ln1509"> </a>
<a name="ln1510">	// send the reply</a>
<a name="ln1511">	reply-&gt;error = result;</a>
<a name="ln1512">	reply-&gt;count = countRead;</a>
<a name="ln1513">	return _SendReply(allocator, (result == B_OK));</a>
<a name="ln1514">}</a>
<a name="ln1515"> </a>
<a name="ln1516">// _HandleRequest</a>
<a name="ln1517">status_t</a>
<a name="ln1518">UserlandRequestHandler::_HandleRequest(RewindDirRequest* request)</a>
<a name="ln1519">{</a>
<a name="ln1520">	// check and execute the request</a>
<a name="ln1521">	status_t result = B_OK;</a>
<a name="ln1522">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1523">	if (!volume)</a>
<a name="ln1524">		result = B_BAD_VALUE;</a>
<a name="ln1525"> </a>
<a name="ln1526">	if (result == B_OK) {</a>
<a name="ln1527">		RequestThreadContext context(volume, request);</a>
<a name="ln1528">		result = volume-&gt;RewindDir(request-&gt;node, request-&gt;dirCookie);</a>
<a name="ln1529">	}</a>
<a name="ln1530"> </a>
<a name="ln1531">	// prepare the reply</a>
<a name="ln1532">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1533">	RewindDirReply* reply;</a>
<a name="ln1534">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1535">	if (error != B_OK)</a>
<a name="ln1536">		RETURN_ERROR(error);</a>
<a name="ln1537"> </a>
<a name="ln1538">	reply-&gt;error = result;</a>
<a name="ln1539"> </a>
<a name="ln1540">	// send the reply</a>
<a name="ln1541">	return _SendReply(allocator, false);</a>
<a name="ln1542">}</a>
<a name="ln1543"> </a>
<a name="ln1544"> </a>
<a name="ln1545">// #pragma mark - attribute directories</a>
<a name="ln1546"> </a>
<a name="ln1547"> </a>
<a name="ln1548">// _HandleRequest</a>
<a name="ln1549">status_t</a>
<a name="ln1550">UserlandRequestHandler::_HandleRequest(OpenAttrDirRequest* request)</a>
<a name="ln1551">{</a>
<a name="ln1552">	// check and execute the request</a>
<a name="ln1553">	status_t result = B_OK;</a>
<a name="ln1554">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1555">	if (!volume)</a>
<a name="ln1556">		result = B_BAD_VALUE;</a>
<a name="ln1557"> </a>
<a name="ln1558">	void* attrDirCookie;</a>
<a name="ln1559">	if (result == B_OK) {</a>
<a name="ln1560">		RequestThreadContext context(volume, request);</a>
<a name="ln1561">		result = volume-&gt;OpenAttrDir(request-&gt;node, &amp;attrDirCookie);</a>
<a name="ln1562">	}</a>
<a name="ln1563"> </a>
<a name="ln1564">	// prepare the reply</a>
<a name="ln1565">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1566">	OpenAttrDirReply* reply;</a>
<a name="ln1567">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1568">	if (error != B_OK)</a>
<a name="ln1569">		RETURN_ERROR(error);</a>
<a name="ln1570"> </a>
<a name="ln1571">	reply-&gt;error = result;</a>
<a name="ln1572">	reply-&gt;attrDirCookie = attrDirCookie;</a>
<a name="ln1573"> </a>
<a name="ln1574">	// send the reply</a>
<a name="ln1575">	return _SendReply(allocator, false);</a>
<a name="ln1576">}</a>
<a name="ln1577"> </a>
<a name="ln1578">// _HandleRequest</a>
<a name="ln1579">status_t</a>
<a name="ln1580">UserlandRequestHandler::_HandleRequest(CloseAttrDirRequest* request)</a>
<a name="ln1581">{</a>
<a name="ln1582">	// check and execute the request</a>
<a name="ln1583">	status_t result = B_OK;</a>
<a name="ln1584">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1585">	if (!volume)</a>
<a name="ln1586">		result = B_BAD_VALUE;</a>
<a name="ln1587"> </a>
<a name="ln1588">	if (result == B_OK) {</a>
<a name="ln1589">		RequestThreadContext context(volume, request);</a>
<a name="ln1590">		result = volume-&gt;CloseAttrDir(request-&gt;node, request-&gt;attrDirCookie);</a>
<a name="ln1591">	}</a>
<a name="ln1592"> </a>
<a name="ln1593">	// prepare the reply</a>
<a name="ln1594">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1595">	CloseAttrDirReply* reply;</a>
<a name="ln1596">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1597">	if (error != B_OK)</a>
<a name="ln1598">		RETURN_ERROR(error);</a>
<a name="ln1599"> </a>
<a name="ln1600">	reply-&gt;error = result;</a>
<a name="ln1601"> </a>
<a name="ln1602">	// send the reply</a>
<a name="ln1603">	return _SendReply(allocator, false);</a>
<a name="ln1604">}</a>
<a name="ln1605"> </a>
<a name="ln1606">// _HandleRequest</a>
<a name="ln1607">status_t</a>
<a name="ln1608">UserlandRequestHandler::_HandleRequest(FreeAttrDirCookieRequest* request)</a>
<a name="ln1609">{</a>
<a name="ln1610">	// check and execute the request</a>
<a name="ln1611">	status_t result = B_OK;</a>
<a name="ln1612">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1613">	if (!volume)</a>
<a name="ln1614">		result = B_BAD_VALUE;</a>
<a name="ln1615"> </a>
<a name="ln1616">	if (result == B_OK) {</a>
<a name="ln1617">		RequestThreadContext context(volume, request);</a>
<a name="ln1618">		result = volume-&gt;FreeAttrDirCookie(request-&gt;node,</a>
<a name="ln1619">			request-&gt;attrDirCookie);</a>
<a name="ln1620">	}</a>
<a name="ln1621"> </a>
<a name="ln1622">	// prepare the reply</a>
<a name="ln1623">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1624">	FreeAttrDirCookieReply* reply;</a>
<a name="ln1625">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1626">	if (error != B_OK)</a>
<a name="ln1627">		RETURN_ERROR(error);</a>
<a name="ln1628"> </a>
<a name="ln1629">	reply-&gt;error = result;</a>
<a name="ln1630"> </a>
<a name="ln1631">	// send the reply</a>
<a name="ln1632">	return _SendReply(allocator, false);</a>
<a name="ln1633">}</a>
<a name="ln1634"> </a>
<a name="ln1635">// _HandleRequest</a>
<a name="ln1636">status_t</a>
<a name="ln1637">UserlandRequestHandler::_HandleRequest(ReadAttrDirRequest* request)</a>
<a name="ln1638">{</a>
<a name="ln1639">	// check and execute the request</a>
<a name="ln1640">	status_t result = B_OK;</a>
<a name="ln1641">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1642">	if (!volume)</a>
<a name="ln1643">		result = B_BAD_VALUE;</a>
<a name="ln1644"> </a>
<a name="ln1645">	void* node = request-&gt;node;</a>
<a name="ln1646">	void* attrDirCookie = request-&gt;attrDirCookie;</a>
<a name="ln1647">	size_t bufferSize = request-&gt;bufferSize;</a>
<a name="ln1648">	uint32 count = request-&gt;count;</a>
<a name="ln1649"> </a>
<a name="ln1650">	// allocate the reply</a>
<a name="ln1651">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1652">	ReadAttrDirReply* reply;</a>
<a name="ln1653">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1654">	if (error != B_OK)</a>
<a name="ln1655">		RETURN_ERROR(error);</a>
<a name="ln1656"> </a>
<a name="ln1657">	void* buffer;</a>
<a name="ln1658">	if (result == B_OK) {</a>
<a name="ln1659">		result = allocator.AllocateAddress(reply-&gt;buffer, bufferSize, 1,</a>
<a name="ln1660">			&amp;buffer, true);</a>
<a name="ln1661">	}</a>
<a name="ln1662"> </a>
<a name="ln1663">	// execute the request</a>
<a name="ln1664">	uint32 countRead;</a>
<a name="ln1665">	if (result == B_OK) {</a>
<a name="ln1666">		RequestThreadContext context(volume, request);</a>
<a name="ln1667">		result = volume-&gt;ReadAttrDir(node, attrDirCookie, buffer, bufferSize,</a>
<a name="ln1668">			count, &amp;countRead);</a>
<a name="ln1669">	}</a>
<a name="ln1670"> </a>
<a name="ln1671">	// reconstruct the reply, in case it has been overwritten</a>
<a name="ln1672">	reply = new(reply) ReadAttrDirReply;</a>
<a name="ln1673"> </a>
<a name="ln1674">	// send the reply</a>
<a name="ln1675">	reply-&gt;error = result;</a>
<a name="ln1676">	reply-&gt;count = countRead;</a>
<a name="ln1677">	return _SendReply(allocator, (result == B_OK));</a>
<a name="ln1678">}</a>
<a name="ln1679"> </a>
<a name="ln1680">// _HandleRequest</a>
<a name="ln1681">status_t</a>
<a name="ln1682">UserlandRequestHandler::_HandleRequest(RewindAttrDirRequest* request)</a>
<a name="ln1683">{</a>
<a name="ln1684">	// check and execute the request</a>
<a name="ln1685">	status_t result = B_OK;</a>
<a name="ln1686">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1687">	if (!volume)</a>
<a name="ln1688">		result = B_BAD_VALUE;</a>
<a name="ln1689"> </a>
<a name="ln1690">	if (result == B_OK) {</a>
<a name="ln1691">		RequestThreadContext context(volume, request);</a>
<a name="ln1692">		result = volume-&gt;RewindAttrDir(request-&gt;node, request-&gt;attrDirCookie);</a>
<a name="ln1693">	}</a>
<a name="ln1694"> </a>
<a name="ln1695">	// prepare the reply</a>
<a name="ln1696">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1697">	RewindAttrDirReply* reply;</a>
<a name="ln1698">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1699">	if (error != B_OK)</a>
<a name="ln1700">		RETURN_ERROR(error);</a>
<a name="ln1701"> </a>
<a name="ln1702">	reply-&gt;error = result;</a>
<a name="ln1703"> </a>
<a name="ln1704">	// send the reply</a>
<a name="ln1705">	return _SendReply(allocator, false);</a>
<a name="ln1706">}</a>
<a name="ln1707"> </a>
<a name="ln1708"> </a>
<a name="ln1709">// #pragma mark - attributes</a>
<a name="ln1710"> </a>
<a name="ln1711"> </a>
<a name="ln1712">// _HandleRequest</a>
<a name="ln1713">status_t</a>
<a name="ln1714">UserlandRequestHandler::_HandleRequest(CreateAttrRequest* request)</a>
<a name="ln1715">{</a>
<a name="ln1716">	// check and execute the request</a>
<a name="ln1717">	status_t result = B_OK;</a>
<a name="ln1718">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1719">	if (!volume)</a>
<a name="ln1720">		result = B_BAD_VALUE;</a>
<a name="ln1721"> </a>
<a name="ln1722">	void* attrCookie;</a>
<a name="ln1723">	if (result == B_OK) {</a>
<a name="ln1724">		RequestThreadContext context(volume, request);</a>
<a name="ln1725">		result = volume-&gt;CreateAttr(request-&gt;node,</a>
<a name="ln1726">			(const char*)request-&gt;name.GetData(), request-&gt;type,</a>
<a name="ln1727">			request-&gt;openMode, &amp;attrCookie);</a>
<a name="ln1728">	}</a>
<a name="ln1729"> </a>
<a name="ln1730">	// prepare the reply</a>
<a name="ln1731">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1732">	CreateAttrReply* reply;</a>
<a name="ln1733">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1734">	if (error != B_OK)</a>
<a name="ln1735">		RETURN_ERROR(error);</a>
<a name="ln1736"> </a>
<a name="ln1737">	reply-&gt;error = result;</a>
<a name="ln1738">	reply-&gt;attrCookie = attrCookie;</a>
<a name="ln1739"> </a>
<a name="ln1740">	// send the reply</a>
<a name="ln1741">	return _SendReply(allocator, false);</a>
<a name="ln1742">}</a>
<a name="ln1743"> </a>
<a name="ln1744">// _HandleRequest</a>
<a name="ln1745">status_t</a>
<a name="ln1746">UserlandRequestHandler::_HandleRequest(OpenAttrRequest* request)</a>
<a name="ln1747">{</a>
<a name="ln1748">	// check and execute the request</a>
<a name="ln1749">	status_t result = B_OK;</a>
<a name="ln1750">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1751">	if (!volume)</a>
<a name="ln1752">		result = B_BAD_VALUE;</a>
<a name="ln1753"> </a>
<a name="ln1754">	void* attrCookie;</a>
<a name="ln1755">	if (result == B_OK) {</a>
<a name="ln1756">		RequestThreadContext context(volume, request);</a>
<a name="ln1757">		result = volume-&gt;OpenAttr(request-&gt;node,</a>
<a name="ln1758">			(const char*)request-&gt;name.GetData(), request-&gt;openMode,</a>
<a name="ln1759">			&amp;attrCookie);</a>
<a name="ln1760">	}</a>
<a name="ln1761"> </a>
<a name="ln1762">	// prepare the reply</a>
<a name="ln1763">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1764">	OpenAttrReply* reply;</a>
<a name="ln1765">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1766">	if (error != B_OK)</a>
<a name="ln1767">		RETURN_ERROR(error);</a>
<a name="ln1768"> </a>
<a name="ln1769">	reply-&gt;error = result;</a>
<a name="ln1770">	reply-&gt;attrCookie = attrCookie;</a>
<a name="ln1771"> </a>
<a name="ln1772">	// send the reply</a>
<a name="ln1773">	return _SendReply(allocator, false);</a>
<a name="ln1774">}</a>
<a name="ln1775"> </a>
<a name="ln1776">// _HandleRequest</a>
<a name="ln1777">status_t</a>
<a name="ln1778">UserlandRequestHandler::_HandleRequest(CloseAttrRequest* request)</a>
<a name="ln1779">{</a>
<a name="ln1780">	// check and execute the request</a>
<a name="ln1781">	status_t result = B_OK;</a>
<a name="ln1782">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1783">	if (!volume)</a>
<a name="ln1784">		result = B_BAD_VALUE;</a>
<a name="ln1785"> </a>
<a name="ln1786">	if (result == B_OK) {</a>
<a name="ln1787">		RequestThreadContext context(volume, request);</a>
<a name="ln1788">		result = volume-&gt;CloseAttr(request-&gt;node, request-&gt;attrCookie);</a>
<a name="ln1789">	}</a>
<a name="ln1790"> </a>
<a name="ln1791">	// prepare the reply</a>
<a name="ln1792">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1793">	CloseAttrReply* reply;</a>
<a name="ln1794">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1795">	if (error != B_OK)</a>
<a name="ln1796">		RETURN_ERROR(error);</a>
<a name="ln1797"> </a>
<a name="ln1798">	reply-&gt;error = result;</a>
<a name="ln1799"> </a>
<a name="ln1800">	// send the reply</a>
<a name="ln1801">	return _SendReply(allocator, false);</a>
<a name="ln1802">}</a>
<a name="ln1803"> </a>
<a name="ln1804">// _HandleRequest</a>
<a name="ln1805">status_t</a>
<a name="ln1806">UserlandRequestHandler::_HandleRequest(FreeAttrCookieRequest* request)</a>
<a name="ln1807">{</a>
<a name="ln1808">	// check and execute the request</a>
<a name="ln1809">	status_t result = B_OK;</a>
<a name="ln1810">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1811">	if (!volume)</a>
<a name="ln1812">		result = B_BAD_VALUE;</a>
<a name="ln1813"> </a>
<a name="ln1814">	if (result == B_OK) {</a>
<a name="ln1815">		RequestThreadContext context(volume, request);</a>
<a name="ln1816">		result = volume-&gt;FreeAttrCookie(request-&gt;node, request-&gt;attrCookie);</a>
<a name="ln1817">	}</a>
<a name="ln1818"> </a>
<a name="ln1819">	// prepare the reply</a>
<a name="ln1820">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1821">	FreeAttrCookieReply* reply;</a>
<a name="ln1822">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1823">	if (error != B_OK)</a>
<a name="ln1824">		RETURN_ERROR(error);</a>
<a name="ln1825"> </a>
<a name="ln1826">	reply-&gt;error = result;</a>
<a name="ln1827"> </a>
<a name="ln1828">	// send the reply</a>
<a name="ln1829">	return _SendReply(allocator, false);</a>
<a name="ln1830">}</a>
<a name="ln1831"> </a>
<a name="ln1832">// _HandleRequest</a>
<a name="ln1833">status_t</a>
<a name="ln1834">UserlandRequestHandler::_HandleRequest(ReadAttrRequest* request)</a>
<a name="ln1835">{</a>
<a name="ln1836">	// check and execute the request</a>
<a name="ln1837">	status_t result = B_OK;</a>
<a name="ln1838">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1839">	if (!volume)</a>
<a name="ln1840">		result = B_BAD_VALUE;</a>
<a name="ln1841"> </a>
<a name="ln1842">	void* node = request-&gt;node;</a>
<a name="ln1843">	void* attrCookie = request-&gt;attrCookie;</a>
<a name="ln1844">	off_t pos = request-&gt;pos;</a>
<a name="ln1845">	size_t size = request-&gt;size;</a>
<a name="ln1846"> </a>
<a name="ln1847">	// allocate the reply</a>
<a name="ln1848">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1849">	ReadAttrReply* reply;</a>
<a name="ln1850">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1851">	if (error != B_OK)</a>
<a name="ln1852">		RETURN_ERROR(error);</a>
<a name="ln1853"> </a>
<a name="ln1854">	void* buffer;</a>
<a name="ln1855">	if (result == B_OK) {</a>
<a name="ln1856">		result = allocator.AllocateAddress(reply-&gt;buffer, size, 1, &amp;buffer,</a>
<a name="ln1857">			true);</a>
<a name="ln1858">	}</a>
<a name="ln1859"> </a>
<a name="ln1860">	// execute the request</a>
<a name="ln1861">	size_t bytesRead;</a>
<a name="ln1862">	if (result == B_OK) {</a>
<a name="ln1863">		RequestThreadContext context(volume, request);</a>
<a name="ln1864">		result = volume-&gt;ReadAttr(node, attrCookie, pos, buffer, size,</a>
<a name="ln1865">			&amp;bytesRead);</a>
<a name="ln1866">	}</a>
<a name="ln1867"> </a>
<a name="ln1868">	// reconstruct the reply, in case it has been overwritten</a>
<a name="ln1869">	reply = new(reply) ReadAttrReply;</a>
<a name="ln1870"> </a>
<a name="ln1871">	// send the reply</a>
<a name="ln1872">	reply-&gt;error = result;</a>
<a name="ln1873">	reply-&gt;bytesRead = bytesRead;</a>
<a name="ln1874">	return _SendReply(allocator, (result == B_OK));</a>
<a name="ln1875">}</a>
<a name="ln1876"> </a>
<a name="ln1877">// _HandleRequest</a>
<a name="ln1878">status_t</a>
<a name="ln1879">UserlandRequestHandler::_HandleRequest(WriteAttrRequest* request)</a>
<a name="ln1880">{</a>
<a name="ln1881">	// check and execute the request</a>
<a name="ln1882">	status_t result = B_OK;</a>
<a name="ln1883">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1884">	if (!volume)</a>
<a name="ln1885">		result = B_BAD_VALUE;</a>
<a name="ln1886"> </a>
<a name="ln1887">	size_t bytesWritten;</a>
<a name="ln1888">	if (result == B_OK) {</a>
<a name="ln1889">		RequestThreadContext context(volume, request);</a>
<a name="ln1890">		result = volume-&gt;WriteAttr(request-&gt;node, request-&gt;attrCookie,</a>
<a name="ln1891">			request-&gt;pos, request-&gt;buffer.GetData(), request-&gt;buffer.GetSize(),</a>
<a name="ln1892">			&amp;bytesWritten);</a>
<a name="ln1893">	}</a>
<a name="ln1894"> </a>
<a name="ln1895">	// prepare the reply</a>
<a name="ln1896">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1897">	WriteAttrReply* reply;</a>
<a name="ln1898">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1899">	if (error != B_OK)</a>
<a name="ln1900">		RETURN_ERROR(error);</a>
<a name="ln1901"> </a>
<a name="ln1902">	reply-&gt;error = result;</a>
<a name="ln1903">	reply-&gt;bytesWritten = bytesWritten;</a>
<a name="ln1904"> </a>
<a name="ln1905">	// send the reply</a>
<a name="ln1906">	return _SendReply(allocator, false);</a>
<a name="ln1907">}</a>
<a name="ln1908"> </a>
<a name="ln1909">// _HandleRequest</a>
<a name="ln1910">status_t</a>
<a name="ln1911">UserlandRequestHandler::_HandleRequest(ReadAttrStatRequest* request)</a>
<a name="ln1912">{</a>
<a name="ln1913">	// check and execute the request</a>
<a name="ln1914">	status_t result = B_OK;</a>
<a name="ln1915">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1916">	if (!volume)</a>
<a name="ln1917">		result = B_BAD_VALUE;</a>
<a name="ln1918"> </a>
<a name="ln1919">	struct stat st;</a>
<a name="ln1920">	if (result == B_OK) {</a>
<a name="ln1921">		RequestThreadContext context(volume, request);</a>
<a name="ln1922">		result = volume-&gt;ReadAttrStat(request-&gt;node, request-&gt;attrCookie,</a>
<a name="ln1923">			&amp;st);</a>
<a name="ln1924">	}</a>
<a name="ln1925"> </a>
<a name="ln1926">	// prepare the reply</a>
<a name="ln1927">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1928">	ReadAttrStatReply* reply;</a>
<a name="ln1929">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1930">	if (error != B_OK)</a>
<a name="ln1931">		RETURN_ERROR(error);</a>
<a name="ln1932"> </a>
<a name="ln1933">	reply-&gt;error = result;</a>
<a name="ln1934">	reply-&gt;st = st;</a>
<a name="ln1935"> </a>
<a name="ln1936">	// send the reply</a>
<a name="ln1937">	return _SendReply(allocator, false);</a>
<a name="ln1938">}</a>
<a name="ln1939"> </a>
<a name="ln1940">// _HandleRequest</a>
<a name="ln1941">status_t</a>
<a name="ln1942">UserlandRequestHandler::_HandleRequest(WriteAttrStatRequest* request)</a>
<a name="ln1943">{</a>
<a name="ln1944">	// check and execute the request</a>
<a name="ln1945">	status_t result = B_OK;</a>
<a name="ln1946">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1947">	if (!volume)</a>
<a name="ln1948">		result = B_BAD_VALUE;</a>
<a name="ln1949"> </a>
<a name="ln1950">	if (result == B_OK) {</a>
<a name="ln1951">		RequestThreadContext context(volume, request);</a>
<a name="ln1952">		result = volume-&gt;WriteAttrStat(request-&gt;node, request-&gt;attrCookie,</a>
<a name="ln1953">			&amp;request-&gt;st, request-&gt;mask);</a>
<a name="ln1954">	}</a>
<a name="ln1955"> </a>
<a name="ln1956">	// prepare the reply</a>
<a name="ln1957">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1958">	WriteAttrStatReply* reply;</a>
<a name="ln1959">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1960">	if (error != B_OK)</a>
<a name="ln1961">		RETURN_ERROR(error);</a>
<a name="ln1962"> </a>
<a name="ln1963">	reply-&gt;error = result;</a>
<a name="ln1964"> </a>
<a name="ln1965">	// send the reply</a>
<a name="ln1966">	return _SendReply(allocator, false);</a>
<a name="ln1967">}</a>
<a name="ln1968"> </a>
<a name="ln1969">// _HandleRequest</a>
<a name="ln1970">status_t</a>
<a name="ln1971">UserlandRequestHandler::_HandleRequest(RenameAttrRequest* request)</a>
<a name="ln1972">{</a>
<a name="ln1973">	// check and execute the request</a>
<a name="ln1974">	status_t result = B_OK;</a>
<a name="ln1975">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln1976">	if (!volume)</a>
<a name="ln1977">		result = B_BAD_VALUE;</a>
<a name="ln1978"> </a>
<a name="ln1979">	if (result == B_OK) {</a>
<a name="ln1980">		RequestThreadContext context(volume, request);</a>
<a name="ln1981">		result = volume-&gt;RenameAttr(</a>
<a name="ln1982">			request-&gt;oldNode, (const char*)request-&gt;oldName.GetData(),</a>
<a name="ln1983">			request-&gt;newNode, (const char*)request-&gt;newName.GetData());</a>
<a name="ln1984">	}</a>
<a name="ln1985"> </a>
<a name="ln1986">	// prepare the reply</a>
<a name="ln1987">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln1988">	RenameAttrReply* reply;</a>
<a name="ln1989">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln1990">	if (error != B_OK)</a>
<a name="ln1991">		RETURN_ERROR(error);</a>
<a name="ln1992"> </a>
<a name="ln1993">	reply-&gt;error = result;</a>
<a name="ln1994"> </a>
<a name="ln1995">	// send the reply</a>
<a name="ln1996">	return _SendReply(allocator, false);</a>
<a name="ln1997">}</a>
<a name="ln1998"> </a>
<a name="ln1999">// _HandleRequest</a>
<a name="ln2000">status_t</a>
<a name="ln2001">UserlandRequestHandler::_HandleRequest(RemoveAttrRequest* request)</a>
<a name="ln2002">{</a>
<a name="ln2003">	// check and execute the request</a>
<a name="ln2004">	status_t result = B_OK;</a>
<a name="ln2005">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2006">	if (!volume)</a>
<a name="ln2007">		result = B_BAD_VALUE;</a>
<a name="ln2008"> </a>
<a name="ln2009">	if (result == B_OK) {</a>
<a name="ln2010">		RequestThreadContext context(volume, request);</a>
<a name="ln2011">		result = volume-&gt;RemoveAttr(request-&gt;node,</a>
<a name="ln2012">			(const char*)request-&gt;name.GetData());</a>
<a name="ln2013">	}</a>
<a name="ln2014"> </a>
<a name="ln2015">	// prepare the reply</a>
<a name="ln2016">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2017">	RemoveAttrReply* reply;</a>
<a name="ln2018">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2019">	if (error != B_OK)</a>
<a name="ln2020">		RETURN_ERROR(error);</a>
<a name="ln2021"> </a>
<a name="ln2022">	reply-&gt;error = result;</a>
<a name="ln2023"> </a>
<a name="ln2024">	// send the reply</a>
<a name="ln2025">	return _SendReply(allocator, false);</a>
<a name="ln2026">}</a>
<a name="ln2027"> </a>
<a name="ln2028"> </a>
<a name="ln2029">// #pragma mark - indices</a>
<a name="ln2030"> </a>
<a name="ln2031"> </a>
<a name="ln2032">// _HandleRequest</a>
<a name="ln2033">status_t</a>
<a name="ln2034">UserlandRequestHandler::_HandleRequest(OpenIndexDirRequest* request)</a>
<a name="ln2035">{</a>
<a name="ln2036">	// check and execute the request</a>
<a name="ln2037">	status_t result = B_OK;</a>
<a name="ln2038">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2039">	if (!volume)</a>
<a name="ln2040">		result = B_BAD_VALUE;</a>
<a name="ln2041"> </a>
<a name="ln2042">	void* indexDirCookie;</a>
<a name="ln2043">	if (result == B_OK) {</a>
<a name="ln2044">		RequestThreadContext context(volume, request);</a>
<a name="ln2045">		result = volume-&gt;OpenIndexDir(&amp;indexDirCookie);</a>
<a name="ln2046">	}</a>
<a name="ln2047"> </a>
<a name="ln2048">	// prepare the reply</a>
<a name="ln2049">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2050">	OpenIndexDirReply* reply;</a>
<a name="ln2051">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2052">	if (error != B_OK)</a>
<a name="ln2053">		RETURN_ERROR(error);</a>
<a name="ln2054"> </a>
<a name="ln2055">	reply-&gt;error = result;</a>
<a name="ln2056">	reply-&gt;indexDirCookie = indexDirCookie;</a>
<a name="ln2057"> </a>
<a name="ln2058">	// send the reply</a>
<a name="ln2059">	return _SendReply(allocator, false);</a>
<a name="ln2060">}</a>
<a name="ln2061"> </a>
<a name="ln2062">// _HandleRequest</a>
<a name="ln2063">status_t</a>
<a name="ln2064">UserlandRequestHandler::_HandleRequest(CloseIndexDirRequest* request)</a>
<a name="ln2065">{</a>
<a name="ln2066">	// check and execute the request</a>
<a name="ln2067">	status_t result = B_OK;</a>
<a name="ln2068">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2069">	if (!volume)</a>
<a name="ln2070">		result = B_BAD_VALUE;</a>
<a name="ln2071"> </a>
<a name="ln2072">	if (result == B_OK) {</a>
<a name="ln2073">		RequestThreadContext context(volume, request);</a>
<a name="ln2074">		result = volume-&gt;CloseIndexDir(request-&gt;indexDirCookie);</a>
<a name="ln2075">	}</a>
<a name="ln2076"> </a>
<a name="ln2077">	// prepare the reply</a>
<a name="ln2078">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2079">	CloseIndexDirReply* reply;</a>
<a name="ln2080">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2081">	if (error != B_OK)</a>
<a name="ln2082">		RETURN_ERROR(error);</a>
<a name="ln2083"> </a>
<a name="ln2084">	reply-&gt;error = result;</a>
<a name="ln2085"> </a>
<a name="ln2086">	// send the reply</a>
<a name="ln2087">	return _SendReply(allocator, false);</a>
<a name="ln2088">}</a>
<a name="ln2089"> </a>
<a name="ln2090">// _HandleRequest</a>
<a name="ln2091">status_t</a>
<a name="ln2092">UserlandRequestHandler::_HandleRequest(FreeIndexDirCookieRequest* request)</a>
<a name="ln2093">{</a>
<a name="ln2094">	// check and execute the request</a>
<a name="ln2095">	status_t result = B_OK;</a>
<a name="ln2096">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2097">	if (!volume)</a>
<a name="ln2098">		result = B_BAD_VALUE;</a>
<a name="ln2099"> </a>
<a name="ln2100">	if (result == B_OK) {</a>
<a name="ln2101">		RequestThreadContext context(volume, request);</a>
<a name="ln2102">		result = volume-&gt;FreeIndexDirCookie(request-&gt;indexDirCookie);</a>
<a name="ln2103">	}</a>
<a name="ln2104"> </a>
<a name="ln2105">	// prepare the reply</a>
<a name="ln2106">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2107">	FreeIndexDirCookieReply* reply;</a>
<a name="ln2108">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2109">	if (error != B_OK)</a>
<a name="ln2110">		RETURN_ERROR(error);</a>
<a name="ln2111"> </a>
<a name="ln2112">	reply-&gt;error = result;</a>
<a name="ln2113"> </a>
<a name="ln2114">	// send the reply</a>
<a name="ln2115">	return _SendReply(allocator, false);</a>
<a name="ln2116">}</a>
<a name="ln2117"> </a>
<a name="ln2118">// _HandleRequest</a>
<a name="ln2119">status_t</a>
<a name="ln2120">UserlandRequestHandler::_HandleRequest(ReadIndexDirRequest* request)</a>
<a name="ln2121">{</a>
<a name="ln2122">	// check and execute the request</a>
<a name="ln2123">	status_t result = B_OK;</a>
<a name="ln2124">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2125">	if (!volume)</a>
<a name="ln2126">		result = B_BAD_VALUE;</a>
<a name="ln2127"> </a>
<a name="ln2128">	void* indexDirCookie = request-&gt;indexDirCookie;</a>
<a name="ln2129">	size_t bufferSize = request-&gt;bufferSize;</a>
<a name="ln2130">	uint32 count = request-&gt;count;</a>
<a name="ln2131"> </a>
<a name="ln2132">	// allocate the reply</a>
<a name="ln2133">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2134">	ReadIndexDirReply* reply;</a>
<a name="ln2135">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2136">	if (error != B_OK)</a>
<a name="ln2137">		RETURN_ERROR(error);</a>
<a name="ln2138"> </a>
<a name="ln2139">	void* buffer;</a>
<a name="ln2140">	if (result == B_OK) {</a>
<a name="ln2141">		result = allocator.AllocateAddress(reply-&gt;buffer, bufferSize, 1,</a>
<a name="ln2142">			&amp;buffer, true);</a>
<a name="ln2143">	}</a>
<a name="ln2144"> </a>
<a name="ln2145">	// execute the request</a>
<a name="ln2146">	uint32 countRead;</a>
<a name="ln2147">	if (result == B_OK) {</a>
<a name="ln2148">		RequestThreadContext context(volume, request);</a>
<a name="ln2149">		result = volume-&gt;ReadIndexDir(indexDirCookie, buffer, bufferSize,</a>
<a name="ln2150">			count, &amp;countRead);</a>
<a name="ln2151">	}</a>
<a name="ln2152"> </a>
<a name="ln2153">	// reconstruct the reply, in case it has been overwritten</a>
<a name="ln2154">	reply = new(reply) ReadIndexDirReply;</a>
<a name="ln2155"> </a>
<a name="ln2156">	// send the reply</a>
<a name="ln2157">	reply-&gt;error = result;</a>
<a name="ln2158">	reply-&gt;count = countRead;</a>
<a name="ln2159">	return _SendReply(allocator, (result == B_OK));</a>
<a name="ln2160">}</a>
<a name="ln2161"> </a>
<a name="ln2162">// _HandleRequest</a>
<a name="ln2163">status_t</a>
<a name="ln2164">UserlandRequestHandler::_HandleRequest(RewindIndexDirRequest* request)</a>
<a name="ln2165">{</a>
<a name="ln2166">	// check and execute the request</a>
<a name="ln2167">	status_t result = B_OK;</a>
<a name="ln2168">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2169">	if (!volume)</a>
<a name="ln2170">		result = B_BAD_VALUE;</a>
<a name="ln2171"> </a>
<a name="ln2172">	if (result == B_OK) {</a>
<a name="ln2173">		RequestThreadContext context(volume, request);</a>
<a name="ln2174">		result = volume-&gt;RewindIndexDir(request-&gt;indexDirCookie);</a>
<a name="ln2175">	}</a>
<a name="ln2176"> </a>
<a name="ln2177">	// prepare the reply</a>
<a name="ln2178">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2179">	RewindIndexDirReply* reply;</a>
<a name="ln2180">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2181">	if (error != B_OK)</a>
<a name="ln2182">		RETURN_ERROR(error);</a>
<a name="ln2183"> </a>
<a name="ln2184">	reply-&gt;error = result;</a>
<a name="ln2185"> </a>
<a name="ln2186">	// send the reply</a>
<a name="ln2187">	return _SendReply(allocator, false);</a>
<a name="ln2188">}</a>
<a name="ln2189"> </a>
<a name="ln2190">// _HandleRequest</a>
<a name="ln2191">status_t</a>
<a name="ln2192">UserlandRequestHandler::_HandleRequest(CreateIndexRequest* request)</a>
<a name="ln2193">{</a>
<a name="ln2194">	// check and execute the request</a>
<a name="ln2195">	status_t result = B_OK;</a>
<a name="ln2196">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2197">	if (!volume)</a>
<a name="ln2198">		result = B_BAD_VALUE;</a>
<a name="ln2199"> </a>
<a name="ln2200">	if (result == B_OK) {</a>
<a name="ln2201">		RequestThreadContext context(volume, request);</a>
<a name="ln2202">		result = volume-&gt;CreateIndex((const char*)request-&gt;name.GetData(),</a>
<a name="ln2203">			request-&gt;type, request-&gt;flags);</a>
<a name="ln2204">	}</a>
<a name="ln2205"> </a>
<a name="ln2206">	// prepare the reply</a>
<a name="ln2207">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2208">	CreateIndexReply* reply;</a>
<a name="ln2209">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2210">	if (error != B_OK)</a>
<a name="ln2211">		RETURN_ERROR(error);</a>
<a name="ln2212"> </a>
<a name="ln2213">	reply-&gt;error = result;</a>
<a name="ln2214"> </a>
<a name="ln2215">	// send the reply</a>
<a name="ln2216">	return _SendReply(allocator, false);</a>
<a name="ln2217">}</a>
<a name="ln2218"> </a>
<a name="ln2219">// _HandleRequest</a>
<a name="ln2220">status_t</a>
<a name="ln2221">UserlandRequestHandler::_HandleRequest(RemoveIndexRequest* request)</a>
<a name="ln2222">{</a>
<a name="ln2223">	// check and execute the request</a>
<a name="ln2224">	status_t result = B_OK;</a>
<a name="ln2225">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2226">	if (!volume)</a>
<a name="ln2227">		result = B_BAD_VALUE;</a>
<a name="ln2228"> </a>
<a name="ln2229">	if (result == B_OK) {</a>
<a name="ln2230">		RequestThreadContext context(volume, request);</a>
<a name="ln2231">		result = volume-&gt;RemoveIndex((const char*)request-&gt;name.GetData());</a>
<a name="ln2232">	}</a>
<a name="ln2233"> </a>
<a name="ln2234">	// prepare the reply</a>
<a name="ln2235">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2236">	RemoveIndexReply* reply;</a>
<a name="ln2237">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2238">	if (error != B_OK)</a>
<a name="ln2239">		RETURN_ERROR(error);</a>
<a name="ln2240"> </a>
<a name="ln2241">	reply-&gt;error = result;</a>
<a name="ln2242"> </a>
<a name="ln2243">	// send the reply</a>
<a name="ln2244">	return _SendReply(allocator, false);</a>
<a name="ln2245">}</a>
<a name="ln2246"> </a>
<a name="ln2247">// _HandleRequest</a>
<a name="ln2248">status_t</a>
<a name="ln2249">UserlandRequestHandler::_HandleRequest(ReadIndexStatRequest* request)</a>
<a name="ln2250">{</a>
<a name="ln2251">	// check and execute the request</a>
<a name="ln2252">	status_t result = B_OK;</a>
<a name="ln2253">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2254">	if (!volume)</a>
<a name="ln2255">		result = B_BAD_VALUE;</a>
<a name="ln2256"> </a>
<a name="ln2257">	struct stat st;</a>
<a name="ln2258">	if (result == B_OK) {</a>
<a name="ln2259">		RequestThreadContext context(volume, request);</a>
<a name="ln2260">		result = volume-&gt;ReadIndexStat((const char*)request-&gt;name.GetData(),</a>
<a name="ln2261">			&amp;st);</a>
<a name="ln2262">	}</a>
<a name="ln2263"> </a>
<a name="ln2264">	// prepare the reply</a>
<a name="ln2265">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2266">	ReadIndexStatReply* reply;</a>
<a name="ln2267">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2268">	if (error != B_OK)</a>
<a name="ln2269">		RETURN_ERROR(error);</a>
<a name="ln2270"> </a>
<a name="ln2271">	reply-&gt;error = result;</a>
<a name="ln2272">	reply-&gt;st = st;</a>
<a name="ln2273"> </a>
<a name="ln2274">	// send the reply</a>
<a name="ln2275">	return _SendReply(allocator, false);</a>
<a name="ln2276">}</a>
<a name="ln2277"> </a>
<a name="ln2278"> </a>
<a name="ln2279">// #pragma mark - queries</a>
<a name="ln2280"> </a>
<a name="ln2281"> </a>
<a name="ln2282">// _HandleRequest</a>
<a name="ln2283">status_t</a>
<a name="ln2284">UserlandRequestHandler::_HandleRequest(OpenQueryRequest* request)</a>
<a name="ln2285">{</a>
<a name="ln2286">	// check and execute the request</a>
<a name="ln2287">	status_t result = B_OK;</a>
<a name="ln2288">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2289">	if (!volume)</a>
<a name="ln2290">		result = B_BAD_VALUE;</a>
<a name="ln2291"> </a>
<a name="ln2292">	void* queryCookie;</a>
<a name="ln2293">	if (result == B_OK) {</a>
<a name="ln2294">		RequestThreadContext context(volume, request);</a>
<a name="ln2295">		result = volume-&gt;OpenQuery((const char*)request-&gt;queryString.GetData(),</a>
<a name="ln2296">			request-&gt;flags, request-&gt;port, request-&gt;token, &amp;queryCookie);</a>
<a name="ln2297">	}</a>
<a name="ln2298"> </a>
<a name="ln2299">	// prepare the reply</a>
<a name="ln2300">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2301">	OpenQueryReply* reply;</a>
<a name="ln2302">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2303">	if (error != B_OK)</a>
<a name="ln2304">		RETURN_ERROR(error);</a>
<a name="ln2305"> </a>
<a name="ln2306">	reply-&gt;error = result;</a>
<a name="ln2307">	reply-&gt;queryCookie = queryCookie;</a>
<a name="ln2308"> </a>
<a name="ln2309">	// send the reply</a>
<a name="ln2310">	return _SendReply(allocator, false);</a>
<a name="ln2311">}</a>
<a name="ln2312"> </a>
<a name="ln2313">// _HandleRequest</a>
<a name="ln2314">status_t</a>
<a name="ln2315">UserlandRequestHandler::_HandleRequest(CloseQueryRequest* request)</a>
<a name="ln2316">{</a>
<a name="ln2317">	// check and execute the request</a>
<a name="ln2318">	status_t result = B_OK;</a>
<a name="ln2319">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2320">	if (!volume)</a>
<a name="ln2321">		result = B_BAD_VALUE;</a>
<a name="ln2322"> </a>
<a name="ln2323">	if (result == B_OK) {</a>
<a name="ln2324">		RequestThreadContext context(volume, request);</a>
<a name="ln2325">		result = volume-&gt;CloseQuery(request-&gt;queryCookie);</a>
<a name="ln2326">	}</a>
<a name="ln2327"> </a>
<a name="ln2328">	// prepare the reply</a>
<a name="ln2329">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2330">	CloseQueryReply* reply;</a>
<a name="ln2331">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2332">	if (error != B_OK)</a>
<a name="ln2333">		RETURN_ERROR(error);</a>
<a name="ln2334"> </a>
<a name="ln2335">	reply-&gt;error = result;</a>
<a name="ln2336"> </a>
<a name="ln2337">	// send the reply</a>
<a name="ln2338">	return _SendReply(allocator, false);</a>
<a name="ln2339">}</a>
<a name="ln2340"> </a>
<a name="ln2341">// _HandleRequest</a>
<a name="ln2342">status_t</a>
<a name="ln2343">UserlandRequestHandler::_HandleRequest(FreeQueryCookieRequest* request)</a>
<a name="ln2344">{</a>
<a name="ln2345">	// check and execute the request</a>
<a name="ln2346">	status_t result = B_OK;</a>
<a name="ln2347">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2348">	if (!volume)</a>
<a name="ln2349">		result = B_BAD_VALUE;</a>
<a name="ln2350"> </a>
<a name="ln2351">	if (result == B_OK) {</a>
<a name="ln2352">		RequestThreadContext context(volume, request);</a>
<a name="ln2353">		result = volume-&gt;FreeQueryCookie(request-&gt;queryCookie);</a>
<a name="ln2354">	}</a>
<a name="ln2355"> </a>
<a name="ln2356">	// prepare the reply</a>
<a name="ln2357">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2358">	FreeQueryCookieReply* reply;</a>
<a name="ln2359">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2360">	if (error != B_OK)</a>
<a name="ln2361">		RETURN_ERROR(error);</a>
<a name="ln2362"> </a>
<a name="ln2363">	reply-&gt;error = result;</a>
<a name="ln2364"> </a>
<a name="ln2365">	// send the reply</a>
<a name="ln2366">	return _SendReply(allocator, false);</a>
<a name="ln2367">}</a>
<a name="ln2368"> </a>
<a name="ln2369">// _HandleRequest</a>
<a name="ln2370">status_t</a>
<a name="ln2371">UserlandRequestHandler::_HandleRequest(ReadQueryRequest* request)</a>
<a name="ln2372">{</a>
<a name="ln2373">	// check and execute the request</a>
<a name="ln2374">	status_t result = B_OK;</a>
<a name="ln2375">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2376">	if (!volume)</a>
<a name="ln2377">		result = B_BAD_VALUE;</a>
<a name="ln2378"> </a>
<a name="ln2379">	void* queryCookie = request-&gt;queryCookie;</a>
<a name="ln2380">	size_t bufferSize = request-&gt;bufferSize;</a>
<a name="ln2381">	uint32 count = request-&gt;count;</a>
<a name="ln2382"> </a>
<a name="ln2383">	// allocate the reply</a>
<a name="ln2384">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2385">	ReadQueryReply* reply;</a>
<a name="ln2386">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2387">	if (error != B_OK)</a>
<a name="ln2388">		RETURN_ERROR(error);</a>
<a name="ln2389"> </a>
<a name="ln2390">	void* buffer;</a>
<a name="ln2391">	if (result == B_OK) {</a>
<a name="ln2392">		result = allocator.AllocateAddress(reply-&gt;buffer, bufferSize, 1,</a>
<a name="ln2393">			&amp;buffer, true);</a>
<a name="ln2394">	}</a>
<a name="ln2395"> </a>
<a name="ln2396">	// execute the request</a>
<a name="ln2397">	uint32 countRead;</a>
<a name="ln2398">	if (result == B_OK) {</a>
<a name="ln2399">		RequestThreadContext context(volume, request);</a>
<a name="ln2400">		result = volume-&gt;ReadQuery(queryCookie, buffer, bufferSize,</a>
<a name="ln2401">			count, &amp;countRead);</a>
<a name="ln2402">	}</a>
<a name="ln2403"> </a>
<a name="ln2404">	// reconstruct the reply, in case it has been overwritten</a>
<a name="ln2405">	reply = new(reply) ReadQueryReply;</a>
<a name="ln2406"> </a>
<a name="ln2407">	// send the reply</a>
<a name="ln2408">	reply-&gt;error = result;</a>
<a name="ln2409">	reply-&gt;count = countRead;</a>
<a name="ln2410">	return _SendReply(allocator, (result == B_OK));</a>
<a name="ln2411">}</a>
<a name="ln2412"> </a>
<a name="ln2413">// _HandleRequest</a>
<a name="ln2414">status_t</a>
<a name="ln2415">UserlandRequestHandler::_HandleRequest(RewindQueryRequest* request)</a>
<a name="ln2416">{</a>
<a name="ln2417">	// check and execute the request</a>
<a name="ln2418">	status_t result = B_OK;</a>
<a name="ln2419">	Volume* volume = (Volume*)request-&gt;volume;</a>
<a name="ln2420">	if (!volume)</a>
<a name="ln2421">		result = B_BAD_VALUE;</a>
<a name="ln2422"> </a>
<a name="ln2423">	if (result == B_OK) {</a>
<a name="ln2424">		RequestThreadContext context(volume, request);</a>
<a name="ln2425">		result = volume-&gt;RewindQuery(request-&gt;queryCookie);</a>
<a name="ln2426">	}</a>
<a name="ln2427"> </a>
<a name="ln2428">	// prepare the reply</a>
<a name="ln2429">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2430">	RewindQueryReply* reply;</a>
<a name="ln2431">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2432">	if (error != B_OK)</a>
<a name="ln2433">		RETURN_ERROR(error);</a>
<a name="ln2434"> </a>
<a name="ln2435">	reply-&gt;error = result;</a>
<a name="ln2436"> </a>
<a name="ln2437">	// send the reply</a>
<a name="ln2438">	return _SendReply(allocator, false);</a>
<a name="ln2439">}</a>
<a name="ln2440"> </a>
<a name="ln2441"> </a>
<a name="ln2442">// #pragma mark - node monitoring</a>
<a name="ln2443"> </a>
<a name="ln2444"> </a>
<a name="ln2445">// _HandleRequest</a>
<a name="ln2446">status_t</a>
<a name="ln2447">UserlandRequestHandler::_HandleRequest(NodeMonitoringEventRequest* request)</a>
<a name="ln2448">{</a>
<a name="ln2449">	// check and execute the request</a>
<a name="ln2450">	KMessage event;</a>
<a name="ln2451">	event.SetTo(request-&gt;event.GetData(), request-&gt;event.GetSize());</a>
<a name="ln2452">	((NotificationListener*)request-&gt;listener)-&gt;EventOccurred(</a>
<a name="ln2453">		*(NotificationService*)NULL, &amp;event);</a>
<a name="ln2454"> </a>
<a name="ln2455">	// prepare the reply</a>
<a name="ln2456">	RequestAllocator allocator(fPort-&gt;GetPort());</a>
<a name="ln2457">	NodeMonitoringEventReply* reply;</a>
<a name="ln2458">	status_t error = AllocateRequest(allocator, &amp;reply);</a>
<a name="ln2459">	if (error != B_OK)</a>
<a name="ln2460">		RETURN_ERROR(error);</a>
<a name="ln2461"> </a>
<a name="ln2462">	reply-&gt;error = B_OK;</a>
<a name="ln2463"> </a>
<a name="ln2464">	// send the reply</a>
<a name="ln2465">	return _SendReply(allocator, false);</a>
<a name="ln2466">}</a>
<a name="ln2467"> </a>
<a name="ln2468"> </a>
<a name="ln2469">// #pragma mark - other</a>
<a name="ln2470"> </a>
<a name="ln2471"> </a>
<a name="ln2472">// _SendReply</a>
<a name="ln2473">status_t</a>
<a name="ln2474">UserlandRequestHandler::_SendReply(RequestAllocator&amp; allocator,</a>
<a name="ln2475">	bool expectsReceipt)</a>
<a name="ln2476">{</a>
<a name="ln2477">	if (expectsReceipt) {</a>
<a name="ln2478">		SingleReplyRequestHandler handler(RECEIPT_ACK_REPLY);</a>
<a name="ln2479">		return fPort-&gt;SendRequest(&amp;allocator, &amp;handler);</a>
<a name="ln2480">	} else</a>
<a name="ln2481">		return fPort-&gt;SendRequest(&amp;allocator);</a>
<a name="ln2482">}</a>
<a name="ln2483"> </a>

</code></pre>
<div class="balloon" rel="732"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v595/" target="_blank">V595</a> The 'writeBuffer' pointer was utilized before it was verified against nullptr. Check lines: 732, 750.</p></div>
<div class="balloon" rel="1145"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v614/" target="_blank">V614</a> Potentially uninitialized pointer 'fileCookie' used.</p></div>
<div class="balloon" rel="2307"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v614/" target="_blank">V614</a> Potentially uninitialized pointer 'queryCookie' used.</p></div>
<div class="balloon" rel="2056"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v614/" target="_blank">V614</a> Potentially uninitialized pointer 'indexDirCookie' used.</p></div>
<div class="balloon" rel="1770"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v614/" target="_blank">V614</a> Potentially uninitialized pointer 'attrCookie' used.</p></div>
<div class="balloon" rel="1738"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v614/" target="_blank">V614</a> Potentially uninitialized pointer 'attrCookie' used.</p></div>
<div class="balloon" rel="1572"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v614/" target="_blank">V614</a> Potentially uninitialized pointer 'attrDirCookie' used.</p></div>
<div class="balloon" rel="1175"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v614/" target="_blank">V614</a> Potentially uninitialized pointer 'fileCookie' used.</p></div>
<div class="balloon" rel="240"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v547/" target="_blank">V547</a> Expression 'result == ((int) 0)' is always true.</p></div>
<div class="balloon" rel="494"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v614/" target="_blank">V614</a> Potentially uninitialized pointer 'node' used.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
