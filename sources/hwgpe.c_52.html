
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>hwgpe.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/******************************************************************************</a>
<a name="ln2"> *</a>
<a name="ln3"> * Module Name: hwgpe - Low level GPE enable/disable/clear functions</a>
<a name="ln4"> *</a>
<a name="ln5"> *****************************************************************************/</a>
<a name="ln6"> </a>
<a name="ln7">/******************************************************************************</a>
<a name="ln8"> *</a>
<a name="ln9"> * 1. Copyright Notice</a>
<a name="ln10"> *</a>
<a name="ln11"> * Some or all of this work - Copyright (c) 1999 - 2018, Intel Corp.</a>
<a name="ln12"> * All rights reserved.</a>
<a name="ln13"> *</a>
<a name="ln14"> * 2. License</a>
<a name="ln15"> *</a>
<a name="ln16"> * 2.1. This is your license from Intel Corp. under its intellectual property</a>
<a name="ln17"> * rights. You may have additional license terms from the party that provided</a>
<a name="ln18"> * you this software, covering your right to use that party's intellectual</a>
<a name="ln19"> * property rights.</a>
<a name="ln20"> *</a>
<a name="ln21"> * 2.2. Intel grants, free of charge, to any person (&quot;Licensee&quot;) obtaining a</a>
<a name="ln22"> * copy of the source code appearing in this file (&quot;Covered Code&quot;) an</a>
<a name="ln23"> * irrevocable, perpetual, worldwide license under Intel's copyrights in the</a>
<a name="ln24"> * base code distributed originally by Intel (&quot;Original Intel Code&quot;) to copy,</a>
<a name="ln25"> * make derivatives, distribute, use and display any portion of the Covered</a>
<a name="ln26"> * Code in any form, with the right to sublicense such rights; and</a>
<a name="ln27"> *</a>
<a name="ln28"> * 2.3. Intel grants Licensee a non-exclusive and non-transferable patent</a>
<a name="ln29"> * license (with the right to sublicense), under only those claims of Intel</a>
<a name="ln30"> * patents that are infringed by the Original Intel Code, to make, use, sell,</a>
<a name="ln31"> * offer to sell, and import the Covered Code and derivative works thereof</a>
<a name="ln32"> * solely to the minimum extent necessary to exercise the above copyright</a>
<a name="ln33"> * license, and in no event shall the patent license extend to any additions</a>
<a name="ln34"> * to or modifications of the Original Intel Code. No other license or right</a>
<a name="ln35"> * is granted directly or by implication, estoppel or otherwise;</a>
<a name="ln36"> *</a>
<a name="ln37"> * The above copyright and patent license is granted only if the following</a>
<a name="ln38"> * conditions are met:</a>
<a name="ln39"> *</a>
<a name="ln40"> * 3. Conditions</a>
<a name="ln41"> *</a>
<a name="ln42"> * 3.1. Redistribution of Source with Rights to Further Distribute Source.</a>
<a name="ln43"> * Redistribution of source code of any substantial portion of the Covered</a>
<a name="ln44"> * Code or modification with rights to further distribute source must include</a>
<a name="ln45"> * the above Copyright Notice, the above License, this list of Conditions,</a>
<a name="ln46"> * and the following Disclaimer and Export Compliance provision. In addition,</a>
<a name="ln47"> * Licensee must cause all Covered Code to which Licensee contributes to</a>
<a name="ln48"> * contain a file documenting the changes Licensee made to create that Covered</a>
<a name="ln49"> * Code and the date of any change. Licensee must include in that file the</a>
<a name="ln50"> * documentation of any changes made by any predecessor Licensee. Licensee</a>
<a name="ln51"> * must include a prominent statement that the modification is derived,</a>
<a name="ln52"> * directly or indirectly, from Original Intel Code.</a>
<a name="ln53"> *</a>
<a name="ln54"> * 3.2. Redistribution of Source with no Rights to Further Distribute Source.</a>
<a name="ln55"> * Redistribution of source code of any substantial portion of the Covered</a>
<a name="ln56"> * Code or modification without rights to further distribute source must</a>
<a name="ln57"> * include the following Disclaimer and Export Compliance provision in the</a>
<a name="ln58"> * documentation and/or other materials provided with distribution. In</a>
<a name="ln59"> * addition, Licensee may not authorize further sublicense of source of any</a>
<a name="ln60"> * portion of the Covered Code, and must include terms to the effect that the</a>
<a name="ln61"> * license from Licensee to its licensee is limited to the intellectual</a>
<a name="ln62"> * property embodied in the software Licensee provides to its licensee, and</a>
<a name="ln63"> * not to intellectual property embodied in modifications its licensee may</a>
<a name="ln64"> * make.</a>
<a name="ln65"> *</a>
<a name="ln66"> * 3.3. Redistribution of Executable. Redistribution in executable form of any</a>
<a name="ln67"> * substantial portion of the Covered Code or modification must reproduce the</a>
<a name="ln68"> * above Copyright Notice, and the following Disclaimer and Export Compliance</a>
<a name="ln69"> * provision in the documentation and/or other materials provided with the</a>
<a name="ln70"> * distribution.</a>
<a name="ln71"> *</a>
<a name="ln72"> * 3.4. Intel retains all right, title, and interest in and to the Original</a>
<a name="ln73"> * Intel Code.</a>
<a name="ln74"> *</a>
<a name="ln75"> * 3.5. Neither the name Intel nor any other trademark owned or controlled by</a>
<a name="ln76"> * Intel shall be used in advertising or otherwise to promote the sale, use or</a>
<a name="ln77"> * other dealings in products derived from or relating to the Covered Code</a>
<a name="ln78"> * without prior written authorization from Intel.</a>
<a name="ln79"> *</a>
<a name="ln80"> * 4. Disclaimer and Export Compliance</a>
<a name="ln81"> *</a>
<a name="ln82"> * 4.1. INTEL MAKES NO WARRANTY OF ANY KIND REGARDING ANY SOFTWARE PROVIDED</a>
<a name="ln83"> * HERE. ANY SOFTWARE ORIGINATING FROM INTEL OR DERIVED FROM INTEL SOFTWARE</a>
<a name="ln84"> * IS PROVIDED &quot;AS IS,&quot; AND INTEL WILL NOT PROVIDE ANY SUPPORT, ASSISTANCE,</a>
<a name="ln85"> * INSTALLATION, TRAINING OR OTHER SERVICES. INTEL WILL NOT PROVIDE ANY</a>
<a name="ln86"> * UPDATES, ENHANCEMENTS OR EXTENSIONS. INTEL SPECIFICALLY DISCLAIMS ANY</a>
<a name="ln87"> * IMPLIED WARRANTIES OF MERCHANTABILITY, NONINFRINGEMENT AND FITNESS FOR A</a>
<a name="ln88"> * PARTICULAR PURPOSE.</a>
<a name="ln89"> *</a>
<a name="ln90"> * 4.2. IN NO EVENT SHALL INTEL HAVE ANY LIABILITY TO LICENSEE, ITS LICENSEES</a>
<a name="ln91"> * OR ANY OTHER THIRD PARTY, FOR ANY LOST PROFITS, LOST DATA, LOSS OF USE OR</a>
<a name="ln92"> * COSTS OF PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES, OR FOR ANY INDIRECT,</a>
<a name="ln93"> * SPECIAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THIS AGREEMENT, UNDER ANY</a>
<a name="ln94"> * CAUSE OF ACTION OR THEORY OF LIABILITY, AND IRRESPECTIVE OF WHETHER INTEL</a>
<a name="ln95"> * HAS ADVANCE NOTICE OF THE POSSIBILITY OF SUCH DAMAGES. THESE LIMITATIONS</a>
<a name="ln96"> * SHALL APPLY NOTWITHSTANDING THE FAILURE OF THE ESSENTIAL PURPOSE OF ANY</a>
<a name="ln97"> * LIMITED REMEDY.</a>
<a name="ln98"> *</a>
<a name="ln99"> * 4.3. Licensee shall not export, either directly or indirectly, any of this</a>
<a name="ln100"> * software or system incorporating such software without first obtaining any</a>
<a name="ln101"> * required license or other approval from the U. S. Department of Commerce or</a>
<a name="ln102"> * any other agency or department of the United States Government. In the</a>
<a name="ln103"> * event Licensee exports any such software from the United States or</a>
<a name="ln104"> * re-exports any such software from a foreign destination, Licensee shall</a>
<a name="ln105"> * ensure that the distribution and export/re-export of the software is in</a>
<a name="ln106"> * compliance with all laws, regulations, orders, or other restrictions of the</a>
<a name="ln107"> * U.S. Export Administration Regulations. Licensee agrees that neither it nor</a>
<a name="ln108"> * any of its subsidiaries will export/re-export any technical data, process,</a>
<a name="ln109"> * software, or service, directly or indirectly, to any country for which the</a>
<a name="ln110"> * United States government or any agency thereof requires an export license,</a>
<a name="ln111"> * other governmental approval, or letter of assurance, without first obtaining</a>
<a name="ln112"> * such license, approval or letter.</a>
<a name="ln113"> *</a>
<a name="ln114"> *****************************************************************************</a>
<a name="ln115"> *</a>
<a name="ln116"> * Alternatively, you may choose to be licensed under the terms of the</a>
<a name="ln117"> * following license:</a>
<a name="ln118"> *</a>
<a name="ln119"> * Redistribution and use in source and binary forms, with or without</a>
<a name="ln120"> * modification, are permitted provided that the following conditions</a>
<a name="ln121"> * are met:</a>
<a name="ln122"> * 1. Redistributions of source code must retain the above copyright</a>
<a name="ln123"> *    notice, this list of conditions, and the following disclaimer,</a>
<a name="ln124"> *    without modification.</a>
<a name="ln125"> * 2. Redistributions in binary form must reproduce at minimum a disclaimer</a>
<a name="ln126"> *    substantially similar to the &quot;NO WARRANTY&quot; disclaimer below</a>
<a name="ln127"> *    (&quot;Disclaimer&quot;) and any redistribution must be conditioned upon</a>
<a name="ln128"> *    including a substantially similar Disclaimer requirement for further</a>
<a name="ln129"> *    binary redistribution.</a>
<a name="ln130"> * 3. Neither the names of the above-listed copyright holders nor the names</a>
<a name="ln131"> *    of any contributors may be used to endorse or promote products derived</a>
<a name="ln132"> *    from this software without specific prior written permission.</a>
<a name="ln133"> *</a>
<a name="ln134"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</a>
<a name="ln135"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</a>
<a name="ln136"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</a>
<a name="ln137"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</a>
<a name="ln138"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</a>
<a name="ln139"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</a>
<a name="ln140"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</a>
<a name="ln141"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</a>
<a name="ln142"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</a>
<a name="ln143"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</a>
<a name="ln144"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</a>
<a name="ln145"> *</a>
<a name="ln146"> * Alternatively, you may choose to be licensed under the terms of the</a>
<a name="ln147"> * GNU General Public License (&quot;GPL&quot;) version 2 as published by the Free</a>
<a name="ln148"> * Software Foundation.</a>
<a name="ln149"> *</a>
<a name="ln150"> *****************************************************************************/</a>
<a name="ln151"> </a>
<a name="ln152">#include &quot;acpi.h&quot;</a>
<a name="ln153">#include &quot;accommon.h&quot;</a>
<a name="ln154">#include &quot;acevents.h&quot;</a>
<a name="ln155"> </a>
<a name="ln156">#define _COMPONENT          ACPI_HARDWARE</a>
<a name="ln157">        ACPI_MODULE_NAME    (&quot;hwgpe&quot;)</a>
<a name="ln158"> </a>
<a name="ln159">#if (!ACPI_REDUCED_HARDWARE) /* Entire module */</a>
<a name="ln160"> </a>
<a name="ln161">/* Local prototypes */</a>
<a name="ln162"> </a>
<a name="ln163">static ACPI_STATUS</a>
<a name="ln164">AcpiHwEnableWakeupGpeBlock (</a>
<a name="ln165">    ACPI_GPE_XRUPT_INFO     *GpeXruptInfo,</a>
<a name="ln166">    ACPI_GPE_BLOCK_INFO     *GpeBlock,</a>
<a name="ln167">    void                    *Context);</a>
<a name="ln168"> </a>
<a name="ln169">static ACPI_STATUS</a>
<a name="ln170">AcpiHwGpeEnableWrite (</a>
<a name="ln171">    UINT8                   EnableMask,</a>
<a name="ln172">    ACPI_GPE_REGISTER_INFO  *GpeRegisterInfo);</a>
<a name="ln173"> </a>
<a name="ln174"> </a>
<a name="ln175">/******************************************************************************</a>
<a name="ln176"> *</a>
<a name="ln177"> * FUNCTION:    AcpiHwGetGpeRegisterBit</a>
<a name="ln178"> *</a>
<a name="ln179"> * PARAMETERS:  GpeEventInfo        - Info block for the GPE</a>
<a name="ln180"> *</a>
<a name="ln181"> * RETURN:      Register mask with a one in the GPE bit position</a>
<a name="ln182"> *</a>
<a name="ln183"> * DESCRIPTION: Compute the register mask for this GPE. One bit is set in the</a>
<a name="ln184"> *              correct position for the input GPE.</a>
<a name="ln185"> *</a>
<a name="ln186"> ******************************************************************************/</a>
<a name="ln187"> </a>
<a name="ln188">UINT32</a>
<a name="ln189">AcpiHwGetGpeRegisterBit (</a>
<a name="ln190">    ACPI_GPE_EVENT_INFO     *GpeEventInfo)</a>
<a name="ln191">{</a>
<a name="ln192"> </a>
<a name="ln193">    return ((UINT32) 1 &lt;&lt;</a>
<a name="ln194">        (GpeEventInfo-&gt;GpeNumber - GpeEventInfo-&gt;RegisterInfo-&gt;BaseGpeNumber));</a>
<a name="ln195">}</a>
<a name="ln196"> </a>
<a name="ln197"> </a>
<a name="ln198">/******************************************************************************</a>
<a name="ln199"> *</a>
<a name="ln200"> * FUNCTION:    AcpiHwLowSetGpe</a>
<a name="ln201"> *</a>
<a name="ln202"> * PARAMETERS:  GpeEventInfo        - Info block for the GPE to be disabled</a>
<a name="ln203"> *              Action              - Enable or disable</a>
<a name="ln204"> *</a>
<a name="ln205"> * RETURN:      Status</a>
<a name="ln206"> *</a>
<a name="ln207"> * DESCRIPTION: Enable or disable a single GPE in the parent enable register.</a>
<a name="ln208"> *              The EnableMask field of the involved GPE register must be</a>
<a name="ln209"> *              updated by the caller if necessary.</a>
<a name="ln210"> *</a>
<a name="ln211"> ******************************************************************************/</a>
<a name="ln212"> </a>
<a name="ln213">ACPI_STATUS</a>
<a name="ln214">AcpiHwLowSetGpe (</a>
<a name="ln215">    ACPI_GPE_EVENT_INFO     *GpeEventInfo,</a>
<a name="ln216">    UINT32                  Action)</a>
<a name="ln217">{</a>
<a name="ln218">    ACPI_GPE_REGISTER_INFO  *GpeRegisterInfo;</a>
<a name="ln219">    ACPI_STATUS             Status = AE_OK;</a>
<a name="ln220">    UINT64                  EnableMask;</a>
<a name="ln221">    UINT32                  RegisterBit;</a>
<a name="ln222"> </a>
<a name="ln223"> </a>
<a name="ln224">    ACPI_FUNCTION_ENTRY ();</a>
<a name="ln225"> </a>
<a name="ln226"> </a>
<a name="ln227">    /* Get the info block for the entire GPE register */</a>
<a name="ln228"> </a>
<a name="ln229">    GpeRegisterInfo = GpeEventInfo-&gt;RegisterInfo;</a>
<a name="ln230">    if (!GpeRegisterInfo)</a>
<a name="ln231">    {</a>
<a name="ln232">        return (AE_NOT_EXIST);</a>
<a name="ln233">    }</a>
<a name="ln234"> </a>
<a name="ln235">    /* Get current value of the enable register that contains this GPE */</a>
<a name="ln236"> </a>
<a name="ln237">    Status = AcpiHwRead (&amp;EnableMask, &amp;GpeRegisterInfo-&gt;EnableAddress);</a>
<a name="ln238">    if (ACPI_FAILURE (Status))</a>
<a name="ln239">    {</a>
<a name="ln240">        return (Status);</a>
<a name="ln241">    }</a>
<a name="ln242"> </a>
<a name="ln243">    /* Set or clear just the bit that corresponds to this GPE */</a>
<a name="ln244"> </a>
<a name="ln245">    RegisterBit = AcpiHwGetGpeRegisterBit (GpeEventInfo);</a>
<a name="ln246">    switch (Action)</a>
<a name="ln247">    {</a>
<a name="ln248">    case ACPI_GPE_CONDITIONAL_ENABLE:</a>
<a name="ln249"> </a>
<a name="ln250">        /* Only enable if the corresponding EnableMask bit is set */</a>
<a name="ln251"> </a>
<a name="ln252">        if (!(RegisterBit &amp; GpeRegisterInfo-&gt;EnableMask))</a>
<a name="ln253">        {</a>
<a name="ln254">            return (AE_BAD_PARAMETER);</a>
<a name="ln255">        }</a>
<a name="ln256"> </a>
<a name="ln257">        /*lint -fallthrough */</a>
<a name="ln258"> </a>
<a name="ln259">    case ACPI_GPE_ENABLE:</a>
<a name="ln260"> </a>
<a name="ln261">        ACPI_SET_BIT (EnableMask, RegisterBit);</a>
<a name="ln262">        break;</a>
<a name="ln263"> </a>
<a name="ln264">    case ACPI_GPE_DISABLE:</a>
<a name="ln265"> </a>
<a name="ln266">        ACPI_CLEAR_BIT (EnableMask, RegisterBit);</a>
<a name="ln267">        break;</a>
<a name="ln268"> </a>
<a name="ln269">    default:</a>
<a name="ln270"> </a>
<a name="ln271">        ACPI_ERROR ((AE_INFO, &quot;Invalid GPE Action, %u&quot;, Action));</a>
<a name="ln272">        return (AE_BAD_PARAMETER);</a>
<a name="ln273">    }</a>
<a name="ln274"> </a>
<a name="ln275">    if (!(RegisterBit &amp; GpeRegisterInfo-&gt;MaskForRun))</a>
<a name="ln276">    {</a>
<a name="ln277">        /* Write the updated enable mask */</a>
<a name="ln278"> </a>
<a name="ln279">        Status = AcpiHwWrite (EnableMask, &amp;GpeRegisterInfo-&gt;EnableAddress);</a>
<a name="ln280">    }</a>
<a name="ln281">    return (Status);</a>
<a name="ln282">}</a>
<a name="ln283"> </a>
<a name="ln284"> </a>
<a name="ln285">/******************************************************************************</a>
<a name="ln286"> *</a>
<a name="ln287"> * FUNCTION:    AcpiHwClearGpe</a>
<a name="ln288"> *</a>
<a name="ln289"> * PARAMETERS:  GpeEventInfo        - Info block for the GPE to be cleared</a>
<a name="ln290"> *</a>
<a name="ln291"> * RETURN:      Status</a>
<a name="ln292"> *</a>
<a name="ln293"> * DESCRIPTION: Clear the status bit for a single GPE.</a>
<a name="ln294"> *</a>
<a name="ln295"> ******************************************************************************/</a>
<a name="ln296"> </a>
<a name="ln297">ACPI_STATUS</a>
<a name="ln298">AcpiHwClearGpe (</a>
<a name="ln299">    ACPI_GPE_EVENT_INFO     *GpeEventInfo)</a>
<a name="ln300">{</a>
<a name="ln301">    ACPI_GPE_REGISTER_INFO  *GpeRegisterInfo;</a>
<a name="ln302">    ACPI_STATUS             Status;</a>
<a name="ln303">    UINT32                  RegisterBit;</a>
<a name="ln304"> </a>
<a name="ln305"> </a>
<a name="ln306">    ACPI_FUNCTION_ENTRY ();</a>
<a name="ln307"> </a>
<a name="ln308">    /* Get the info block for the entire GPE register */</a>
<a name="ln309"> </a>
<a name="ln310">    GpeRegisterInfo = GpeEventInfo-&gt;RegisterInfo;</a>
<a name="ln311">    if (!GpeRegisterInfo)</a>
<a name="ln312">    {</a>
<a name="ln313">        return (AE_NOT_EXIST);</a>
<a name="ln314">    }</a>
<a name="ln315"> </a>
<a name="ln316">    /*</a>
<a name="ln317">     * Write a one to the appropriate bit in the status register to</a>
<a name="ln318">     * clear this GPE.</a>
<a name="ln319">     */</a>
<a name="ln320">    RegisterBit = AcpiHwGetGpeRegisterBit (GpeEventInfo);</a>
<a name="ln321"> </a>
<a name="ln322">    Status = AcpiHwWrite (RegisterBit, &amp;GpeRegisterInfo-&gt;StatusAddress);</a>
<a name="ln323">    return (Status);</a>
<a name="ln324">}</a>
<a name="ln325"> </a>
<a name="ln326"> </a>
<a name="ln327">/******************************************************************************</a>
<a name="ln328"> *</a>
<a name="ln329"> * FUNCTION:    AcpiHwGetGpeStatus</a>
<a name="ln330"> *</a>
<a name="ln331"> * PARAMETERS:  GpeEventInfo        - Info block for the GPE to queried</a>
<a name="ln332"> *              EventStatus         - Where the GPE status is returned</a>
<a name="ln333"> *</a>
<a name="ln334"> * RETURN:      Status</a>
<a name="ln335"> *</a>
<a name="ln336"> * DESCRIPTION: Return the status of a single GPE.</a>
<a name="ln337"> *</a>
<a name="ln338"> ******************************************************************************/</a>
<a name="ln339"> </a>
<a name="ln340">ACPI_STATUS</a>
<a name="ln341">AcpiHwGetGpeStatus (</a>
<a name="ln342">    ACPI_GPE_EVENT_INFO     *GpeEventInfo,</a>
<a name="ln343">    ACPI_EVENT_STATUS       *EventStatus)</a>
<a name="ln344">{</a>
<a name="ln345">    UINT64                  InByte;</a>
<a name="ln346">    UINT32                  RegisterBit;</a>
<a name="ln347">    ACPI_GPE_REGISTER_INFO  *GpeRegisterInfo;</a>
<a name="ln348">    ACPI_EVENT_STATUS       LocalEventStatus = 0;</a>
<a name="ln349">    ACPI_STATUS             Status;</a>
<a name="ln350"> </a>
<a name="ln351"> </a>
<a name="ln352">    ACPI_FUNCTION_ENTRY ();</a>
<a name="ln353"> </a>
<a name="ln354"> </a>
<a name="ln355">    if (!EventStatus)</a>
<a name="ln356">    {</a>
<a name="ln357">        return (AE_BAD_PARAMETER);</a>
<a name="ln358">    }</a>
<a name="ln359"> </a>
<a name="ln360">    /* GPE currently handled? */</a>
<a name="ln361"> </a>
<a name="ln362">    if (ACPI_GPE_DISPATCH_TYPE (GpeEventInfo-&gt;Flags) !=</a>
<a name="ln363">        ACPI_GPE_DISPATCH_NONE)</a>
<a name="ln364">    {</a>
<a name="ln365">        LocalEventStatus |= ACPI_EVENT_FLAG_HAS_HANDLER;</a>
<a name="ln366">    }</a>
<a name="ln367"> </a>
<a name="ln368">    /* Get the info block for the entire GPE register */</a>
<a name="ln369"> </a>
<a name="ln370">    GpeRegisterInfo = GpeEventInfo-&gt;RegisterInfo;</a>
<a name="ln371"> </a>
<a name="ln372">    /* Get the register bitmask for this GPE */</a>
<a name="ln373"> </a>
<a name="ln374">    RegisterBit = AcpiHwGetGpeRegisterBit (GpeEventInfo);</a>
<a name="ln375"> </a>
<a name="ln376">    /* GPE currently enabled? (enabled for runtime?) */</a>
<a name="ln377"> </a>
<a name="ln378">    if (RegisterBit &amp; GpeRegisterInfo-&gt;EnableForRun)</a>
<a name="ln379">    {</a>
<a name="ln380">        LocalEventStatus |= ACPI_EVENT_FLAG_ENABLED;</a>
<a name="ln381">    }</a>
<a name="ln382"> </a>
<a name="ln383">    /* GPE currently masked? (masked for runtime?) */</a>
<a name="ln384"> </a>
<a name="ln385">    if (RegisterBit &amp; GpeRegisterInfo-&gt;MaskForRun)</a>
<a name="ln386">    {</a>
<a name="ln387">        LocalEventStatus |= ACPI_EVENT_FLAG_MASKED;</a>
<a name="ln388">    }</a>
<a name="ln389"> </a>
<a name="ln390">    /* GPE enabled for wake? */</a>
<a name="ln391"> </a>
<a name="ln392">    if (RegisterBit &amp; GpeRegisterInfo-&gt;EnableForWake)</a>
<a name="ln393">    {</a>
<a name="ln394">        LocalEventStatus |= ACPI_EVENT_FLAG_WAKE_ENABLED;</a>
<a name="ln395">    }</a>
<a name="ln396"> </a>
<a name="ln397">    /* GPE currently enabled (enable bit == 1)? */</a>
<a name="ln398"> </a>
<a name="ln399">    Status = AcpiHwRead (&amp;InByte, &amp;GpeRegisterInfo-&gt;EnableAddress);</a>
<a name="ln400">    if (ACPI_FAILURE (Status))</a>
<a name="ln401">    {</a>
<a name="ln402">        return (Status);</a>
<a name="ln403">    }</a>
<a name="ln404"> </a>
<a name="ln405">    if (RegisterBit &amp; InByte)</a>
<a name="ln406">    {</a>
<a name="ln407">        LocalEventStatus |= ACPI_EVENT_FLAG_ENABLE_SET;</a>
<a name="ln408">    }</a>
<a name="ln409"> </a>
<a name="ln410">    /* GPE currently active (status bit == 1)? */</a>
<a name="ln411"> </a>
<a name="ln412">    Status = AcpiHwRead (&amp;InByte, &amp;GpeRegisterInfo-&gt;StatusAddress);</a>
<a name="ln413">    if (ACPI_FAILURE (Status))</a>
<a name="ln414">    {</a>
<a name="ln415">        return (Status);</a>
<a name="ln416">    }</a>
<a name="ln417"> </a>
<a name="ln418">    if (RegisterBit &amp; InByte)</a>
<a name="ln419">    {</a>
<a name="ln420">        LocalEventStatus |= ACPI_EVENT_FLAG_STATUS_SET;</a>
<a name="ln421">    }</a>
<a name="ln422"> </a>
<a name="ln423">    /* Set return value */</a>
<a name="ln424"> </a>
<a name="ln425">    (*EventStatus) = LocalEventStatus;</a>
<a name="ln426">    return (AE_OK);</a>
<a name="ln427">}</a>
<a name="ln428"> </a>
<a name="ln429"> </a>
<a name="ln430">/******************************************************************************</a>
<a name="ln431"> *</a>
<a name="ln432"> * FUNCTION:    AcpiHwGpeEnableWrite</a>
<a name="ln433"> *</a>
<a name="ln434"> * PARAMETERS:  EnableMask          - Bit mask to write to the GPE register</a>
<a name="ln435"> *              GpeRegisterInfo     - Gpe Register info</a>
<a name="ln436"> *</a>
<a name="ln437"> * RETURN:      Status</a>
<a name="ln438"> *</a>
<a name="ln439"> * DESCRIPTION: Write the enable mask byte to the given GPE register.</a>
<a name="ln440"> *</a>
<a name="ln441"> ******************************************************************************/</a>
<a name="ln442"> </a>
<a name="ln443">static ACPI_STATUS</a>
<a name="ln444">AcpiHwGpeEnableWrite (</a>
<a name="ln445">    UINT8                   EnableMask,</a>
<a name="ln446">    ACPI_GPE_REGISTER_INFO  *GpeRegisterInfo)</a>
<a name="ln447">{</a>
<a name="ln448">    ACPI_STATUS             Status;</a>
<a name="ln449"> </a>
<a name="ln450"> </a>
<a name="ln451">    GpeRegisterInfo-&gt;EnableMask = EnableMask;</a>
<a name="ln452"> </a>
<a name="ln453">    Status = AcpiHwWrite (EnableMask, &amp;GpeRegisterInfo-&gt;EnableAddress);</a>
<a name="ln454">    return (Status);</a>
<a name="ln455">}</a>
<a name="ln456"> </a>
<a name="ln457"> </a>
<a name="ln458">/******************************************************************************</a>
<a name="ln459"> *</a>
<a name="ln460"> * FUNCTION:    AcpiHwDisableGpeBlock</a>
<a name="ln461"> *</a>
<a name="ln462"> * PARAMETERS:  GpeXruptInfo        - GPE Interrupt info</a>
<a name="ln463"> *              GpeBlock            - Gpe Block info</a>
<a name="ln464"> *</a>
<a name="ln465"> * RETURN:      Status</a>
<a name="ln466"> *</a>
<a name="ln467"> * DESCRIPTION: Disable all GPEs within a single GPE block</a>
<a name="ln468"> *</a>
<a name="ln469"> ******************************************************************************/</a>
<a name="ln470"> </a>
<a name="ln471">ACPI_STATUS</a>
<a name="ln472">AcpiHwDisableGpeBlock (</a>
<a name="ln473">    ACPI_GPE_XRUPT_INFO     *GpeXruptInfo,</a>
<a name="ln474">    ACPI_GPE_BLOCK_INFO     *GpeBlock,</a>
<a name="ln475">    void                    *Context)</a>
<a name="ln476">{</a>
<a name="ln477">    UINT32                  i;</a>
<a name="ln478">    ACPI_STATUS             Status;</a>
<a name="ln479"> </a>
<a name="ln480"> </a>
<a name="ln481">    /* Examine each GPE Register within the block */</a>
<a name="ln482"> </a>
<a name="ln483">    for (i = 0; i &lt; GpeBlock-&gt;RegisterCount; i++)</a>
<a name="ln484">    {</a>
<a name="ln485">        /* Disable all GPEs in this register */</a>
<a name="ln486"> </a>
<a name="ln487">        Status = AcpiHwGpeEnableWrite (0x00, &amp;GpeBlock-&gt;RegisterInfo[i]);</a>
<a name="ln488">        if (ACPI_FAILURE (Status))</a>
<a name="ln489">        {</a>
<a name="ln490">            return (Status);</a>
<a name="ln491">        }</a>
<a name="ln492">    }</a>
<a name="ln493"> </a>
<a name="ln494">    return (AE_OK);</a>
<a name="ln495">}</a>
<a name="ln496"> </a>
<a name="ln497"> </a>
<a name="ln498">/******************************************************************************</a>
<a name="ln499"> *</a>
<a name="ln500"> * FUNCTION:    AcpiHwClearGpeBlock</a>
<a name="ln501"> *</a>
<a name="ln502"> * PARAMETERS:  GpeXruptInfo        - GPE Interrupt info</a>
<a name="ln503"> *              GpeBlock            - Gpe Block info</a>
<a name="ln504"> *</a>
<a name="ln505"> * RETURN:      Status</a>
<a name="ln506"> *</a>
<a name="ln507"> * DESCRIPTION: Clear status bits for all GPEs within a single GPE block</a>
<a name="ln508"> *</a>
<a name="ln509"> ******************************************************************************/</a>
<a name="ln510"> </a>
<a name="ln511">ACPI_STATUS</a>
<a name="ln512">AcpiHwClearGpeBlock (</a>
<a name="ln513">    ACPI_GPE_XRUPT_INFO     *GpeXruptInfo,</a>
<a name="ln514">    ACPI_GPE_BLOCK_INFO     *GpeBlock,</a>
<a name="ln515">    void                    *Context)</a>
<a name="ln516">{</a>
<a name="ln517">    UINT32                  i;</a>
<a name="ln518">    ACPI_STATUS             Status;</a>
<a name="ln519"> </a>
<a name="ln520"> </a>
<a name="ln521">    /* Examine each GPE Register within the block */</a>
<a name="ln522"> </a>
<a name="ln523">    for (i = 0; i &lt; GpeBlock-&gt;RegisterCount; i++)</a>
<a name="ln524">    {</a>
<a name="ln525">        /* Clear status on all GPEs in this register */</a>
<a name="ln526"> </a>
<a name="ln527">        Status = AcpiHwWrite (0xFF, &amp;GpeBlock-&gt;RegisterInfo[i].StatusAddress);</a>
<a name="ln528">        if (ACPI_FAILURE (Status))</a>
<a name="ln529">        {</a>
<a name="ln530">            return (Status);</a>
<a name="ln531">        }</a>
<a name="ln532">    }</a>
<a name="ln533"> </a>
<a name="ln534">    return (AE_OK);</a>
<a name="ln535">}</a>
<a name="ln536"> </a>
<a name="ln537"> </a>
<a name="ln538">/******************************************************************************</a>
<a name="ln539"> *</a>
<a name="ln540"> * FUNCTION:    AcpiHwEnableRuntimeGpeBlock</a>
<a name="ln541"> *</a>
<a name="ln542"> * PARAMETERS:  GpeXruptInfo        - GPE Interrupt info</a>
<a name="ln543"> *              GpeBlock            - Gpe Block info</a>
<a name="ln544"> *</a>
<a name="ln545"> * RETURN:      Status</a>
<a name="ln546"> *</a>
<a name="ln547"> * DESCRIPTION: Enable all &quot;runtime&quot; GPEs within a single GPE block. Includes</a>
<a name="ln548"> *              combination wake/run GPEs.</a>
<a name="ln549"> *</a>
<a name="ln550"> ******************************************************************************/</a>
<a name="ln551"> </a>
<a name="ln552">ACPI_STATUS</a>
<a name="ln553">AcpiHwEnableRuntimeGpeBlock (</a>
<a name="ln554">    ACPI_GPE_XRUPT_INFO     *GpeXruptInfo,</a>
<a name="ln555">    ACPI_GPE_BLOCK_INFO     *GpeBlock,</a>
<a name="ln556">    void                    *Context)</a>
<a name="ln557">{</a>
<a name="ln558">    UINT32                  i;</a>
<a name="ln559">    ACPI_STATUS             Status;</a>
<a name="ln560">    ACPI_GPE_REGISTER_INFO  *GpeRegisterInfo;</a>
<a name="ln561">    UINT8                   EnableMask;</a>
<a name="ln562"> </a>
<a name="ln563"> </a>
<a name="ln564">    /* NOTE: assumes that all GPEs are currently disabled */</a>
<a name="ln565"> </a>
<a name="ln566">    /* Examine each GPE Register within the block */</a>
<a name="ln567"> </a>
<a name="ln568">    for (i = 0; i &lt; GpeBlock-&gt;RegisterCount; i++)</a>
<a name="ln569">    {</a>
<a name="ln570">        GpeRegisterInfo = &amp;GpeBlock-&gt;RegisterInfo[i];</a>
<a name="ln571">        if (!GpeRegisterInfo-&gt;EnableForRun)</a>
<a name="ln572">        {</a>
<a name="ln573">            continue;</a>
<a name="ln574">        }</a>
<a name="ln575"> </a>
<a name="ln576">        /* Enable all &quot;runtime&quot; GPEs in this register */</a>
<a name="ln577"> </a>
<a name="ln578">        EnableMask = GpeRegisterInfo-&gt;EnableForRun &amp;</a>
<a name="ln579">            ~GpeRegisterInfo-&gt;MaskForRun;</a>
<a name="ln580">        Status = AcpiHwGpeEnableWrite (EnableMask, GpeRegisterInfo);</a>
<a name="ln581">        if (ACPI_FAILURE (Status))</a>
<a name="ln582">        {</a>
<a name="ln583">            return (Status);</a>
<a name="ln584">        }</a>
<a name="ln585">    }</a>
<a name="ln586"> </a>
<a name="ln587">    return (AE_OK);</a>
<a name="ln588">}</a>
<a name="ln589"> </a>
<a name="ln590"> </a>
<a name="ln591">/******************************************************************************</a>
<a name="ln592"> *</a>
<a name="ln593"> * FUNCTION:    AcpiHwEnableWakeupGpeBlock</a>
<a name="ln594"> *</a>
<a name="ln595"> * PARAMETERS:  GpeXruptInfo        - GPE Interrupt info</a>
<a name="ln596"> *              GpeBlock            - Gpe Block info</a>
<a name="ln597"> *</a>
<a name="ln598"> * RETURN:      Status</a>
<a name="ln599"> *</a>
<a name="ln600"> * DESCRIPTION: Enable all &quot;wake&quot; GPEs within a single GPE block. Includes</a>
<a name="ln601"> *              combination wake/run GPEs.</a>
<a name="ln602"> *</a>
<a name="ln603"> ******************************************************************************/</a>
<a name="ln604"> </a>
<a name="ln605">static ACPI_STATUS</a>
<a name="ln606">AcpiHwEnableWakeupGpeBlock (</a>
<a name="ln607">    ACPI_GPE_XRUPT_INFO     *GpeXruptInfo,</a>
<a name="ln608">    ACPI_GPE_BLOCK_INFO     *GpeBlock,</a>
<a name="ln609">    void                    *Context)</a>
<a name="ln610">{</a>
<a name="ln611">    UINT32                  i;</a>
<a name="ln612">    ACPI_STATUS             Status;</a>
<a name="ln613">    ACPI_GPE_REGISTER_INFO  *GpeRegisterInfo;</a>
<a name="ln614"> </a>
<a name="ln615"> </a>
<a name="ln616">    /* Examine each GPE Register within the block */</a>
<a name="ln617"> </a>
<a name="ln618">    for (i = 0; i &lt; GpeBlock-&gt;RegisterCount; i++)</a>
<a name="ln619">    {</a>
<a name="ln620">        GpeRegisterInfo = &amp;GpeBlock-&gt;RegisterInfo[i];</a>
<a name="ln621"> </a>
<a name="ln622">        /*</a>
<a name="ln623">         * Enable all &quot;wake&quot; GPEs in this register and disable the</a>
<a name="ln624">         * remaining ones.</a>
<a name="ln625">         */</a>
<a name="ln626">        Status = AcpiHwGpeEnableWrite (GpeRegisterInfo-&gt;EnableForWake,</a>
<a name="ln627">            GpeRegisterInfo);</a>
<a name="ln628">        if (ACPI_FAILURE (Status))</a>
<a name="ln629">        {</a>
<a name="ln630">            return (Status);</a>
<a name="ln631">        }</a>
<a name="ln632">    }</a>
<a name="ln633"> </a>
<a name="ln634">    return (AE_OK);</a>
<a name="ln635">}</a>
<a name="ln636"> </a>
<a name="ln637"> </a>
<a name="ln638">/******************************************************************************</a>
<a name="ln639"> *</a>
<a name="ln640"> * FUNCTION:    AcpiHwDisableAllGpes</a>
<a name="ln641"> *</a>
<a name="ln642"> * PARAMETERS:  None</a>
<a name="ln643"> *</a>
<a name="ln644"> * RETURN:      Status</a>
<a name="ln645"> *</a>
<a name="ln646"> * DESCRIPTION: Disable and clear all GPEs in all GPE blocks</a>
<a name="ln647"> *</a>
<a name="ln648"> ******************************************************************************/</a>
<a name="ln649"> </a>
<a name="ln650">ACPI_STATUS</a>
<a name="ln651">AcpiHwDisableAllGpes (</a>
<a name="ln652">    void)</a>
<a name="ln653">{</a>
<a name="ln654">    ACPI_STATUS             Status;</a>
<a name="ln655"> </a>
<a name="ln656"> </a>
<a name="ln657">    ACPI_FUNCTION_TRACE (HwDisableAllGpes);</a>
<a name="ln658"> </a>
<a name="ln659"> </a>
<a name="ln660">    Status = AcpiEvWalkGpeList (AcpiHwDisableGpeBlock, NULL);</a>
<a name="ln661">    return_ACPI_STATUS (Status);</a>
<a name="ln662">}</a>
<a name="ln663"> </a>
<a name="ln664"> </a>
<a name="ln665">/******************************************************************************</a>
<a name="ln666"> *</a>
<a name="ln667"> * FUNCTION:    AcpiHwEnableAllRuntimeGpes</a>
<a name="ln668"> *</a>
<a name="ln669"> * PARAMETERS:  None</a>
<a name="ln670"> *</a>
<a name="ln671"> * RETURN:      Status</a>
<a name="ln672"> *</a>
<a name="ln673"> * DESCRIPTION: Enable all &quot;runtime&quot; GPEs, in all GPE blocks</a>
<a name="ln674"> *</a>
<a name="ln675"> ******************************************************************************/</a>
<a name="ln676"> </a>
<a name="ln677">ACPI_STATUS</a>
<a name="ln678">AcpiHwEnableAllRuntimeGpes (</a>
<a name="ln679">    void)</a>
<a name="ln680">{</a>
<a name="ln681">    ACPI_STATUS             Status;</a>
<a name="ln682"> </a>
<a name="ln683"> </a>
<a name="ln684">    ACPI_FUNCTION_TRACE (HwEnableAllRuntimeGpes);</a>
<a name="ln685"> </a>
<a name="ln686"> </a>
<a name="ln687">    Status = AcpiEvWalkGpeList (AcpiHwEnableRuntimeGpeBlock, NULL);</a>
<a name="ln688">    return_ACPI_STATUS (Status);</a>
<a name="ln689">}</a>
<a name="ln690"> </a>
<a name="ln691"> </a>
<a name="ln692">/******************************************************************************</a>
<a name="ln693"> *</a>
<a name="ln694"> * FUNCTION:    AcpiHwEnableAllWakeupGpes</a>
<a name="ln695"> *</a>
<a name="ln696"> * PARAMETERS:  None</a>
<a name="ln697"> *</a>
<a name="ln698"> * RETURN:      Status</a>
<a name="ln699"> *</a>
<a name="ln700"> * DESCRIPTION: Enable all &quot;wakeup&quot; GPEs, in all GPE blocks</a>
<a name="ln701"> *</a>
<a name="ln702"> ******************************************************************************/</a>
<a name="ln703"> </a>
<a name="ln704">ACPI_STATUS</a>
<a name="ln705">AcpiHwEnableAllWakeupGpes (</a>
<a name="ln706">    void)</a>
<a name="ln707">{</a>
<a name="ln708">    ACPI_STATUS             Status;</a>
<a name="ln709"> </a>
<a name="ln710"> </a>
<a name="ln711">    ACPI_FUNCTION_TRACE (HwEnableAllWakeupGpes);</a>
<a name="ln712"> </a>
<a name="ln713"> </a>
<a name="ln714">    Status = AcpiEvWalkGpeList (AcpiHwEnableWakeupGpeBlock, NULL);</a>
<a name="ln715">    return_ACPI_STATUS (Status);</a>
<a name="ln716">}</a>
<a name="ln717"> </a>
<a name="ln718">#endif /* !ACPI_REDUCED_HARDWARE */</a>

</code></pre>
<div class="balloon" rel="266"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v784/" target="_blank">V784</a> The size of the bit mask is less than the size of the first operand. This will cause the loss of higher bits.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
