
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>TabletDevice.cpp</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2"> * Copyright 2003-2008 Stephan AÃŸmus &lt;superstippi@gmx.de&gt;. All rights reserved.</a>
<a name="ln3"> * Distributed under the terms of the MIT license.</a>
<a name="ln4"> *</a>
<a name="ln5"> * Copyright 2000-2002  Olaf van Es. All Rights Reserved.</a>
<a name="ln6"> * Distributed under the terms of the MIT license.</a>
<a name="ln7"> *</a>
<a name="ln8"> * These people have added and tested device ids:</a>
<a name="ln9"> *</a>
<a name="ln10"> *		Frans van Nispen	&lt;frans@xentronix.com&gt;</a>
<a name="ln11"> *		Stefan Werner		&lt;stefan@keindesign.de&gt;</a>
<a name="ln12"> *		Hiroyuki Tsutsumi	&lt;???&gt;</a>
<a name="ln13"> *		Jeroen Oortwijn		&lt;oortwijn@gmail.com&gt;</a>
<a name="ln14"> * 		Calvin Hill			&lt;calvin@hakobaito.co.uk&gt;</a>
<a name="ln15"> */</a>
<a name="ln16"> </a>
<a name="ln17">#include &lt;stdio.h&gt;</a>
<a name="ln18">#include &lt;stdlib.h&gt;</a>
<a name="ln19">#include &lt;string.h&gt;</a>
<a name="ln20"> </a>
<a name="ln21">#include &lt;File.h&gt;</a>
<a name="ln22">#include &lt;InterfaceDefs.h&gt;</a>
<a name="ln23">#include &lt;Screen.h&gt;</a>
<a name="ln24">#include &lt;View.h&gt;</a>
<a name="ln25"> </a>
<a name="ln26">#include &quot;DeviceReader.h&quot;</a>
<a name="ln27">#include &quot;MasterServerDevice.h&quot;</a>
<a name="ln28"> </a>
<a name="ln29">#include &quot;TabletDevice.h&quot;</a>
<a name="ln30"> </a>
<a name="ln31">#define SNOOZE_AMOUNT 2500</a>
<a name="ln32">#define JITTER_X .0007</a>
<a name="ln33">#define JITTER_Y .0007</a>
<a name="ln34">#define ACCELERATION_KICK_IN 2.3</a>
<a name="ln35"> </a>
<a name="ln36">// constructor</a>
<a name="ln37">TabletDevice::TabletDevice(MasterServerDevice* parent, DeviceReader* reader)</a>
<a name="ln38">	: PointingDevice(parent, reader),</a>
<a name="ln39">	  fThreadID(B_ERROR),</a>
<a name="ln40">	  fDeviceMode(DEVICE_UNKOWN),</a>
<a name="ln41">	  fMaxX(1.0),</a>
<a name="ln42">	  fMaxY(1.0),</a>
<a name="ln43">	  fPosX(0.5),</a>
<a name="ln44">	  fPosY(0.5),</a>
<a name="ln45">	  fFakeMouseX(0.5),</a>
<a name="ln46">	  fFakeMouseY(0.5),</a>
<a name="ln47">	  fButtons(0),</a>
<a name="ln48">	  fPressure(0.0),</a>
<a name="ln49">	  fModifiers(0),</a>
<a name="ln50">	  fEraser(0),</a>
<a name="ln51">	  fTiltX(0.0),</a>
<a name="ln52">	  fTiltY(0.0),</a>
<a name="ln53">	  fClicks(0),</a>
<a name="ln54">	  fHasContact(false)</a>
<a name="ln55">{</a>
<a name="ln56">}</a>
<a name="ln57"> </a>
<a name="ln58">// destructor</a>
<a name="ln59">TabletDevice::~TabletDevice()</a>
<a name="ln60">{</a>
<a name="ln61">	// cleanup</a>
<a name="ln62">	Stop();</a>
<a name="ln63">}</a>
<a name="ln64"> </a>
<a name="ln65">// InitCheck</a>
<a name="ln66">status_t</a>
<a name="ln67">TabletDevice::InitCheck()</a>
<a name="ln68">{</a>
<a name="ln69">	status_t status = PointingDevice::InitCheck();</a>
<a name="ln70">	if (status &gt;= B_OK)</a>
<a name="ln71">		status = DetectDevice(fReader);</a>
<a name="ln72">	return status;</a>
<a name="ln73">}</a>
<a name="ln74"> </a>
<a name="ln75">// Start</a>
<a name="ln76">status_t</a>
<a name="ln77">TabletDevice::Start()</a>
<a name="ln78">{</a>
<a name="ln79">	status_t status = B_NO_INIT;</a>
<a name="ln80">	if (fReader) {</a>
<a name="ln81">		fActive = true;</a>
<a name="ln82">		// get a nice name for our polling thread</a>
<a name="ln83">		const char* name;</a>
<a name="ln84">		_GetName(fReader-&gt;ProductID(), &amp;name);</a>
<a name="ln85">		// start generating events</a>
<a name="ln86">		fThreadID = spawn_thread(poll_usb_device, name, 104, this);</a>
<a name="ln87">		if (fThreadID &gt;= B_OK) {</a>
<a name="ln88">			resume_thread(fThreadID);</a>
<a name="ln89">			status = B_OK;</a>
<a name="ln90">		} else</a>
<a name="ln91">			status = fThreadID;</a>
<a name="ln92">	}</a>
<a name="ln93">	return status;</a>
<a name="ln94">}</a>
<a name="ln95"> </a>
<a name="ln96">// Stop</a>
<a name="ln97">status_t</a>
<a name="ln98">TabletDevice::Stop()</a>
<a name="ln99">{</a>
<a name="ln100">	status_t err = B_OK;</a>
<a name="ln101"> </a>
<a name="ln102">	fActive = false;</a>
<a name="ln103">	if (fThreadID &gt;= B_OK)</a>
<a name="ln104">		wait_for_thread(fThreadID, &amp;err);</a>
<a name="ln105">	fThreadID = B_ERROR;</a>
<a name="ln106"> </a>
<a name="ln107">	return err;</a>
<a name="ln108">}</a>
<a name="ln109"> </a>
<a name="ln110">// DetectDevice</a>
<a name="ln111">status_t</a>
<a name="ln112">TabletDevice::DetectDevice(const DeviceReader* reader)</a>
<a name="ln113">{</a>
<a name="ln114">	status_t status = B_OK;</a>
<a name="ln115">	switch (reader-&gt;ProductID()) {</a>
<a name="ln116">		case 0x00:</a>
<a name="ln117">			SetDevice(5040.0, 3780.0, DEVICE_PENPARTNER);</a>
<a name="ln118">			break;</a>
<a name="ln119">		case 0x03:</a>
<a name="ln120">			SetDevice(2048.0, 15360.0, DEVICE_PL500);</a>
<a name="ln121">			break;</a>
<a name="ln122">		case 0x10:</a>
<a name="ln123">		case 0x11:</a>
<a name="ln124">		case 0x13:</a>
<a name="ln125">			SetDevice(10206.0, 7422.0, DEVICE_GRAPHIRE);</a>
<a name="ln126">			break;</a>
<a name="ln127">		case 0x12:	// Graphire 3 4x5</a>
<a name="ln128">			SetDevice(13918.0, 10206.0, DEVICE_GRAPHIRE);</a>
<a name="ln129">			break;</a>
<a name="ln130">		case 0x14:	// Graphire 3 6x8</a>
<a name="ln131">			SetDevice(16704.0, 12064.0, DEVICE_GRAPHIRE);</a>
<a name="ln132">			break;</a>
<a name="ln133">		case 0x15:	// Graphire 4 4x5 (tested)</a>
<a name="ln134">			SetDevice(10208.0, 7024.0, DEVICE_GRAPHIRE);</a>
<a name="ln135">			break;</a>
<a name="ln136">		case 0x16:	// Graphire 4 6x8 (tested)</a>
<a name="ln137">			SetDevice(16704.0, 12064.0, DEVICE_GRAPHIRE);</a>
<a name="ln138">			break;</a>
<a name="ln139">		case 0x17:	// BambooFun 4x5 (from Linux Wacom Project)</a>
<a name="ln140">			SetDevice(14760.0, 9225.0, DEVICE_BAMBOO);</a>
<a name="ln141">			break;</a>
<a name="ln142">		case 0x18:	// BambooFun 6x8 (from Linux Wacom Project)</a>
<a name="ln143">			SetDevice(21648.0, 13530.0, DEVICE_BAMBOO);</a>
<a name="ln144">			break;</a>
<a name="ln145">		case 0x20:</a>
<a name="ln146">			SetDevice(12700.0, 10600.0, DEVICE_INTUOS);</a>
<a name="ln147">			break;</a>
<a name="ln148">		case 0x21:</a>
<a name="ln149">			SetDevice(20320.0, 16240.0);</a>
<a name="ln150">			break;</a>
<a name="ln151">		case 0x22:</a>
<a name="ln152">			SetDevice(30480.0, 24060.0);</a>
<a name="ln153">			break;</a>
<a name="ln154">		case 0x23:</a>
<a name="ln155">			SetDevice(30480.0, 31680.0);</a>
<a name="ln156">			break;</a>
<a name="ln157">		case 0x24:</a>
<a name="ln158">			SetDevice(45720.0, 31680.0);</a>
<a name="ln159">			break;</a>
<a name="ln160">		case 0x30:</a>
<a name="ln161">			SetDevice(5408.0, 4056.0, DEVICE_PL500);</a>
<a name="ln162">			break;</a>
<a name="ln163">		case 0x31:</a>
<a name="ln164">			SetDevice(6144.0, 4608.0, DEVICE_PL500);</a>
<a name="ln165">			break;</a>
<a name="ln166">		case 0x32:</a>
<a name="ln167">			SetDevice(6126.0, 4604.0, DEVICE_PL500);</a>
<a name="ln168">			break;</a>
<a name="ln169">		case 0x33:</a>
<a name="ln170">			SetDevice(6260.0, 5016.0, DEVICE_PL500);</a>
<a name="ln171">			break;</a>
<a name="ln172">		case 0x34:</a>
<a name="ln173">			SetDevice(6144.0, 4608.0, DEVICE_PL500);</a>
<a name="ln174">			break;</a>
<a name="ln175">		case 0x35:</a>
<a name="ln176">			SetDevice(7220.0, 5780.0, DEVICE_PL500);</a>
<a name="ln177">			break;</a>
<a name="ln178">		case 0x3F:</a>
<a name="ln179">			SetDevice(87200.0, 65600.0, DEVICE_CINTIQ);</a>
<a name="ln180">			break;</a>
<a name="ln181">		case 0x41:</a>
<a name="ln182">			SetDevice(12700.0, 10600.0);</a>
<a name="ln183">			break;</a>
<a name="ln184">		case 0x42:</a>
<a name="ln185">			SetDevice(20320.0, 16240.0);</a>
<a name="ln186">			break;</a>
<a name="ln187">		case 0x43:</a>
<a name="ln188">			SetDevice(30480.0, 24060.0);</a>
<a name="ln189">			break;</a>
<a name="ln190">		case 0x44:</a>
<a name="ln191">			SetDevice(30480.0, 31680.0);</a>
<a name="ln192">			break;</a>
<a name="ln193">		case 0x45:</a>
<a name="ln194">			SetDevice(45720.0, 31680.0);</a>
<a name="ln195">			break;</a>
<a name="ln196">		case 0x47:	// some I2 6x8 report as 0x47</a>
<a name="ln197">			SetDevice(20320.0, 16240.0);</a>
<a name="ln198">			break;</a>
<a name="ln199">		case 0x60:</a>
<a name="ln200">			SetDevice(5104.0, 3712.0, DEVICE_GRAPHIRE);</a>
<a name="ln201">			break;</a>
<a name="ln202">		case 0x61: // PenStation</a>
<a name="ln203">//			SetDevice(3403.0, 2475.0, DEVICE_GRAPHIRE); // this version was untested</a>
<a name="ln204">			SetDevice(3248.0, 2320.0, DEVICE_PENSTATION); // this version came from &quot;beer&quot;</a>
<a name="ln205">			break;</a>
<a name="ln206">		case 0x62: // Volito</a>
<a name="ln207">			SetDevice(5040.0, 3712.0, DEVICE_VOLITO);</a>
<a name="ln208">			break;</a>
<a name="ln209">		case 0x64:	// PenPartner.1</a>
<a name="ln210">//			SetDevice(3450.0, 2100.0, DEVICE_PENSTATION);</a>
<a name="ln211">			SetDevice(3248.0, 2320.0, DEVICE_PENSTATION);</a>
<a name="ln212">			break;</a>
<a name="ln213">		case 0x65:	// Bamboo (from Linux Wacom Project)</a>
<a name="ln214">			SetDevice(14760.0, 9225.0, DEVICE_BAMBOO);</a>
<a name="ln215">			break;</a>
<a name="ln216">		case 0x69:	// Bamboo1 (from Linux Wacom Project)</a>
<a name="ln217">			SetDevice(5104.0,  3712.0, DEVICE_BAMBOO);</a>
<a name="ln218">			break;</a>
<a name="ln219">		case 0xB0:</a>
<a name="ln220">			SetDevice(25400.0, 20320.0, DEVICE_INTUOS3);</a>
<a name="ln221">			break;</a>
<a name="ln222">		case 0xB1:</a>
<a name="ln223">			SetDevice(40640.0, 30480.0, DEVICE_INTUOS3);</a>
<a name="ln224">			break;</a>
<a name="ln225">		case 0xB2:</a>
<a name="ln226">			SetDevice(60960.0, 45720.0, DEVICE_INTUOS3);</a>
<a name="ln227">			break;</a>
<a name="ln228">		case 0xD0:	// Wacom Bamboo 2FG (from Linux Wacom Project)</a>
<a name="ln229">			SetDevice(14720.0, 9200.0, DEVICE_BAMBOO_PT);</a>
<a name="ln230">			break;</a>
<a name="ln231">		case 0xD1:	// Wacom BambooFun 2FG 4x5 (from Linux Wacom Project)</a>
<a name="ln232">			SetDevice(14720.0, 9200.0, DEVICE_BAMBOO_PT);</a>
<a name="ln233">			break;</a>
<a name="ln234">		case 0xD2:	// Wacom Bamboo Craft (from Linux Wacom Project)</a>
<a name="ln235">			SetDevice(14720.0, 9200.0, DEVICE_BAMBOO_PT);</a>
<a name="ln236">			break;</a>
<a name="ln237">		case 0xD3:	// Wacom BambooFun 2FG 6x8 (from Linux Wacom Project)</a>
<a name="ln238">			SetDevice(21648.0, 13530.0, DEVICE_BAMBOO_PT);</a>
<a name="ln239">			break;</a>
<a name="ln240">		case 0xD4:	// Wacom Bamboo 4x5 (from Linux Wacom Project)</a>
<a name="ln241">			SetDevice(14720.0, 9200.0, DEVICE_BAMBOO_PT);</a>
<a name="ln242">			break;</a>
<a name="ln243">		case 0xD6:	// Wacom Bamboo CTH-460/K (from Linux Wacom Project)</a>
<a name="ln244">			SetDevice(14720.0, 9200.0, DEVICE_BAMBOO_PT);</a>
<a name="ln245">			break;</a>
<a name="ln246">		case 0xD7:	// Wacom Bamboo CTH-461/S (from Linux Wacom Project)</a>
<a name="ln247">			SetDevice(14720.0, 9200.0, DEVICE_BAMBOO_PT);</a>
<a name="ln248">			break;</a>
<a name="ln249">		case 0xD8:	// Wacom Bamboo CTH-661/S1 (from Linux Wacom Project)</a>
<a name="ln250">			SetDevice(21648.0, 13530.0, DEVICE_BAMBOO_PT);</a>
<a name="ln251">			break;</a>
<a name="ln252">		case 0xDA:	// Wacom Bamboo CTH-461/L (from Linux Wacom Project)</a>
<a name="ln253">			SetDevice(14720.0, 9200.0, DEVICE_BAMBOO_PT);</a>
<a name="ln254">			break;</a>
<a name="ln255">		case 0xDB:	// Wacom Bamboo CTH-661 (from Linux Wacom Project)</a>
<a name="ln256">			SetDevice(21648.0, 13530.0, DEVICE_BAMBOO_PT);</a>
<a name="ln257">			break;</a>
<a name="ln258">		case 0xDD:	// Wacom Bamboo Pen/Connect (CTL-470) (from Linux Wacom Project)</a>
<a name="ln259">			SetDevice(14720.0, 9200.0, DEVICE_BAMBOO_PT);</a>
<a name="ln260">			break;</a>
<a name="ln261">		default:</a>
<a name="ln262">			status = B_BAD_VALUE;</a>
<a name="ln263">			break;</a>
<a name="ln264">	}</a>
<a name="ln265">	return status;</a>
<a name="ln266">}</a>
<a name="ln267"> </a>
<a name="ln268">// SetDevice</a>
<a name="ln269">void</a>
<a name="ln270">TabletDevice::SetDevice(float maxX, float maxY, uint32 mode)</a>
<a name="ln271">{</a>
<a name="ln272">	fDeviceMode = mode;</a>
<a name="ln273">	fMaxX = maxX;</a>
<a name="ln274">	fMaxY = maxY;</a>
<a name="ln275">	fJitterX = JITTER_X;</a>
<a name="ln276">	fJitterY = JITTER_Y;</a>
<a name="ln277">}</a>
<a name="ln278"> </a>
<a name="ln279">// ReadData</a>
<a name="ln280">void</a>
<a name="ln281">TabletDevice::ReadData(const uchar* data, int dataBytes, bool&amp; hasContact,</a>
<a name="ln282">	uint32&amp; mode, uint32&amp; buttons, float&amp; x, float&amp; y, float&amp; pressure,</a>
<a name="ln283">	int32&amp; clicks, int32&amp; eraser, float&amp; wheelX, float&amp; wheelY,</a>
<a name="ln284">	float&amp; tiltX, float&amp; tiltY) const</a>
<a name="ln285">{</a>
<a name="ln286">	hasContact = false;</a>
<a name="ln287">	buttons = 0;</a>
<a name="ln288">	mode = MODE_PEN;</a>
<a name="ln289">	bool firstButton = false;</a>
<a name="ln290">	bool secondButton = false;</a>
<a name="ln291">	bool thirdButton = false;</a>
<a name="ln292">	uint16 xPos = 0;</a>
<a name="ln293">	uint16 yPos = 0;</a>
<a name="ln294"> </a>
<a name="ln295">	switch (fDeviceMode) {</a>
<a name="ln296">		case DEVICE_PENPARTNER: {</a>
<a name="ln297">			xPos = data[2] &lt;&lt; 8 | data[1];</a>
<a name="ln298">			yPos = data[4] &lt;&lt; 8 | data[3];</a>
<a name="ln299"> </a>
<a name="ln300">			eraser = (data[5] &amp; 0x20);</a>
<a name="ln301"> </a>
<a name="ln302">			int8 pressureData = data[6];</a>
<a name="ln303">			pressure = (float)(pressureData + 120) / 240.0;</a>
<a name="ln304"> </a>
<a name="ln305">			firstButton = ((pressureData &gt; -80) &amp;&amp; !(data[5] &amp; 0x20));</a>
<a name="ln306">			secondButton = (data[5] &amp; 0x40);</a>
<a name="ln307"> </a>
<a name="ln308">			hasContact = true;</a>
<a name="ln309">			break;</a>
<a name="ln310">		}</a>
<a name="ln311">		case DEVICE_GRAPHIRE:</a>
<a name="ln312">		case DEVICE_BAMBOO:</a>
<a name="ln313">		{</a>
<a name="ln314">			xPos = data[3] &lt;&lt; 8 | data[2];</a>
<a name="ln315">			yPos = data[5] &lt;&lt; 8 | data[4];</a>
<a name="ln316"> </a>
<a name="ln317">			hasContact = (data[1] &amp; 0x80);</a>
<a name="ln318"> </a>
<a name="ln319">			uint16 pressureData = data[7] &lt;&lt; 8 | data[6];</a>
<a name="ln320">			pressure = (float)pressureData / 511.0;</a>
<a name="ln321">			eraser = (data[1] &amp; 0x20);</a>
<a name="ln322"> </a>
<a name="ln323">			// mouse wheel support</a>
<a name="ln324">			if (data[1] &amp; 0x40) {	// mouse is on tablet!</a>
<a name="ln325">				wheelY = (float)(int8)data[6];</a>
<a name="ln326">				mode = MODE_MOUSE;</a>
<a name="ln327">				// override contact to loose it as soon as possible</a>
<a name="ln328">				// when mouse is lifted from tablet</a>
<a name="ln329">				hasContact = (uint8)data[7] &gt;= 30;</a>
<a name="ln330">				pressure = 0.0;</a>
<a name="ln331">				eraser = 0;</a>
<a name="ln332">			}</a>
<a name="ln333"> </a>
<a name="ln334">			firstButton = pressure &gt; 0.0 ? true : (data[1] &amp; 0x01);</a>
<a name="ln335">			secondButton = (data[1] &amp; 0x02);</a>
<a name="ln336">			thirdButton = (data[1] &amp; 0x04);</a>
<a name="ln337"> </a>
<a name="ln338">			break;</a>
<a name="ln339">		}</a>
<a name="ln340">		case DEVICE_BAMBOO_PT:</a>
<a name="ln341">		{</a>
<a name="ln342">			if (dataBytes &lt; 20) {	// ignore touch-packets</a>
<a name="ln343">				xPos = data[3] &lt;&lt; 8 | data[2];</a>
<a name="ln344">				yPos = data[5] &lt;&lt; 8 | data[4];</a>
<a name="ln345"> </a>
<a name="ln346">				hasContact = (data[1] &amp; 0x20);</a>
<a name="ln347"> </a>
<a name="ln348">				uint16 pressureData = data[7] &lt;&lt; 8 | data[6];</a>
<a name="ln349">				pressure = (float)pressureData / 1023.0;</a>
<a name="ln350">				eraser = (data[1] &amp; 0x08);</a>
<a name="ln351"> </a>
<a name="ln352">				firstButton = (data[1] &amp; 0x01);</a>
<a name="ln353">				secondButton = (data[1] &amp; 0x02);</a>
<a name="ln354">				thirdButton = (data[1] &amp; 0x04);</a>
<a name="ln355"> </a>
<a name="ln356">				break;</a>
<a name="ln357">			}</a>
<a name="ln358">		}</a>
<a name="ln359">		case DEVICE_INTUOS:</a>
<a name="ln360">		case DEVICE_INTUOS3:</a>
<a name="ln361">		case DEVICE_CINTIQ:</a>
<a name="ln362">			if ((data[0] == 0x02) &amp;&amp; !(((data[1] &gt;&gt; 5) &amp; 0x03) == 0x02)) {</a>
<a name="ln363">				if (fDeviceMode == DEVICE_INTUOS3) {</a>
<a name="ln364">					xPos = (data[2] &lt;&lt; 9) | (data[3] &lt;&lt; 1)</a>
<a name="ln365">						| ((data[9] &gt;&gt; 1) &amp; 1);</a>
<a name="ln366">					yPos = (data[4] &lt;&lt; 9) | (data[5] &lt;&lt; 1) | (data[9] &amp; 1);</a>
<a name="ln367">				} else {</a>
<a name="ln368">					xPos = (data[2] &lt;&lt; 8) | data[3];</a>
<a name="ln369">					yPos = (data[4] &lt;&lt; 8) | data[5];</a>
<a name="ln370">				}</a>
<a name="ln371">				uint16 pressureData = data[6] &lt;&lt; 2 | ((data[7] &gt;&gt; 6) &amp; 0x03);</a>
<a name="ln372">				pressure = (float)pressureData / 1023.0;</a>
<a name="ln373"> </a>
<a name="ln374">				// mouse and wheel support</a>
<a name="ln375">				if (data[1] == 0xf0) {	// mouse is on tablet!</a>
<a name="ln376">					mode = MODE_MOUSE;</a>
<a name="ln377"> </a>
<a name="ln378">					if (data[8] == 0x02)</a>
<a name="ln379">						wheelY = 1.0;</a>
<a name="ln380">					else if (data[8] == 0x01)</a>
<a name="ln381">						wheelY = -1.0;</a>
<a name="ln382"> </a>
<a name="ln383">					firstButton = (data[8] &amp; 0x04);</a>
<a name="ln384">					secondButton = (data[8] &amp; 0x10);</a>
<a name="ln385">					thirdButton = (data[8] &amp; 0x08);</a>
<a name="ln386"> </a>
<a name="ln387">					// override contact to loose it as soon as possible</a>
<a name="ln388">					// when mouse is lifted from tablet</a>
<a name="ln389">					hasContact = data[9] &lt;= 0x68;</a>
<a name="ln390">					pressure = 0.0;</a>
<a name="ln391">					eraser = 0;</a>
<a name="ln392">				} else {</a>
<a name="ln393">					firstButton = (data[6] &gt; 2);</a>
<a name="ln394">						// For Intuos it MUST be &gt;1,</a>
<a name="ln395">						// but '&gt;1' still gets false actuations (shaking)</a>
<a name="ln396">					secondButton = (data[1] &amp; 0x02);</a>
<a name="ln397">					thirdButton = (data[1] &amp; 0x04);</a>
<a name="ln398">					hasContact = (data[1] &amp; 0x40);</a>
<a name="ln399">						// TODO: is this meaningful? (always true on Intuos)</a>
<a name="ln400">					if (fDeviceMode == DEVICE_INTUOS) {	// TODO: test perhaps superfluous?</a>
<a name="ln401">						// Original Intuos protocol:</a>
<a name="ln402">						//  data[6] is used to signal use of the eraser,</a>
<a name="ln403">						//  as well as being the high bits of pressure.</a>
<a name="ln404">						//  While not in contact:</a>
<a name="ln405">						//	 If the pen end is lowermost data[6] = 1;</a>
<a name="ln406">						//	 If the eraser end is down data[6] = 0, and pressure is strictly 0</a>
<a name="ln407">						//   data[9] (top 5 bits: 0x70..0xd0) indicates height above the tablet.</a>
<a name="ln408">						eraser = fEraser;</a>
<a name="ln409">							// keep established value unless not touching pad</a>
<a name="ln410">						// Eraser state only valid when away from surface</a>
<a name="ln411">						if (data[6] &lt;= 1 &amp;&amp; data[9] &gt; 0x80) { 	// not touching tablet</a>
<a name="ln412">							if (pressureData == 0) eraser = 1;	// strictly 0 means eraser</a>
<a name="ln413">							else if (pressureData &gt; 6) eraser = 0;	// avoid slop</a>
<a name="ln414">						}</a>
<a name="ln415">					}</a>
<a name="ln416">					// Get raw tilt values (0..54..127)</a>
<a name="ln417">					int8 tiltDataX = ((data[7] &amp; 0x3f) &lt;&lt; 1) | ((data[8] &amp; 0x80) &gt;&gt; 7);</a>
<a name="ln418">					int8 tiltDataY = data[8] &amp; 0x7f;</a>
<a name="ln419">					// convert to floats</a>
<a name="ln420">					tiltX = (float)(tiltDataX - 64) / 64.0;</a>
<a name="ln421">					tiltY = (float)(tiltDataY - 64) / 64.0;</a>
<a name="ln422">				}</a>
<a name="ln423">			}</a>
<a name="ln424">			break;</a>
<a name="ln425">		case DEVICE_PL500: {</a>
<a name="ln426">			hasContact = ( data[1] &amp; 0x20);</a>
<a name="ln427">			xPos = data[2] &lt;&lt; 8 | data[3];</a>
<a name="ln428">			yPos = data[5] &lt;&lt; 8 | data[6];</a>
<a name="ln429">			firstButton = (data[4] &amp; 0x08);</a>
<a name="ln430">			secondButton = (data[4] &amp; 0x10);</a>
<a name="ln431">			thirdButton = (data[4] &amp; 0x20);</a>
<a name="ln432">			uint16 pressureData = (data[4] &amp; 0x04) &gt;&gt; 2 | (data[7] &amp; 0x7f) &lt;&lt; 1;</a>
<a name="ln433">			pressure = (float)pressureData / 511.0;</a>
<a name="ln434">			break;</a>
<a name="ln435">		}</a>
<a name="ln436">		case DEVICE_VOLITO: {</a>
<a name="ln437">			eraser = 0;</a>
<a name="ln438">			thirdButton = 0;</a>
<a name="ln439"> </a>
<a name="ln440">			xPos = data[3] &lt;&lt; 8 | data[2];</a>
<a name="ln441">			yPos = data[5] &lt;&lt; 8 | data[4];</a>
<a name="ln442"> </a>
<a name="ln443">			hasContact = (data[1] &amp; 0x80);</a>
<a name="ln444"> </a>
<a name="ln445">			firstButton = (data[1] &amp; 0x01) == 1;</a>
<a name="ln446">			secondButton = data[1] &amp; 0x04;</a>
<a name="ln447"> </a>
<a name="ln448">			uint16 pressureData = data[7] &lt;&lt; 8 | data[6];</a>
<a name="ln449">			pressure = (float)pressureData / 511.0;</a>
<a name="ln450"> </a>
<a name="ln451">			if (data[1] &amp; 0x40) {	// mouse is on tablet</a>
<a name="ln452">				wheelY = 0;</a>
<a name="ln453">				mode = MODE_MOUSE;</a>
<a name="ln454">				hasContact = (uint8)data[7] &gt;= 30;</a>
<a name="ln455">				pressure = 0.0;</a>
<a name="ln456">				secondButton = data[1] &amp; 0x02;</a>
<a name="ln457">			}</a>
<a name="ln458"> </a>
<a name="ln459">			break;</a>
<a name="ln460">		}</a>
<a name="ln461">		case DEVICE_PENSTATION: {</a>
<a name="ln462">			xPos = data[3] &lt;&lt; 8 | data[2];</a>
<a name="ln463">			yPos = data[5] &lt;&lt; 8 | data[4];</a>
<a name="ln464">			hasContact = (data[1] &amp; 0x10);</a>
<a name="ln465">			uint16 pressureData = data[7] &lt;&lt; 8 | data[6];</a>
<a name="ln466">			pressure = (float)pressureData / 511.0;</a>
<a name="ln467">			firstButton = (data[1] &amp; 0x01);</a>
<a name="ln468">			secondButton = (data[1] &amp; 0x02);</a>
<a name="ln469">			thirdButton = (data[1] &amp; 0x04);</a>
<a name="ln470">			break;</a>
<a name="ln471">		}</a>
<a name="ln472">	}</a>
<a name="ln473">	if (pressure &gt; 1.0)</a>
<a name="ln474">		pressure = 1.0;</a>
<a name="ln475">	else if (pressure &lt; 0.0)</a>
<a name="ln476">		pressure = 0.0;</a>
<a name="ln477">	buttons = (firstButton ? B_PRIMARY_MOUSE_BUTTON : 0)</a>
<a name="ln478">			   | (secondButton ? B_SECONDARY_MOUSE_BUTTON : 0)</a>
<a name="ln479">			   | (thirdButton ? B_TERTIARY_MOUSE_BUTTON : 0);</a>
<a name="ln480">	x = (float)xPos;</a>
<a name="ln481">	y = (float)yPos;</a>
<a name="ln482">}</a>
<a name="ln483"> </a>
<a name="ln484">// SetStatus</a>
<a name="ln485">void</a>
<a name="ln486">TabletDevice::SetStatus(uint32 mode, uint32 buttons, float x, float y,</a>
<a name="ln487">	float pressure, int32 clicks, uint32 modifiers, int32 eraser,</a>
<a name="ln488">	float wheelX, float wheelY, float tiltX, float tiltY, const uchar* data)</a>
<a name="ln489">{</a>
<a name="ln490">	if (fActive) {</a>
<a name="ln491">		uint32 what = B_MOUSE_MOVED;</a>
<a name="ln492">		if (buttons &gt; fButtons)</a>
<a name="ln493">			what = B_MOUSE_DOWN;</a>
<a name="ln494">		else if (buttons &lt; fButtons)</a>
<a name="ln495">			what = B_MOUSE_UP;</a>
<a name="ln496"> </a>
<a name="ln497"> </a>
<a name="ln498">#if DEBUG</a>
<a name="ln499">	float tabletX = x;</a>
<a name="ln500">	float tabletY = y;</a>
<a name="ln501">#endif</a>
<a name="ln502">		x /= fMaxX;</a>
<a name="ln503">		y /= fMaxY;</a>
<a name="ln504"> </a>
<a name="ln505">		float deltaX = 0.0;</a>
<a name="ln506">		float deltaY = 0.0;</a>
<a name="ln507"> </a>
<a name="ln508">		float absDeltaX = 0.0;</a>
<a name="ln509">		float absDeltaY = 0.0;</a>
<a name="ln510"> </a>
<a name="ln511">		float unfilteredX = x;</a>
<a name="ln512">		float unfilteredY = y;</a>
<a name="ln513"> </a>
<a name="ln514">		if (fHasContact) {</a>
<a name="ln515">			deltaX = x - fPosX;</a>
<a name="ln516">			deltaY = y - fPosY;</a>
<a name="ln517"> </a>
<a name="ln518">			absDeltaX = fabsf(deltaX);</a>
<a name="ln519">			absDeltaY = fabsf(deltaY);</a>
<a name="ln520"> </a>
<a name="ln521">#if 0 //DEBUG</a>
<a name="ln522">fParent-&gt;LogString() &lt;&lt; &quot;x: &quot; &lt;&lt; x &lt;&lt; &quot;, y: &quot; &lt;&lt; y &lt;&lt; &quot;, pressure: &quot; &lt;&lt; pressure &lt;&lt; &quot;\n&quot;;</a>
<a name="ln523">fParent-&gt;LogString() &lt;&lt; &quot;tilt x: &quot; &lt;&lt; tiltX &lt;&lt; &quot;, tilt y: &quot; &lt;&lt; tiltY &lt;&lt; &quot;\n\n&quot;;</a>
<a name="ln524">#endif</a>
<a name="ln525">			// apply a bit of filtering</a>
<a name="ln526">			if (absDeltaX &lt; fJitterX)</a>
<a name="ln527">				x = fPosX;</a>
<a name="ln528">			if (absDeltaY &lt; fJitterY)</a>
<a name="ln529">				y = fPosY;</a>
<a name="ln530">		}</a>
<a name="ln531"> </a>
<a name="ln532">		// only do send message if something changed</a>
<a name="ln533">		if (x != fPosX || y != fPosY || fButtons != buttons || pressure != fPressure</a>
<a name="ln534">			|| fEraser != eraser || fTiltX != tiltX || fTiltY != tiltY) {</a>
<a name="ln535"> </a>
<a name="ln536">			bigtime_t now = system_time();</a>
<a name="ln537"> </a>
<a name="ln538">			// common fields for any mouse message</a>
<a name="ln539">			BMessage* event = new BMessage(what);</a>
<a name="ln540">			event-&gt;AddInt64(&quot;when&quot;, now);</a>
<a name="ln541">			event-&gt;AddInt32(&quot;buttons&quot;, buttons);</a>
<a name="ln542">			if (mode == MODE_PEN) {</a>
<a name="ln543">				event-&gt;AddFloat(&quot;x&quot;, x);</a>
<a name="ln544">				event-&gt;AddFloat(&quot;y&quot;, y);</a>
<a name="ln545">				event-&gt;AddFloat(&quot;be:tablet_x&quot;, unfilteredX);</a>
<a name="ln546">				event-&gt;AddFloat(&quot;be:tablet_y&quot;, unfilteredY);</a>
<a name="ln547">				event-&gt;AddFloat(&quot;be:tablet_pressure&quot;, pressure);</a>
<a name="ln548">				event-&gt;AddInt32(&quot;be:tablet_eraser&quot;, eraser);</a>
<a name="ln549">				if (_DeviceSupportsTilt()) {</a>
<a name="ln550">					event-&gt;AddFloat(&quot;be:tablet_tilt_x&quot;, tiltX);</a>
<a name="ln551">					event-&gt;AddFloat(&quot;be:tablet_tilt_y&quot;, tiltY);</a>
<a name="ln552">				}</a>
<a name="ln553">				// adjust mouse coordinates as well</a>
<a name="ln554">				// to have the mouse appear at the pens</a>
<a name="ln555">				// last position when switching</a>
<a name="ln556">				fFakeMouseX = unfilteredX;</a>
<a name="ln557">				fFakeMouseY = unfilteredY;</a>
<a name="ln558">			} else if (mode == MODE_MOUSE) {</a>
<a name="ln559">				// apply acceleration</a>
<a name="ln560">				float accelerationX = fJitterX * ACCELERATION_KICK_IN;</a>
<a name="ln561">//				if (absDeltaX &gt; accelerationX)</a>
<a name="ln562">					deltaX *= absDeltaX / accelerationX;</a>
<a name="ln563">				float accelerationY = fJitterY * ACCELERATION_KICK_IN;</a>
<a name="ln564">//				if (absDeltaY &gt; accelerationY)</a>
<a name="ln565">					deltaY *= absDeltaY / accelerationY;</a>
<a name="ln566">				// calculate screen coordinates</a>
<a name="ln567">				fFakeMouseX = min_c(1.0, max_c(0.0, fFakeMouseX + deltaX));</a>
<a name="ln568">				fFakeMouseY = min_c(1.0, max_c(0.0, fFakeMouseY + deltaY));</a>
<a name="ln569">				event-&gt;AddFloat(&quot;x&quot;, fFakeMouseX);</a>
<a name="ln570">				event-&gt;AddFloat(&quot;y&quot;, fFakeMouseY);</a>
<a name="ln571">				event-&gt;AddFloat(&quot;be:tablet_x&quot;, fFakeMouseX);</a>
<a name="ln572">				event-&gt;AddFloat(&quot;be:tablet_y&quot;, fFakeMouseY);</a>
<a name="ln573">			}</a>
<a name="ln574">			event-&gt;AddInt32(&quot;modifiers&quot;, modifiers);</a>
<a name="ln575"> </a>
<a name="ln576">#if DEBUG</a>
<a name="ln577">if (data) {</a>
<a name="ln578">	event-&gt;AddData(&quot;raw usb data&quot;, B_RAW_TYPE, data, 12);</a>
<a name="ln579">}</a>
<a name="ln580">event-&gt;AddFloat(&quot;tablet x&quot;, tabletX);</a>
<a name="ln581">event-&gt;AddFloat(&quot;tablet y&quot;, tabletY);</a>
<a name="ln582">#endif</a>
<a name="ln583">			// additional fields for mouse down or up</a>
<a name="ln584">			if (what == B_MOUSE_DOWN) {</a>
<a name="ln585">				if (now - fLastClickTime &lt; fParent-&gt;DoubleClickSpeed()) {</a>
<a name="ln586">					fClicks++;</a>
<a name="ln587">					if (fClicks &gt; 3)</a>
<a name="ln588">						fClicks = 1;</a>
<a name="ln589">				} else {</a>
<a name="ln590">					fClicks = 1;</a>
<a name="ln591">				}</a>
<a name="ln592">				fLastClickTime = now;</a>
<a name="ln593">				event-&gt;AddInt32(&quot;clicks&quot;, fClicks);</a>
<a name="ln594">			} else if (what == B_MOUSE_UP)</a>
<a name="ln595">				event-&gt;AddInt32(&quot;clicks&quot;, 0);</a>
<a name="ln596"> </a>
<a name="ln597">			status_t ret = fParent-&gt;EnqueueMessage(event);</a>
<a name="ln598">			if (ret &lt; B_OK)</a>
<a name="ln599">				PRINT((&quot;EnqueueMessage(): %s\n&quot;, strerror(ret)));</a>
<a name="ln600"> </a>
<a name="ln601">			// apply values to members</a>
<a name="ln602">			fPosX = x;</a>
<a name="ln603">			fPosY = y;</a>
<a name="ln604">			fButtons = buttons;</a>
<a name="ln605">			fPressure = pressure;</a>
<a name="ln606">			fModifiers = modifiers;</a>
<a name="ln607">			fEraser = eraser;</a>
<a name="ln608">			fTiltX = tiltX;</a>
<a name="ln609">			fTiltY = tiltY;</a>
<a name="ln610">		}</a>
<a name="ln611"> </a>
<a name="ln612">		// separate wheel changed message</a>
<a name="ln613">		if (fWheelX != wheelX || fWheelY != wheelY) {</a>
<a name="ln614">			BMessage* event = new BMessage(B_MOUSE_WHEEL_CHANGED);</a>
<a name="ln615">			event-&gt;AddInt64(&quot;when&quot;, system_time());</a>
<a name="ln616">			event-&gt;AddFloat(&quot;be:wheel_delta_x&quot;, wheelX);</a>
<a name="ln617">			event-&gt;AddFloat(&quot;be:wheel_delta_y&quot;, wheelY);</a>
<a name="ln618">			fParent-&gt;EnqueueMessage(event);</a>
<a name="ln619"> </a>
<a name="ln620">			// apply values to members</a>
<a name="ln621">			fWheelX = wheelX;</a>
<a name="ln622">			fWheelY = wheelY;</a>
<a name="ln623">		}</a>
<a name="ln624">	}</a>
<a name="ln625">}</a>
<a name="ln626"> </a>
<a name="ln627">// SetContact</a>
<a name="ln628">void</a>
<a name="ln629">TabletDevice::SetContact(bool contact)</a>
<a name="ln630">{</a>
<a name="ln631">	fHasContact = contact;</a>
<a name="ln632">}</a>
<a name="ln633"> </a>
<a name="ln634">// poll_usb_device</a>
<a name="ln635">int32</a>
<a name="ln636">TabletDevice::poll_usb_device(void* arg)</a>
<a name="ln637">{</a>
<a name="ln638">	TabletDevice* tabletDevice = (TabletDevice*)arg;</a>
<a name="ln639">	DeviceReader* reader = tabletDevice-&gt;fReader;</a>
<a name="ln640"> </a>
<a name="ln641">	if (!reader || reader-&gt;InitCheck() &lt; B_OK)</a>
<a name="ln642">		return B_BAD_VALUE;</a>
<a name="ln643"> </a>
<a name="ln644">	int dataBytes = reader-&gt;MaxPacketSize();</a>
<a name="ln645">	if (dataBytes &gt; 128)</a>
<a name="ln646">		return B_BAD_VALUE;</a>
<a name="ln647"> </a>
<a name="ln648">	uchar data[max_c(12, dataBytes)];</a>
<a name="ln649"> </a>
<a name="ln650">	while (tabletDevice-&gt;IsActive()) {</a>
<a name="ln651"> </a>
<a name="ln652">		status_t ret = reader-&gt;ReadData(data, dataBytes);</a>
<a name="ln653"> </a>
<a name="ln654">		if (ret == dataBytes) {</a>
<a name="ln655">			// data we read from the wacom device</a>
<a name="ln656">			uint32 mode;</a>
<a name="ln657">			bool hasContact = false;</a>
<a name="ln658">			uint32 buttons = 0;</a>
<a name="ln659">			float x = 0.0;</a>
<a name="ln660">			float y = 0.0;</a>
<a name="ln661">			float pressure = 0.0;</a>
<a name="ln662">			int32 clicks = 0;</a>
<a name="ln663">			int32 eraser = 0;</a>
<a name="ln664">			float wheelX = 0.0;</a>
<a name="ln665">			float wheelY = 0.0;</a>
<a name="ln666">			float tiltX = 0.0;</a>
<a name="ln667">			float tiltY = 0.0;</a>
<a name="ln668">			// let the device extract all information from the data</a>
<a name="ln669">			tabletDevice-&gt;ReadData(data, dataBytes, hasContact, mode, buttons,</a>
<a name="ln670">								   x, y, pressure, clicks, eraser,</a>
<a name="ln671">								   wheelX, wheelY, tiltX, tiltY);</a>
<a name="ln672">			if (hasContact) {</a>
<a name="ln673">				// apply the changes to the device</a>
<a name="ln674">				tabletDevice-&gt;SetStatus(mode, buttons, x, y, pressure,</a>
<a name="ln675">										clicks, modifiers(), eraser,</a>
<a name="ln676">										wheelX, wheelY, tiltX, tiltY, data);</a>
<a name="ln677">			} else</a>
<a name="ln678">				PRINT((&quot;device has no contact\n&quot;));</a>
<a name="ln679">			tabletDevice-&gt;SetContact(hasContact);</a>
<a name="ln680">		} else {</a>
<a name="ln681">			PRINT((&quot;failed to read %ld bytes, read: %ld or %s\n&quot;,</a>
<a name="ln682">				dataBytes, ret, strerror(ret)));</a>
<a name="ln683"> </a>
<a name="ln684">			if (ret &lt; B_OK) {</a>
<a name="ln685">				if (ret == B_TIMED_OUT)</a>
<a name="ln686">					snooze(SNOOZE_AMOUNT);</a>
<a name="ln687">				else if (ret == B_INTERRUPTED)</a>
<a name="ln688">					snooze(SNOOZE_AMOUNT);</a>
<a name="ln689">				else {</a>
<a name="ln690">					return ret;</a>
<a name="ln691">				}</a>
<a name="ln692">			}</a>
<a name="ln693">		}</a>
<a name="ln694">	}</a>
<a name="ln695"> </a>
<a name="ln696">	return B_OK;</a>
<a name="ln697">}</a>
<a name="ln698"> </a>
<a name="ln699">// _DeviceSupportsTilt</a>
<a name="ln700">bool</a>
<a name="ln701">TabletDevice::_DeviceSupportsTilt() const</a>
<a name="ln702">{</a>
<a name="ln703">	bool tilt = false;</a>
<a name="ln704">	switch (fDeviceMode) {</a>
<a name="ln705">		case DEVICE_INTUOS:</a>
<a name="ln706">		case DEVICE_INTUOS3:</a>
<a name="ln707">		case DEVICE_CINTIQ:</a>
<a name="ln708">			tilt = true;</a>
<a name="ln709">			break;</a>
<a name="ln710">	}</a>
<a name="ln711">	return tilt;</a>
<a name="ln712">}</a>
<a name="ln713"> </a>
<a name="ln714">// _GetName</a>
<a name="ln715">void</a>
<a name="ln716">TabletDevice::_GetName(uint16 productID, const char** name) const</a>
<a name="ln717">{</a>
<a name="ln718">	switch (productID) {</a>
<a name="ln719">		case 0x00:</a>
<a name="ln720">			*name = &quot;Wacom USB&quot;;</a>
<a name="ln721">			break;</a>
<a name="ln722">		case 0x03:	// driver does not support this yet</a>
<a name="ln723">			*name = &quot;Wacom Cintiq Partner USB&quot;;</a>
<a name="ln724">			break;</a>
<a name="ln725">		case 0x10:</a>
<a name="ln726">			*name = &quot;Wacom Graphire USB&quot;;</a>
<a name="ln727">			break;</a>
<a name="ln728">		case 0x11:</a>
<a name="ln729">			*name = &quot;Wacom Graphire2 4x5\&quot; USB&quot;;</a>
<a name="ln730">			break;</a>
<a name="ln731">		case 0x12:</a>
<a name="ln732">			*name = &quot;Wacom Graphire2 5x7\&quot; USB&quot;;</a>
<a name="ln733">			break;</a>
<a name="ln734">		case 0x13:</a>
<a name="ln735">			*name = &quot;Wacom Graphire3 4x5\&quot; USB&quot;;</a>
<a name="ln736">			break;</a>
<a name="ln737">		case 0x14:</a>
<a name="ln738">			*name = &quot;Wacom Graphire3 6x8\&quot; USB&quot;;</a>
<a name="ln739">			break;</a>
<a name="ln740">		case 0x15:</a>
<a name="ln741">			*name = &quot;Wacom Graphire4 4x5\&quot; USB&quot;;</a>
<a name="ln742">			break;</a>
<a name="ln743">		case 0x16:</a>
<a name="ln744">			*name = &quot;Wacom Graphire4 6x8\&quot; USB&quot;;</a>
<a name="ln745">			break;</a>
<a name="ln746">		case 0x17:</a>
<a name="ln747">			*name = &quot;Wacom BambooFun 4x5\&quot; USB&quot;;</a>
<a name="ln748">			break;</a>
<a name="ln749">		case 0x18:</a>
<a name="ln750">			*name = &quot;Wacom BambooFun 6x8\&quot; USB&quot;;</a>
<a name="ln751">			break;</a>
<a name="ln752">		case 0x20:</a>
<a name="ln753">			*name = &quot;Wacom Intuos 4x5\&quot; USB&quot;;</a>
<a name="ln754">			break;</a>
<a name="ln755">		case 0x21:</a>
<a name="ln756">			*name = &quot;Wacom Intuos 6x8\&quot; USB&quot;;</a>
<a name="ln757">			break;</a>
<a name="ln758">		case 0x22:</a>
<a name="ln759">			*name = &quot;Wacom Intuos 9x12\&quot; USB&quot;;</a>
<a name="ln760">			break;</a>
<a name="ln761">		case 0x23:</a>
<a name="ln762">			*name = &quot;Wacom Intuos 12x12\&quot; USB&quot;;</a>
<a name="ln763">			break;</a>
<a name="ln764">		case 0x24:</a>
<a name="ln765">			*name = &quot;Wacom Intuos 12x18\&quot; USB&quot;;</a>
<a name="ln766">			break;</a>
<a name="ln767">		case 0x30:</a>
<a name="ln768">			*name = &quot;Wacom PL400 USB&quot;;</a>
<a name="ln769">			break;</a>
<a name="ln770">		case 0x31:</a>
<a name="ln771">			*name = &quot;Wacom PL500 USB&quot;;</a>
<a name="ln772">			break;</a>
<a name="ln773">		case 0x32:</a>
<a name="ln774">			*name = &quot;Wacom PL600 USB&quot;;</a>
<a name="ln775">			break;</a>
<a name="ln776">		case 0x33:</a>
<a name="ln777">			*name = &quot;Wacom PL600SX USB&quot;;</a>
<a name="ln778">			break;</a>
<a name="ln779">		case 0x34:</a>
<a name="ln780">			*name = &quot;Wacom PL550 USB&quot;;</a>
<a name="ln781">			break;</a>
<a name="ln782">		case 0x35:</a>
<a name="ln783">			*name = &quot;Wacom PL800 USB&quot;;</a>
<a name="ln784">			break;</a>
<a name="ln785"> </a>
<a name="ln786">		case 0x3F:</a>
<a name="ln787">			*name = &quot;Wacom Cintiq 21UX USB&quot;;</a>
<a name="ln788">			break;</a>
<a name="ln789"> </a>
<a name="ln790">		case 0x41:</a>
<a name="ln791">			*name = &quot;Wacom Intuos2 4x5\&quot; USB&quot;;</a>
<a name="ln792">			break;</a>
<a name="ln793">		case 0x42:</a>
<a name="ln794">			*name = &quot;Wacom Intuos2 6x8\&quot; USB&quot;;</a>
<a name="ln795">			break;</a>
<a name="ln796">		case 0x43:</a>
<a name="ln797">			*name = &quot;Wacom Intuos2 9x12\&quot; USB&quot;;</a>
<a name="ln798">			break;</a>
<a name="ln799">		case 0x44:</a>
<a name="ln800">			*name = &quot;Wacom Intuos2 12x12\&quot; USB&quot;;</a>
<a name="ln801">			break;</a>
<a name="ln802">		case 0x45:</a>
<a name="ln803">			*name = &quot;Wacom Intuos2 12x18\&quot; USB&quot;;</a>
<a name="ln804">			break;</a>
<a name="ln805">		case 0x47:	// some I2 6x8s seem to report as 0x47</a>
<a name="ln806">			*name = &quot;Wacom Intuos2 6x8\&quot; USB&quot;;</a>
<a name="ln807">			break;</a>
<a name="ln808"> </a>
<a name="ln809">		case 0x60:</a>
<a name="ln810">			*name = &quot;Wacom Volito USB&quot;;</a>
<a name="ln811">			break;</a>
<a name="ln812">		case 0x61:</a>
<a name="ln813">			*name = &quot;Wacom PenStation USB&quot;;</a>
<a name="ln814">			break;</a>
<a name="ln815">		case 0x62:</a>
<a name="ln816">			*name = &quot;Wacom Volito2 USB&quot;;</a>
<a name="ln817">			break;</a>
<a name="ln818">		case 0x64:</a>
<a name="ln819">			*name = &quot;Wacom PenPartner.1 USB&quot;;</a>
<a name="ln820">			break;</a>
<a name="ln821">		case 0x65:</a>
<a name="ln822">			*name = &quot;Wacom Bamboo USB&quot;;</a>
<a name="ln823">			break;</a>
<a name="ln824">		case 0x69:</a>
<a name="ln825">			*name = &quot;Wacom Bamboo1 USB&quot;;</a>
<a name="ln826">			break;</a>
<a name="ln827"> </a>
<a name="ln828">		case 0xB0:</a>
<a name="ln829">			*name = &quot;Wacom Intuos3 4x5 USB&quot;;</a>
<a name="ln830">			break;</a>
<a name="ln831">		case 0xB1:</a>
<a name="ln832">			*name = &quot;Wacom Intuos3 6x8 USB&quot;;</a>
<a name="ln833">			break;</a>
<a name="ln834">		case 0xB2:</a>
<a name="ln835">			*name = &quot;Wacom Intuos3 9x12 USB&quot;;</a>
<a name="ln836">			break;</a>
<a name="ln837"> </a>
<a name="ln838">		case 0xD0:</a>
<a name="ln839">			*name = &quot;Wacom Bamboo 2FG USB&quot;;</a>
<a name="ln840">			break;</a>
<a name="ln841">		case 0xD1:</a>
<a name="ln842">			*name = &quot;Wacom BambooFun 2FG 4x5\&quot; USB&quot;;</a>
<a name="ln843">			break;</a>
<a name="ln844">		case 0xD2:</a>
<a name="ln845">			*name = &quot;Wacom Bamboo Craft USB&quot;;</a>
<a name="ln846">			break;</a>
<a name="ln847">		case 0xD3:</a>
<a name="ln848">			*name = &quot;Wacom BambooFun 2FG 6x8\&quot; USB&quot;;</a>
<a name="ln849">			break;</a>
<a name="ln850">		case 0xD4:</a>
<a name="ln851">			*name = &quot;Wacom Bamboo 4x5\&quot; USB&quot;;</a>
<a name="ln852">			break;</a>
<a name="ln853">		case 0xD6:</a>
<a name="ln854">			*name = &quot;Wacom Bamboo (CTH-460/K)&quot;;</a>
<a name="ln855">			break;</a>
<a name="ln856">		case 0xD7:</a>
<a name="ln857">			*name = &quot;Wacom Bamboo (CTH-461/S)&quot;;</a>
<a name="ln858">			break;</a>
<a name="ln859">		case 0xD8:</a>
<a name="ln860">			*name = &quot;Wacom Bamboo (CTH-661/S1)&quot;;</a>
<a name="ln861">			break;</a>
<a name="ln862">		case 0xDA:</a>
<a name="ln863">			*name = &quot;Wacom Bamboo (CTH-461/L)&quot;;</a>
<a name="ln864">			break;</a>
<a name="ln865">		case 0xDB:</a>
<a name="ln866">			*name = &quot;Wacom Bamboo (CTH-661)&quot;;</a>
<a name="ln867">			break;</a>
<a name="ln868">		case 0xDD:</a>
<a name="ln869">			*name = &quot;Wacom Bamboo Pen/Connect (CTL-470)&quot;;</a>
<a name="ln870">			break;</a>
<a name="ln871"> </a>
<a name="ln872">		default:</a>
<a name="ln873">			*name = &quot;&lt;unkown wacom tablet&gt;&quot;;</a>
<a name="ln874">			break;</a>
<a name="ln875">	}</a>
<a name="ln876">}</a>
<a name="ln877"> </a>

</code></pre>
<div class="balloon" rel="37"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the constructor. Consider inspecting: fDataBytes, fWheelX, fWheelY, fLastClickTime, fJitterX, fJitterY.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
