
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>CEchoGals_mixer.cpp</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">// ****************************************************************************</a>
<a name="ln2">//</a>
<a name="ln3">//		CEchoGals_mixer.cpp</a>
<a name="ln4">//</a>
<a name="ln5">//		Implementation file for the CEchoGals driver class (mixer functions).</a>
<a name="ln6">//		Set editor tabs to 3 for your viewing pleasure.</a>
<a name="ln7">//</a>
<a name="ln8">// ----------------------------------------------------------------------------</a>
<a name="ln9">//</a>
<a name="ln10">// This file is part of Echo Digital Audio's generic driver library.</a>
<a name="ln11">// Copyright Echo Digital Audio Corporation (c) 1998 - 2005</a>
<a name="ln12">// All rights reserved</a>
<a name="ln13">// www.echoaudio.com</a>
<a name="ln14">//</a>
<a name="ln15">// This library is free software; you can redistribute it and/or</a>
<a name="ln16">// modify it under the terms of the GNU Lesser General Public</a>
<a name="ln17">// License as published by the Free Software Foundation; either</a>
<a name="ln18">// version 2.1 of the License, or (at your option) any later version.</a>
<a name="ln19">//</a>
<a name="ln20">// This library is distributed in the hope that it will be useful,</a>
<a name="ln21">// but WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln22">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln23">// Lesser General Public License for more details.</a>
<a name="ln24">//</a>
<a name="ln25">// You should have received a copy of the GNU Lesser General Public</a>
<a name="ln26">// License along with this library; if not, write to the Free Software</a>
<a name="ln27">// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</a>
<a name="ln28">//</a>
<a name="ln29">// ****************************************************************************</a>
<a name="ln30"> </a>
<a name="ln31">#include &quot;CEchoGals.h&quot;</a>
<a name="ln32"> </a>
<a name="ln33">#undef ECHO_DEBUGPRINTF</a>
<a name="ln34">#define ECHO_DEBUGPRINTF(x)</a>
<a name="ln35"> </a>
<a name="ln36">/****************************************************************************</a>
<a name="ln37"> </a>
<a name="ln38">	CEchoGals mixer client management</a>
<a name="ln39"> </a>
<a name="ln40"> ****************************************************************************/</a>
<a name="ln41"> </a>
<a name="ln42">//===========================================================================</a>
<a name="ln43">//</a>
<a name="ln44">// Open the mixer - create a mixer client structure for this client and </a>
<a name="ln45">// return the cookie.  The cookie uniquely identifies this client to the </a>
<a name="ln46">// mixer driver. </a>
<a name="ln47">//</a>
<a name="ln48">// Valid cookies are non-zero.  If you get a zero cookie, the open failed</a>
<a name="ln49">// somehow.</a>
<a name="ln50">//</a>
<a name="ln51">// Clients can change mixer controls without calling OpenMixer first; it just</a>
<a name="ln52">// means that they can't track control changes made by other clients.</a>
<a name="ln53">//</a>
<a name="ln54">//===========================================================================</a>
<a name="ln55"> </a>
<a name="ln56">ECHOSTATUS CEchoGals::OpenMixer(NUINT &amp;Cookie)</a>
<a name="ln57">{</a>
<a name="ln58">	ECHO_MIXER_CLIENT *pTemp;</a>
<a name="ln59"> </a>
<a name="ln60">	if (m_fMixerDisabled)</a>
<a name="ln61">		return ECHOSTATUS_MIXER_DISABLED;</a>
<a name="ln62"> </a>
<a name="ln63">	//</a>
<a name="ln64">	// If the cookie is non-zero, then use the specified value</a>
<a name="ln65">	//</a>
<a name="ln66">	if (0 != Cookie)</a>
<a name="ln67">	{</a>
<a name="ln68">		pTemp = m_pMixerClients;</a>
<a name="ln69">		while (pTemp != NULL)</a>
<a name="ln70">		{</a>
<a name="ln71">			if (Cookie == pTemp-&gt;Cookie)</a>
<a name="ln72">			{</a>
<a name="ln73">				ECHO_DEBUGPRINTF((&quot;CEchoGals::OpenMixer - cookie 0x%lx already in use\n&quot;,</a>
<a name="ln74">										Cookie));</a>
<a name="ln75">				return ECHOSTATUS_BAD_COOKIE;</a>
<a name="ln76">			}</a>
<a name="ln77">			</a>
<a name="ln78">			pTemp = pTemp-&gt;pNext;</a>
<a name="ln79">		}</a>
<a name="ln80">	}</a>
<a name="ln81">	else</a>
<a name="ln82">	{</a>
<a name="ln83">		//</a>
<a name="ln84">		// Make a new cookie</a>
<a name="ln85">		//</a>
<a name="ln86">		ULONGLONG ullTime;</a>
<a name="ln87"> </a>
<a name="ln88">		m_pOsSupport-&gt;OsGetSystemTime(&amp;ullTime);</a>
<a name="ln89">		Cookie = (NUINT) ullTime;</a>
<a name="ln90">		if (0 == Cookie)</a>
<a name="ln91">			Cookie = 1;</a>
<a name="ln92">		</a>
<a name="ln93">		//</a>
<a name="ln94">		// Look through the existing mixer client list to ensure that this</a>
<a name="ln95">		// cookie is unique.</a>
<a name="ln96">		//</a>
<a name="ln97">		pTemp = m_pMixerClients;</a>
<a name="ln98">		while (pTemp != NULL)</a>
<a name="ln99">		{</a>
<a name="ln100">			if (Cookie == pTemp-&gt;Cookie)</a>
<a name="ln101">			{</a>
<a name="ln102">				//</a>
<a name="ln103">				// Oops, someone is already using this cookie.  Increment </a>
<a name="ln104">				// the new cookie and try again.</a>
<a name="ln105">				//</a>
<a name="ln106">				Cookie++;</a>
<a name="ln107">				pTemp = m_pMixerClients;			</a>
<a name="ln108">			}</a>
<a name="ln109">		</a>
<a name="ln110">			pTemp = pTemp-&gt;pNext;</a>
<a name="ln111">		}</a>
<a name="ln112">		</a>
<a name="ln113">	}</a>
<a name="ln114">	</a>
<a name="ln115"> </a>
<a name="ln116">	//</a>
<a name="ln117">	// Allocate the mixer client structure</a>
<a name="ln118">	//</a>
<a name="ln119">	ECHO_MIXER_CLIENT *pClient = NULL;</a>
<a name="ln120">	ECHOSTATUS			Status;</a>
<a name="ln121">	</a>
<a name="ln122">	Status = OsAllocateNonPaged(sizeof(ECHO_MIXER_CLIENT),(void **) &amp;pClient);</a>
<a name="ln123">	if (NULL == pClient)</a>
<a name="ln124">	{</a>
<a name="ln125">		Cookie = 0;</a>
<a name="ln126">		return Status;		</a>
<a name="ln127">	}</a>
<a name="ln128"> </a>
<a name="ln129">	</a>
<a name="ln130">	//</a>
<a name="ln131">	// Store the new cookie and the new mixer client</a>
<a name="ln132">	//</a>
<a name="ln133">	pClient-&gt;Cookie = Cookie;</a>
<a name="ln134">	pClient-&gt;pNext = m_pMixerClients;</a>
<a name="ln135">	m_pMixerClients = pClient;</a>
<a name="ln136">	</a>
<a name="ln137">	return ECHOSTATUS_OK;</a>
<a name="ln138">	</a>
<a name="ln139">}	// OpenMixer</a>
<a name="ln140"> </a>
<a name="ln141"> </a>
<a name="ln142">//===========================================================================</a>
<a name="ln143">//</a>
<a name="ln144">// Find a mixer client that matches a cookie</a>
<a name="ln145">//</a>
<a name="ln146">//===========================================================================</a>
<a name="ln147"> </a>
<a name="ln148">ECHO_MIXER_CLIENT *CEchoGals::GetMixerClient(NUINT Cookie)</a>
<a name="ln149">{</a>
<a name="ln150">	ECHO_MIXER_CLIENT *pTemp;</a>
<a name="ln151">	</a>
<a name="ln152">	pTemp = m_pMixerClients;</a>
<a name="ln153">	while (NULL != pTemp)</a>
<a name="ln154">	{</a>
<a name="ln155">		if (Cookie == pTemp-&gt;Cookie)</a>
<a name="ln156">			break;</a>
<a name="ln157">			</a>
<a name="ln158">		pTemp = pTemp-&gt;pNext;</a>
<a name="ln159">	}</a>
<a name="ln160">	</a>
<a name="ln161">	return pTemp;</a>
<a name="ln162">	</a>
<a name="ln163">}	// GetMixerClient</a>
<a name="ln164"> </a>
<a name="ln165"> </a>
<a name="ln166">//===========================================================================</a>
<a name="ln167">//</a>
<a name="ln168">// Close the mixer - free the mixer client structure</a>
<a name="ln169">//</a>
<a name="ln170">//===========================================================================</a>
<a name="ln171"> </a>
<a name="ln172">ECHOSTATUS CEchoGals::CloseMixer(NUINT Cookie)</a>
<a name="ln173">{</a>
<a name="ln174">	//</a>
<a name="ln175">	//	Search the linked list and remove the client that matches the cookie</a>
<a name="ln176">	// </a>
<a name="ln177">	ECHO_MIXER_CLIENT *pTemp;</a>
<a name="ln178">	</a>
<a name="ln179">	pTemp = m_pMixerClients;</a>
<a name="ln180">	if (NULL == pTemp)</a>
<a name="ln181">		return ECHOSTATUS_BAD_COOKIE;</a>
<a name="ln182">		</a>
<a name="ln183">	//</a>
<a name="ln184">	// Head of the list?</a>
<a name="ln185">	//		</a>
<a name="ln186">	if (pTemp-&gt;Cookie == Cookie)</a>
<a name="ln187">	{</a>
<a name="ln188">		m_pMixerClients = pTemp-&gt;pNext;</a>
<a name="ln189">		OsFreeNonPaged(pTemp);</a>
<a name="ln190">		</a>
<a name="ln191">		return ECHOSTATUS_OK;</a>
<a name="ln192">	}</a>
<a name="ln193">		</a>
<a name="ln194">	//</a>
<a name="ln195">	// Not the head of the list; search the list</a>
<a name="ln196">	//</a>
<a name="ln197">	while (NULL != pTemp-&gt;pNext)</a>
<a name="ln198">	{</a>
<a name="ln199">		if (Cookie == pTemp-&gt;pNext-&gt;Cookie)</a>
<a name="ln200">		{</a>
<a name="ln201">			ECHO_MIXER_CLIENT *pDeadClient;</a>
<a name="ln202">			</a>
<a name="ln203">			pDeadClient = pTemp-&gt;pNext;</a>
<a name="ln204">			pTemp-&gt;pNext = pDeadClient-&gt;pNext;</a>
<a name="ln205">			OsFreeNonPaged(pDeadClient);</a>
<a name="ln206">			</a>
<a name="ln207">			return ECHOSTATUS_OK;</a>
<a name="ln208">		}</a>
<a name="ln209">			</a>
<a name="ln210">		pTemp = pTemp-&gt;pNext;</a>
<a name="ln211">	}</a>
<a name="ln212"> </a>
<a name="ln213">	//</a>
<a name="ln214">	// No soup for you!</a>
<a name="ln215">	//</a>
<a name="ln216">	return ECHOSTATUS_BAD_COOKIE;</a>
<a name="ln217"> </a>
<a name="ln218">} // CloseMixer	</a>
<a name="ln219"> </a>
<a name="ln220"> </a>
<a name="ln221">//===========================================================================</a>
<a name="ln222">//</a>
<a name="ln223">// IsMixerOpen - returns true if at least one client has the mixer open</a>
<a name="ln224">//</a>
<a name="ln225">//===========================================================================</a>
<a name="ln226"> </a>
<a name="ln227">BOOL CEchoGals::IsMixerOpen()</a>
<a name="ln228">{</a>
<a name="ln229">	if (NULL == m_pMixerClients)</a>
<a name="ln230">		return FALSE;</a>
<a name="ln231">		</a>
<a name="ln232">	return TRUE;</a>
<a name="ln233">	</a>
<a name="ln234">}	// IsMixerOpen</a>
<a name="ln235"> </a>
<a name="ln236"> </a>
<a name="ln237">//===========================================================================</a>
<a name="ln238">//</a>
<a name="ln239">// This function is called when a mixer control changes; add the change</a>
<a name="ln240">//	to the queue for each client.</a>
<a name="ln241">//</a>
<a name="ln242">// Here's what the wCh1 and wCh2 parameters represent, based on the wType</a>
<a name="ln243">// parameter:</a>
<a name="ln244">//</a>
<a name="ln245">// wType				wCh1				wCh2</a>
<a name="ln246">// -----				----				----</a>
<a name="ln247">// ECHO_BUS_OUT	Output bus		Ignored</a>
<a name="ln248">// ECHO_BUS_IN		Input bus		Ignored</a>
<a name="ln249">// ECHO_PIPE_OUT	Output pipe		Output bus</a>
<a name="ln250">// ECHO_MONITOR	Input bus		Output bus</a>
<a name="ln251">//</a>
<a name="ln252">// ECHO_PIPE_IN is not used right now.</a>
<a name="ln253">//</a>
<a name="ln254">//===========================================================================</a>
<a name="ln255"> </a>
<a name="ln256">ECHOSTATUS CEchoGals::MixerControlChanged</a>
<a name="ln257">(</a>
<a name="ln258">	WORD	wType,		// One of the ECHO_CHANNEL_TYPES</a>
<a name="ln259">	WORD  wParameter, // One of the MXN_* values</a>
<a name="ln260">	WORD 	wCh1,			// Depends on the wType value</a>
<a name="ln261">	WORD  wCh2			// Also depends on wType value</a>
<a name="ln262">)</a>
<a name="ln263">{</a>
<a name="ln264">	ECHO_MIXER_CLIENT *pClient = m_pMixerClients;</a>
<a name="ln265">	PMIXER_NOTIFY		pNotify;</a>
<a name="ln266">	</a>
<a name="ln267">	if (m_fMixerDisabled)</a>
<a name="ln268">		return ECHOSTATUS_MIXER_DISABLED;</a>
<a name="ln269">	</a>
<a name="ln270">	//</a>
<a name="ln271">	// Go through all the clients and store this control change</a>
<a name="ln272">	//</a>
<a name="ln273">	while (NULL != pClient)</a>
<a name="ln274">	{</a>
<a name="ln275">		//</a>
<a name="ln276">		// Search the circular buffer for this client and see if </a>
<a name="ln277">		// this control change is already stored</a>
<a name="ln278">		//</a>
<a name="ln279">		DWORD				dwIndex,dwCount;</a>
<a name="ln280">		BOOL				fFound;</a>
<a name="ln281">		</a>
<a name="ln282">		dwCount = pClient-&gt;dwCount;</a>
<a name="ln283">		dwIndex = pClient-&gt;dwTail;</a>
<a name="ln284">		fFound = FALSE;</a>
<a name="ln285">		while (dwCount &gt; 0)</a>
<a name="ln286">		{</a>
<a name="ln287">			pNotify = pClient-&gt;Notifies + dwIndex;</a>
<a name="ln288">			if (	(pNotify-&gt;wType == wType) &amp;&amp;</a>
<a name="ln289">					(pNotify-&gt;wParameter == wParameter) &amp;&amp;</a>
<a name="ln290">					(pNotify-&gt;u.wPipeOut == wCh1) &amp;&amp; 	// can use any union member her</a>
<a name="ln291">					(pNotify-&gt;wBusOut == wCh2))</a>
<a name="ln292">			{</a>
<a name="ln293">				//</a>
<a name="ln294">				// Found this notify already in the circular buffer </a>
<a name="ln295">				//</a>
<a name="ln296">				fFound = TRUE;</a>
<a name="ln297">				break;</a>
<a name="ln298">			}</a>
<a name="ln299">			dwIndex++;</a>
<a name="ln300">			dwIndex &amp;= MAX_MIXER_NOTIFIES - 1;</a>
<a name="ln301">			dwCount--;</a>
<a name="ln302">		}</a>
<a name="ln303">		</a>
<a name="ln304">		//</a>
<a name="ln305">		// If the notify was not found, add this notify to the circular buffer if </a>
<a name="ln306">		// there is enough room.</a>
<a name="ln307">		//</a>
<a name="ln308">		if ( 	(FALSE == fFound) &amp;&amp;</a>
<a name="ln309">				(pClient-&gt;dwCount != MAX_MIXER_NOTIFIES))</a>
<a name="ln310">		{</a>
<a name="ln311">			pNotify = pClient-&gt;Notifies + pClient-&gt;dwHead;</a>
<a name="ln312">			</a>
<a name="ln313">			pNotify-&gt;wType 		= wType;</a>
<a name="ln314">			pNotify-&gt;wParameter 	= wParameter;</a>
<a name="ln315">			</a>
<a name="ln316">			if (ECHO_BUS_OUT == wType)</a>
<a name="ln317">			{</a>
<a name="ln318">				pNotify-&gt;u.wPipeOut = ECHO_CHANNEL_UNUSED;</a>
<a name="ln319">				pNotify-&gt;wBusOut = wCh1;</a>
<a name="ln320">			}</a>
<a name="ln321">			else</a>
<a name="ln322">			{</a>
<a name="ln323">				pNotify-&gt;u.wPipeOut	= wCh1;		// can use any union member here also</a>
<a name="ln324">				pNotify-&gt;wBusOut	= wCh2;</a>
<a name="ln325">			}</a>
<a name="ln326">			</a>
<a name="ln327">			pClient-&gt;dwCount += 1;</a>
<a name="ln328">			pClient-&gt;dwHead = (pClient-&gt;dwHead + 1) &amp; (MAX_MIXER_NOTIFIES - 1);</a>
<a name="ln329">		}</a>
<a name="ln330">		</a>
<a name="ln331">		pClient = pClient-&gt;pNext;</a>
<a name="ln332">	}</a>
<a name="ln333">	</a>
<a name="ln334">	return ECHOSTATUS_OK;</a>
<a name="ln335">	</a>
<a name="ln336">}	// MixerControlChanged</a>
<a name="ln337"> </a>
<a name="ln338"> </a>
<a name="ln339">//===========================================================================</a>
<a name="ln340">//</a>
<a name="ln341">// This method is called when a client wants to know what controls have </a>
<a name="ln342">// changed.</a>
<a name="ln343">//</a>
<a name="ln344">//===========================================================================</a>
<a name="ln345"> </a>
<a name="ln346">ECHOSTATUS CEchoGals::GetControlChanges</a>
<a name="ln347">(</a>
<a name="ln348">	PMIXER_MULTI_NOTIFY	pNotifies,</a>
<a name="ln349">	NUINT	MixerCookie</a>
<a name="ln350">)</a>
<a name="ln351">{</a>
<a name="ln352">	//</a>
<a name="ln353">	// Match the cookie</a>
<a name="ln354">	//</a>
<a name="ln355">	ECHO_MIXER_CLIENT *pClient = GetMixerClient(MixerCookie);</a>
<a name="ln356">	</a>
<a name="ln357">	if (NULL == pClient)</a>
<a name="ln358">	{</a>
<a name="ln359">		pNotifies-&gt;dwCount = 0;</a>
<a name="ln360">		return ECHOSTATUS_BAD_COOKIE;		</a>
<a name="ln361">	}</a>
<a name="ln362">	</a>
<a name="ln363">	//</a>
<a name="ln364">	// Copy mixer notifies</a>
<a name="ln365">	//</a>
<a name="ln366">	PMIXER_NOTIFY	pDest,pSrc;</a>
<a name="ln367">	DWORD				dwNumClientNotifies,dwNumReturned;</a>
<a name="ln368">	</a>
<a name="ln369">	dwNumClientNotifies = pNotifies-&gt;dwCount;</a>
<a name="ln370">	pDest = pNotifies-&gt;Notifies;</a>
<a name="ln371">	dwNumReturned = 0;</a>
<a name="ln372">	while ( (dwNumClientNotifies &gt; 0) &amp;&amp; (pClient-&gt;dwCount &gt; 0))</a>
<a name="ln373">	{</a>
<a name="ln374">		pSrc = pClient-&gt;Notifies + pClient-&gt;dwTail;</a>
<a name="ln375">	</a>
<a name="ln376">		OsCopyMemory(pDest,pSrc,sizeof(MIXER_NOTIFY));</a>
<a name="ln377">		</a>
<a name="ln378">		pDest++;</a>
<a name="ln379"> </a>
<a name="ln380">		pClient-&gt;dwTail = (pClient-&gt;dwTail + 1) &amp; (MAX_MIXER_NOTIFIES - 1);</a>
<a name="ln381">		pClient-&gt;dwCount -= 1;</a>
<a name="ln382"> </a>
<a name="ln383">		dwNumClientNotifies--;</a>
<a name="ln384"> </a>
<a name="ln385">		dwNumReturned++;</a>
<a name="ln386">	}</a>
<a name="ln387">	</a>
<a name="ln388">	pNotifies-&gt;dwCount = dwNumReturned;</a>
<a name="ln389">	</a>
<a name="ln390">	return ECHOSTATUS_OK;</a>
<a name="ln391"> </a>
<a name="ln392">}	// GetControlChanges</a>
<a name="ln393"> </a>
<a name="ln394"> </a>
<a name="ln395"> </a>
<a name="ln396"> </a>
<a name="ln397">/****************************************************************************</a>
<a name="ln398"> </a>
<a name="ln399">	CEchoGals mixer control</a>
<a name="ln400"> </a>
<a name="ln401"> ****************************************************************************/</a>
<a name="ln402"> </a>
<a name="ln403">//===========================================================================</a>
<a name="ln404">//</a>
<a name="ln405">// Process mixer function - service a single mixer function</a>
<a name="ln406">//</a>
<a name="ln407">//===========================================================================</a>
<a name="ln408"> </a>
<a name="ln409">ECHOSTATUS CEchoGals::ProcessMixerFunction</a>
<a name="ln410">(</a>
<a name="ln411">	PMIXER_FUNCTION	pMixerFunction,</a>
<a name="ln412">	INT32 &amp;					iRtnDataSz</a>
<a name="ln413">)</a>
<a name="ln414">{</a>
<a name="ln415">	ECHOSTATUS			Status = ECHOSTATUS_OK;</a>
<a name="ln416">	</a>
<a name="ln417">	if (m_fMixerDisabled)</a>
<a name="ln418">		return ECHOSTATUS_MIXER_DISABLED;</a>
<a name="ln419">	</a>
<a name="ln420">	switch ( pMixerFunction-&gt;iFunction )</a>
<a name="ln421">	{</a>
<a name="ln422">		case MXF_GET_CAPS :</a>
<a name="ln423">			Status = GetCapabilities( &amp;pMixerFunction-&gt;Data.Capabilities );</a>
<a name="ln424">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln425">									 &quot;MXF_GET_CAPS  Status %ld\n&quot;, Status) );</a>
<a name="ln426">			break;</a>
<a name="ln427"> </a>
<a name="ln428">		case MXF_GET_LEVEL :</a>
<a name="ln429">			Status = GetAudioLineLevel( pMixerFunction);</a>
<a name="ln430">			/*</a>
<a name="ln431">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln432">									 &quot;MXF_GET_LEVEL  Status %ld\n&quot;, Status) );</a>
<a name="ln433">			*/</a>
<a name="ln434">			break;</a>
<a name="ln435"> </a>
<a name="ln436">		case MXF_SET_LEVEL :</a>
<a name="ln437">			Status = SetAudioLineLevel( pMixerFunction);</a>
<a name="ln438">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln439">									 &quot;MXF_SET_LEVEL  Status %ld\n&quot;, Status) );</a>
<a name="ln440">			break;</a>
<a name="ln441"> </a>
<a name="ln442">		case MXF_GET_NOMINAL :</a>
<a name="ln443">			Status = GetAudioNominal( pMixerFunction);</a>
<a name="ln444">			/*</a>
<a name="ln445">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln446">									 &quot;MXF_GET_NOMINAL  Status %ld\n&quot;, Status) );</a>
<a name="ln447">			*/</a>
<a name="ln448">			break;</a>
<a name="ln449"> </a>
<a name="ln450">		case MXF_SET_NOMINAL :</a>
<a name="ln451">			Status = SetAudioNominal( pMixerFunction);</a>
<a name="ln452">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln453">									 &quot;MXF_SET_NOMINAL  Status %ld\n&quot;, Status) );</a>
<a name="ln454">			break;</a>
<a name="ln455"> </a>
<a name="ln456">		case MXF_GET_MONITOR :</a>
<a name="ln457">			Status = GetAudioMonitor( pMixerFunction-&gt;Channel.wChannel,</a>
<a name="ln458">											  pMixerFunction-&gt;Data.Monitor.wBusOut,</a>
<a name="ln459">											  pMixerFunction-&gt;Data.Monitor.Data.iLevel );</a>
<a name="ln460">			/*	  </a>
<a name="ln461">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln462">									 &quot;MXF_GET_MONITOR  Status %ld\n&quot;, Status) );</a>
<a name="ln463">			*/</a>
<a name="ln464">			break;</a>
<a name="ln465"> </a>
<a name="ln466">		case MXF_SET_MONITOR :</a>
<a name="ln467">			Status = SetAudioMonitor( pMixerFunction-&gt;Channel.wChannel,</a>
<a name="ln468">											  pMixerFunction-&gt;Data.Monitor.wBusOut,</a>
<a name="ln469">											  pMixerFunction-&gt;Data.Monitor.Data.iLevel );</a>
<a name="ln470">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln471">									 &quot;MXF_SET_MONITOR  Status %ld\n&quot;, Status) );</a>
<a name="ln472">			break;</a>
<a name="ln473"> </a>
<a name="ln474">		case MXF_GET_CLOCK_DETECT :</a>
<a name="ln475">			Status = GetInputClockDetect( pMixerFunction-&gt;Data.dwClockDetectBits );</a>
<a name="ln476">			break;</a>
<a name="ln477">	</a>
<a name="ln478">		case MXF_GET_INPUT_CLOCK :</a>
<a name="ln479">			Status = GetInputClock( pMixerFunction-&gt;Data.wClock );</a>
<a name="ln480">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln481">									 &quot;MXF_GET_INPUT_CLOCK  Status %ld\n&quot;, Status) );</a>
<a name="ln482">			break;			</a>
<a name="ln483"> </a>
<a name="ln484">		case MXF_SET_INPUT_CLOCK :</a>
<a name="ln485">			Status = SetInputClock( pMixerFunction-&gt;Data.wClock );</a>
<a name="ln486">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln487">									 &quot;MXF_SET_INPUT_CLOCK  Status %ld\n&quot;, Status) );</a>
<a name="ln488">			break;			</a>
<a name="ln489"> </a>
<a name="ln490"> </a>
<a name="ln491">		case MXF_GET_OUTPUT_CLOCK :</a>
<a name="ln492">			Status = GetOutputClock( pMixerFunction-&gt;Data.wClock );</a>
<a name="ln493">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln494">									 &quot;MXF_GET_OUTPUT_CLOCK  Status %ld\n&quot;, Status) );</a>
<a name="ln495">			break;			</a>
<a name="ln496"> </a>
<a name="ln497">		case MXF_SET_OUTPUT_CLOCK :</a>
<a name="ln498">			Status = SetOutputClock( pMixerFunction-&gt;Data.wClock );</a>
<a name="ln499">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln500">									 &quot;MXF_SET_OUTPUT_CLOCK  Status %ld\n&quot;, Status) );</a>
<a name="ln501">			break;			</a>
<a name="ln502"> </a>
<a name="ln503"> </a>
<a name="ln504">		case MXF_GET_METERS :</a>
<a name="ln505">		</a>
<a name="ln506">			if (NULL != GetDspCommObject())</a>
<a name="ln507">			{</a>
<a name="ln508">				Status = GetDspCommObject()-&gt;</a>
<a name="ln509">								GetAudioMeters( &amp;pMixerFunction-&gt;Data.Meters );				</a>
<a name="ln510">			}</a>
<a name="ln511">			else</a>
<a name="ln512">			{</a>
<a name="ln513">				Status = ECHOSTATUS_DSP_DEAD;</a>
<a name="ln514">			}</a>
<a name="ln515"> </a>
<a name="ln516">			//ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln517">			// 						 &quot;MXF_GET_METERS  Status %ld\n&quot;, Status) );</a>
<a name="ln518">			break;</a>
<a name="ln519"> </a>
<a name="ln520">		case MXF_GET_METERS_ON :</a>
<a name="ln521">			Status = GetMetersOn( pMixerFunction-&gt;Data.bMetersOn );</a>
<a name="ln522">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln523">									 &quot;MXF_SET_METERS  Status %ld\n&quot;, Status) );</a>
<a name="ln524">			break;</a>
<a name="ln525"> </a>
<a name="ln526">		case MXF_SET_METERS_ON :</a>
<a name="ln527">			Status = SetMetersOn( pMixerFunction-&gt;Data.bMetersOn );</a>
<a name="ln528">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln529">									 &quot;MXF_SET_METERS_ON  Status %ld\n&quot;, Status) );</a>
<a name="ln530">			break;</a>
<a name="ln531"> </a>
<a name="ln532">		case MXF_GET_PROF_SPDIF :</a>
<a name="ln533">			if ( ECHOSTATUS_DSP_DEAD == IsProfessionalSpdif() )</a>
<a name="ln534">			{</a>
<a name="ln535">				Status = ECHOSTATUS_DSP_DEAD;				</a>
<a name="ln536">			}</a>
<a name="ln537">			else</a>
<a name="ln538">			{</a>
<a name="ln539">				pMixerFunction-&gt;Data.bProfSpdif = IsProfessionalSpdif();</a>
<a name="ln540">			}</a>
<a name="ln541">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln542">									 &quot;MXF_GET_PROF_SPDIF  Pro S/PDIF: 0x%x  Status %ld\n&quot;, </a>
<a name="ln543">									 pMixerFunction-&gt;Data.bProfSpdif,</a>
<a name="ln544">									 Status) );</a>
<a name="ln545">			break;</a>
<a name="ln546"> </a>
<a name="ln547">		case MXF_SET_PROF_SPDIF :</a>
<a name="ln548">			SetProfessionalSpdif( pMixerFunction-&gt;Data.bProfSpdif );</a>
<a name="ln549">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln550">									 &quot;MXF_SET_PROF_SPDIF  Pro S/PDIF: 0x%x  Status %ld\n&quot;, </a>
<a name="ln551">									 pMixerFunction-&gt;Data.bProfSpdif,</a>
<a name="ln552">									 Status) );</a>
<a name="ln553">			break;</a>
<a name="ln554"> </a>
<a name="ln555">		case MXF_GET_MUTE :</a>
<a name="ln556">			Status = GetAudioMute(pMixerFunction);</a>
<a name="ln557">			/*</a>
<a name="ln558">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln559">									 &quot;MXF_GET_MUTE  Status %ld\n&quot;, Status) );</a>
<a name="ln560">			*/</a>
<a name="ln561">			break;</a>
<a name="ln562"> </a>
<a name="ln563">		case MXF_SET_MUTE :</a>
<a name="ln564">			Status = SetAudioMute(pMixerFunction);</a>
<a name="ln565">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln566">									 &quot;MXF_SET_MUTE  Status %ld\n&quot;, Status) );</a>
<a name="ln567">			break;</a>
<a name="ln568"> </a>
<a name="ln569">		case MXF_GET_MONITOR_MUTE :</a>
<a name="ln570">			Status = </a>
<a name="ln571">				GetAudioMonitorMute( pMixerFunction-&gt;Channel.wChannel,</a>
<a name="ln572">										   pMixerFunction-&gt;Data.Monitor.wBusOut,</a>
<a name="ln573">										   pMixerFunction-&gt;Data.Monitor.Data.bMuteOn );</a>
<a name="ln574">			/*</a>
<a name="ln575">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln576">									 &quot;MXF_GET_MONITOR_MUTE  Status %ld\n&quot;, Status) );</a>
<a name="ln577">			*/</a>
<a name="ln578">			break;</a>
<a name="ln579"> </a>
<a name="ln580">		case MXF_SET_MONITOR_MUTE :</a>
<a name="ln581">			Status = </a>
<a name="ln582">				SetAudioMonitorMute( pMixerFunction-&gt;Channel.wChannel,</a>
<a name="ln583">										   pMixerFunction-&gt;Data.Monitor.wBusOut,</a>
<a name="ln584">										   pMixerFunction-&gt;Data.Monitor.Data.bMuteOn );</a>
<a name="ln585">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln586">									 &quot;MXF_SET_MONITOR_MUTE  Status %ld\n&quot;, Status) );</a>
<a name="ln587">			break;</a>
<a name="ln588"> </a>
<a name="ln589">		case MXF_GET_MONITOR_PAN :</a>
<a name="ln590">			Status = </a>
<a name="ln591">				GetAudioMonitorPan( pMixerFunction-&gt;Channel.wChannel,</a>
<a name="ln592">										  pMixerFunction-&gt;Data.Monitor.wBusOut,</a>
<a name="ln593">										  pMixerFunction-&gt;Data.Monitor.Data.iPan);</a>
<a name="ln594">			/*</a>
<a name="ln595"> </a>
<a name="ln596">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln597">									 &quot;MXF_GET_MONITOR_PAN  Status %ld\n&quot;, Status) );</a>
<a name="ln598">			*/									 </a>
<a name="ln599">									 </a>
<a name="ln600">			break;</a>
<a name="ln601">		case MXF_SET_MONITOR_PAN :</a>
<a name="ln602">			Status = </a>
<a name="ln603">				SetAudioMonitorPan( pMixerFunction-&gt;Channel.wChannel,</a>
<a name="ln604">										  pMixerFunction-&gt;Data.Monitor.wBusOut,</a>
<a name="ln605">										  pMixerFunction-&gt;Data.Monitor.Data.iPan );</a>
<a name="ln606">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln607">									 &quot;MXF_SET_MONITOR_PAN  Status %ld\n&quot;, Status) );</a>
<a name="ln608">			break;</a>
<a name="ln609"> </a>
<a name="ln610">		case MXF_GET_FLAGS :</a>
<a name="ln611">			pMixerFunction-&gt;Data.wFlags = GetFlags();</a>
<a name="ln612">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln613">									 &quot;MXF_GET_FLAGS 0x%x  Status %ld\n&quot;,</a>
<a name="ln614">									 pMixerFunction-&gt;Data.wFlags,</a>
<a name="ln615">									 Status) );</a>
<a name="ln616">			break;</a>
<a name="ln617">		case MXF_SET_FLAGS :</a>
<a name="ln618">			SetFlags( pMixerFunction-&gt;Data.wFlags );</a>
<a name="ln619">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln620">									 &quot;MXF_SET_FLAGS 0x%x  Status %ld\n&quot;,</a>
<a name="ln621">									 pMixerFunction-&gt;Data.wFlags,</a>
<a name="ln622">									 Status) );</a>
<a name="ln623">			break;</a>
<a name="ln624">		case MXF_CLEAR_FLAGS :</a>
<a name="ln625">			ClearFlags( pMixerFunction-&gt;Data.wFlags );</a>
<a name="ln626">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln627">									 &quot;MXF_CLEAR_FLAGS 0x%x  Status %ld\n&quot;,</a>
<a name="ln628">									 pMixerFunction-&gt;Data.wFlags,</a>
<a name="ln629">									 Status) );</a>
<a name="ln630">			break;</a>
<a name="ln631"> </a>
<a name="ln632">		case MXF_GET_SAMPLERATE_LOCK :</a>
<a name="ln633">			GetAudioLockedSampleRate( pMixerFunction-&gt;Data.dwLockedSampleRate );</a>
<a name="ln634">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln635">									 &quot;MXF_GET_SAMPLERATE_LOCK 0x%lx  Status %ld\n&quot;,</a>
<a name="ln636">									 pMixerFunction-&gt;Data.dwLockedSampleRate,</a>
<a name="ln637">									 Status) );</a>
<a name="ln638">			break;</a>
<a name="ln639"> </a>
<a name="ln640">		case MXF_SET_SAMPLERATE_LOCK :</a>
<a name="ln641">			SetAudioLockedSampleRate( pMixerFunction-&gt;Data.dwLockedSampleRate );</a>
<a name="ln642">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln643">									 &quot;MXF_SET_SAMPLERATE_LOCK 0x%lx  Status %ld\n&quot;,</a>
<a name="ln644">									 pMixerFunction-&gt;Data.dwLockedSampleRate,</a>
<a name="ln645">									 Status) );</a>
<a name="ln646">			break;</a>
<a name="ln647"> </a>
<a name="ln648">		case MXF_GET_SAMPLERATE :</a>
<a name="ln649">		</a>
<a name="ln650">			GetAudioSampleRate( &amp;pMixerFunction-&gt;Data.dwSampleRate );</a>
<a name="ln651"> </a>
<a name="ln652">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln653">									 &quot;MXF_GET_SAMPLERATE 0x%lx  Status %ld\n&quot;,</a>
<a name="ln654">									 pMixerFunction-&gt;Data.dwSampleRate,</a>
<a name="ln655">									 Status) );</a>
<a name="ln656">			break;</a>
<a name="ln657"> </a>
<a name="ln658">#ifdef MIDI_SUPPORT			</a>
<a name="ln659"> </a>
<a name="ln660">		case MXF_GET_MIDI_IN_ACTIVITY :</a>
<a name="ln661">			pMixerFunction-&gt;Data.bMidiActive = m_MidiIn.IsActive();</a>
<a name="ln662"> </a>
<a name="ln663">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln664">									 &quot;MXF_GET_MIDI_IN_ACTIVITY %s &quot;</a>
<a name="ln665">									 &quot;Status %ld\n&quot;,</a>
<a name="ln666">									 ( pMixerFunction-&gt;Data.bMidiActive ) </a>
<a name="ln667">										? &quot;ACTIVE&quot; : &quot;INACTIVE&quot;,</a>
<a name="ln668">									 Status) );</a>
<a name="ln669">			break;</a>
<a name="ln670"> </a>
<a name="ln671"> </a>
<a name="ln672">		case MXF_GET_MIDI_OUT_ACTIVITY :</a>
<a name="ln673">			pMixerFunction-&gt;Data.bMidiActive =</a>
<a name="ln674">				GetDspCommObject()-&gt;IsMidiOutActive();</a>
<a name="ln675"> </a>
<a name="ln676">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln677">									 &quot;MXF_GET_MIDI_OUT_ACTIVITY %s &quot;</a>
<a name="ln678">									 &quot;Status %ld\n&quot;,</a>
<a name="ln679">									 ( pMixerFunction-&gt;Data.bMidiActive ) </a>
<a name="ln680">										? &quot;ACTIVE&quot; : &quot;INACTIVE&quot;,</a>
<a name="ln681">									 Status) );</a>
<a name="ln682">			break;</a>
<a name="ln683"> </a>
<a name="ln684">#endif // MIDI_SUPPORT</a>
<a name="ln685"> </a>
<a name="ln686"> </a>
<a name="ln687">		case MXF_GET_DIGITAL_MODE :</a>
<a name="ln688">			Status = ECHOSTATUS_OK;</a>
<a name="ln689">			pMixerFunction-&gt;Data.iDigMode = GetDigitalMode();</a>
<a name="ln690">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln691">									 &quot;MXF_GET_DIGITAL_MODE %s &quot;</a>
<a name="ln692">									 &quot;Status %ld\n&quot;,</a>
<a name="ln693">									 ( DIGITAL_MODE_SPDIF_RCA == </a>
<a name="ln694">											pMixerFunction-&gt;Data.iDigMode )</a>
<a name="ln695">										? &quot;S/PDIF RCA&quot; </a>
<a name="ln696">										: ( DIGITAL_MODE_SPDIF_OPTICAL == </a>
<a name="ln697">											pMixerFunction-&gt;Data.iDigMode )</a>
<a name="ln698">												? &quot;S/PDIF Optical&quot; : &quot;ADAT&quot;,</a>
<a name="ln699">									 Status) );</a>
<a name="ln700">			break;</a>
<a name="ln701"> </a>
<a name="ln702"> </a>
<a name="ln703">		case MXF_SET_DIGITAL_MODE :</a>
<a name="ln704">			Status = SetDigitalMode( (BYTE) pMixerFunction-&gt;Data.iDigMode );</a>
<a name="ln705">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln706">									 &quot;MXF_SET_DIGITAL_MODE %s &quot;</a>
<a name="ln707">									 &quot;Status %ld\n&quot;,</a>
<a name="ln708">									 ( DIGITAL_MODE_SPDIF_RCA == </a>
<a name="ln709">											pMixerFunction-&gt;Data.iDigMode )</a>
<a name="ln710">										? &quot;S/PDIF RCA&quot; </a>
<a name="ln711">										: ( DIGITAL_MODE_SPDIF_OPTICAL == </a>
<a name="ln712">											pMixerFunction-&gt;Data.iDigMode )</a>
<a name="ln713">												? &quot;S/PDIF Optical&quot; : &quot;ADAT&quot;,</a>
<a name="ln714">									 Status) );</a>
<a name="ln715">			break;</a>
<a name="ln716"> </a>
<a name="ln717"> </a>
<a name="ln718">		case MXF_GET_PAN :</a>
<a name="ln719">			Status = GetAudioPan( pMixerFunction);</a>
<a name="ln720">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln721">									 &quot;MXF_GET_PAN  Status %ld\n&quot;, Status) );</a>
<a name="ln722">			break;</a>
<a name="ln723"> </a>
<a name="ln724">		case MXF_SET_PAN :</a>
<a name="ln725">			Status = SetAudioPan( pMixerFunction);</a>
<a name="ln726">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln727">									 &quot;MXF_SET_PAN  Status %ld\n&quot;, Status) );</a>
<a name="ln728">			break;</a>
<a name="ln729">			</a>
<a name="ln730">#ifdef DIGITAL_INPUT_AUTO_MUTE_SUPPORT</a>
<a name="ln731"> </a>
<a name="ln732">		case MXF_GET_DIG_IN_AUTO_MUTE	:</a>
<a name="ln733">			Status =  GetDigitalInAutoMute( pMixerFunction );</a>
<a name="ln734">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln735">									 &quot;MXF_GET_DIG_IN_AUTO_MUTE  Status %ld\n&quot;, Status) );</a>
<a name="ln736">			break;</a>
<a name="ln737">			</a>
<a name="ln738"> </a>
<a name="ln739">		case MXF_SET_DIG_IN_AUTO_MUTE	:</a>
<a name="ln740">			Status = SetDigitalInAutoMute( pMixerFunction );</a>
<a name="ln741">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln742">									 &quot;MXF_SET_DIG_IN_AUTO_MUTE  Status %ld\n&quot;, Status) );</a>
<a name="ln743">			break;</a>
<a name="ln744"> </a>
<a name="ln745">#endif // DIGITAL_INPUT_AUTO_MUTE_SUPPORT</a>
<a name="ln746"> </a>
<a name="ln747">		case MXF_GET_AUDIO_LATENCY :</a>
<a name="ln748">			GetAudioLatency( &amp;(pMixerFunction-&gt;Data.Latency) );</a>
<a name="ln749">			break;</a>
<a name="ln750">			</a>
<a name="ln751">#ifdef PHANTOM_POWER_CONTROL</a>
<a name="ln752">		</a>
<a name="ln753">		case MXF_GET_PHANTOM_POWER :</a>
<a name="ln754">			GetPhantomPower( &amp;(pMixerFunction-&gt;Data.fPhantomPower) );</a>
<a name="ln755">			break;</a>
<a name="ln756">			</a>
<a name="ln757">		case MXF_SET_PHANTOM_POWER :</a>
<a name="ln758">			SetPhantomPower( pMixerFunction-&gt;Data.fPhantomPower );</a>
<a name="ln759">			break;</a>
<a name="ln760">			</a>
<a name="ln761">#endif</a>
<a name="ln762"> </a>
<a name="ln763">		default :</a>
<a name="ln764">			iRtnDataSz = 0;</a>
<a name="ln765">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerFunction: &quot;</a>
<a name="ln766">									 &quot;Function %ld not supported\n&quot;,</a>
<a name="ln767">									 pMixerFunction-&gt;iFunction) );</a>
<a name="ln768">			return ECHOSTATUS_NOT_SUPPORTED;</a>
<a name="ln769">	}</a>
<a name="ln770"> </a>
<a name="ln771">	pMixerFunction-&gt;RtnStatus = Status;</a>
<a name="ln772">	iRtnDataSz = sizeof( MIXER_FUNCTION );</a>
<a name="ln773"> </a>
<a name="ln774">	return Status;</a>
<a name="ln775"> </a>
<a name="ln776">}	// ECHOSTATUS CEchoGals::ProcessMixerFunction</a>
<a name="ln777"> </a>
<a name="ln778"> </a>
<a name="ln779"> </a>
<a name="ln780"> </a>
<a name="ln781">//===========================================================================</a>
<a name="ln782">//</a>
<a name="ln783">// Process multiple mixer functions</a>
<a name="ln784">//</a>
<a name="ln785">//===========================================================================</a>
<a name="ln786"> </a>
<a name="ln787">ECHOSTATUS CEchoGals::ProcessMixerMultiFunction</a>
<a name="ln788">(</a>
<a name="ln789">	PMIXER_MULTI_FUNCTION	pMixerFunctions,	// Request from mixer</a>
<a name="ln790">	INT32 &amp;							iRtnDataSz			// # bytes returned (if any)</a>
<a name="ln791">)</a>
<a name="ln792">{</a>
<a name="ln793">	ECHOSTATUS			Status = ECHOSTATUS_NOT_SUPPORTED;</a>
<a name="ln794">	PMIXER_FUNCTION	pMixerFunction;</a>
<a name="ln795">	INT32					iRtn, nCard, i;</a>
<a name="ln796">	</a>
<a name="ln797">	if (m_fMixerDisabled)</a>
<a name="ln798">		return ECHOSTATUS_MIXER_DISABLED;</a>
<a name="ln799"> </a>
<a name="ln800">	iRtnDataSz = sizeof( MIXER_MULTI_FUNCTION ) - sizeof( MIXER_FUNCTION );</a>
<a name="ln801">	pMixerFunction = &amp;pMixerFunctions-&gt;MixerFunction[ 0 ];</a>
<a name="ln802">	nCard = pMixerFunction-&gt;Channel.wCardId;</a>
<a name="ln803">	for ( i = 0; i &lt; pMixerFunctions-&gt;iCount; i++ )</a>
<a name="ln804">	{</a>
<a name="ln805">		pMixerFunction = &amp;pMixerFunctions-&gt;MixerFunction[ i ];</a>
<a name="ln806">		if ( nCard != pMixerFunction-&gt;Channel.wCardId )</a>
<a name="ln807">		{</a>
<a name="ln808">			ECHO_DEBUGPRINTF( (&quot;CEchoGals::ProcessMixerMultiFunction: &quot;</a>
<a name="ln809">									 &quot;All functions MUST be for the same card &quot;</a>
<a name="ln810">									 &quot;exp %ld act %d!\n&quot;,</a>
<a name="ln811">									 nCard,</a>
<a name="ln812">									 pMixerFunction-&gt;Channel.wCardId) );</a>
<a name="ln813">			return ECHOSTATUS_NOT_SUPPORTED;</a>
<a name="ln814">		}</a>
<a name="ln815"> </a>
<a name="ln816">		Status = ProcessMixerFunction(pMixerFunction,iRtn);</a>
<a name="ln817">		iRtnDataSz += iRtn;</a>
<a name="ln818">	}</a>
<a name="ln819"> </a>
<a name="ln820">	return Status;</a>
<a name="ln821"> </a>
<a name="ln822">}	// ECHOSTATUS CEchoGals::ProcessMixerMultiFunction</a>
<a name="ln823"> </a>
<a name="ln824"> </a>
<a name="ln825"> </a>
<a name="ln826"> </a>
<a name="ln827">//===========================================================================</a>
<a name="ln828">//</a>
<a name="ln829">// Typically, if you are writing a console, you will be polling the driver</a>
<a name="ln830">// to get the current peak and VU meters, clock detect bits, and </a>
<a name="ln831">// control changes.  GetPolledStuff will fill out an ECHO_POLLED_STUFF</a>
<a name="ln832">// structure with all of those things.</a>
<a name="ln833">//</a>
<a name="ln834">//===========================================================================</a>
<a name="ln835"> </a>
<a name="ln836">ECHOSTATUS CEchoGals::GetPolledStuff</a>
<a name="ln837">(</a>
<a name="ln838">	ECHO_POLLED_STUFF *pPolledStuff,</a>
<a name="ln839">	NUINT MixerCookie</a>
<a name="ln840">)</a>
<a name="ln841">{</a>
<a name="ln842">	ECHO_MIXER_CLIENT *pClient;</a>
<a name="ln843">	CDspCommObject *pDCO = GetDspCommObject();</a>
<a name="ln844">	</a>
<a name="ln845">	if (m_fMixerDisabled)</a>
<a name="ln846">		return ECHOSTATUS_MIXER_DISABLED;</a>
<a name="ln847">	</a>
<a name="ln848">	if (NULL == pDCO)</a>
<a name="ln849">		return ECHOSTATUS_DSP_DEAD;</a>
<a name="ln850">		</a>
<a name="ln851">	//</a>
<a name="ln852">	// Fill out the non-client-specific portions of the struct</a>
<a name="ln853">	//</a>
<a name="ln854">	pDCO-&gt;GetAudioMeters(&amp;(pPolledStuff-&gt;Meters));</a>
<a name="ln855">	GetInputClockDetect(pPolledStuff-&gt;dwClockDetectBits);</a>
<a name="ln856">	</a>
<a name="ln857">	//</a>
<a name="ln858">	// If there is a matching client, fill out the number</a>
<a name="ln859">	// of notifies</a>
<a name="ln860">	//</a>
<a name="ln861">	pClient = GetMixerClient(MixerCookie);</a>
<a name="ln862">	if (NULL == pClient)</a>
<a name="ln863">		pPolledStuff-&gt;dwNumPendingNotifies = 0;</a>
<a name="ln864">	else	</a>
<a name="ln865">		pPolledStuff-&gt;dwNumPendingNotifies = pClient-&gt;dwCount;</a>
<a name="ln866">	</a>
<a name="ln867">	return ECHOSTATUS_OK;</a>
<a name="ln868">	</a>
<a name="ln869">}	// GetPolledStuff</a>
<a name="ln870"> </a>
<a name="ln871"> </a>
<a name="ln872">//===========================================================================</a>
<a name="ln873">//</a>
<a name="ln874">//	Get the pan setting for an output pipe (virtual outputs only)</a>
<a name="ln875">//</a>
<a name="ln876">//===========================================================================</a>
<a name="ln877"> </a>
<a name="ln878">ECHOSTATUS CEchoGals::GetAudioPan</a>
<a name="ln879">(</a>
<a name="ln880">	PMIXER_FUNCTION	pMF</a>
<a name="ln881">)</a>
<a name="ln882">{</a>
<a name="ln883">	WORD 			wPipe;</a>
<a name="ln884">	WORD 			wBus;</a>
<a name="ln885">	ECHOSTATUS 	Status;</a>
<a name="ln886">	</a>
<a name="ln887">	if ( 	(pMF-&gt;Channel.dwType != ECHO_PIPE_OUT) ||</a>
<a name="ln888">			( !HasVmixer() ) )</a>
<a name="ln889">		return ECHOSTATUS_INVALID_CHANNEL;</a>
<a name="ln890">		</a>
<a name="ln891">	wPipe = pMF-&gt;Channel.wChannel;</a>
<a name="ln892">	wBus = pMF-&gt;Data.PipeOut.wBusOut;</a>
<a name="ln893">	Status = m_PipeOutCtrl.GetPan(wPipe,</a>
<a name="ln894">											wBus,</a>
<a name="ln895">											pMF-&gt;Data.PipeOut.Data.iPan);</a>
<a name="ln896"> </a>
<a name="ln897">	return Status;</a>
<a name="ln898"> </a>
<a name="ln899">}	// ECHOSTATUS CEchoGals::GetAudioPan</a>
<a name="ln900"> </a>
<a name="ln901"> </a>
<a name="ln902">//===========================================================================</a>
<a name="ln903">//</a>
<a name="ln904">//	Set the pan for an output pipe (virtual outputs only)</a>
<a name="ln905">//</a>
<a name="ln906">//===========================================================================</a>
<a name="ln907"> </a>
<a name="ln908">ECHOSTATUS CEchoGals::SetAudioPan</a>
<a name="ln909">(</a>
<a name="ln910">	PMIXER_FUNCTION	pMF</a>
<a name="ln911">)</a>
<a name="ln912">{</a>
<a name="ln913">	WORD 			wPipe;</a>
<a name="ln914">	WORD 			wBus;</a>
<a name="ln915">	ECHOSTATUS 	Status;</a>
<a name="ln916">	</a>
<a name="ln917">	if ( 	(pMF-&gt;Channel.dwType != ECHO_PIPE_OUT) ||</a>
<a name="ln918">			( !HasVmixer() ) )</a>
<a name="ln919">		return ECHOSTATUS_INVALID_CHANNEL;</a>
<a name="ln920">		</a>
<a name="ln921">	wPipe = pMF-&gt;Channel.wChannel;</a>
<a name="ln922">	wBus = pMF-&gt;Data.PipeOut.wBusOut;</a>
<a name="ln923">	Status = m_PipeOutCtrl.SetPan(wPipe,</a>
<a name="ln924">											wBus,</a>
<a name="ln925">											pMF-&gt;Data.PipeOut.Data.iPan);</a>
<a name="ln926"> </a>
<a name="ln927">	return Status;</a>
<a name="ln928">	</a>
<a name="ln929">}	// ECHOSTATUS CEchoGals::SetAudioPan</a>
<a name="ln930"> </a>
<a name="ln931"> </a>
<a name="ln932"> </a>
<a name="ln933"> </a>
<a name="ln934">/****************************************************************************</a>
<a name="ln935"> </a>
<a name="ln936">	CEchoGals clock control</a>
<a name="ln937">	</a>
<a name="ln938">	The input clock is the sync source - is the audio for this card running</a>
<a name="ln939">	off of the internal clock, synced to word clock, etc.</a>
<a name="ln940">	</a>
<a name="ln941">	Output clock is only supported on Layla20 - Layla20 can transmit either</a>
<a name="ln942">	word or super clock.</a>
<a name="ln943"> </a>
<a name="ln944"> ****************************************************************************/</a>
<a name="ln945"> </a>
<a name="ln946">//===========================================================================</a>
<a name="ln947">//</a>
<a name="ln948">// Get input and output clocks - just return the stored value</a>
<a name="ln949">//</a>
<a name="ln950">//===========================================================================</a>
<a name="ln951"> </a>
<a name="ln952">ECHOSTATUS CEchoGals::GetInputClock(WORD &amp;wClock)</a>
<a name="ln953">{</a>
<a name="ln954">	if ( NULL == GetDspCommObject() )</a>
<a name="ln955">		return ECHOSTATUS_DSP_DEAD;</a>
<a name="ln956"> </a>
<a name="ln957">	wClock = GetDspCommObject()-&gt;GetInputClock();</a>
<a name="ln958">	</a>
<a name="ln959">	return ECHOSTATUS_OK;</a>
<a name="ln960">}	</a>
<a name="ln961"> </a>
<a name="ln962"> </a>
<a name="ln963">ECHOSTATUS CEchoGals::GetOutputClock(WORD &amp;wClock)</a>
<a name="ln964">{</a>
<a name="ln965">	if ( NULL == GetDspCommObject() )</a>
<a name="ln966">		return ECHOSTATUS_DSP_DEAD;</a>
<a name="ln967"> </a>
<a name="ln968">	wClock = GetDspCommObject()-&gt;GetOutputClock();</a>
<a name="ln969">	</a>
<a name="ln970">	return ECHOSTATUS_OK;</a>
<a name="ln971">}	</a>
<a name="ln972"> </a>
<a name="ln973"> </a>
<a name="ln974">//===========================================================================</a>
<a name="ln975">//</a>
<a name="ln976">// Set input and output clocks - pass it down to the comm page and</a>
<a name="ln977">// store the control change.</a>
<a name="ln978">//</a>
<a name="ln979">//===========================================================================</a>
<a name="ln980"> </a>
<a name="ln981">ECHOSTATUS CEchoGals::SetInputClock(WORD wClock)</a>
<a name="ln982">{</a>
<a name="ln983">	ECHOSTATUS Status;</a>
<a name="ln984"> </a>
<a name="ln985">	if ( NULL == GetDspCommObject() || GetDspCommObject()-&gt;IsBoardBad() )</a>
<a name="ln986">		return ECHOSTATUS_DSP_DEAD;</a>
<a name="ln987"> </a>
<a name="ln988">	ECHO_DEBUGPRINTF( (&quot;CEchoGals::SetInputClock: &quot;) );</a>
<a name="ln989">	</a>
<a name="ln990">	Status = GetDspCommObject()-&gt;SetInputClock( wClock );</a>
<a name="ln991"> </a>
<a name="ln992">	if (ECHOSTATUS_OK == Status)</a>
<a name="ln993">	{</a>
<a name="ln994">		MixerControlChanged( ECHO_NO_CHANNEL_TYPE,</a>
<a name="ln995">									MXN_INPUT_CLOCK);</a>
<a name="ln996">	}</a>
<a name="ln997">	return Status;</a>
<a name="ln998"> </a>
<a name="ln999">}	// SetInputClock</a>
<a name="ln1000"> </a>
<a name="ln1001"> </a>
<a name="ln1002">ECHOSTATUS CEchoGals::SetOutputClock(WORD wClock)</a>
<a name="ln1003">{</a>
<a name="ln1004">	ECHOSTATUS Status;</a>
<a name="ln1005"> </a>
<a name="ln1006">	if ( NULL == GetDspCommObject() || GetDspCommObject()-&gt;IsBoardBad() )</a>
<a name="ln1007">		return ECHOSTATUS_DSP_DEAD;</a>
<a name="ln1008"> </a>
<a name="ln1009">	ECHO_DEBUGPRINTF( (&quot;CEchoGals::SetOutputClock: &quot;) );</a>
<a name="ln1010">	</a>
<a name="ln1011">	Status = GetDspCommObject()-&gt;SetOutputClock( wClock );</a>
<a name="ln1012"> </a>
<a name="ln1013">	if (ECHOSTATUS_OK == Status)</a>
<a name="ln1014">	{</a>
<a name="ln1015">		MixerControlChanged( ECHO_NO_CHANNEL_TYPE,</a>
<a name="ln1016">									MXN_OUTPUT_CLOCK);</a>
<a name="ln1017">	}</a>
<a name="ln1018">	return Status;</a>
<a name="ln1019"> </a>
<a name="ln1020">}	</a>
<a name="ln1021"> </a>
<a name="ln1022"> </a>
<a name="ln1023">//===========================================================================</a>
<a name="ln1024">//</a>
<a name="ln1025">// Get the currently detected clock bits - default method.  Overridden by </a>
<a name="ln1026">// derived card classes.</a>
<a name="ln1027">//</a>
<a name="ln1028">//===========================================================================</a>
<a name="ln1029"> </a>
<a name="ln1030">ECHOSTATUS CEchoGals::GetInputClockDetect(DWORD &amp;dwClockDetectBits)</a>
<a name="ln1031">{</a>
<a name="ln1032">	dwClockDetectBits = ECHO_CLOCK_INTERNAL;</a>
<a name="ln1033"> </a>
<a name="ln1034">	return ECHOSTATUS_OK;</a>
<a name="ln1035">}	</a>
<a name="ln1036"> </a>
<a name="ln1037"> </a>
<a name="ln1038">//===========================================================================</a>
<a name="ln1039">//</a>
<a name="ln1040">// Set the locked sample rate</a>
<a name="ln1041">//</a>
<a name="ln1042">//===========================================================================</a>
<a name="ln1043"> </a>
<a name="ln1044">ECHOSTATUS CEchoGals::SetAudioLockedSampleRate</a>
<a name="ln1045">(</a>
<a name="ln1046">	DWORD		dwSampleRate</a>
<a name="ln1047">)</a>
<a name="ln1048">{</a>
<a name="ln1049">	ECHOSTATUS	Status;</a>
<a name="ln1050">							 </a>
<a name="ln1051">	Status = QueryAudioSampleRate( dwSampleRate );</a>
<a name="ln1052">	if ( ECHOSTATUS_OK != Status )</a>
<a name="ln1053">		return Status;</a>
<a name="ln1054"> </a>
<a name="ln1055">	if (0 != (ECHOGALS_FLAG_SAMPLE_RATE_LOCKED &amp; GetFlags()))</a>
<a name="ln1056">	{</a>
<a name="ln1057">		GetDspCommObject()-&gt;SetSampleRate( dwSampleRate );</a>
<a name="ln1058">		m_dwSampleRate = dwSampleRate;</a>
<a name="ln1059">	}</a>
<a name="ln1060"> </a>
<a name="ln1061">	m_dwLockedSampleRate = dwSampleRate;</a>
<a name="ln1062"> </a>
<a name="ln1063">	return ECHOSTATUS_OK;</a>
<a name="ln1064"> </a>
<a name="ln1065">}	// ECHOSTATUS CEchoGals::SetAudioLockedSampleRate</a>
<a name="ln1066"> </a>
<a name="ln1067"> </a>
<a name="ln1068">//===========================================================================</a>
<a name="ln1069">//</a>
<a name="ln1070">// Get the locked sample rate</a>
<a name="ln1071">//</a>
<a name="ln1072">//===========================================================================</a>
<a name="ln1073"> </a>
<a name="ln1074">ECHOSTATUS CEchoGals::GetAudioLockedSampleRate</a>
<a name="ln1075">(</a>
<a name="ln1076">	DWORD	   &amp;dwSampleRate</a>
<a name="ln1077">)</a>
<a name="ln1078">{</a>
<a name="ln1079">	dwSampleRate = m_dwLockedSampleRate;</a>
<a name="ln1080">		</a>
<a name="ln1081">	return ECHOSTATUS_OK;</a>
<a name="ln1082">	</a>
<a name="ln1083">}	// ECHOSTATUS CEchoGals::GetAudioLockedSampleRate</a>
<a name="ln1084"> </a>
<a name="ln1085"> </a>
<a name="ln1086"> </a>
<a name="ln1087">#ifdef DIGITAL_INPUT_AUTO_MUTE_SUPPORT</a>
<a name="ln1088"> </a>
<a name="ln1089">//===========================================================================</a>
<a name="ln1090">//</a>
<a name="ln1091">// Get the digital input auto mute flag from the comm page</a>
<a name="ln1092">//</a>
<a name="ln1093">//===========================================================================</a>
<a name="ln1094"> </a>
<a name="ln1095">ECHOSTATUS CEchoGals::GetDigitalInAutoMute(PMIXER_FUNCTION pMixerFunction)</a>
<a name="ln1096">{</a>
<a name="ln1097">	BOOL fAutoMute;</a>
<a name="ln1098">	</a>
<a name="ln1099">	if (0 == (m_wFlags &amp; ECHOGALS_ROFLAG_DIGITAL_IN_AUTOMUTE))</a>
<a name="ln1100">	{</a>
<a name="ln1101">		pMixerFunction-&gt;Data.fDigitalInAutoMute = FALSE;</a>
<a name="ln1102">		return ECHOSTATUS_NOT_SUPPORTED;</a>
<a name="ln1103">	}</a>
<a name="ln1104"> </a>
<a name="ln1105">	GetDspCommObject()-&gt;GetDigitalInputAutoMute(	fAutoMute );</a>
<a name="ln1106">	pMixerFunction-&gt;Data.fDigitalInAutoMute = fAutoMute;</a>
<a name="ln1107">	</a>
<a name="ln1108">	return ECHOSTATUS_OK;		</a>
<a name="ln1109">	</a>
<a name="ln1110">} // GetDigitalInAutoMute</a>
<a name="ln1111"> </a>
<a name="ln1112"> </a>
<a name="ln1113">//===========================================================================</a>
<a name="ln1114">//</a>
<a name="ln1115">// Set the digital input auto mute flag</a>
<a name="ln1116">//</a>
<a name="ln1117">//===========================================================================</a>
<a name="ln1118"> </a>
<a name="ln1119">ECHOSTATUS CEchoGals::SetDigitalInAutoMute(PMIXER_FUNCTION pMixerFunction)</a>
<a name="ln1120">{</a>
<a name="ln1121">	BOOL fAutoMute;</a>
<a name="ln1122">	</a>
<a name="ln1123">	if (0 == (m_wFlags &amp; ECHOGALS_ROFLAG_DIGITAL_IN_AUTOMUTE))</a>
<a name="ln1124">		return ECHOSTATUS_NOT_SUPPORTED;</a>
<a name="ln1125">	</a>
<a name="ln1126">	fAutoMute = pMixerFunction-&gt;Data.fDigitalInAutoMute;</a>
<a name="ln1127">	GetDspCommObject()-&gt;SetDigitalInputAutoMute( fAutoMute );	</a>
<a name="ln1128">	</a>
<a name="ln1129">	return ECHOSTATUS_OK;		</a>
<a name="ln1130">	</a>
<a name="ln1131">} // SetDigitalInAutoMute</a>
<a name="ln1132"> </a>
<a name="ln1133">#endif // DIGITAL_INPUT_AUTO_MUTE_SUPPORT</a>
<a name="ln1134"> </a>
<a name="ln1135"> </a>
<a name="ln1136">//===========================================================================</a>
<a name="ln1137">//</a>
<a name="ln1138">// Get the gain for an output bus, input bus, or output pipe.</a>
<a name="ln1139">//</a>
<a name="ln1140">// Gain levels are in units of dB * 256.</a>
<a name="ln1141">//</a>
<a name="ln1142">//===========================================================================</a>
<a name="ln1143"> </a>
<a name="ln1144">ECHOSTATUS CEchoGals::GetAudioLineLevel</a>
<a name="ln1145">(</a>
<a name="ln1146">	PMIXER_FUNCTION	pMF</a>
<a name="ln1147">)</a>
<a name="ln1148">{</a>
<a name="ln1149">	WORD 			wPipe;</a>
<a name="ln1150">	WORD 			wBus;</a>
<a name="ln1151">	ECHOSTATUS 	Status;</a>
<a name="ln1152"> </a>
<a name="ln1153">	switch (pMF-&gt;Channel.dwType)</a>
<a name="ln1154">	{</a>
<a name="ln1155">		case ECHO_BUS_OUT :</a>
<a name="ln1156">			</a>
<a name="ln1157">			wBus = pMF-&gt;Channel.wChannel;</a>
<a name="ln1158">			</a>
<a name="ln1159">			if (wBus &lt; GetNumBussesOut())</a>
<a name="ln1160">			{</a>
<a name="ln1161">				pMF-&gt;Data.iLevel = m_BusOutLineLevels[wBus].GetGain();				</a>
<a name="ln1162">				Status = ECHOSTATUS_OK;</a>
<a name="ln1163">			}</a>
<a name="ln1164">			else</a>
<a name="ln1165">			{</a>
<a name="ln1166">				Status = ECHOSTATUS_INVALID_CHANNEL;</a>
<a name="ln1167">			}</a>
<a name="ln1168"> </a>
<a name="ln1169">			break;</a>
<a name="ln1170"> </a>
<a name="ln1171">		case ECHO_BUS_IN :</a>
<a name="ln1172"> </a>
<a name="ln1173">			wBus = pMF-&gt;Channel.wChannel;</a>
<a name="ln1174">			if (wBus &lt; GetNumBussesIn())</a>
<a name="ln1175">			{</a>
<a name="ln1176">				pMF-&gt;Data.iLevel = m_BusInLineLevels[wBus].GetGain();				</a>
<a name="ln1177">				Status = ECHOSTATUS_OK;</a>
<a name="ln1178">			}</a>
<a name="ln1179">			else</a>
<a name="ln1180">			{</a>
<a name="ln1181">				Status = ECHOSTATUS_INVALID_CHANNEL;</a>
<a name="ln1182">			}</a>
<a name="ln1183">			break;</a>
<a name="ln1184">		</a>
<a name="ln1185">		case ECHO_PIPE_OUT :</a>
<a name="ln1186">		</a>
<a name="ln1187">			wPipe = pMF-&gt;Channel.wChannel;</a>
<a name="ln1188">			wBus = pMF-&gt;Data.PipeOut.wBusOut;</a>
<a name="ln1189"> 			Status = m_PipeOutCtrl.GetGain(	wPipe,</a>
<a name="ln1190">														wBus,</a>
<a name="ln1191">														pMF-&gt;Data.PipeOut.Data.iLevel);</a>
<a name="ln1192">			break;</a>
<a name="ln1193"> </a>
<a name="ln1194">		default:</a>
<a name="ln1195">			Status = ECHOSTATUS_INVALID_PARAM;</a>
<a name="ln1196">			break;</a>
<a name="ln1197">	}</a>
<a name="ln1198"> </a>
<a name="ln1199">	return Status;</a>
<a name="ln1200"> </a>
<a name="ln1201">}	// ECHOSTATUS CEchoGals::GetAudioLineLevel</a>
<a name="ln1202"> </a>
<a name="ln1203"> </a>
<a name="ln1204">//===========================================================================</a>
<a name="ln1205">//</a>
<a name="ln1206">// Utility function to check that a setting is within the correct range.</a>
<a name="ln1207">//</a>
<a name="ln1208">//===========================================================================</a>
<a name="ln1209"> </a>
<a name="ln1210">ECHOSTATUS CheckSetting(INT32 iValue,INT32 iMin,INT32 iMax)</a>
<a name="ln1211">{</a>
<a name="ln1212">	if ( (iValue &gt; iMax) || (iValue &lt; iMin))</a>
<a name="ln1213">		return ECHOSTATUS_INVALID_PARAM;</a>
<a name="ln1214">	</a>
<a name="ln1215">	return ECHOSTATUS_OK;	</a>
<a name="ln1216">		</a>
<a name="ln1217">}	// CheckSetting</a>
<a name="ln1218"> </a>
<a name="ln1219"> </a>
<a name="ln1220">//===========================================================================</a>
<a name="ln1221">//</a>
<a name="ln1222">// Set the gain for an output bus, input bus, or output pipe.</a>
<a name="ln1223">//</a>
<a name="ln1224">// Gain levels are in units of dB * 256.</a>
<a name="ln1225">//</a>
<a name="ln1226">//===========================================================================</a>
<a name="ln1227"> </a>
<a name="ln1228">ECHOSTATUS CEchoGals::SetAudioLineLevel</a>
<a name="ln1229">(</a>
<a name="ln1230">	PMIXER_FUNCTION	pMF</a>
<a name="ln1231">)</a>
<a name="ln1232">{</a>
<a name="ln1233">	WORD 			wPipe;</a>
<a name="ln1234">	WORD 			wBus;</a>
<a name="ln1235">	ECHOSTATUS 	Status;</a>
<a name="ln1236">	INT32 			iLevel;</a>
<a name="ln1237"> </a>
<a name="ln1238">	switch (pMF-&gt;Channel.dwType)</a>
<a name="ln1239">	{</a>
<a name="ln1240">		case ECHO_BUS_OUT :</a>
<a name="ln1241"> </a>
<a name="ln1242">			wBus = pMF-&gt;Channel.wChannel;</a>
<a name="ln1243">			iLevel = pMF-&gt;Data.iLevel;</a>
<a name="ln1244">			</a>
<a name="ln1245">			Status = CheckSetting(iLevel,ECHOGAIN_MINOUT,ECHOGAIN_MAXOUT);</a>
<a name="ln1246">			if (ECHOSTATUS_OK != Status)</a>
<a name="ln1247">				break;</a>
<a name="ln1248">			</a>
<a name="ln1249">			Status = m_BusOutLineLevels[wBus].SetGain(iLevel);</a>
<a name="ln1250">			break;</a>
<a name="ln1251">			</a>
<a name="ln1252">		case ECHO_BUS_IN :</a>
<a name="ln1253">		</a>
<a name="ln1254">			wBus = pMF-&gt;Channel.wChannel;</a>
<a name="ln1255">			iLevel = pMF-&gt;Data.iLevel;</a>
<a name="ln1256"> </a>
<a name="ln1257">			Status = CheckSetting(iLevel,ECHOGAIN_MININP,ECHOGAIN_MAXINP);</a>
<a name="ln1258">			if (ECHOSTATUS_OK != Status)</a>
<a name="ln1259">				break;</a>
<a name="ln1260"> </a>
<a name="ln1261">			Status = m_BusInLineLevels[wBus].SetGain(iLevel);</a>
<a name="ln1262">			break;</a>
<a name="ln1263">			</a>
<a name="ln1264">		case ECHO_PIPE_OUT :</a>
<a name="ln1265"> </a>
<a name="ln1266">			wPipe = pMF-&gt;Channel.wChannel;</a>
<a name="ln1267">			wBus = pMF-&gt;Data.PipeOut.wBusOut;</a>
<a name="ln1268">			iLevel = pMF-&gt;Data.PipeOut.Data.iLevel;</a>
<a name="ln1269"> </a>
<a name="ln1270">			Status = CheckSetting(iLevel,ECHOGAIN_MINOUT,ECHOGAIN_MAXOUT);</a>
<a name="ln1271">			if (ECHOSTATUS_OK != Status)</a>
<a name="ln1272">				break;</a>
<a name="ln1273"> </a>
<a name="ln1274"> 			Status = m_PipeOutCtrl.SetGain(	wPipe,</a>
<a name="ln1275">														wBus,</a>
<a name="ln1276">														iLevel);</a>
<a name="ln1277">			break;</a>
<a name="ln1278">			</a>
<a name="ln1279">		default:</a>
<a name="ln1280">			Status = ECHOSTATUS_INVALID_PARAM;</a>
<a name="ln1281">			break;</a>
<a name="ln1282">	}</a>
<a name="ln1283"> </a>
<a name="ln1284">	return Status;</a>
<a name="ln1285">	</a>
<a name="ln1286">}	// ECHOSTATUS CEchoGals::SetAudioLineLevel</a>
<a name="ln1287"> </a>
<a name="ln1288"> </a>
<a name="ln1289">//===========================================================================</a>
<a name="ln1290">//</a>
<a name="ln1291">// Get the nominal level for an output or input bus.  The nominal level is</a>
<a name="ln1292">// also referred to as the +4/-10 switch.</a>
<a name="ln1293">//</a>
<a name="ln1294">//===========================================================================</a>
<a name="ln1295"> </a>
<a name="ln1296">ECHOSTATUS CEchoGals::GetAudioNominal</a>
<a name="ln1297">(</a>
<a name="ln1298">	PMIXER_FUNCTION	pMF</a>
<a name="ln1299">)</a>
<a name="ln1300">{</a>
<a name="ln1301">	BYTE					byNominal;</a>
<a name="ln1302">	ECHOSTATUS			Status;</a>
<a name="ln1303">	CDspCommObject *	pDspCommObj = GetDspCommObject();</a>
<a name="ln1304">	WORD					wCh;</a>
<a name="ln1305"> </a>
<a name="ln1306">	if ( NULL == pDspCommObj || pDspCommObj-&gt;IsBoardBad() )</a>
<a name="ln1307">		return ECHOSTATUS_DSP_DEAD;</a>
<a name="ln1308">		</a>
<a name="ln1309">	switch (pMF-&gt;Channel.dwType)</a>
<a name="ln1310">	{</a>
<a name="ln1311">		case ECHO_BUS_OUT :</a>
<a name="ln1312">			wCh = pMF-&gt;Channel.wChannel;</a>
<a name="ln1313">			break;</a>
<a name="ln1314">			</a>
<a name="ln1315">		case ECHO_BUS_IN :</a>
<a name="ln1316">			wCh = pMF-&gt;Channel.wChannel + GetNumBussesOut();</a>
<a name="ln1317">			break;</a>
<a name="ln1318">		</a>
<a name="ln1319">		default :</a>
<a name="ln1320">			return ECHOSTATUS_INVALID_CHANNEL;</a>
<a name="ln1321">	}</a>
<a name="ln1322">		</a>
<a name="ln1323">	Status = pDspCommObj-&gt;GetNominalLevel( wCh, &amp;byNominal );</a>
<a name="ln1324"> </a>
<a name="ln1325">	if ( ECHOSTATUS_OK != Status )</a>
<a name="ln1326">		return Status;</a>
<a name="ln1327"> </a>
<a name="ln1328">	pMF-&gt;Data.iNominal = ( byNominal ) ? -10 : 4;</a>
<a name="ln1329"> </a>
<a name="ln1330">	return ECHOSTATUS_OK;</a>
<a name="ln1331">}	// ECHOSTATUS CEchoGals::GetAudioNominal</a>
<a name="ln1332"> </a>
<a name="ln1333"> </a>
<a name="ln1334">//===========================================================================</a>
<a name="ln1335">//</a>
<a name="ln1336">// Set the nominal level for an output or input bus.  The nominal level is</a>
<a name="ln1337">// also referred to as the +4/-10 switch.</a>
<a name="ln1338">//</a>
<a name="ln1339">//===========================================================================</a>
<a name="ln1340"> </a>
<a name="ln1341">ECHOSTATUS CEchoGals::SetAudioNominal</a>
<a name="ln1342">(</a>
<a name="ln1343">	PMIXER_FUNCTION	pMF</a>
<a name="ln1344">)</a>
<a name="ln1345">{</a>
<a name="ln1346">	ECHOSTATUS	Status;</a>
<a name="ln1347">	WORD			wCh;</a>
<a name="ln1348">	INT32			iNominal;</a>
<a name="ln1349"> </a>
<a name="ln1350">	if ( NULL == GetDspCommObject() || GetDspCommObject()-&gt;IsBoardBad() )</a>
<a name="ln1351">		return ECHOSTATUS_DSP_DEAD;</a>
<a name="ln1352">	</a>
<a name="ln1353">	switch (pMF-&gt;Channel.dwType)</a>
<a name="ln1354">	{</a>
<a name="ln1355">		case ECHO_BUS_OUT :</a>
<a name="ln1356">			wCh = pMF-&gt;Channel.wChannel;</a>
<a name="ln1357">			break;</a>
<a name="ln1358">			</a>
<a name="ln1359">		case ECHO_BUS_IN :</a>
<a name="ln1360">			wCh = pMF-&gt;Channel.wChannel + GetNumBussesOut();</a>
<a name="ln1361">			break;</a>
<a name="ln1362">		</a>
<a name="ln1363">		default :</a>
<a name="ln1364">			return ECHOSTATUS_INVALID_CHANNEL;</a>
<a name="ln1365">	}</a>
<a name="ln1366"> </a>
<a name="ln1367">	iNominal = pMF-&gt;Data.iNominal;</a>
<a name="ln1368">	</a>
<a name="ln1369">	if ((iNominal!= -10) &amp;&amp; (iNominal != 4))</a>
<a name="ln1370">		return ECHOSTATUS_INVALID_PARAM;</a>
<a name="ln1371">	</a>
<a name="ln1372">	Status =</a>
<a name="ln1373">		GetDspCommObject()-&gt;SetNominalLevel( wCh,</a>
<a name="ln1374">														( iNominal == -10 ) );</a>
<a name="ln1375"> </a>
<a name="ln1376">	if ( ECHOSTATUS_OK != Status )</a>
<a name="ln1377">		return Status;</a>
<a name="ln1378"> </a>
<a name="ln1379">	Status = MixerControlChanged( (WORD) pMF-&gt;Channel.dwType,</a>
<a name="ln1380">											MXN_NOMINAL,</a>
<a name="ln1381">											pMF-&gt;Channel.wChannel);</a>
<a name="ln1382">	return Status;</a>
<a name="ln1383"> </a>
<a name="ln1384">}	// ECHOSTATUS CEchoGals::SetAudioNominal</a>
<a name="ln1385"> </a>
<a name="ln1386"> </a>
<a name="ln1387">//===========================================================================</a>
<a name="ln1388">//</a>
<a name="ln1389">// Set the mute for an output bus, input bus, or output pipe.</a>
<a name="ln1390">//</a>
<a name="ln1391">//===========================================================================</a>
<a name="ln1392"> </a>
<a name="ln1393">ECHOSTATUS CEchoGals::SetAudioMute</a>
<a name="ln1394">(</a>
<a name="ln1395">		PMIXER_FUNCTION	pMF</a>
<a name="ln1396">)</a>
<a name="ln1397">{</a>
<a name="ln1398">	WORD 			wPipe;</a>
<a name="ln1399">	WORD 			wBus;</a>
<a name="ln1400">	ECHOSTATUS 	Status;</a>
<a name="ln1401">	BOOL			bMute;</a>
<a name="ln1402">	</a>
<a name="ln1403">	switch (pMF-&gt;Channel.dwType)</a>
<a name="ln1404">	{</a>
<a name="ln1405">		case ECHO_BUS_OUT :</a>
<a name="ln1406"> </a>
<a name="ln1407">			wBus = pMF-&gt;Channel.wChannel;</a>
<a name="ln1408">			bMute = pMF-&gt;Data.bMuteOn;</a>
<a name="ln1409">			Status = m_BusOutLineLevels[wBus].SetMute(bMute);</a>
<a name="ln1410">			break;</a>
<a name="ln1411">			</a>
<a name="ln1412">		case ECHO_BUS_IN :</a>
<a name="ln1413">	</a>
<a name="ln1414">			wBus = pMF-&gt;Channel.wChannel;</a>
<a name="ln1415">			bMute = pMF-&gt;Data.bMuteOn;</a>
<a name="ln1416">			Status = m_BusInLineLevels[wBus].SetMute(bMute);</a>
<a name="ln1417">			break;</a>
<a name="ln1418">			</a>
<a name="ln1419">		case ECHO_PIPE_OUT :</a>
<a name="ln1420"> </a>
<a name="ln1421">			wPipe = pMF-&gt;Channel.wChannel;</a>
<a name="ln1422">			wBus = pMF-&gt;Data.PipeOut.wBusOut;</a>
<a name="ln1423">			bMute = pMF-&gt;Data.PipeOut.Data.bMuteOn;</a>
<a name="ln1424"> 			Status = m_PipeOutCtrl.SetMute(	wPipe,</a>
<a name="ln1425">														wBus,</a>
<a name="ln1426">														bMute);</a>
<a name="ln1427">			break;</a>
<a name="ln1428">			</a>
<a name="ln1429">		default:</a>
<a name="ln1430">			Status = ECHOSTATUS_INVALID_PARAM;</a>
<a name="ln1431">			break;</a>
<a name="ln1432">	}</a>
<a name="ln1433"> </a>
<a name="ln1434">	return Status;</a>
<a name="ln1435">}	// ECHOSTATUS CEchoGals::SetAudioMute</a>
<a name="ln1436"> </a>
<a name="ln1437"> </a>
<a name="ln1438">//===========================================================================</a>
<a name="ln1439">//</a>
<a name="ln1440">// Get the mute for an output bus, input bus, or output pipe.</a>
<a name="ln1441">//</a>
<a name="ln1442">//===========================================================================</a>
<a name="ln1443"> </a>
<a name="ln1444">ECHOSTATUS CEchoGals::GetAudioMute</a>
<a name="ln1445">(</a>
<a name="ln1446">		PMIXER_FUNCTION	pMF</a>
<a name="ln1447">)</a>
<a name="ln1448">{</a>
<a name="ln1449">	WORD 			wPipe;</a>
<a name="ln1450">	WORD 			wBus;</a>
<a name="ln1451">	ECHOSTATUS 	Status;</a>
<a name="ln1452"> </a>
<a name="ln1453">	switch (pMF-&gt;Channel.dwType)</a>
<a name="ln1454">	{</a>
<a name="ln1455">		case ECHO_BUS_OUT :</a>
<a name="ln1456">			</a>
<a name="ln1457">			wBus = pMF-&gt;Channel.wChannel;</a>
<a name="ln1458">			</a>
<a name="ln1459">			if (wBus &lt; GetNumBussesOut())</a>
<a name="ln1460">			{</a>
<a name="ln1461">				pMF-&gt;Data.bMuteOn = m_BusOutLineLevels[wBus].IsMuteOn();</a>
<a name="ln1462">				Status = ECHOSTATUS_OK;</a>
<a name="ln1463">			}</a>
<a name="ln1464">			else</a>
<a name="ln1465">			{</a>
<a name="ln1466">				Status = ECHOSTATUS_INVALID_CHANNEL;</a>
<a name="ln1467">			}</a>
<a name="ln1468"> </a>
<a name="ln1469">			break;</a>
<a name="ln1470"> </a>
<a name="ln1471">		case ECHO_BUS_IN :</a>
<a name="ln1472"> </a>
<a name="ln1473">			wBus = pMF-&gt;Channel.wChannel;</a>
<a name="ln1474">			</a>
<a name="ln1475">			if (wBus &lt; GetNumBussesIn())</a>
<a name="ln1476">			{</a>
<a name="ln1477">				pMF-&gt;Data.bMuteOn = m_BusInLineLevels[wBus].IsMuteOn();</a>
<a name="ln1478">				Status = ECHOSTATUS_OK;</a>
<a name="ln1479">			}</a>
<a name="ln1480">			else</a>
<a name="ln1481">			{</a>
<a name="ln1482">				Status = ECHOSTATUS_INVALID_CHANNEL;</a>
<a name="ln1483">			}</a>
<a name="ln1484">			break;</a>
<a name="ln1485">		</a>
<a name="ln1486">		case ECHO_PIPE_OUT :</a>
<a name="ln1487">		</a>
<a name="ln1488">			wPipe = pMF-&gt;Channel.wChannel;</a>
<a name="ln1489">			wBus = pMF-&gt;Data.PipeOut.wBusOut;</a>
<a name="ln1490"> 			Status = m_PipeOutCtrl.GetMute(	wPipe,</a>
<a name="ln1491">														wBus,</a>
<a name="ln1492">														pMF-&gt;Data.PipeOut.Data.bMuteOn);</a>
<a name="ln1493">			break;</a>
<a name="ln1494"> </a>
<a name="ln1495">		default:</a>
<a name="ln1496">			Status = ECHOSTATUS_INVALID_PARAM;</a>
<a name="ln1497">			break;</a>
<a name="ln1498">	}</a>
<a name="ln1499"> </a>
<a name="ln1500">	return Status;</a>
<a name="ln1501"> </a>
<a name="ln1502">}	// ECHOSTATUS CEchoGals::GetAudioMute</a>
<a name="ln1503"> </a>
<a name="ln1504"> </a>
<a name="ln1505">//===========================================================================</a>
<a name="ln1506">//</a>
<a name="ln1507">// Get the monitor gain for a single input bus mixed to a single output bus.</a>
<a name="ln1508">//</a>
<a name="ln1509">//===========================================================================</a>
<a name="ln1510"> </a>
<a name="ln1511">ECHOSTATUS CEchoGals::GetAudioMonitor</a>
<a name="ln1512">(</a>
<a name="ln1513">	WORD	wBusIn,</a>
<a name="ln1514">	WORD	wBusOut,</a>
<a name="ln1515">	INT32 &amp;	iGain</a>
<a name="ln1516">)</a>
<a name="ln1517">{</a>
<a name="ln1518">	if ( wBusIn  &gt;= GetNumBussesIn() ||</a>
<a name="ln1519">		  wBusOut &gt;= GetNumBussesOut() )</a>
<a name="ln1520">	{</a>
<a name="ln1521">		return ECHOSTATUS_INVALID_INDEX;</a>
<a name="ln1522">	}</a>
<a name="ln1523">	</a>
<a name="ln1524">	//</a>
<a name="ln1525">	// Get the monitor value</a>
<a name="ln1526">	//</a>
<a name="ln1527">	m_MonitorCtrl.GetGain(wBusIn,wBusOut,iGain);</a>
<a name="ln1528">	</a>
<a name="ln1529">	return ECHOSTATUS_OK;</a>
<a name="ln1530"> </a>
<a name="ln1531">}	// ECHOSTATUS CEchoGals::GetAudioMonitor</a>
<a name="ln1532"> </a>
<a name="ln1533"> </a>
<a name="ln1534">//===========================================================================</a>
<a name="ln1535">//</a>
<a name="ln1536">// Set the monitor gain for a single input bus mixed to a single output bus.</a>
<a name="ln1537">//</a>
<a name="ln1538">//===========================================================================</a>
<a name="ln1539"> </a>
<a name="ln1540">ECHOSTATUS CEchoGals::SetAudioMonitor</a>
<a name="ln1541">(</a>
<a name="ln1542">	WORD	wBusIn,</a>
<a name="ln1543">	WORD	wBusOut,</a>
<a name="ln1544">	INT32	iGain</a>
<a name="ln1545">)</a>
<a name="ln1546">{</a>
<a name="ln1547">	ECHOSTATUS	Status;</a>
<a name="ln1548"> </a>
<a name="ln1549">	if ( wBusIn  &gt;= GetNumBussesIn() ||</a>
<a name="ln1550">		  wBusOut &gt;= GetNumBussesOut() )</a>
<a name="ln1551">	{</a>
<a name="ln1552">		return ECHOSTATUS_INVALID_INDEX;</a>
<a name="ln1553">	}</a>
<a name="ln1554">	</a>
<a name="ln1555">	Status = CheckSetting(iGain,ECHOGAIN_MINOUT,ECHOGAIN_MAXOUT);</a>
<a name="ln1556">	if (ECHOSTATUS_OK == Status)</a>
<a name="ln1557">	{</a>
<a name="ln1558">		//</a>
<a name="ln1559">		// Set the monitor gain</a>
<a name="ln1560">		// </a>
<a name="ln1561">		m_MonitorCtrl.SetGain(wBusIn,wBusOut,iGain);</a>
<a name="ln1562">	}</a>
<a name="ln1563"> </a>
<a name="ln1564">	return Status;</a>
<a name="ln1565">	</a>
<a name="ln1566">}	// ECHOSTATUS CEchoGals::SetAudioMonitor</a>
<a name="ln1567"> </a>
<a name="ln1568"> </a>
<a name="ln1569">//===========================================================================</a>
<a name="ln1570">//</a>
<a name="ln1571">//	Helper functions for doing log conversions on pan values</a>
<a name="ln1572">//</a>
<a name="ln1573">// The parameter iNum is a fixed point 32 bit number in 16.16 format;</a>
<a name="ln1574">// that is, 16 bits of integer and 16 bits of decimal</a>
<a name="ln1575">// To convert a float number to fixed point, simply multiply by 2^16 and round</a>
<a name="ln1576">//</a>
<a name="ln1577">// Valid range for iNum is from +1.0 (0x10000) to 0.</a>
<a name="ln1578">//</a>
<a name="ln1579">//===========================================================================</a>
<a name="ln1580"> </a>
<a name="ln1581">#define FIXED_BASE		16							// 16 bits of fraction</a>
<a name="ln1582">#define FIXED_ONE_HALF	((INT32) 0x00008000)	// 0.5 in 16.16 format</a>
<a name="ln1583">#define COEFF_A2			((INT32) 0xffffa9ac)	// -.3372223</a>
<a name="ln1584">#define COEFF_A1			((INT32) 0x0000ff8a)	//  .9981958</a>
<a name="ln1585">#define COEFF_A0			((INT32) 0xffff5661)	// -.6626105</a>
<a name="ln1586"> </a>
<a name="ln1587">#define DB_CONVERT		0x60546		// 6.02... in 16.16</a>
<a name="ln1588"> </a>
<a name="ln1589">// Note use of double precision here to prevent overflow</a>
<a name="ln1590">static INT32 FixedMult( INT32 iNum1, INT32 iNum2 )</a>
<a name="ln1591">{</a>
<a name="ln1592">	LONGLONG llNum;</a>
<a name="ln1593"> </a>
<a name="ln1594">	llNum = (LONGLONG) iNum1 * (LONGLONG) iNum2;</a>
<a name="ln1595"> </a>
<a name="ln1596">	return (INT32) (llNum &gt;&gt; FIXED_BASE);</a>
<a name="ln1597">}	// INT32 FixedMult( INT32 iNum1, INT32 iNum2 )</a>
<a name="ln1598"> </a>
<a name="ln1599"> </a>
<a name="ln1600">static INT32 log2( INT32 iNum )</a>
<a name="ln1601">{</a>
<a name="ln1602">	INT32 iNumShifts;</a>
<a name="ln1603">	INT32 iTemp;</a>
<a name="ln1604"> </a>
<a name="ln1605">	// log2 is undefined for zero, so return -infinity (or close enough)</a>
<a name="ln1606">	if ( 0 == iNum )</a>
<a name="ln1607">		return ECHOGAIN_MUTED;</a>
<a name="ln1608"> </a>
<a name="ln1609">	// Step 1 - Normalize and save the number of shifts</a>
<a name="ln1610">	// Keep shifting iNum up until iNum &gt; 0.5</a>
<a name="ln1611">	iNumShifts = 0;</a>
<a name="ln1612">	while ( iNum &lt; FIXED_ONE_HALF )</a>
<a name="ln1613">	{</a>
<a name="ln1614">		iNumShifts++;</a>
<a name="ln1615">		iNum &lt;&lt;= 1;</a>
<a name="ln1616">	}</a>
<a name="ln1617"> </a>
<a name="ln1618">	// Step 2 - Calculate LOG2 by polynomial approximation.  8 bit accuracy.</a>
<a name="ln1619">	//</a>
<a name="ln1620">	// LOG2(x) = 4.0* (-.3372223 x*x + .9981958 x - .6626105)</a>
<a name="ln1621">	//                           a2             a1            a0</a>
<a name="ln1622">	// where  0.5 &lt;= x &lt; 1.0</a>
<a name="ln1623">	//</a>
<a name="ln1624"> </a>
<a name="ln1625">	// Compute polynomial sum</a>
<a name="ln1626">	iTemp = FixedMult( iNum, iNum );				// iTemp now has iNum squared</a>
<a name="ln1627">	iTemp = FixedMult( iTemp, COEFF_A2 );</a>
<a name="ln1628">	iTemp += FixedMult( iNum, COEFF_A1 );</a>
<a name="ln1629">	iTemp += COEFF_A0;</a>
<a name="ln1630"> </a>
<a name="ln1631">	// Multiply by four</a>
<a name="ln1632">	iTemp &lt;&lt;= 2;</a>
<a name="ln1633"> </a>
<a name="ln1634">	// Account for the normalize shifts</a>
<a name="ln1635">	iTemp -= ( iNumShifts &lt;&lt; FIXED_BASE );</a>
<a name="ln1636"> </a>
<a name="ln1637">	return( iTemp );</a>
<a name="ln1638">}	// INT32 log2( INT32 iNum )</a>
<a name="ln1639"> </a>
<a name="ln1640"> </a>
<a name="ln1641">//</a>
<a name="ln1642">//	Convert pan value to Db X 256</a>
<a name="ln1643">//	Pan value is 0 - MAX_MIXER_PAN</a>
<a name="ln1644">//</a>
<a name="ln1645">INT32 PanToDb( INT32 iPan )</a>
<a name="ln1646">{</a>
<a name="ln1647">	if ( iPan &gt;= ( MAX_MIXER_PAN - 1 ) )</a>
<a name="ln1648">		return( 0 );</a>
<a name="ln1649">	if ( iPan &lt;= 1 )</a>
<a name="ln1650">		return( ECHOGAIN_MUTED );</a>
<a name="ln1651">	//</a>
<a name="ln1652">	//	Convert pan to 16.16</a>
<a name="ln1653">	//</a>
<a name="ln1654">	iPan = ( iPan &lt;&lt; 16 ) / MAX_MIXER_PAN;</a>
<a name="ln1655">	//</a>
<a name="ln1656">	//	Take the log</a>
<a name="ln1657">	//</a>
<a name="ln1658">	iPan = log2( iPan );</a>
<a name="ln1659">	//</a>
<a name="ln1660">	// To convert to decibels*256, just multiply by the conversion factor</a>
<a name="ln1661">	//</a>
<a name="ln1662">	iPan = FixedMult( iPan &lt;&lt; 8, DB_CONVERT );</a>
<a name="ln1663">	//</a>
<a name="ln1664">	// To round, add one half and then mask off the fractional bits</a>
<a name="ln1665">	//</a>
<a name="ln1666">	iPan = ( iPan + FIXED_ONE_HALF ) &gt;&gt; FIXED_BASE;</a>
<a name="ln1667">	return( iPan );</a>
<a name="ln1668">}	// INT32 PanToDb( INT32 iPan )</a>
<a name="ln1669"> </a>
<a name="ln1670"> </a>
<a name="ln1671">//===========================================================================</a>
<a name="ln1672">//</a>
<a name="ln1673">// Set the monitor pan</a>
<a name="ln1674">//</a>
<a name="ln1675">//	For this to work effectively, both the input and output channels must</a>
<a name="ln1676">//	both either be odd or even.  Thus even channel numbers are for the</a>
<a name="ln1677">//	left channel and odd channel numbers are for the right channel.</a>
<a name="ln1678">//	Pan values will be computed for both channels.</a>
<a name="ln1679">//</a>
<a name="ln1680">// iPan ranges from 0 (hard left) to MAX_MIXER_PAN (hard right)</a>
<a name="ln1681">//</a>
<a name="ln1682">//===========================================================================</a>
<a name="ln1683"> </a>
<a name="ln1684">ECHOSTATUS CEchoGals::SetAudioMonitorPan</a>
<a name="ln1685">(</a>
<a name="ln1686">	WORD	wBusIn,</a>
<a name="ln1687">	WORD	wBusOut,</a>
<a name="ln1688">	INT32	iPan						// New pan</a>
<a name="ln1689">)</a>
<a name="ln1690">{</a>
<a name="ln1691">	ECHOSTATUS Status;</a>
<a name="ln1692"> </a>
<a name="ln1693">	if ( wBusIn  &gt;= GetNumBussesIn() ||</a>
<a name="ln1694">		  wBusOut &gt;= GetNumBussesOut() )</a>
<a name="ln1695">	{</a>
<a name="ln1696">		return ECHOSTATUS_INVALID_INDEX;</a>
<a name="ln1697">	}</a>
<a name="ln1698">	</a>
<a name="ln1699">	Status = CheckSetting(iPan,0,MAX_MIXER_PAN);</a>
<a name="ln1700">	if (ECHOSTATUS_OK == Status)</a>
<a name="ln1701">	{</a>
<a name="ln1702">		//</a>
<a name="ln1703">		// Set the pan</a>
<a name="ln1704">		// </a>
<a name="ln1705">		m_MonitorCtrl.SetPan(wBusIn,wBusOut,iPan);</a>
<a name="ln1706">	}</a>
<a name="ln1707"> </a>
<a name="ln1708">	return Status;</a>
<a name="ln1709">		</a>
<a name="ln1710">}	// ECHOSTATUS CEchoGals::SetAudioMonitorPan</a>
<a name="ln1711"> </a>
<a name="ln1712"> </a>
<a name="ln1713">//===========================================================================</a>
<a name="ln1714">//</a>
<a name="ln1715">// Get the monitor pan</a>
<a name="ln1716">//</a>
<a name="ln1717">//===========================================================================</a>
<a name="ln1718"> </a>
<a name="ln1719">ECHOSTATUS CEchoGals::GetAudioMonitorPan</a>
<a name="ln1720">(</a>
<a name="ln1721">	WORD	wBusIn,</a>
<a name="ln1722">	WORD	wBusOut,</a>
<a name="ln1723">	INT32 &amp;	iPan						// Returns current pan (0 - MAX_MIXER_PAN)</a>
<a name="ln1724">)</a>
<a name="ln1725">{</a>
<a name="ln1726">	if ( wBusIn  &gt;= GetNumBussesIn() ||</a>
<a name="ln1727">		  wBusOut &gt;= GetNumBussesOut() )</a>
<a name="ln1728">	{</a>
<a name="ln1729">		return ECHOSTATUS_INVALID_INDEX;</a>
<a name="ln1730">	}</a>
<a name="ln1731">	</a>
<a name="ln1732">	//</a>
<a name="ln1733">	// Get the pan</a>
<a name="ln1734">	// </a>
<a name="ln1735">	m_MonitorCtrl.GetPan(wBusIn,wBusOut,iPan);</a>
<a name="ln1736">	</a>
<a name="ln1737">	return ECHOSTATUS_OK;</a>
<a name="ln1738"> </a>
<a name="ln1739">}	// ECHOSTATUS CEchoGals::GetAudioMonitorPan</a>
<a name="ln1740"> </a>
<a name="ln1741"> </a>
<a name="ln1742">//===========================================================================</a>
<a name="ln1743">//</a>
<a name="ln1744">// Set the monitor mute</a>
<a name="ln1745">//</a>
<a name="ln1746">//===========================================================================</a>
<a name="ln1747"> </a>
<a name="ln1748">ECHOSTATUS CEchoGals::SetAudioMonitorMute</a>
<a name="ln1749">(</a>
<a name="ln1750">	WORD	wBusIn,</a>
<a name="ln1751">	WORD	wBusOut,</a>
<a name="ln1752">	BOOL	bMute						// New state</a>
<a name="ln1753">)</a>
<a name="ln1754">{</a>
<a name="ln1755">	if ( wBusIn  &gt;= GetNumBussesIn() ||</a>
<a name="ln1756">		  wBusOut &gt;= GetNumBussesOut() )</a>
<a name="ln1757">	{</a>
<a name="ln1758">		return ECHOSTATUS_INVALID_INDEX;</a>
<a name="ln1759">	}</a>
<a name="ln1760">	</a>
<a name="ln1761">	//</a>
<a name="ln1762">	// Set the mute</a>
<a name="ln1763">	// </a>
<a name="ln1764">	m_MonitorCtrl.SetMute(wBusIn,wBusOut,bMute);</a>
<a name="ln1765">		</a>
<a name="ln1766">	return ECHOSTATUS_OK;</a>
<a name="ln1767">	</a>
<a name="ln1768">}	// ECHOSTATUS CEchoGals::SetAudioMonitorMute</a>
<a name="ln1769"> </a>
<a name="ln1770"> </a>
<a name="ln1771">//===========================================================================</a>
<a name="ln1772">//</a>
<a name="ln1773">// Get the monitor mute</a>
<a name="ln1774">//</a>
<a name="ln1775">//===========================================================================</a>
<a name="ln1776"> </a>
<a name="ln1777">ECHOSTATUS CEchoGals::GetAudioMonitorMute</a>
<a name="ln1778">(</a>
<a name="ln1779">	WORD	wBusIn,</a>
<a name="ln1780">	WORD	wBusOut,</a>
<a name="ln1781">	BOOL 	&amp;bMute	  				// Returns current state</a>
<a name="ln1782">)</a>
<a name="ln1783">{</a>
<a name="ln1784">	if ( wBusIn  &gt;= GetNumBussesIn() ||</a>
<a name="ln1785">		  wBusOut &gt;= GetNumBussesOut() )</a>
<a name="ln1786">	{</a>
<a name="ln1787">		return ECHOSTATUS_INVALID_INDEX;</a>
<a name="ln1788">	}</a>
<a name="ln1789">	</a>
<a name="ln1790">	//</a>
<a name="ln1791">	// Get the mute</a>
<a name="ln1792">	// </a>
<a name="ln1793">	m_MonitorCtrl.GetMute(wBusIn,wBusOut,bMute);</a>
<a name="ln1794">	</a>
<a name="ln1795">	return ECHOSTATUS_OK;</a>
<a name="ln1796">	</a>
<a name="ln1797">}	// ECHOSTATUS CEchoGals::GetAudioMonitorMute</a>
<a name="ln1798"> </a>
<a name="ln1799"> </a>
<a name="ln1800">//===========================================================================</a>
<a name="ln1801">//</a>
<a name="ln1802">// Set the S/PDIF output format to professional or consumer</a>
<a name="ln1803">//</a>
<a name="ln1804">//===========================================================================</a>
<a name="ln1805"> </a>
<a name="ln1806">void CEchoGals::SetProfessionalSpdif( BOOL bNewStatus )</a>
<a name="ln1807">{</a>
<a name="ln1808">	ECHO_DEBUGPRINTF((&quot;CEchoGals::SetProfessionalSpdif %d\n&quot;,bNewStatus));</a>
<a name="ln1809">	</a>
<a name="ln1810">	if ( NULL != GetDspCommObject() )</a>
<a name="ln1811">	{</a>
<a name="ln1812">		GetDspCommObject()-&gt;SetProfessionalSpdif( bNewStatus );</a>
<a name="ln1813">		MixerControlChanged( ECHO_NO_CHANNEL_TYPE,</a>
<a name="ln1814">									MXN_SPDIF );</a>
<a name="ln1815">	}</a>
<a name="ln1816">}	// void CEchoGals::SetProfessionalSpdif( BOOL bNewStatus )</a>
<a name="ln1817"> </a>
<a name="ln1818"> </a>
<a name="ln1819">//===========================================================================</a>
<a name="ln1820">//</a>
<a name="ln1821">// Set driver flags</a>
<a name="ln1822">//</a>
<a name="ln1823">//	See ECHOGALS_FLAG_??? definitions in EchoGalsXface.h</a>
<a name="ln1824">//</a>
<a name="ln1825">//===========================================================================</a>
<a name="ln1826"> </a>
<a name="ln1827">ECHOSTATUS CEchoGals::SetFlags</a>
<a name="ln1828">(</a>
<a name="ln1829">	WORD	wFlags</a>
<a name="ln1830">)</a>
<a name="ln1831">{</a>
<a name="ln1832">	//</a>
<a name="ln1833">	// Mask off the read-only flags so they don't change</a>
<a name="ln1834">	//</a>
<a name="ln1835">	wFlags &amp;= ECHOGALS_FLAG_WRITABLE_MASK;</a>
<a name="ln1836"> </a>
<a name="ln1837">	//</a>
<a name="ln1838">	// Set the flags &amp; mark the flags as changed</a>
<a name="ln1839">	//</a>
<a name="ln1840">	m_wFlags |= wFlags;</a>
<a name="ln1841"> </a>
<a name="ln1842">	MixerControlChanged(	ECHO_NO_CHANNEL_TYPE,</a>
<a name="ln1843">								MXN_FLAGS );</a>
<a name="ln1844"> </a>
<a name="ln1845">	return ECHOSTATUS_OK;</a>
<a name="ln1846"> </a>
<a name="ln1847">}	// ECHOSTATUS CEchoGals::SetFlags</a>
<a name="ln1848"> </a>
<a name="ln1849"> </a>
<a name="ln1850">//===========================================================================</a>
<a name="ln1851">//</a>
<a name="ln1852">// Clear driver flags</a>
<a name="ln1853">//</a>
<a name="ln1854">//	See ECHOGALS_FLAG_??? definitions in EchoGalsXface.h</a>
<a name="ln1855">//</a>
<a name="ln1856">//===========================================================================</a>
<a name="ln1857"> </a>
<a name="ln1858">ECHOSTATUS CEchoGals::ClearFlags</a>
<a name="ln1859">(</a>
<a name="ln1860">	WORD	wFlags</a>
<a name="ln1861">)</a>
<a name="ln1862">{</a>
<a name="ln1863">	//</a>
<a name="ln1864">	// Mask off the read-only flags so they don't change</a>
<a name="ln1865">	//</a>
<a name="ln1866">	wFlags &amp;= ECHOGALS_FLAG_WRITABLE_MASK;</a>
<a name="ln1867"> </a>
<a name="ln1868">	//</a>
<a name="ln1869">	// Clear the flags &amp; mark the flags as changed</a>
<a name="ln1870">	//</a>
<a name="ln1871">	m_wFlags &amp;= ~wFlags;</a>
<a name="ln1872"> </a>
<a name="ln1873">	MixerControlChanged(	ECHO_NO_CHANNEL_TYPE,</a>
<a name="ln1874">								MXN_FLAGS );</a>
<a name="ln1875"> </a>
<a name="ln1876">	return ECHOSTATUS_OK;</a>
<a name="ln1877">	</a>
<a name="ln1878">}	// ECHOSTATUS CEchoGals::ClearFlags</a>
<a name="ln1879"> </a>
<a name="ln1880"> </a>
<a name="ln1881">//===========================================================================</a>
<a name="ln1882">//</a>
<a name="ln1883">// Set the digital mode - currently for Gina24, Layla24, and Mona</a>
<a name="ln1884">//</a>
<a name="ln1885">//===========================================================================</a>
<a name="ln1886"> </a>
<a name="ln1887">ECHOSTATUS CEchoGals::SetDigitalMode</a>
<a name="ln1888">(</a>
<a name="ln1889">	BYTE byDigitalMode</a>
<a name="ln1890">)</a>
<a name="ln1891">{</a>
<a name="ln1892">	ECHOSTATUS	Status;</a>
<a name="ln1893">	BYTE			byPreviousDigitalMode;</a>
<a name="ln1894"> </a>
<a name="ln1895">	if ( NULL == GetDspCommObject() || GetDspCommObject()-&gt;IsBoardBad() )</a>
<a name="ln1896">		return ECHOSTATUS_DSP_DEAD;</a>
<a name="ln1897"> </a>
<a name="ln1898">	if ( 0 == GetDspCommObject()-&gt;GetDigitalModes() )</a>
<a name="ln1899">		return ECHOSTATUS_DIGITAL_MODE_NOT_SUPPORTED;</a>
<a name="ln1900"> </a>
<a name="ln1901">	if ( TRUE == GetDspCommObject()-&gt;IsTransportActive() ) </a>
<a name="ln1902">	{</a>
<a name="ln1903">		ECHO_DEBUGPRINTF( ( 	&quot;CEchoGals::SetDigitalMode()  Cannot set the digital &quot;</a>
<a name="ln1904">									&quot;mode while transport is running\n&quot;));</a>
<a name="ln1905">		return ECHOSTATUS_BUSY;</a>
<a name="ln1906">	}</a>
<a name="ln1907">	byPreviousDigitalMode = GetDspCommObject()-&gt;GetDigitalMode();</a>
<a name="ln1908">	Status = GetDspCommObject()-&gt;SetDigitalMode( byDigitalMode );</a>
<a name="ln1909">	MixerControlChanged( ECHO_NO_CHANNEL_TYPE,</a>
<a name="ln1910">								MXN_DIGITAL_MODE );</a>
<a name="ln1911">	MixerControlChanged( ECHO_NO_CHANNEL_TYPE, </a>
<a name="ln1912">								MXN_INPUT_CLOCK );</a>
<a name="ln1913"> </a>
<a name="ln1914">	//</a>
<a name="ln1915">	//	If we successfully changed the digital mode from or to ADAT, then </a>
<a name="ln1916">	//	make sure all output, input and monitor levels are updated by the</a>
<a name="ln1917">	//	DSP comm object.</a>
<a name="ln1918">	//</a>
<a name="ln1919">	if ( ECHOSTATUS_OK == Status &amp;&amp;</a>
<a name="ln1920">		  byPreviousDigitalMode != byDigitalMode &amp;&amp;</a>
<a name="ln1921">		  ( DIGITAL_MODE_ADAT == byPreviousDigitalMode ||</a>
<a name="ln1922">		    DIGITAL_MODE_ADAT == byDigitalMode ) )</a>
<a name="ln1923">	{</a>
<a name="ln1924">		WORD	i, j,wBus,wPipe;</a>
<a name="ln1925"> </a>
<a name="ln1926">		for ( i = 0; i &lt; GetNumBussesIn(); i++ )</a>
<a name="ln1927">		{</a>
<a name="ln1928">			for ( j = 0; j &lt; GetNumBussesOut(); j += 2 )</a>
<a name="ln1929">			{</a>
<a name="ln1930">				m_MonitorCtrl.SetGain(i,j,ECHOGAIN_UPDATE,FALSE);</a>
<a name="ln1931">			}</a>
<a name="ln1932">		}</a>
<a name="ln1933"> </a>
<a name="ln1934">		for ( wBus = 0; wBus &lt; GetNumBussesOut(); wBus++)</a>
<a name="ln1935">		{</a>
<a name="ln1936">			for ( wPipe = 0; wPipe &lt; GetNumPipesOut(); wPipe++)</a>
<a name="ln1937">			{</a>
<a name="ln1938">				m_PipeOutCtrl.SetGain(wPipe,wBus,ECHOGAIN_UPDATE,FALSE);</a>
<a name="ln1939">			}</a>
<a name="ln1940">		}</a>
<a name="ln1941"> </a>
<a name="ln1942">		for ( i = 0; i &lt; GetNumBussesOut(); i++ )</a>
<a name="ln1943">		{</a>
<a name="ln1944">			m_BusOutLineLevels[ i ].SetGain(ECHOGAIN_UPDATE,FALSE);</a>
<a name="ln1945">		}</a>
<a name="ln1946"> </a>
<a name="ln1947">		for ( i = 0; i &lt; GetNumBussesIn(); i++ )</a>
<a name="ln1948">		{</a>
<a name="ln1949">			m_BusInLineLevels[ i ].SetGain( ECHOGAIN_UPDATE );</a>
<a name="ln1950">		}</a>
<a name="ln1951">		</a>
<a name="ln1952">		//</a>
<a name="ln1953">		// Now set them all at once, since all the</a>
<a name="ln1954">		// fImmediate parameters were set to FALSE.  Do the output</a>
<a name="ln1955">		// bus _and_ the output pipe in case this is a vmixer card.</a>
<a name="ln1956">		//</a>
<a name="ln1957">		m_BusOutLineLevels[0].SetGain(ECHOGAIN_UPDATE,TRUE);</a>
<a name="ln1958">		m_PipeOutCtrl.SetGain(0,0,ECHOGAIN_UPDATE,TRUE);</a>
<a name="ln1959">	}</a>
<a name="ln1960">	</a>
<a name="ln1961">	//</a>
<a name="ln1962">	// If the card has just been put in ADAT mode, it is possible</a>
<a name="ln1963">	// that the locked sample rate is greater than 48KHz, which is not allowed</a>
<a name="ln1964">	// in ADAT mode.  If this happens, change the locked rate to 48.</a>
<a name="ln1965">	//</a>
<a name="ln1966">	if ( 	(DIGITAL_MODE_ADAT == byDigitalMode) &amp;&amp;</a>
<a name="ln1967">			(m_wFlags &amp; ECHOGALS_FLAG_SAMPLE_RATE_LOCKED) &amp;&amp;</a>
<a name="ln1968">			(m_dwLockedSampleRate &gt; 48000) )</a>
<a name="ln1969">	{</a>
<a name="ln1970">		m_dwLockedSampleRate = 48000;</a>
<a name="ln1971">	}</a>
<a name="ln1972">	</a>
<a name="ln1973">	return Status;</a>
<a name="ln1974">	</a>
<a name="ln1975">}	// ECHOSTATUS CEchoGals::SetDigitalMode( ... )</a>
<a name="ln1976"> </a>
<a name="ln1977"> </a>
<a name="ln1978">/*</a>
<a name="ln1979"> </a>
<a name="ln1980">The output bus gain controls aren't actually implemented in the hardware;</a>
<a name="ln1981">insted they are virtual controls created by the generic code.</a>
<a name="ln1982"> </a>
<a name="ln1983">The signal sent to an output bus is a mix of the monitors and output pipes</a>
<a name="ln1984">routed to that bus; the output bus gain is therefore implemented by tweaking</a>
<a name="ln1985">each appropriate monitor and output pipe gain.</a>
<a name="ln1986"> </a>
<a name="ln1987">*/</a>
<a name="ln1988"> </a>
<a name="ln1989"> </a>
<a name="ln1990">//===========================================================================</a>
<a name="ln1991">//</a>
<a name="ln1992">// Adjust all the monitor levels for a particular output bus</a>
<a name="ln1993">//</a>
<a name="ln1994">// For efficiency, fImmediate is set to FALSE in the call</a>
<a name="ln1995">// to SetGain; all the monitor and pipe out gains are</a>
<a name="ln1996">// sent to the DSP at once by AdjustPipesOutForBusOut.</a>
<a name="ln1997">//</a>
<a name="ln1998">//===========================================================================</a>
<a name="ln1999"> </a>
<a name="ln2000">ECHOSTATUS CEchoGals::AdjustMonitorsForBusOut(WORD wBusOut)</a>
<a name="ln2001">{</a>
<a name="ln2002">	WORD wBusIn;</a>
<a name="ln2003">	</a>
<a name="ln2004">	//</a>
<a name="ln2005">	// Poke the monitors</a>
<a name="ln2006">	//</a>
<a name="ln2007">	for (wBusIn = 0; wBusIn &lt; GetNumBussesIn(); wBusIn++)</a>
<a name="ln2008">	{</a>
<a name="ln2009">		m_MonitorCtrl.SetGain(wBusIn,wBusOut,ECHOGAIN_UPDATE,FALSE);</a>
<a name="ln2010">	}</a>
<a name="ln2011">	</a>
<a name="ln2012">	return ECHOSTATUS_OK;</a>
<a name="ln2013">	</a>
<a name="ln2014">}	// AdjustMonitorsForBusOut</a>
<a name="ln2015"> </a>
<a name="ln2016">	</a>
<a name="ln2017">//===========================================================================</a>
<a name="ln2018">//</a>
<a name="ln2019">// Adjust all the pipe out levels for a particular output bus</a>
<a name="ln2020">//</a>
<a name="ln2021">// For efficiency, fImmediate is set to FALSE in the call</a>
<a name="ln2022">// to SetGain; all the monitor and pipe out gains are</a>
<a name="ln2023">// sent to the DSP at once by AdjustPipesOutForBusOut.</a>
<a name="ln2024">//</a>
<a name="ln2025">//===========================================================================</a>
<a name="ln2026"> </a>
<a name="ln2027">ECHOSTATUS CEchoGals::AdjustPipesOutForBusOut(WORD wBusOut,INT32 iBusOutGain)</a>
<a name="ln2028">{</a>
<a name="ln2029">	ECHO_DEBUGPRINTF((&quot;CEchoGals::AdjustPipesOutForBusOut wBusOut %d  iBusOutGain %ld\n&quot;,</a>
<a name="ln2030">							wBusOut,</a>
<a name="ln2031">							iBusOutGain));</a>
<a name="ln2032">					</a>
<a name="ln2033">	//</a>
<a name="ln2034">	// Round down to the nearest even bus</a>
<a name="ln2035">	//</a>
<a name="ln2036">	wBusOut &amp;= 0xfffe;							</a>
<a name="ln2037">							</a>
<a name="ln2038">	m_PipeOutCtrl.SetGain(wBusOut,wBusOut,ECHOGAIN_UPDATE,FALSE);</a>
<a name="ln2039">	wBusOut++;</a>
<a name="ln2040">	m_PipeOutCtrl.SetGain(wBusOut,wBusOut,ECHOGAIN_UPDATE,TRUE);	</a>
<a name="ln2041">	</a>
<a name="ln2042">	return ECHOSTATUS_OK;</a>
<a name="ln2043">	</a>
<a name="ln2044">}	// AdjustPipesOutForBusOut</a>
<a name="ln2045"> </a>
<a name="ln2046"> </a>
<a name="ln2047"> </a>
<a name="ln2048">//===========================================================================</a>
<a name="ln2049">//</a>
<a name="ln2050">// GetAudioLatency - returns the latency for a single pipe</a>
<a name="ln2051">//</a>
<a name="ln2052">//===========================================================================</a>
<a name="ln2053"> </a>
<a name="ln2054">void CEchoGals::GetAudioLatency(ECHO_AUDIO_LATENCY *pLatency)</a>
<a name="ln2055">{</a>
<a name="ln2056">	DWORD dwLatency;</a>
<a name="ln2057"> </a>
<a name="ln2058">	if (FALSE == pLatency-&gt;wIsInput)</a>
<a name="ln2059">	{</a>
<a name="ln2060">		if (pLatency-&gt;wPipe &gt;= GetFirstDigitalBusOut())</a>
<a name="ln2061">			dwLatency = m_wDigitalOutputLatency;</a>
<a name="ln2062">		else</a>
<a name="ln2063">			dwLatency = m_wAnalogOutputLatency;	</a>
<a name="ln2064">	}</a>
<a name="ln2065">	else</a>
<a name="ln2066">	{</a>
<a name="ln2067">		if (pLatency-&gt;wPipe &gt;= GetFirstDigitalBusIn())</a>
<a name="ln2068">			dwLatency = m_wDigitalInputLatency;</a>
<a name="ln2069">		else</a>
<a name="ln2070">			dwLatency = m_wAnalogInputLatency;	</a>
<a name="ln2071">	}</a>
<a name="ln2072">	</a>
<a name="ln2073">	pLatency-&gt;dwLatency = dwLatency;</a>
<a name="ln2074"> </a>
<a name="ln2075">}	// GetAudioLatency</a>

</code></pre>
<div class="balloon" rel="1607"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v610/" target="_blank">V610</a> Undefined behavior. Check the shift operator '<<'. The left operand '-128' is negative.</p></div>
<div class="balloon" rel="1555"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v610/" target="_blank">V610</a> Undefined behavior. Check the shift operator '<<'. The left operand '-128' is negative.</p></div>
<div class="balloon" rel="1270"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v610/" target="_blank">V610</a> Undefined behavior. Check the shift operator '<<'. The left operand '-128' is negative.</p></div>
<div class="balloon" rel="1245"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v610/" target="_blank">V610</a> Undefined behavior. Check the shift operator '<<'. The left operand '-128' is negative.</p></div>
<div class="balloon" rel="1257"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v610/" target="_blank">V610</a> Undefined behavior. Check the shift operator '<<'. The left operand '-25' is negative.</p></div>
<div class="balloon" rel="533"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v562/" target="_blank">V562</a> It's odd to compare a bool type value with a value of 18: 0x12 == IsProfessionalSpdif().</p></div>
<div class="balloon" rel="1650"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v610/" target="_blank">V610</a> Undefined behavior. Check the shift operator '<<'. The left operand '-128' is negative.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
