
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>ar9300_attach.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2"> * Copyright (c) 2013 Qualcomm Atheros, Inc.</a>
<a name="ln3"> *</a>
<a name="ln4"> * Permission to use, copy, modify, and/or distribute this software for any</a>
<a name="ln5"> * purpose with or without fee is hereby granted, provided that the above</a>
<a name="ln6"> * copyright notice and this permission notice appear in all copies.</a>
<a name="ln7"> *</a>
<a name="ln8"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH</a>
<a name="ln9"> * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY</a>
<a name="ln10"> * AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,</a>
<a name="ln11"> * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM</a>
<a name="ln12"> * LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR</a>
<a name="ln13"> * OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR</a>
<a name="ln14"> * PERFORMANCE OF THIS SOFTWARE.</a>
<a name="ln15"> */</a>
<a name="ln16"> </a>
<a name="ln17">#include &quot;opt_ah.h&quot;</a>
<a name="ln18"> </a>
<a name="ln19">#include &quot;ah.h&quot;</a>
<a name="ln20">#include &quot;ah_internal.h&quot;</a>
<a name="ln21">#include &quot;ah_devid.h&quot;</a>
<a name="ln22"> </a>
<a name="ln23">#include &quot;ar9300/ar9300desc.h&quot;</a>
<a name="ln24">#include &quot;ar9300/ar9300.h&quot;</a>
<a name="ln25">#include &quot;ar9300/ar9300reg.h&quot;</a>
<a name="ln26">#include &quot;ar9300/ar9300phy.h&quot;</a>
<a name="ln27">#include &quot;ar9300/ar9300paprd.h&quot;</a>
<a name="ln28"> </a>
<a name="ln29">#include &quot;ar9300/ar9300_stub.h&quot;</a>
<a name="ln30">#include &quot;ar9300/ar9300_stub_funcs.h&quot;</a>
<a name="ln31"> </a>
<a name="ln32"> </a>
<a name="ln33">/* Add static register initialization vectors */</a>
<a name="ln34">#include &quot;ar9300/ar9300_osprey22.ini&quot;</a>
<a name="ln35">#include &quot;ar9300/ar9330_11.ini&quot;</a>
<a name="ln36">#include &quot;ar9300/ar9330_12.ini&quot;</a>
<a name="ln37">#include &quot;ar9300/ar9340.ini&quot;</a>
<a name="ln38">#include &quot;ar9300/ar9485.ini&quot;</a>
<a name="ln39">#include &quot;ar9300/ar9485_1_1.ini&quot;</a>
<a name="ln40">#include &quot;ar9300/ar9300_jupiter10.ini&quot;</a>
<a name="ln41">/* TODO: convert the 2.0 code to use the new initvals from ath9k */</a>
<a name="ln42">#include &quot;ar9300/ar9300_jupiter20.ini&quot;</a>
<a name="ln43">#include &quot;ar9300/ar9462_2p0_initvals.h&quot;</a>
<a name="ln44">#include &quot;ar9300/ar9462_2p1_initvals.h&quot;</a>
<a name="ln45">#include &quot;ar9300/ar9580.ini&quot;</a>
<a name="ln46">#include &quot;ar9300/ar955x.ini&quot;</a>
<a name="ln47">#include &quot;ar9300/ar953x.ini&quot;</a>
<a name="ln48">#include &quot;ar9300/ar9300_aphrodite10.ini&quot;</a>
<a name="ln49"> </a>
<a name="ln50"> </a>
<a name="ln51">/* Include various freebsd specific HAL methods */</a>
<a name="ln52">#include &quot;ar9300/ar9300_freebsd.h&quot;</a>
<a name="ln53"> </a>
<a name="ln54">/* XXX duplicate in ar9300_radio.c ? */</a>
<a name="ln55">static HAL_BOOL ar9300_get_chip_power_limits(struct ath_hal *ah,</a>
<a name="ln56">    struct ieee80211_channel *chan);</a>
<a name="ln57"> </a>
<a name="ln58">static inline HAL_STATUS ar9300_init_mac_addr(struct ath_hal *ah);</a>
<a name="ln59">static inline HAL_STATUS ar9300_hw_attach(struct ath_hal *ah);</a>
<a name="ln60">static inline void ar9300_hw_detach(struct ath_hal *ah);</a>
<a name="ln61">static int16_t ar9300_get_nf_adjust(struct ath_hal *ah,</a>
<a name="ln62">    const HAL_CHANNEL_INTERNAL *c);</a>
<a name="ln63">#if 0</a>
<a name="ln64">int ar9300_get_cal_intervals(struct ath_hal *ah, HAL_CALIBRATION_TIMER **timerp,</a>
<a name="ln65">    HAL_CAL_QUERY query);</a>
<a name="ln66">#endif</a>
<a name="ln67"> </a>
<a name="ln68">#if ATH_TRAFFIC_FAST_RECOVER</a>
<a name="ln69">unsigned long ar9300_get_pll3_sqsum_dvc(struct ath_hal *ah);</a>
<a name="ln70">#endif</a>
<a name="ln71">static int ar9300_init_offsets(struct ath_hal *ah, u_int16_t devid);</a>
<a name="ln72"> </a>
<a name="ln73"> </a>
<a name="ln74">static void</a>
<a name="ln75">ar9300_disable_pcie_phy(struct ath_hal *ah);</a>
<a name="ln76"> </a>
<a name="ln77">static const HAL_PERCAL_DATA iq_cal_single_sample =</a>
<a name="ln78">                          {IQ_MISMATCH_CAL,</a>
<a name="ln79">                          MIN_CAL_SAMPLES,</a>
<a name="ln80">                          PER_MAX_LOG_COUNT,</a>
<a name="ln81">                          ar9300_iq_cal_collect,</a>
<a name="ln82">                          ar9300_iq_calibration};</a>
<a name="ln83"> </a>
<a name="ln84">#if 0</a>
<a name="ln85">static HAL_CALIBRATION_TIMER ar9300_cals[] =</a>
<a name="ln86">                          { {IQ_MISMATCH_CAL,               /* Cal type */</a>
<a name="ln87">                             1200000,                       /* Cal interval */</a>
<a name="ln88">                             0                              /* Cal timestamp */</a>
<a name="ln89">                            },</a>
<a name="ln90">                          {TEMP_COMP_CAL,</a>
<a name="ln91">                             5000,</a>
<a name="ln92">                             0</a>
<a name="ln93">                            },</a>
<a name="ln94">                          };</a>
<a name="ln95">#endif</a>
<a name="ln96"> </a>
<a name="ln97">#if ATH_PCIE_ERROR_MONITOR</a>
<a name="ln98"> </a>
<a name="ln99">int ar9300_start_pcie_error_monitor(struct ath_hal *ah, int b_auto_stop)</a>
<a name="ln100">{</a>
<a name="ln101">    u_int32_t val;</a>
<a name="ln102"> </a>
<a name="ln103">    /* Clear the counters */</a>
<a name="ln104">    OS_REG_WRITE(ah, PCIE_CO_ERR_CTR_CTR0, 0);</a>
<a name="ln105">    OS_REG_WRITE(ah, PCIE_CO_ERR_CTR_CTR1, 0);</a>
<a name="ln106">    </a>
<a name="ln107">    /* Read the previous value */</a>
<a name="ln108">    val = OS_REG_READ(ah, PCIE_CO_ERR_CTR_CTRL);</a>
<a name="ln109"> </a>
<a name="ln110">    /* Set auto_stop */</a>
<a name="ln111">    if (b_auto_stop) {</a>
<a name="ln112">        val |=</a>
<a name="ln113">            RCVD_ERR_CTR_AUTO_STOP | BAD_TLP_ERR_CTR_AUTO_STOP |</a>
<a name="ln114">            BAD_DLLP_ERR_CTR_AUTO_STOP | RPLY_TO_ERR_CTR_AUTO_STOP |</a>
<a name="ln115">            RPLY_NUM_RO_ERR_CTR_AUTO_STOP;</a>
<a name="ln116">    } else {</a>
<a name="ln117">        val &amp;= ~(</a>
<a name="ln118">            RCVD_ERR_CTR_AUTO_STOP | BAD_TLP_ERR_CTR_AUTO_STOP |</a>
<a name="ln119">            BAD_DLLP_ERR_CTR_AUTO_STOP | RPLY_TO_ERR_CTR_AUTO_STOP |</a>
<a name="ln120">            RPLY_NUM_RO_ERR_CTR_AUTO_STOP);</a>
<a name="ln121">    }</a>
<a name="ln122">    OS_REG_WRITE(ah, PCIE_CO_ERR_CTR_CTRL, val );</a>
<a name="ln123"> </a>
<a name="ln124">    /*</a>
<a name="ln125">     * Start to run.</a>
<a name="ln126">     * This has to be done separately from the above auto_stop flag setting,</a>
<a name="ln127">     * to avoid a HW race condition.</a>
<a name="ln128">     */</a>
<a name="ln129">    val |=</a>
<a name="ln130">        RCVD_ERR_CTR_RUN | BAD_TLP_ERR_CTR_RUN | BAD_DLLP_ERR_CTR_RUN |</a>
<a name="ln131">        RPLY_TO_ERR_CTR_RUN | RPLY_NUM_RO_ERR_CTR_RUN;</a>
<a name="ln132">    OS_REG_WRITE(ah, PCIE_CO_ERR_CTR_CTRL, val);</a>
<a name="ln133"> </a>
<a name="ln134">    return 0;</a>
<a name="ln135">}</a>
<a name="ln136"> </a>
<a name="ln137">int ar9300_read_pcie_error_monitor(struct ath_hal *ah, void* p_read_counters)</a>
<a name="ln138">{</a>
<a name="ln139">    u_int32_t val;</a>
<a name="ln140">    ar_pcie_error_moniter_counters *p_counters =</a>
<a name="ln141">        (ar_pcie_error_moniter_counters*) p_read_counters;</a>
<a name="ln142">    </a>
<a name="ln143">    val = OS_REG_READ(ah, PCIE_CO_ERR_CTR_CTR0);</a>
<a name="ln144">    </a>
<a name="ln145">    p_counters-&gt;uc_receiver_errors = MS(val, RCVD_ERR_MASK);</a>
<a name="ln146">    p_counters-&gt;uc_bad_tlp_errors  = MS(val, BAD_TLP_ERR_MASK);</a>
<a name="ln147">    p_counters-&gt;uc_bad_dllp_errors = MS(val, BAD_DLLP_ERR_MASK);</a>
<a name="ln148"> </a>
<a name="ln149">    val = OS_REG_READ(ah, PCIE_CO_ERR_CTR_CTR1);</a>
<a name="ln150">    </a>
<a name="ln151">    p_counters-&gt;uc_replay_timeout_errors        = MS(val, RPLY_TO_ERR_MASK);</a>
<a name="ln152">    p_counters-&gt;uc_replay_number_rollover_errors= MS(val, RPLY_NUM_RO_ERR_MASK);</a>
<a name="ln153"> </a>
<a name="ln154">    return 0;</a>
<a name="ln155">}</a>
<a name="ln156"> </a>
<a name="ln157">int ar9300_stop_pcie_error_monitor(struct ath_hal *ah)</a>
<a name="ln158">{</a>
<a name="ln159">    u_int32_t val;</a>
<a name="ln160">        </a>
<a name="ln161">    /* Read the previous value */</a>
<a name="ln162">    val = OS_REG_READ(ah, PCIE_CO_ERR_CTR_CTRL);</a>
<a name="ln163">    </a>
<a name="ln164">    val &amp;= ~(</a>
<a name="ln165">        RCVD_ERR_CTR_RUN |</a>
<a name="ln166">        BAD_TLP_ERR_CTR_RUN |</a>
<a name="ln167">        BAD_DLLP_ERR_CTR_RUN |</a>
<a name="ln168">        RPLY_TO_ERR_CTR_RUN |</a>
<a name="ln169">        RPLY_NUM_RO_ERR_CTR_RUN);</a>
<a name="ln170">   </a>
<a name="ln171">    /* Start to stop */</a>
<a name="ln172">    OS_REG_WRITE(ah, PCIE_CO_ERR_CTR_CTRL, val );</a>
<a name="ln173"> </a>
<a name="ln174">    return 0;</a>
<a name="ln175">}</a>
<a name="ln176"> </a>
<a name="ln177">#endif /* ATH_PCIE_ERROR_MONITOR */</a>
<a name="ln178"> </a>
<a name="ln179">#if 0</a>
<a name="ln180">/* WIN32 does not support C99 */</a>
<a name="ln181">static const struct ath_hal_private ar9300hal = {</a>
<a name="ln182">    {</a>
<a name="ln183">        ar9300_get_rate_table,             /* ah_get_rate_table */</a>
<a name="ln184">        ar9300_detach,                     /* ah_detach */</a>
<a name="ln185"> </a>
<a name="ln186">        /* Reset Functions */</a>
<a name="ln187">        ar9300_reset,                      /* ah_reset */</a>
<a name="ln188">        ar9300_phy_disable,                /* ah_phy_disable */</a>
<a name="ln189">        ar9300_disable,                    /* ah_disable */</a>
<a name="ln190">        ar9300_config_pci_power_save,      /* ah_config_pci_power_save */</a>
<a name="ln191">        ar9300_set_pcu_config,             /* ah_set_pcu_config */</a>
<a name="ln192">        ar9300_calibration,                /* ah_per_calibration */</a>
<a name="ln193">        ar9300_reset_cal_valid,            /* ah_reset_cal_valid */</a>
<a name="ln194">        ar9300_set_tx_power_limit,         /* ah_set_tx_power_limit */</a>
<a name="ln195"> </a>
<a name="ln196">#if ATH_ANT_DIV_COMB</a>
<a name="ln197">        ar9300_ant_ctrl_set_lna_div_use_bt_ant,     /* ah_ant_ctrl_set_lna_div_use_bt_ant */</a>
<a name="ln198">#endif /* ATH_ANT_DIV_COMB */</a>
<a name="ln199">#ifdef ATH_SUPPORT_DFS</a>
<a name="ln200">        ar9300_radar_wait,                 /* ah_radar_wait */</a>
<a name="ln201"> </a>
<a name="ln202">        /* New DFS functions */</a>
<a name="ln203">        ar9300_check_dfs,                  /* ah_ar_check_dfs */</a>
<a name="ln204">        ar9300_dfs_found,                  /* ah_ar_dfs_found */</a>
<a name="ln205">        ar9300_enable_dfs,                 /* ah_ar_enable_dfs */</a>
<a name="ln206">        ar9300_get_dfs_thresh,             /* ah_ar_get_dfs_thresh */</a>
<a name="ln207">        ar9300_get_dfs_radars,             /* ah_ar_get_dfs_radars */</a>
<a name="ln208">        ar9300_adjust_difs,                /* ah_adjust_difs */</a>
<a name="ln209">        ar9300_dfs_config_fft,             /* ah_dfs_config_fft */</a>
<a name="ln210">        ar9300_dfs_cac_war,                /* ah_dfs_cac_war */</a>
<a name="ln211">        ar9300_cac_tx_quiet,               /* ah_cac_tx_quiet */</a>
<a name="ln212">#endif</a>
<a name="ln213">        ar9300_get_extension_channel,      /* ah_get_extension_channel */</a>
<a name="ln214">        ar9300_is_fast_clock_enabled,      /* ah_is_fast_clock_enabled */</a>
<a name="ln215"> </a>
<a name="ln216">        /* Transmit functions */</a>
<a name="ln217">        ar9300_update_tx_trig_level,       /* ah_update_tx_trig_level */</a>
<a name="ln218">        ar9300_get_tx_trig_level,          /* ah_get_tx_trig_level */</a>
<a name="ln219">        ar9300_setup_tx_queue,             /* ah_setup_tx_queue */</a>
<a name="ln220">        ar9300_set_tx_queue_props,         /* ah_set_tx_queue_props */</a>
<a name="ln221">        ar9300_get_tx_queue_props,         /* ah_get_tx_queue_props */</a>
<a name="ln222">        ar9300_release_tx_queue,           /* ah_release_tx_queue */</a>
<a name="ln223">        ar9300_reset_tx_queue,             /* ah_reset_tx_queue */</a>
<a name="ln224">        ar9300_get_tx_dp,                  /* ah_get_tx_dp */</a>
<a name="ln225">        ar9300_set_tx_dp,                  /* ah_set_tx_dp */</a>
<a name="ln226">        ar9300_num_tx_pending,             /* ah_num_tx_pending */</a>
<a name="ln227">        ar9300_start_tx_dma,               /* ah_start_tx_dma */</a>
<a name="ln228">        ar9300_stop_tx_dma,                /* ah_stop_tx_dma */</a>
<a name="ln229">        ar9300_stop_tx_dma_indv_que,       /* ah_stop_tx_dma_indv_que */</a>
<a name="ln230">        ar9300_abort_tx_dma,               /* ah_abort_tx_dma */</a>
<a name="ln231">        ar9300_fill_tx_desc,               /* ah_fill_tx_desc */</a>
<a name="ln232">        ar9300_set_desc_link,              /* ah_set_desc_link */</a>
<a name="ln233">        ar9300_get_desc_link_ptr,          /* ah_get_desc_link_ptr */</a>
<a name="ln234">        ar9300_clear_tx_desc_status,       /* ah_clear_tx_desc_status */</a>
<a name="ln235">#ifdef ATH_SWRETRY</a>
<a name="ln236">        ar9300_clear_dest_mask,            /* ah_clear_dest_mask */</a>
<a name="ln237">#endif</a>
<a name="ln238">        ar9300_proc_tx_desc,               /* ah_proc_tx_desc */</a>
<a name="ln239">        ar9300_get_raw_tx_desc,            /* ah_get_raw_tx_desc */</a>
<a name="ln240">        ar9300_get_tx_rate_code,           /* ah_get_tx_rate_code */</a>
<a name="ln241">        AH_NULL,                           /* ah_get_tx_intr_queue */</a>
<a name="ln242">        ar9300_tx_req_intr_desc,           /* ah_req_tx_intr_desc */</a>
<a name="ln243">        ar9300_calc_tx_airtime,            /* ah_calc_tx_airtime */</a>
<a name="ln244">        ar9300_setup_tx_status_ring,       /* ah_setup_tx_status_ring */</a>
<a name="ln245"> </a>
<a name="ln246">        /* RX Functions */</a>
<a name="ln247">        ar9300_get_rx_dp,                  /* ah_get_rx_dp */</a>
<a name="ln248">        ar9300_set_rx_dp,                  /* ah_set_rx_dp */</a>
<a name="ln249">        ar9300_enable_receive,             /* ah_enable_receive */</a>
<a name="ln250">        ar9300_stop_dma_receive,           /* ah_stop_dma_receive */</a>
<a name="ln251">        ar9300_start_pcu_receive,          /* ah_start_pcu_receive */</a>
<a name="ln252">        ar9300_stop_pcu_receive,           /* ah_stop_pcu_receive */</a>
<a name="ln253">        ar9300_set_multicast_filter,       /* ah_set_multicast_filter */</a>
<a name="ln254">        ar9300_get_rx_filter,              /* ah_get_rx_filter */</a>
<a name="ln255">        ar9300_set_rx_filter,              /* ah_set_rx_filter */</a>
<a name="ln256">        ar9300_set_rx_sel_evm,             /* ah_set_rx_sel_evm */</a>
<a name="ln257">        ar9300_set_rx_abort,               /* ah_set_rx_abort */</a>
<a name="ln258">        AH_NULL,                           /* ah_setup_rx_desc */</a>
<a name="ln259">        ar9300_proc_rx_desc,               /* ah_proc_rx_desc */</a>
<a name="ln260">        ar9300_get_rx_key_idx,             /* ah_get_rx_key_idx */</a>
<a name="ln261">        ar9300_proc_rx_desc_fast,          /* ah_proc_rx_desc_fast */</a>
<a name="ln262">        ar9300_ani_ar_poll,                /* ah_rx_monitor */</a>
<a name="ln263">        ar9300_process_mib_intr,           /* ah_proc_mib_event */</a>
<a name="ln264"> </a>
<a name="ln265">        /* Misc Functions */</a>
<a name="ln266">        ar9300_get_capability,             /* ah_get_capability */</a>
<a name="ln267">        ar9300_set_capability,             /* ah_set_capability */</a>
<a name="ln268">        ar9300_get_diag_state,             /* ah_get_diag_state */</a>
<a name="ln269">        ar9300_get_mac_address,            /* ah_get_mac_address */</a>
<a name="ln270">        ar9300_set_mac_address,            /* ah_set_mac_address */</a>
<a name="ln271">        ar9300_get_bss_id_mask,            /* ah_get_bss_id_mask */</a>
<a name="ln272">        ar9300_set_bss_id_mask,            /* ah_set_bss_id_mask */</a>
<a name="ln273">        ar9300_set_regulatory_domain,      /* ah_set_regulatory_domain */</a>
<a name="ln274">        ar9300_set_led_state,              /* ah_set_led_state */</a>
<a name="ln275">        ar9300_set_power_led_state,        /* ah_setpowerledstate */</a>
<a name="ln276">        ar9300_set_network_led_state,      /* ah_setnetworkledstate */</a>
<a name="ln277">        ar9300_write_associd,              /* ah_write_associd */</a>
<a name="ln278">        ar9300_force_tsf_sync,             /* ah_force_tsf_sync */</a>
<a name="ln279">        ar9300_gpio_cfg_input,             /* ah_gpio_cfg_input */</a>
<a name="ln280">        ar9300_gpio_cfg_output,            /* ah_gpio_cfg_output */</a>
<a name="ln281">        ar9300_gpio_cfg_output_led_off,    /* ah_gpio_cfg_output_led_off */</a>
<a name="ln282">        ar9300_gpio_get,                   /* ah_gpio_get */</a>
<a name="ln283">        ar9300_gpio_set,                   /* ah_gpio_set */</a>
<a name="ln284">        ar9300_gpio_get_intr,              /* ah_gpio_get_intr */</a>
<a name="ln285">        ar9300_gpio_set_intr,              /* ah_gpio_set_intr */</a>
<a name="ln286">        ar9300_gpio_get_polarity,          /* ah_gpio_get_polarity */</a>
<a name="ln287">        ar9300_gpio_set_polarity,          /* ah_gpio_set_polarity */</a>
<a name="ln288">        ar9300_gpio_get_mask,              /* ah_gpio_get_mask */</a>
<a name="ln289">        ar9300_gpio_set_mask,              /* ah_gpio_set_mask */</a>
<a name="ln290">        ar9300_get_tsf32,                  /* ah_get_tsf32 */</a>
<a name="ln291">        ar9300_get_tsf64,                  /* ah_get_tsf64 */</a>
<a name="ln292">        ar9300_get_tsf2_32,                /* ah_get_tsf2_32 */</a>
<a name="ln293">        ar9300_reset_tsf,                  /* ah_reset_tsf */</a>
<a name="ln294">        ar9300_detect_card_present,        /* ah_detect_card_present */</a>
<a name="ln295">        ar9300_update_mib_mac_stats,       /* ah_update_mib_mac_stats */</a>
<a name="ln296">        ar9300_get_mib_mac_stats,          /* ah_get_mib_mac_stats */</a>
<a name="ln297">        ar9300_get_rfgain,                 /* ah_get_rf_gain */</a>
<a name="ln298">        ar9300_get_def_antenna,            /* ah_get_def_antenna */</a>
<a name="ln299">        ar9300_set_def_antenna,            /* ah_set_def_antenna */</a>
<a name="ln300">        ar9300_set_slot_time,              /* ah_set_slot_time */</a>
<a name="ln301">        ar9300_set_ack_timeout,            /* ah_set_ack_timeout */</a>
<a name="ln302">        ar9300_get_ack_timeout,            /* ah_get_ack_timeout */</a>
<a name="ln303">        ar9300_set_coverage_class,         /* ah_set_coverage_class */</a>
<a name="ln304">        ar9300_set_quiet,                  /* ah_set_quiet */</a>
<a name="ln305">        ar9300_set_antenna_switch,         /* ah_set_antenna_switch */</a>
<a name="ln306">        ar9300_get_desc_info,              /* ah_get_desc_info */</a>
<a name="ln307">        ar9300_select_ant_config,          /* ah_select_ant_config */</a>
<a name="ln308">        ar9300_ant_ctrl_common_get,        /* ah_ant_ctrl_common_get */</a>
<a name="ln309">        ar9300_ant_swcom_sel,              /* ah_ant_swcom_sel */</a>
<a name="ln310">        ar9300_enable_tpc,                 /* ah_enable_tpc */</a>
<a name="ln311">        AH_NULL,                           /* ah_olpc_temp_compensation */</a>
<a name="ln312">#if ATH_SUPPORT_CRDC</a>
<a name="ln313">        ar9300_chain_rssi_diff_compensation,/*ah_chain_rssi_diff_compensation*/</a>
<a name="ln314">#endif</a>
<a name="ln315">        ar9300_disable_phy_restart,        /* ah_disable_phy_restart */</a>
<a name="ln316">        ar9300_enable_keysearch_always,</a>
<a name="ln317">        ar9300_interference_is_present,    /* ah_interference_is_present */</a>
<a name="ln318">        ar9300_disp_tpc_tables,             /* ah_disp_tpc_tables */</a>
<a name="ln319">        ar9300_get_tpc_tables,              /* ah_get_tpc_tables */</a>
<a name="ln320">        /* Key Cache Functions */</a>
<a name="ln321">        ar9300_get_key_cache_size,         /* ah_get_key_cache_size */</a>
<a name="ln322">        ar9300_reset_key_cache_entry,      /* ah_reset_key_cache_entry */</a>
<a name="ln323">        ar9300_is_key_cache_entry_valid,   /* ah_is_key_cache_entry_valid */</a>
<a name="ln324">        ar9300_set_key_cache_entry,        /* ah_set_key_cache_entry */</a>
<a name="ln325">        ar9300_set_key_cache_entry_mac,    /* ah_set_key_cache_entry_mac */</a>
<a name="ln326">        ar9300_print_keycache,             /* ah_print_key_cache */</a>
<a name="ln327">#if ATH_SUPPORT_KEYPLUMB_WAR</a>
<a name="ln328">        ar9300_check_key_cache_entry,      /* ah_check_key_cache_entry */</a>
<a name="ln329">#endif</a>
<a name="ln330">        /* Power Management Functions */</a>
<a name="ln331">        ar9300_set_power_mode,             /* ah_set_power_mode */</a>
<a name="ln332">        ar9300_set_sm_power_mode,          /* ah_set_sm_ps_mode */</a>
<a name="ln333">#if ATH_WOW</a>
<a name="ln334">        ar9300_wow_apply_pattern,          /* ah_wow_apply_pattern */</a>
<a name="ln335">        ar9300_wow_enable,                 /* ah_wow_enable */</a>
<a name="ln336">        ar9300_wow_wake_up,                /* ah_wow_wake_up */</a>
<a name="ln337">#if ATH_WOW_OFFLOAD</a>
<a name="ln338">        ar9300_wowoffload_prep,                 /* ah_wow_offload_prep */</a>
<a name="ln339">        ar9300_wowoffload_post,                 /* ah_wow_offload_post */</a>
<a name="ln340">        ar9300_wowoffload_download_rekey_data,  /* ah_wow_offload_download_rekey_data */</a>
<a name="ln341">        ar9300_wowoffload_retrieve_data,        /* ah_wow_offload_retrieve_data */</a>
<a name="ln342">        ar9300_wowoffload_download_acer_magic,  /* ah_wow_offload_download_acer_magic */</a>
<a name="ln343">        ar9300_wowoffload_download_acer_swka,   /* ah_wow_offload_download_acer_swka */</a>
<a name="ln344">        ar9300_wowoffload_download_arp_info,    /* ah_wow_offload_download_arp_info */</a>
<a name="ln345">        ar9300_wowoffload_download_ns_info,     /* ah_wow_offload_download_ns_info */</a>
<a name="ln346">#endif /* ATH_WOW_OFFLOAD */</a>
<a name="ln347">#endif</a>
<a name="ln348"> </a>
<a name="ln349">        /* Get Channel Noise */</a>
<a name="ln350">        ath_hal_get_chan_noise,            /* ah_get_chan_noise */</a>
<a name="ln351">        ar9300_chain_noise_floor,          /* ah_get_chain_noise_floor */</a>
<a name="ln352">        ar9300_get_nf_from_reg,            /* ah_get_nf_from_reg */</a>
<a name="ln353">        ar9300_get_rx_nf_offset,           /* ah_get_rx_nf_offset */</a>
<a name="ln354"> </a>
<a name="ln355">        /* Beacon Functions */</a>
<a name="ln356">        ar9300_beacon_init,                /* ah_beacon_init */</a>
<a name="ln357">        ar9300_set_sta_beacon_timers,      /* ah_set_station_beacon_timers */</a>
<a name="ln358"> </a>
<a name="ln359">        /* Interrupt Functions */</a>
<a name="ln360">        ar9300_is_interrupt_pending,       /* ah_is_interrupt_pending */</a>
<a name="ln361">        ar9300_get_pending_interrupts,     /* ah_get_pending_interrupts */</a>
<a name="ln362">        ar9300_get_interrupts,             /* ah_get_interrupts */</a>
<a name="ln363">        ar9300_set_interrupts,             /* ah_set_interrupts */</a>
<a name="ln364">        ar9300_set_intr_mitigation_timer,  /* ah_set_intr_mitigation_timer */</a>
<a name="ln365">        ar9300_get_intr_mitigation_timer,  /* ah_get_intr_mitigation_timer */</a>
<a name="ln366">	ar9300ForceVCS,</a>
<a name="ln367">        ar9300SetDfs3StreamFix,</a>
<a name="ln368">        ar9300Get3StreamSignature,</a>
<a name="ln369"> </a>
<a name="ln370">        /* 11n specific functions (NOT applicable to ar9300) */</a>
<a name="ln371">        ar9300_set_11n_tx_desc,            /* ah_set_11n_tx_desc */</a>
<a name="ln372">        /* Update rxchain */</a>
<a name="ln373">        ar9300_set_rx_chainmask,           /*ah_set_rx_chainmask*/</a>
<a name="ln374">        /*Updating locationing register */</a>
<a name="ln375">        ar9300_update_loc_ctl_reg,         /*ah_update_loc_ctl_reg*/</a>
<a name="ln376">        /* Start PAPRD functions  */</a>
<a name="ln377">        ar9300_set_paprd_tx_desc,          /* ah_set_paprd_tx_desc */</a>
<a name="ln378">        ar9300_paprd_init_table,           /* ah_paprd_init_table */</a>
<a name="ln379">        ar9300_paprd_setup_gain_table,     /* ah_paprd_setup_gain_table */</a>
<a name="ln380">        ar9300_paprd_create_curve,         /* ah_paprd_create_curve */</a>
<a name="ln381">        ar9300_paprd_is_done,              /* ah_paprd_is_done */</a>
<a name="ln382">        ar9300_enable_paprd,               /* ah_PAPRDEnable */</a>
<a name="ln383">        ar9300_populate_paprd_single_table,/* ah_paprd_populate_table */</a>
<a name="ln384">        ar9300_is_tx_done,                 /* ah_is_tx_done */</a>
<a name="ln385">        ar9300_paprd_dec_tx_pwr,            /* ah_paprd_dec_tx_pwr*/</a>
<a name="ln386">        ar9300_paprd_thermal_send,         /* ah_paprd_thermal_send */</a>
<a name="ln387">        /* End PAPRD functions */</a>
<a name="ln388">        ar9300_set_11n_rate_scenario,      /* ah_set_11n_rate_scenario */</a>
<a name="ln389">        ar9300_set_11n_aggr_first,         /* ah_set_11n_aggr_first */</a>
<a name="ln390">        ar9300_set_11n_aggr_middle,        /* ah_set_11n_aggr_middle */</a>
<a name="ln391">        ar9300_set_11n_aggr_last,          /* ah_set_11n_aggr_last */</a>
<a name="ln392">        ar9300_clr_11n_aggr,               /* ah_clr_11n_aggr */</a>
<a name="ln393">        ar9300_set_11n_rifs_burst_middle,  /* ah_set_11n_rifs_burst_middle */</a>
<a name="ln394">        ar9300_set_11n_rifs_burst_last,    /* ah_set_11n_rifs_burst_last */</a>
<a name="ln395">        ar9300_clr_11n_rifs_burst,         /* ah_clr_11n_rifs_burst */</a>
<a name="ln396">        ar9300_set_11n_aggr_rifs_burst,    /* ah_set_11n_aggr_rifs_burst */</a>
<a name="ln397">        ar9300_set_11n_rx_rifs,            /* ah_set_11n_rx_rifs */</a>
<a name="ln398">        ar9300_set_smart_antenna,             /* ah_setSmartAntenna */</a>
<a name="ln399">        ar9300_detect_bb_hang,             /* ah_detect_bb_hang */</a>
<a name="ln400">        ar9300_detect_mac_hang,            /* ah_detect_mac_hang */</a>
<a name="ln401">        ar9300_set_immunity,               /* ah_immunity */</a>
<a name="ln402">        ar9300_get_hw_hangs,               /* ah_get_hang_types */</a>
<a name="ln403">        ar9300_set_11n_burst_duration,     /* ah_set_11n_burst_duration */</a>
<a name="ln404">        ar9300_set_11n_virtual_more_frag,  /* ah_set_11n_virtual_more_frag */</a>
<a name="ln405">        ar9300_get_11n_ext_busy,           /* ah_get_11n_ext_busy */</a>
<a name="ln406">        ar9300_set_11n_mac2040,            /* ah_set_11n_mac2040 */</a>
<a name="ln407">        ar9300_get_11n_rx_clear,           /* ah_get_11n_rx_clear */</a>
<a name="ln408">        ar9300_set_11n_rx_clear,           /* ah_set_11n_rx_clear */</a>
<a name="ln409">        ar9300_get_mib_cycle_counts_pct,   /* ah_get_mib_cycle_counts_pct */</a>
<a name="ln410">        ar9300_dma_reg_dump,               /* ah_dma_reg_dump */</a>
<a name="ln411"> </a>
<a name="ln412">        /* force_ppm specific functions */</a>
<a name="ln413">        ar9300_ppm_get_rssi_dump,          /* ah_ppm_get_rssi_dump */</a>
<a name="ln414">        ar9300_ppm_arm_trigger,            /* ah_ppm_arm_trigger */</a>
<a name="ln415">        ar9300_ppm_get_trigger,            /* ah_ppm_get_trigger */</a>
<a name="ln416">        ar9300_ppm_force,                  /* ah_ppm_force */</a>
<a name="ln417">        ar9300_ppm_un_force,               /* ah_ppm_un_force */</a>
<a name="ln418">        ar9300_ppm_get_force_state,        /* ah_ppm_get_force_state */</a>
<a name="ln419"> </a>
<a name="ln420">        ar9300_get_spur_info,              /* ah_get_spur_info */</a>
<a name="ln421">        ar9300_set_spur_info,              /* ah_get_spur_info */</a>
<a name="ln422"> </a>
<a name="ln423">        ar9300_get_min_cca_pwr,            /* ah_ar_get_noise_floor_val */</a>
<a name="ln424"> </a>
<a name="ln425">        ar9300_green_ap_ps_on_off,         /* ah_set_rx_green_ap_ps_on_off */</a>
<a name="ln426">        ar9300_is_single_ant_power_save_possible, /* ah_is_single_ant_power_save_possible */</a>
<a name="ln427"> </a>
<a name="ln428">        /* radio measurement specific functions */</a>
<a name="ln429">        ar9300_get_mib_cycle_counts,       /* ah_get_mib_cycle_counts */</a>
<a name="ln430">        ar9300_get_vow_stats,              /* ah_get_vow_stats */</a>
<a name="ln431">        ar9300_clear_mib_counters,         /* ah_clear_mib_counters */</a>
<a name="ln432">#if ATH_GEN_RANDOMNESS</a>
<a name="ln433">        ar9300_get_rssi_chain0,            /* ah_get_rssi_chain0 */</a>
<a name="ln434">#endif</a>
<a name="ln435">#ifdef ATH_BT_COEX</a>
<a name="ln436">        /* Bluetooth Coexistence functions */</a>
<a name="ln437">        ar9300_set_bt_coex_info,           /* ah_set_bt_coex_info */</a>
<a name="ln438">        ar9300_bt_coex_config,             /* ah_bt_coex_config */</a>
<a name="ln439">        ar9300_bt_coex_set_qcu_thresh,     /* ah_bt_coex_set_qcu_thresh */</a>
<a name="ln440">        ar9300_bt_coex_set_weights,        /* ah_bt_coex_set_weights */</a>
<a name="ln441">        ar9300_bt_coex_setup_bmiss_thresh, /* ah_bt_coex_set_bmiss_thresh */</a>
<a name="ln442">        ar9300_bt_coex_set_parameter,      /* ah_bt_coex_set_parameter */</a>
<a name="ln443">        ar9300_bt_coex_disable,            /* ah_bt_coex_disable */</a>
<a name="ln444">        ar9300_bt_coex_enable,             /* ah_bt_coex_enable */</a>
<a name="ln445">        ar9300_get_bt_active_gpio,         /* ah_bt_coex_info*/</a>
<a name="ln446">        ar9300_get_wlan_active_gpio,       /* ah__coex_wlan_info*/</a>
<a name="ln447">#endif</a>
<a name="ln448">        /* Generic Timer functions */</a>
<a name="ln449">        ar9300_alloc_generic_timer,        /* ah_gentimer_alloc */</a>
<a name="ln450">        ar9300_free_generic_timer,         /* ah_gentimer_free */</a>
<a name="ln451">        ar9300_start_generic_timer,        /* ah_gentimer_start */</a>
<a name="ln452">        ar9300_stop_generic_timer,         /* ah_gentimer_stop */</a>
<a name="ln453">        ar9300_get_gen_timer_interrupts,   /* ah_gentimer_get_intr */</a>
<a name="ln454"> </a>
<a name="ln455">        ar9300_set_dcs_mode,               /* ah_set_dcs_mode */</a>
<a name="ln456">        ar9300_get_dcs_mode,               /* ah_get_dcs_mode */</a>
<a name="ln457">        </a>
<a name="ln458">#if ATH_ANT_DIV_COMB</a>
<a name="ln459">        ar9300_ant_div_comb_get_config,    /* ah_get_ant_dvi_comb_conf */</a>
<a name="ln460">        ar9300_ant_div_comb_set_config,    /* ah_set_ant_dvi_comb_conf */</a>
<a name="ln461">#endif</a>
<a name="ln462"> </a>
<a name="ln463">        ar9300_get_bb_panic_info,          /* ah_get_bb_panic_info */</a>
<a name="ln464">        ar9300_handle_radar_bb_panic,      /* ah_handle_radar_bb_panic */</a>
<a name="ln465">        ar9300_set_hal_reset_reason,       /* ah_set_hal_reset_reason */</a>
<a name="ln466"> </a>
<a name="ln467">#if ATH_PCIE_ERROR_MONITOR</a>
<a name="ln468">        ar9300_start_pcie_error_monitor,   /* ah_start_pcie_error_monitor */</a>
<a name="ln469">        ar9300_read_pcie_error_monitor,    /* ah_read_pcie_error_monitor*/</a>
<a name="ln470">        ar9300_stop_pcie_error_monitor,    /* ah_stop_pcie_error_monitor*/</a>
<a name="ln471">#endif /* ATH_PCIE_ERROR_MONITOR */</a>
<a name="ln472"> </a>
<a name="ln473">#if ATH_SUPPORT_SPECTRAL        </a>
<a name="ln474">        /* Spectral scan */</a>
<a name="ln475">        ar9300_configure_spectral_scan,    /* ah_ar_configure_spectral */</a>
<a name="ln476">        ar9300_get_spectral_params,        /* ah_ar_get_spectral_config */</a>
<a name="ln477">        ar9300_start_spectral_scan,        /* ah_ar_start_spectral_scan */</a>
<a name="ln478">        ar9300_stop_spectral_scan,         /* ah_ar_stop_spectral_scan */</a>
<a name="ln479">        ar9300_is_spectral_enabled,        /* ah_ar_is_spectral_enabled */</a>
<a name="ln480">        ar9300_is_spectral_active,         /* ah_ar_is_spectral_active */</a>
<a name="ln481">        ar9300_get_ctl_chan_nf,            /* ah_ar_get_ctl_nf */</a>
<a name="ln482">        ar9300_get_ext_chan_nf,            /* ah_ar_get_ext_nf */</a>
<a name="ln483">#endif  /*  ATH_SUPPORT_SPECTRAL */ </a>
<a name="ln484"> </a>
<a name="ln485"> </a>
<a name="ln486">        ar9300_promisc_mode,               /* ah_promisc_mode */</a>
<a name="ln487">        ar9300_read_pktlog_reg,            /* ah_read_pktlog_reg */</a>
<a name="ln488">        ar9300_write_pktlog_reg,           /* ah_write_pktlog_reg */</a>
<a name="ln489">        ar9300_set_proxy_sta,              /* ah_set_proxy_sta */</a>
<a name="ln490">        ar9300_get_cal_intervals,          /* ah_get_cal_intervals */</a>
<a name="ln491">#if ATH_TRAFFIC_FAST_RECOVER</a>
<a name="ln492">        ar9300_get_pll3_sqsum_dvc,         /* ah_get_pll3_sqsum_dvc */</a>
<a name="ln493">#endif</a>
<a name="ln494">#ifdef ATH_SUPPORT_HTC</a>
<a name="ln495">        AH_NULL,</a>
<a name="ln496">#endif</a>
<a name="ln497"> </a>
<a name="ln498">#ifdef ATH_TX99_DIAG</a>
<a name="ln499">        /* Tx99 functions */</a>
<a name="ln500">#ifdef ATH_SUPPORT_HTC</a>
<a name="ln501">        AH_NULL,</a>
<a name="ln502">        AH_NULL,</a>
<a name="ln503">        AH_NULL,</a>
<a name="ln504">        AH_NULL,</a>
<a name="ln505">        AH_NULL,</a>
<a name="ln506">        AH_NULL,</a>
<a name="ln507">        AH_NULL,</a>
<a name="ln508">#else</a>
<a name="ln509">        AH_NULL,</a>
<a name="ln510">        AH_NULL,</a>
<a name="ln511">        ar9300_tx99_channel_pwr_update,		/* ah_tx99channelpwrupdate */</a>
<a name="ln512">        ar9300_tx99_start,					/* ah_tx99start */</a>
<a name="ln513">        ar9300_tx99_stop,					/* ah_tx99stop */</a>
<a name="ln514">        ar9300_tx99_chainmsk_setup,			/* ah_tx99_chainmsk_setup */</a>
<a name="ln515">        ar9300_tx99_set_single_carrier,		/* ah_tx99_set_single_carrier */</a>
<a name="ln516">#endif</a>
<a name="ln517">#endif</a>
<a name="ln518">        ar9300_chk_rssi_update_tx_pwr,</a>
<a name="ln519">        ar9300_is_skip_paprd_by_greentx,   /* ah_is_skip_paprd_by_greentx */</a>
<a name="ln520">        ar9300_hwgreentx_set_pal_spare,    /* ah_hwgreentx_set_pal_spare */</a>
<a name="ln521">#if ATH_SUPPORT_MCI</a>
<a name="ln522">        /* MCI Coexistence Functions */</a>
<a name="ln523">        ar9300_mci_setup,                   /* ah_mci_setup */</a>
<a name="ln524">        ar9300_mci_send_message,            /* ah_mci_send_message */</a>
<a name="ln525">        ar9300_mci_get_interrupt,           /* ah_mci_get_interrupt */</a>
<a name="ln526">        ar9300_mci_state,                   /* ah_mci_state */</a>
<a name="ln527">        ar9300_mci_detach,                  /* ah_mci_detach */</a>
<a name="ln528">#endif</a>
<a name="ln529">        ar9300_reset_hw_beacon_proc_crc,   /* ah_reset_hw_beacon_proc_crc */</a>
<a name="ln530">        ar9300_get_hw_beacon_rssi,         /* ah_get_hw_beacon_rssi */</a>
<a name="ln531">        ar9300_set_hw_beacon_rssi_threshold,/*ah_set_hw_beacon_rssi_threshold*/</a>
<a name="ln532">        ar9300_reset_hw_beacon_rssi,       /* ah_reset_hw_beacon_rssi */</a>
<a name="ln533">        ar9300_mat_enable,                 /* ah_mat_enable */</a>
<a name="ln534">        ar9300_dump_keycache,              /* ah_dump_keycache */</a>
<a name="ln535">        ar9300_is_ani_noise_spur,         /* ah_is_ani_noise_spur */</a>
<a name="ln536">        ar9300_set_hw_beacon_proc,         /* ah_set_hw_beacon_proc */</a>
<a name="ln537">        ar9300_set_ctl_pwr,                 /* ah_set_ctl_pwr */</a>
<a name="ln538">        ar9300_set_txchainmaskopt,          /* ah_set_txchainmaskopt */</a>
<a name="ln539">    },</a>
<a name="ln540"> </a>
<a name="ln541">    ar9300_get_channel_edges,              /* ah_get_channel_edges */</a>
<a name="ln542">    ar9300_get_wireless_modes,             /* ah_get_wireless_modes */</a>
<a name="ln543">    ar9300_eeprom_read_word,               /* ah_eeprom_read */</a>
<a name="ln544">    AH_NULL,</a>
<a name="ln545">    ar9300_eeprom_dump_support,            /* ah_eeprom_dump */</a>
<a name="ln546">    ar9300_get_chip_power_limits,          /* ah_get_chip_power_limits */</a>
<a name="ln547"> </a>
<a name="ln548">    ar9300_get_nf_adjust,                  /* ah_get_nf_adjust */</a>
<a name="ln549">    /* rest is zero'd by compiler */</a>
<a name="ln550">};</a>
<a name="ln551">#endif</a>
<a name="ln552"> </a>
<a name="ln553">/*</a>
<a name="ln554"> * Read MAC version/revision information from Chip registers and initialize</a>
<a name="ln555"> * local data structures.</a>
<a name="ln556"> */</a>
<a name="ln557">void</a>
<a name="ln558">ar9300_read_revisions(struct ath_hal *ah)</a>
<a name="ln559">{</a>
<a name="ln560">    u_int32_t val;</a>
<a name="ln561"> </a>
<a name="ln562">    /* XXX verify if this is the correct way to read revision on Osprey */</a>
<a name="ln563">    /* new SREV format for Sowl and later */</a>
<a name="ln564">    val = OS_REG_READ(ah, AR_HOSTIF_REG(ah, AR_SREV));</a>
<a name="ln565"> </a>
<a name="ln566">    if (AH_PRIVATE(ah)-&gt;ah_devid == AR9300_DEVID_AR9340) {</a>
<a name="ln567">        /* XXX: AR_SREV register in Wasp reads 0 */</a>
<a name="ln568">        AH_PRIVATE(ah)-&gt;ah_macVersion = AR_SREV_VERSION_WASP;</a>
<a name="ln569">    } else if(AH_PRIVATE(ah)-&gt;ah_devid == AR9300_DEVID_QCA955X) {</a>
<a name="ln570">        /* XXX: AR_SREV register in Scorpion reads 0 */</a>
<a name="ln571">       AH_PRIVATE(ah)-&gt;ah_macVersion = AR_SREV_VERSION_SCORPION;</a>
<a name="ln572">    } else if(AH_PRIVATE(ah)-&gt;ah_devid == AR9300_DEVID_QCA953X) {</a>
<a name="ln573">        /* XXX: AR_SREV register in HoneyBEE reads 0 */</a>
<a name="ln574">       AH_PRIVATE(ah)-&gt;ah_macVersion = AR_SREV_VERSION_HONEYBEE;</a>
<a name="ln575">    } else {</a>
<a name="ln576">        /*</a>
<a name="ln577">         * Include 6-bit Chip Type (masked to 0)</a>
<a name="ln578">         * to differentiate from pre-Sowl versions</a>
<a name="ln579">         */</a>
<a name="ln580">        AH_PRIVATE(ah)-&gt;ah_macVersion =</a>
<a name="ln581">            (val &amp; AR_SREV_VERSION2) &gt;&gt; AR_SREV_TYPE2_S;</a>
<a name="ln582">    }</a>
<a name="ln583"> </a>
<a name="ln584"> </a>
<a name="ln585"> </a>
<a name="ln586"> </a>
<a name="ln587"> </a>
<a name="ln588">#ifdef AH_SUPPORT_HORNET</a>
<a name="ln589">    /*</a>
<a name="ln590">     *  EV74984, due to Hornet 1.1 didn't update WMAC revision,</a>
<a name="ln591">     *  so that have to read SoC's revision ID instead</a>
<a name="ln592">     */</a>
<a name="ln593">    if (AH_PRIVATE(ah)-&gt;ah_macVersion == AR_SREV_VERSION_HORNET) {</a>
<a name="ln594">#define AR_SOC_RST_REVISION_ID         0xB8060090</a>
<a name="ln595">#define REG_READ(_reg)                 *((volatile u_int32_t *)(_reg))</a>
<a name="ln596">        if ((REG_READ(AR_SOC_RST_REVISION_ID) &amp; AR_SREV_REVISION_HORNET_11_MASK)</a>
<a name="ln597">            == AR_SREV_REVISION_HORNET_11)</a>
<a name="ln598">        {</a>
<a name="ln599">            AH_PRIVATE(ah)-&gt;ah_macRev = AR_SREV_REVISION_HORNET_11;</a>
<a name="ln600">        } else {</a>
<a name="ln601">            AH_PRIVATE(ah)-&gt;ah_macRev = MS(val, AR_SREV_REVISION2);</a>
<a name="ln602">        }</a>
<a name="ln603">#undef REG_READ</a>
<a name="ln604">#undef AR_SOC_RST_REVISION_ID</a>
<a name="ln605">    } else</a>
<a name="ln606">#endif</a>
<a name="ln607">    if (AH_PRIVATE(ah)-&gt;ah_macVersion == AR_SREV_VERSION_WASP)</a>
<a name="ln608">    {</a>
<a name="ln609">#define AR_SOC_RST_REVISION_ID         0xB8060090</a>
<a name="ln610">#define REG_READ(_reg)                 *((volatile u_int32_t *)(_reg))</a>
<a name="ln611"> </a>
<a name="ln612">        AH_PRIVATE(ah)-&gt;ah_macRev = </a>
<a name="ln613">            REG_READ(AR_SOC_RST_REVISION_ID) &amp; AR_SREV_REVISION_WASP_MASK; </a>
<a name="ln614">#undef REG_READ</a>
<a name="ln615">#undef AR_SOC_RST_REVISION_ID</a>
<a name="ln616">    }</a>
<a name="ln617">    else</a>
<a name="ln618">        AH_PRIVATE(ah)-&gt;ah_macRev = MS(val, AR_SREV_REVISION2);</a>
<a name="ln619"> </a>
<a name="ln620">    if (AR_SREV_JUPITER(ah) || AR_SREV_APHRODITE(ah)) {</a>
<a name="ln621">        AH_PRIVATE(ah)-&gt;ah_ispcie = AH_TRUE;</a>
<a name="ln622">    }</a>
<a name="ln623">    else {</a>
<a name="ln624">        AH_PRIVATE(ah)-&gt;ah_ispcie = </a>
<a name="ln625">            (val &amp; AR_SREV_TYPE2_HOST_MODE) ? 0 : 1;</a>
<a name="ln626">    }</a>
<a name="ln627">    </a>
<a name="ln628">}</a>
<a name="ln629"> </a>
<a name="ln630">/*</a>
<a name="ln631"> * Attach for an AR9300 part.</a>
<a name="ln632"> */</a>
<a name="ln633">struct ath_hal *</a>
<a name="ln634">ar9300_attach(u_int16_t devid, HAL_SOFTC sc, HAL_BUS_TAG st,</a>
<a name="ln635">  HAL_BUS_HANDLE sh, uint16_t *eepromdata, HAL_OPS_CONFIG *ah_config,</a>
<a name="ln636">  HAL_STATUS *status)</a>
<a name="ln637">{</a>
<a name="ln638">    struct ath_hal_9300     *ahp;</a>
<a name="ln639">    struct ath_hal          *ah;</a>
<a name="ln640">    struct ath_hal_private  *ahpriv;</a>
<a name="ln641">    HAL_STATUS              ecode;</a>
<a name="ln642"> </a>
<a name="ln643">    HAL_NO_INTERSPERSED_READS;</a>
<a name="ln644"> </a>
<a name="ln645">    /* NB: memory is returned zero'd */</a>
<a name="ln646">    ahp = ar9300_new_state(devid, sc, st, sh, eepromdata, ah_config, status);</a>
<a name="ln647">    if (ahp == AH_NULL) {</a>
<a name="ln648">        return AH_NULL;</a>
<a name="ln649">    }</a>
<a name="ln650">    ah = &amp;ahp-&gt;ah_priv.h;</a>
<a name="ln651">    ar9300_init_offsets(ah, devid);</a>
<a name="ln652">    ahpriv = AH_PRIVATE(ah);</a>
<a name="ln653">//    AH_PRIVATE(ah)-&gt;ah_bustype = bustype;</a>
<a name="ln654"> </a>
<a name="ln655">    /* FreeBSD: to make OTP work for now, provide this.. */</a>
<a name="ln656">    AH9300(ah)-&gt;ah_cal_mem = ath_hal_malloc(HOST_CALDATA_SIZE);</a>
<a name="ln657">    if (AH9300(ah)-&gt;ah_cal_mem == NULL) {</a>
<a name="ln658">        ath_hal_printf(ah, &quot;%s: caldata malloc failed!\n&quot;, __func__);</a>
<a name="ln659">        ecode = HAL_EIO;</a>
<a name="ln660">        goto bad;</a>
<a name="ln661">    }</a>
<a name="ln662"> </a>
<a name="ln663">    /*</a>
<a name="ln664">     * If eepromdata is not NULL, copy it it into ah_cal_mem.</a>
<a name="ln665">     */</a>
<a name="ln666">    if (eepromdata != NULL)</a>
<a name="ln667">        OS_MEMCPY(AH9300(ah)-&gt;ah_cal_mem, eepromdata, HOST_CALDATA_SIZE);</a>
<a name="ln668"> </a>
<a name="ln669">    /* XXX FreeBSD: enable RX mitigation */</a>
<a name="ln670">    ah-&gt;ah_config.ath_hal_intr_mitigation_rx = 1;</a>
<a name="ln671"> </a>
<a name="ln672">    /* interrupt mitigation */</a>
<a name="ln673">#ifdef AR5416_INT_MITIGATION</a>
<a name="ln674">    if (ah-&gt;ah_config.ath_hal_intr_mitigation_rx != 0) {</a>
<a name="ln675">        ahp-&gt;ah_intr_mitigation_rx = AH_TRUE;</a>
<a name="ln676">    }</a>
<a name="ln677">#else</a>
<a name="ln678">    /* Enable Rx mitigation (default) */</a>
<a name="ln679">    ahp-&gt;ah_intr_mitigation_rx = AH_TRUE;</a>
<a name="ln680">    ah-&gt;ah_config.ath_hal_intr_mitigation_rx = 1;</a>
<a name="ln681"> </a>
<a name="ln682">#endif</a>
<a name="ln683">#ifdef HOST_OFFLOAD</a>
<a name="ln684">    /* Reset default Rx mitigation values for Hornet */</a>
<a name="ln685">    if (AR_SREV_HORNET(ah)) {</a>
<a name="ln686">        ahp-&gt;ah_intr_mitigation_rx = AH_FALSE;</a>
<a name="ln687">#ifdef AR5416_INT_MITIGATION</a>
<a name="ln688">        ah-&gt;ah_config.ath_hal_intr_mitigation_rx = 0;</a>
<a name="ln689">#endif</a>
<a name="ln690">    }</a>
<a name="ln691">#endif</a>
<a name="ln692"> </a>
<a name="ln693">    if (ah-&gt;ah_config.ath_hal_intr_mitigation_tx != 0) {</a>
<a name="ln694">        ahp-&gt;ah_intr_mitigation_tx = AH_TRUE;</a>
<a name="ln695">    }</a>
<a name="ln696"> </a>
<a name="ln697">    /*</a>
<a name="ln698">     * Read back AR_WA into a permanent copy and set bits 14 and 17. </a>
<a name="ln699">     * We need to do this to avoid RMW of this register. </a>
<a name="ln700">     * Do this before calling ar9300_set_reset_reg. </a>
<a name="ln701">     * If not, the AR_WA register which was inited via EEPROM</a>
<a name="ln702">     * will get wiped out.</a>
<a name="ln703">     */</a>
<a name="ln704">    ahp-&gt;ah_wa_reg_val = OS_REG_READ(ah,  AR_HOSTIF_REG(ah, AR_WA));</a>
<a name="ln705">    /* Set Bits 14 and 17 in the AR_WA register. */</a>
<a name="ln706">    ahp-&gt;ah_wa_reg_val |=</a>
<a name="ln707">        AR_WA_D3_TO_L1_DISABLE | AR_WA_ASPM_TIMER_BASED_DISABLE;</a>
<a name="ln708">    </a>
<a name="ln709">    if (!ar9300_set_reset_reg(ah, HAL_RESET_POWER_ON)) {    /* reset chip */</a>
<a name="ln710">        HALDEBUG(ah, HAL_DEBUG_RESET, &quot;%s: couldn't reset chip\n&quot;, __func__);</a>
<a name="ln711">        ecode = HAL_EIO;</a>
<a name="ln712">        goto bad;</a>
<a name="ln713">    }</a>
<a name="ln714"> </a>
<a name="ln715">    if (AR_SREV_JUPITER(ah)</a>
<a name="ln716">#if ATH_WOW_OFFLOAD</a>
<a name="ln717">        &amp;&amp; !HAL_WOW_CTRL(ah, HAL_WOW_OFFLOAD_SET_4004_BIT14)</a>
<a name="ln718">#endif</a>
<a name="ln719">        )</a>
<a name="ln720">    {</a>
<a name="ln721">        /* Jupiter doesn't need bit 14 to be set. */</a>
<a name="ln722">        ahp-&gt;ah_wa_reg_val &amp;= ~AR_WA_D3_TO_L1_DISABLE;</a>
<a name="ln723">        OS_REG_WRITE(ah, AR_HOSTIF_REG(ah, AR_WA), ahp-&gt;ah_wa_reg_val);</a>
<a name="ln724">    }</a>
<a name="ln725"> </a>
<a name="ln726">#if ATH_SUPPORT_MCI</a>
<a name="ln727">    if (AR_SREV_JUPITER(ah) || AR_SREV_APHRODITE(ah)) {</a>
<a name="ln728">#if 1</a>
<a name="ln729">        ah-&gt;ah_btCoexSetWeights = ar9300_mci_bt_coex_set_weights;</a>
<a name="ln730">        ah-&gt;ah_btCoexDisable = ar9300_mci_bt_coex_disable;</a>
<a name="ln731">        ah-&gt;ah_btCoexEnable = ar9300_mci_bt_coex_enable;</a>
<a name="ln732">#endif</a>
<a name="ln733">        ahp-&gt;ah_mci_ready = AH_FALSE;</a>
<a name="ln734">        ahp-&gt;ah_mci_bt_state = MCI_BT_SLEEP;</a>
<a name="ln735">        ahp-&gt;ah_mci_coex_major_version_wlan = MCI_GPM_COEX_MAJOR_VERSION_WLAN;</a>
<a name="ln736">        ahp-&gt;ah_mci_coex_minor_version_wlan = MCI_GPM_COEX_MINOR_VERSION_WLAN;</a>
<a name="ln737">        ahp-&gt;ah_mci_coex_major_version_bt = MCI_GPM_COEX_MAJOR_VERSION_DEFAULT;</a>
<a name="ln738">        ahp-&gt;ah_mci_coex_minor_version_bt = MCI_GPM_COEX_MINOR_VERSION_DEFAULT;</a>
<a name="ln739">        ahp-&gt;ah_mci_coex_bt_version_known = AH_FALSE;</a>
<a name="ln740">        ahp-&gt;ah_mci_coex_2g5g_update = AH_TRUE; /* track if 2g5g status sent */</a>
<a name="ln741">        /* will be updated before boot up sequence */</a>
<a name="ln742">        ahp-&gt;ah_mci_coex_is_2g = AH_TRUE;</a>
<a name="ln743">        ahp-&gt;ah_mci_coex_wlan_channels_update = AH_FALSE;</a>
<a name="ln744">        ahp-&gt;ah_mci_coex_wlan_channels[0] = 0x00000000;</a>
<a name="ln745">        ahp-&gt;ah_mci_coex_wlan_channels[1] = 0xffffffff;</a>
<a name="ln746">        ahp-&gt;ah_mci_coex_wlan_channels[2] = 0xffffffff;</a>
<a name="ln747">        ahp-&gt;ah_mci_coex_wlan_channels[3] = 0x7fffffff;</a>
<a name="ln748">        ahp-&gt;ah_mci_query_bt = AH_TRUE; /* In case WLAN start after BT */</a>
<a name="ln749">        ahp-&gt;ah_mci_unhalt_bt_gpm = AH_TRUE; /* Send UNHALT at beginning */</a>
<a name="ln750">        ahp-&gt;ah_mci_halted_bt_gpm = AH_FALSE; /* Allow first HALT */</a>
<a name="ln751">        ahp-&gt;ah_mci_need_flush_btinfo = AH_FALSE;</a>
<a name="ln752">        ahp-&gt;ah_mci_wlan_cal_seq = 0;</a>
<a name="ln753">        ahp-&gt;ah_mci_wlan_cal_done = 0;</a>
<a name="ln754">    }</a>
<a name="ln755">#endif /* ATH_SUPPORT_MCI */</a>
<a name="ln756"> </a>
<a name="ln757">#if ATH_WOW_OFFLOAD</a>
<a name="ln758">    ahp-&gt;ah_mcast_filter_l32_set = 0;</a>
<a name="ln759">    ahp-&gt;ah_mcast_filter_u32_set = 0;</a>
<a name="ln760">#endif</a>
<a name="ln761"> </a>
<a name="ln762">    if (AR_SREV_HORNET(ah)) {</a>
<a name="ln763">#ifdef AH_SUPPORT_HORNET</a>
<a name="ln764">        if (!AR_SREV_HORNET_11(ah)) {</a>
<a name="ln765">            /*</a>
<a name="ln766">             * Do not check bootstrap register, which cannot be trusted</a>
<a name="ln767">             * due to s26 switch issue on CUS164/AP121.</a>
<a name="ln768">             */</a>
<a name="ln769">            ahp-&gt;clk_25mhz = 1;</a>
<a name="ln770">            HALDEBUG(AH_NULL, HAL_DEBUG_UNMASKABLE, &quot;Bootstrap clock 25MHz\n&quot;);</a>
<a name="ln771">        } else {</a>
<a name="ln772">            /* check bootstrap clock setting */</a>
<a name="ln773">#define AR_SOC_SEL_25M_40M         0xB80600AC</a>
<a name="ln774">#define REG_WRITE(_reg, _val)    *((volatile u_int32_t *)(_reg)) = (_val);</a>
<a name="ln775">#define REG_READ(_reg)          (*((volatile u_int32_t *)(_reg)))</a>
<a name="ln776">            if (REG_READ(AR_SOC_SEL_25M_40M) &amp; 0x1) {</a>
<a name="ln777">                ahp-&gt;clk_25mhz = 0;</a>
<a name="ln778">                HALDEBUG(AH_NULL, HAL_DEBUG_UNMASKABLE,</a>
<a name="ln779">                    &quot;Bootstrap clock 40MHz\n&quot;);</a>
<a name="ln780">            } else {</a>
<a name="ln781">                ahp-&gt;clk_25mhz = 1;</a>
<a name="ln782">                HALDEBUG(AH_NULL, HAL_DEBUG_UNMASKABLE,</a>
<a name="ln783">                    &quot;Bootstrap clock 25MHz\n&quot;);</a>
<a name="ln784">            }</a>
<a name="ln785">#undef REG_READ</a>
<a name="ln786">#undef REG_WRITE</a>
<a name="ln787">#undef AR_SOC_SEL_25M_40M</a>
<a name="ln788">        }</a>
<a name="ln789">#endif /* AH_SUPPORT_HORNET */</a>
<a name="ln790">    }</a>
<a name="ln791"> </a>
<a name="ln792">    if (AR_SREV_WASP(ah) || AR_SREV_SCORPION(ah)) {</a>
<a name="ln793">        /* check bootstrap clock setting */</a>
<a name="ln794">#define AR9340_SOC_SEL_25M_40M         0xB80600B0</a>
<a name="ln795">#define AR9340_REF_CLK_40              (1 &lt;&lt; 4) /* 0 - 25MHz   1 - 40 MHz */</a>
<a name="ln796">#define REG_READ(_reg)          (*((volatile u_int32_t *)(_reg)))</a>
<a name="ln797">        if (REG_READ(AR9340_SOC_SEL_25M_40M) &amp; AR9340_REF_CLK_40) {</a>
<a name="ln798">            ahp-&gt;clk_25mhz = 0;</a>
<a name="ln799">            HALDEBUG(AH_NULL, HAL_DEBUG_UNMASKABLE, &quot;Bootstrap clock 40MHz\n&quot;);</a>
<a name="ln800">        } else {</a>
<a name="ln801">            ahp-&gt;clk_25mhz = 1;</a>
<a name="ln802">            HALDEBUG(AH_NULL, HAL_DEBUG_UNMASKABLE, &quot;Bootstrap clock 25MHz\n&quot;);</a>
<a name="ln803">        }</a>
<a name="ln804">#undef REG_READ</a>
<a name="ln805">#undef AR9340_SOC_SEL_25M_40M</a>
<a name="ln806">#undef AR9340_REF_CLK_40</a>
<a name="ln807">    }</a>
<a name="ln808"> </a>
<a name="ln809">    if (AR_SREV_HONEYBEE(ah)) {</a>
<a name="ln810">            ahp-&gt;clk_25mhz = 1;</a>
<a name="ln811">    }</a>
<a name="ln812"> </a>
<a name="ln813">    ar9300_init_pll(ah, AH_NULL);</a>
<a name="ln814"> </a>
<a name="ln815">    if (!ar9300_set_power_mode(ah, HAL_PM_AWAKE, AH_TRUE)) {</a>
<a name="ln816">        HALDEBUG(ah, HAL_DEBUG_RESET, &quot;%s: couldn't wakeup chip\n&quot;, __func__);</a>
<a name="ln817">        ecode = HAL_EIO;</a>
<a name="ln818">        goto bad;</a>
<a name="ln819">    }</a>
<a name="ln820"> </a>
<a name="ln821">    /* No serialization of Register Accesses needed. */</a>
<a name="ln822">    ah-&gt;ah_config.ah_serialise_reg_war = SER_REG_MODE_OFF;</a>
<a name="ln823">    HALDEBUG(ah, HAL_DEBUG_RESET, &quot;%s: ah_serialise_reg_war is %d\n&quot;,</a>
<a name="ln824">             __func__, ah-&gt;ah_config.ah_serialise_reg_war);</a>
<a name="ln825"> </a>
<a name="ln826">    /*</a>
<a name="ln827">     * Add mac revision check when needed.</a>
<a name="ln828">     * - Osprey 1.0 and 2.0 no longer supported.</a>
<a name="ln829">     */</a>
<a name="ln830">    if (((ahpriv-&gt;ah_macVersion == AR_SREV_VERSION_OSPREY) &amp;&amp;</a>
<a name="ln831">          (ahpriv-&gt;ah_macRev &lt;= AR_SREV_REVISION_OSPREY_20)) ||</a>
<a name="ln832">        (ahpriv-&gt;ah_macVersion != AR_SREV_VERSION_OSPREY &amp;&amp;</a>
<a name="ln833">        ahpriv-&gt;ah_macVersion != AR_SREV_VERSION_WASP &amp;&amp; </a>
<a name="ln834">        ahpriv-&gt;ah_macVersion != AR_SREV_VERSION_HORNET &amp;&amp;</a>
<a name="ln835">        ahpriv-&gt;ah_macVersion != AR_SREV_VERSION_POSEIDON &amp;&amp;</a>
<a name="ln836">        ahpriv-&gt;ah_macVersion != AR_SREV_VERSION_SCORPION &amp;&amp;</a>
<a name="ln837">        ahpriv-&gt;ah_macVersion != AR_SREV_VERSION_HONEYBEE &amp;&amp;</a>
<a name="ln838">        ahpriv-&gt;ah_macVersion != AR_SREV_VERSION_JUPITER &amp;&amp;</a>
<a name="ln839">        ahpriv-&gt;ah_macVersion != AR_SREV_VERSION_APHRODITE) ) {</a>
<a name="ln840">        HALDEBUG(ah, HAL_DEBUG_RESET,</a>
<a name="ln841">            &quot;%s: Mac Chip Rev 0x%02x.%x is not supported by this driver\n&quot;,</a>
<a name="ln842">            __func__,</a>
<a name="ln843">            ahpriv-&gt;ah_macVersion,</a>
<a name="ln844">            ahpriv-&gt;ah_macRev);</a>
<a name="ln845">        ecode = HAL_ENOTSUPP;</a>
<a name="ln846">        goto bad;</a>
<a name="ln847">    }</a>
<a name="ln848"> </a>
<a name="ln849">    AH_PRIVATE(ah)-&gt;ah_phyRev = OS_REG_READ(ah, AR_PHY_CHIP_ID);</a>
<a name="ln850"> </a>
<a name="ln851">    /* Setup supported calibrations */</a>
<a name="ln852">    ahp-&gt;ah_iq_cal_data.cal_data = &amp;iq_cal_single_sample;</a>
<a name="ln853">    ahp-&gt;ah_supp_cals = IQ_MISMATCH_CAL;</a>
<a name="ln854"> </a>
<a name="ln855">    /* Enable ANI */</a>
<a name="ln856">    ahp-&gt;ah_ani_function = HAL_ANI_ALL;</a>
<a name="ln857"> </a>
<a name="ln858">    /* Enable RIFS */</a>
<a name="ln859">    ahp-&gt;ah_rifs_enabled = AH_TRUE;</a>
<a name="ln860"> </a>
<a name="ln861">    /* by default, stop RX also in abort txdma, due to</a>
<a name="ln862">       &quot;Unable to stop TxDMA&quot; msg observed */</a>
<a name="ln863">    ahp-&gt;ah_abort_txdma_norx = AH_TRUE;</a>
<a name="ln864"> </a>
<a name="ln865">    /* do not use optional tx chainmask by default */</a>
<a name="ln866">    ahp-&gt;ah_tx_chainmaskopt = 0;</a>
<a name="ln867"> </a>
<a name="ln868">    ahp-&gt;ah_skip_rx_iq_cal = AH_FALSE;</a>
<a name="ln869">    ahp-&gt;ah_rx_cal_complete = AH_FALSE;</a>
<a name="ln870">    ahp-&gt;ah_rx_cal_chan = 0;</a>
<a name="ln871">    ahp-&gt;ah_rx_cal_chan_flag = 0;</a>
<a name="ln872"> </a>
<a name="ln873">    HALDEBUG(ah, HAL_DEBUG_RESET,</a>
<a name="ln874">        &quot;%s: This Mac Chip Rev 0x%02x.%x is \n&quot;, __func__,</a>
<a name="ln875">        ahpriv-&gt;ah_macVersion,</a>
<a name="ln876">        ahpriv-&gt;ah_macRev);</a>
<a name="ln877"> </a>
<a name="ln878">    if (AR_SREV_HORNET_12(ah)) {</a>
<a name="ln879">        /* mac */</a>
<a name="ln880">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln881">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln882">            ar9331_hornet1_2_mac_core,</a>
<a name="ln883">            ARRAY_LENGTH(ar9331_hornet1_2_mac_core), 2);</a>
<a name="ln884">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_POST],</a>
<a name="ln885">            ar9331_hornet1_2_mac_postamble,</a>
<a name="ln886">            ARRAY_LENGTH(ar9331_hornet1_2_mac_postamble), 5);</a>
<a name="ln887"> </a>
<a name="ln888">        /* bb */</a>
<a name="ln889">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln890">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_CORE],</a>
<a name="ln891">            ar9331_hornet1_2_baseband_core,</a>
<a name="ln892">            ARRAY_LENGTH(ar9331_hornet1_2_baseband_core), 2);</a>
<a name="ln893">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln894">            ar9331_hornet1_2_baseband_postamble,</a>
<a name="ln895">            ARRAY_LENGTH(ar9331_hornet1_2_baseband_postamble), 5);</a>
<a name="ln896"> </a>
<a name="ln897">        /* radio */</a>
<a name="ln898">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln899">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_CORE], </a>
<a name="ln900">            ar9331_hornet1_2_radio_core,</a>
<a name="ln901">            ARRAY_LENGTH(ar9331_hornet1_2_radio_core), 2);</a>
<a name="ln902">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_POST], NULL, 0, 0);</a>
<a name="ln903"> </a>
<a name="ln904">        /* soc */</a>
<a name="ln905">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln906">            ar9331_hornet1_2_soc_preamble,</a>
<a name="ln907">            ARRAY_LENGTH(ar9331_hornet1_2_soc_preamble), 2);</a>
<a name="ln908">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_CORE], NULL, 0, 0);</a>
<a name="ln909">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_POST],</a>
<a name="ln910">            ar9331_hornet1_2_soc_postamble,</a>
<a name="ln911">            ARRAY_LENGTH(ar9331_hornet1_2_soc_postamble), 2);</a>
<a name="ln912"> </a>
<a name="ln913">        /* rx/tx gain */</a>
<a name="ln914">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln915">            ar9331_common_rx_gain_hornet1_2, </a>
<a name="ln916">            ARRAY_LENGTH(ar9331_common_rx_gain_hornet1_2), 2);</a>
<a name="ln917">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln918">            ar9331_modes_lowest_ob_db_tx_gain_hornet1_2, </a>
<a name="ln919">            ARRAY_LENGTH(ar9331_modes_lowest_ob_db_tx_gain_hornet1_2), 5);</a>
<a name="ln920"> </a>
<a name="ln921">        ah-&gt;ah_config.ath_hal_pcie_power_save_enable = 0;</a>
<a name="ln922"> </a>
<a name="ln923">        /* Japan 2484Mhz CCK settings */</a>
<a name="ln924">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_japan2484,</a>
<a name="ln925">            ar9331_hornet1_2_baseband_core_txfir_coeff_japan_2484,</a>
<a name="ln926">            ARRAY_LENGTH(</a>
<a name="ln927">                ar9331_hornet1_2_baseband_core_txfir_coeff_japan_2484), 2);</a>
<a name="ln928">    </a>
<a name="ln929">#if 0 /* ATH_WOW */</a>
<a name="ln930">        /* SerDes values during WOW sleep */</a>
<a name="ln931">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_wow, ar9300_pcie_phy_awow,</a>
<a name="ln932">                ARRAY_LENGTH(ar9300_pcie_phy_awow), 2);</a>
<a name="ln933">#endif</a>
<a name="ln934">    </a>
<a name="ln935">        /* additional clock settings */</a>
<a name="ln936">        if (AH9300(ah)-&gt;clk_25mhz) {</a>
<a name="ln937">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional,</a>
<a name="ln938">                ar9331_hornet1_2_xtal_25M,</a>
<a name="ln939">                ARRAY_LENGTH(ar9331_hornet1_2_xtal_25M), 2);</a>
<a name="ln940">        } else {</a>
<a name="ln941">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional,</a>
<a name="ln942">                ar9331_hornet1_2_xtal_40M,</a>
<a name="ln943">                ARRAY_LENGTH(ar9331_hornet1_2_xtal_40M), 2);</a>
<a name="ln944">        }</a>
<a name="ln945"> </a>
<a name="ln946">    } else if (AR_SREV_HORNET_11(ah)) {</a>
<a name="ln947">        /* mac */</a>
<a name="ln948">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln949">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln950">            ar9331_hornet1_1_mac_core,</a>
<a name="ln951">            ARRAY_LENGTH(ar9331_hornet1_1_mac_core), 2);</a>
<a name="ln952">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_POST],</a>
<a name="ln953">            ar9331_hornet1_1_mac_postamble,</a>
<a name="ln954">            ARRAY_LENGTH(ar9331_hornet1_1_mac_postamble), 5);</a>
<a name="ln955"> </a>
<a name="ln956">        /* bb */</a>
<a name="ln957">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln958">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_CORE],</a>
<a name="ln959">            ar9331_hornet1_1_baseband_core,</a>
<a name="ln960">            ARRAY_LENGTH(ar9331_hornet1_1_baseband_core), 2);</a>
<a name="ln961">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln962">            ar9331_hornet1_1_baseband_postamble,</a>
<a name="ln963">            ARRAY_LENGTH(ar9331_hornet1_1_baseband_postamble), 5);</a>
<a name="ln964"> </a>
<a name="ln965">        /* radio */</a>
<a name="ln966">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln967">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_CORE], </a>
<a name="ln968">            ar9331_hornet1_1_radio_core,</a>
<a name="ln969">            ARRAY_LENGTH(ar9331_hornet1_1_radio_core), 2);</a>
<a name="ln970">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_POST], NULL, 0, 0);</a>
<a name="ln971"> </a>
<a name="ln972">        /* soc */</a>
<a name="ln973">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln974">            ar9331_hornet1_1_soc_preamble,</a>
<a name="ln975">            ARRAY_LENGTH(ar9331_hornet1_1_soc_preamble), 2);</a>
<a name="ln976">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_CORE], NULL, 0, 0);</a>
<a name="ln977">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_POST],</a>
<a name="ln978">            ar9331_hornet1_1_soc_postamble,</a>
<a name="ln979">            ARRAY_LENGTH(ar9331_hornet1_1_soc_postamble), 2);</a>
<a name="ln980"> </a>
<a name="ln981">        /* rx/tx gain */</a>
<a name="ln982">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln983">            ar9331_common_rx_gain_hornet1_1, </a>
<a name="ln984">            ARRAY_LENGTH(ar9331_common_rx_gain_hornet1_1), 2);</a>
<a name="ln985">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln986">            ar9331_modes_lowest_ob_db_tx_gain_hornet1_1, </a>
<a name="ln987">            ARRAY_LENGTH(ar9331_modes_lowest_ob_db_tx_gain_hornet1_1), 5);</a>
<a name="ln988"> </a>
<a name="ln989">        ah-&gt;ah_config.ath_hal_pcie_power_save_enable = 0;</a>
<a name="ln990"> </a>
<a name="ln991">        /* Japan 2484Mhz CCK settings */</a>
<a name="ln992">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_japan2484,</a>
<a name="ln993">            ar9331_hornet1_1_baseband_core_txfir_coeff_japan_2484,</a>
<a name="ln994">            ARRAY_LENGTH(</a>
<a name="ln995">                ar9331_hornet1_1_baseband_core_txfir_coeff_japan_2484), 2);</a>
<a name="ln996">    </a>
<a name="ln997">#if 0 /* ATH_WOW */</a>
<a name="ln998">        /* SerDes values during WOW sleep */</a>
<a name="ln999">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_wow, ar9300_pcie_phy_awow,</a>
<a name="ln1000">                       N(ar9300_pcie_phy_awow), 2);</a>
<a name="ln1001">#endif</a>
<a name="ln1002">    </a>
<a name="ln1003">        /* additional clock settings */</a>
<a name="ln1004">        if (AH9300(ah)-&gt;clk_25mhz) {</a>
<a name="ln1005">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional,</a>
<a name="ln1006">                ar9331_hornet1_1_xtal_25M,</a>
<a name="ln1007">                ARRAY_LENGTH(ar9331_hornet1_1_xtal_25M), 2);</a>
<a name="ln1008">        } else {</a>
<a name="ln1009">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional,</a>
<a name="ln1010">                ar9331_hornet1_1_xtal_40M,</a>
<a name="ln1011">                ARRAY_LENGTH(ar9331_hornet1_1_xtal_40M), 2);</a>
<a name="ln1012">        }</a>
<a name="ln1013"> </a>
<a name="ln1014">       } else if (AR_SREV_POSEIDON_11_OR_LATER(ah)) {</a>
<a name="ln1015">        /* mac */</a>
<a name="ln1016">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1017">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln1018">            ar9485_poseidon1_1_mac_core, </a>
<a name="ln1019">            ARRAY_LENGTH( ar9485_poseidon1_1_mac_core), 2);</a>
<a name="ln1020">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_POST],</a>
<a name="ln1021">            ar9485_poseidon1_1_mac_postamble, </a>
<a name="ln1022">            ARRAY_LENGTH(ar9485_poseidon1_1_mac_postamble), 5);</a>
<a name="ln1023"> </a>
<a name="ln1024">        /* bb */</a>
<a name="ln1025">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_PRE], </a>
<a name="ln1026">            ar9485_poseidon1_1, ARRAY_LENGTH(ar9485_poseidon1_1), 2);</a>
<a name="ln1027">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_CORE],</a>
<a name="ln1028">            ar9485_poseidon1_1_baseband_core, </a>
<a name="ln1029">            ARRAY_LENGTH(ar9485_poseidon1_1_baseband_core), 2);</a>
<a name="ln1030">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln1031">            ar9485_poseidon1_1_baseband_postamble, </a>
<a name="ln1032">            ARRAY_LENGTH(ar9485_poseidon1_1_baseband_postamble), 5);</a>
<a name="ln1033"> </a>
<a name="ln1034">        /* radio */</a>
<a name="ln1035">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1036">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_CORE], </a>
<a name="ln1037">            ar9485_poseidon1_1_radio_core, </a>
<a name="ln1038">            ARRAY_LENGTH(ar9485_poseidon1_1_radio_core), 2);</a>
<a name="ln1039">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_POST],</a>
<a name="ln1040">            ar9485_poseidon1_1_radio_postamble, </a>
<a name="ln1041">            ARRAY_LENGTH(ar9485_poseidon1_1_radio_postamble), 2);</a>
<a name="ln1042"> </a>
<a name="ln1043">        /* soc */</a>
<a name="ln1044">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln1045">            ar9485_poseidon1_1_soc_preamble, </a>
<a name="ln1046">            ARRAY_LENGTH(ar9485_poseidon1_1_soc_preamble), 2);</a>
<a name="ln1047"> </a>
<a name="ln1048">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_CORE], NULL, 0, 0);</a>
<a name="ln1049">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_POST], NULL, 0, 0);</a>
<a name="ln1050"> </a>
<a name="ln1051">        /* rx/tx gain */</a>
<a name="ln1052">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, </a>
<a name="ln1053">            ar9485_common_wo_xlna_rx_gain_poseidon1_1, </a>
<a name="ln1054">            ARRAY_LENGTH(ar9485_common_wo_xlna_rx_gain_poseidon1_1), 2);</a>
<a name="ln1055">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain, </a>
<a name="ln1056">            ar9485_modes_lowest_ob_db_tx_gain_poseidon1_1, </a>
<a name="ln1057">            ARRAY_LENGTH(ar9485_modes_lowest_ob_db_tx_gain_poseidon1_1), 5);</a>
<a name="ln1058"> </a>
<a name="ln1059">        /* Japan 2484Mhz CCK settings */</a>
<a name="ln1060">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_japan2484,</a>
<a name="ln1061">            ar9485_poseidon1_1_baseband_core_txfir_coeff_japan_2484,</a>
<a name="ln1062">            ARRAY_LENGTH(</a>
<a name="ln1063">                ar9485_poseidon1_1_baseband_core_txfir_coeff_japan_2484), 2);</a>
<a name="ln1064"> </a>
<a name="ln1065">        /* Load PCIE SERDES settings from INI */</a>
<a name="ln1066">        if (ah-&gt;ah_config.ath_hal_pcie_clock_req) {</a>
<a name="ln1067">            /* Pci-e Clock Request = 1 */</a>
<a name="ln1068">            if (ah-&gt;ah_config.ath_hal_pll_pwr_save </a>
<a name="ln1069">                &amp; AR_PCIE_PLL_PWRSAVE_CONTROL)</a>
<a name="ln1070">            {</a>
<a name="ln1071">                /* Sleep Setting */</a>
<a name="ln1072">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln1073">                    AR_PCIE_PLL_PWRSAVE_ON_D3) </a>
<a name="ln1074">                {</a>
<a name="ln1075">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln1076">                        ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1,</a>
<a name="ln1077">                        ARRAY_LENGTH(</a>
<a name="ln1078">                           ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1),</a>
<a name="ln1079">                        2);</a>
<a name="ln1080">                } else {</a>
<a name="ln1081">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln1082">                        ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_enable_L1,</a>
<a name="ln1083">                        ARRAY_LENGTH(</a>
<a name="ln1084">                           ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_enable_L1),</a>
<a name="ln1085">                        2);</a>
<a name="ln1086">                }    </a>
<a name="ln1087">                /* Awake Setting */</a>
<a name="ln1088">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln1089">                    AR_PCIE_PLL_PWRSAVE_ON_D0)</a>
<a name="ln1090">                {</a>
<a name="ln1091">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln1092">                        ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1,</a>
<a name="ln1093">                        ARRAY_LENGTH(</a>
<a name="ln1094">                           ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1),</a>
<a name="ln1095">                        2);</a>
<a name="ln1096">                } else {</a>
<a name="ln1097">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln1098">                        ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_enable_L1,</a>
<a name="ln1099">                        ARRAY_LENGTH(</a>
<a name="ln1100">                           ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_enable_L1),</a>
<a name="ln1101">                        2);</a>
<a name="ln1102">                }    </a>
<a name="ln1103">                </a>
<a name="ln1104">            } else {</a>
<a name="ln1105">                /*Use driver default setting*/</a>
<a name="ln1106">                /* Sleep Setting */</a>
<a name="ln1107">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln1108">                    ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1,</a>
<a name="ln1109">                    ARRAY_LENGTH(ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1), </a>
<a name="ln1110">                    2);</a>
<a name="ln1111">                /* Awake Setting */</a>
<a name="ln1112">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln1113">                    ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1,</a>
<a name="ln1114">                    ARRAY_LENGTH(ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1), </a>
<a name="ln1115">                    2);</a>
<a name="ln1116">            }</a>
<a name="ln1117">        } else {</a>
<a name="ln1118">            /* Pci-e Clock Request = 0 */</a>
<a name="ln1119">            if (ah-&gt;ah_config.ath_hal_pll_pwr_save </a>
<a name="ln1120">                &amp; AR_PCIE_PLL_PWRSAVE_CONTROL)</a>
<a name="ln1121">            {</a>
<a name="ln1122">                /* Sleep Setting */</a>
<a name="ln1123">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln1124">                    AR_PCIE_PLL_PWRSAVE_ON_D3) </a>
<a name="ln1125">                {</a>
<a name="ln1126">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln1127">                        ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1,</a>
<a name="ln1128">                        ARRAY_LENGTH(</a>
<a name="ln1129">                          ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1),</a>
<a name="ln1130">                        2);</a>
<a name="ln1131">                } else {</a>
<a name="ln1132">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln1133">                        ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_disable_L1,</a>
<a name="ln1134">                        ARRAY_LENGTH(</a>
<a name="ln1135">                          ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_disable_L1),</a>
<a name="ln1136">                        2);</a>
<a name="ln1137">                }    </a>
<a name="ln1138">                /* Awake Setting */</a>
<a name="ln1139">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln1140">                    AR_PCIE_PLL_PWRSAVE_ON_D0)</a>
<a name="ln1141">                {</a>
<a name="ln1142">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln1143">                        ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1,</a>
<a name="ln1144">                        ARRAY_LENGTH(</a>
<a name="ln1145">                          ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1),</a>
<a name="ln1146">                        2);</a>
<a name="ln1147">                } else {</a>
<a name="ln1148">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln1149">                        ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_disable_L1,</a>
<a name="ln1150">                        ARRAY_LENGTH(</a>
<a name="ln1151">                          ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_disable_L1),</a>
<a name="ln1152">                        2);</a>
<a name="ln1153">                }    </a>
<a name="ln1154">                </a>
<a name="ln1155">            } else {</a>
<a name="ln1156">                /*Use driver default setting*/</a>
<a name="ln1157">                /* Sleep Setting */</a>
<a name="ln1158">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln1159">                    ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1,</a>
<a name="ln1160">                    ARRAY_LENGTH(ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1),</a>
<a name="ln1161">                    2);</a>
<a name="ln1162">                /* Awake Setting */</a>
<a name="ln1163">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln1164">                    ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1,</a>
<a name="ln1165">                    ARRAY_LENGTH(ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1),</a>
<a name="ln1166">                    2);</a>
<a name="ln1167">            }</a>
<a name="ln1168">        }</a>
<a name="ln1169">        /* pcie ps setting will honor registry setting, default is 0 */</a>
<a name="ln1170">        //ah-&gt;ah_config.ath_hal_pciePowerSaveEnable = 0;    </a>
<a name="ln1171">   } else if (AR_SREV_POSEIDON(ah)) {</a>
<a name="ln1172">        /* mac */</a>
<a name="ln1173">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1174">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln1175">            ar9485_poseidon1_0_mac_core,</a>
<a name="ln1176">            ARRAY_LENGTH(ar9485_poseidon1_0_mac_core), 2);</a>
<a name="ln1177">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_POST],</a>
<a name="ln1178">            ar9485_poseidon1_0_mac_postamble,</a>
<a name="ln1179">            ARRAY_LENGTH(ar9485_poseidon1_0_mac_postamble), 5);</a>
<a name="ln1180"> </a>
<a name="ln1181">        /* bb */</a>
<a name="ln1182">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_PRE], </a>
<a name="ln1183">            ar9485_poseidon1_0, </a>
<a name="ln1184">            ARRAY_LENGTH(ar9485_poseidon1_0), 2);</a>
<a name="ln1185">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_CORE],</a>
<a name="ln1186">            ar9485_poseidon1_0_baseband_core,</a>
<a name="ln1187">            ARRAY_LENGTH(ar9485_poseidon1_0_baseband_core), 2);</a>
<a name="ln1188">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln1189">            ar9485_poseidon1_0_baseband_postamble,</a>
<a name="ln1190">            ARRAY_LENGTH(ar9485_poseidon1_0_baseband_postamble), 5);</a>
<a name="ln1191"> </a>
<a name="ln1192">        /* radio */</a>
<a name="ln1193">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1194">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_CORE], </a>
<a name="ln1195">            ar9485_poseidon1_0_radio_core,</a>
<a name="ln1196">            ARRAY_LENGTH(ar9485_poseidon1_0_radio_core), 2);</a>
<a name="ln1197">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_POST],</a>
<a name="ln1198">            ar9485_poseidon1_0_radio_postamble,</a>
<a name="ln1199">            ARRAY_LENGTH(ar9485_poseidon1_0_radio_postamble), 2);</a>
<a name="ln1200"> </a>
<a name="ln1201">        /* soc */</a>
<a name="ln1202">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln1203">            ar9485_poseidon1_0_soc_preamble,</a>
<a name="ln1204">            ARRAY_LENGTH(ar9485_poseidon1_0_soc_preamble), 2);</a>
<a name="ln1205">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_CORE], NULL, 0, 0);</a>
<a name="ln1206">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_POST], NULL, 0, 0);</a>
<a name="ln1207"> </a>
<a name="ln1208">        /* rx/tx gain */</a>
<a name="ln1209">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln1210">            ar9485Common_wo_xlna_rx_gain_poseidon1_0, </a>
<a name="ln1211">            ARRAY_LENGTH(ar9485Common_wo_xlna_rx_gain_poseidon1_0), 2);</a>
<a name="ln1212">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln1213">            ar9485Modes_lowest_ob_db_tx_gain_poseidon1_0, </a>
<a name="ln1214">            ARRAY_LENGTH(ar9485Modes_lowest_ob_db_tx_gain_poseidon1_0), 5);</a>
<a name="ln1215"> </a>
<a name="ln1216">        /* Japan 2484Mhz CCK settings */</a>
<a name="ln1217">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_japan2484,</a>
<a name="ln1218">            ar9485_poseidon1_0_baseband_core_txfir_coeff_japan_2484,</a>
<a name="ln1219">            ARRAY_LENGTH(</a>
<a name="ln1220">                ar9485_poseidon1_0_baseband_core_txfir_coeff_japan_2484), 2);</a>
<a name="ln1221"> </a>
<a name="ln1222">        /* Load PCIE SERDES settings from INI */</a>
<a name="ln1223">        if (ah-&gt;ah_config.ath_hal_pcie_clock_req) {</a>
<a name="ln1224">            /* Pci-e Clock Request = 1 */</a>
<a name="ln1225">            if (ah-&gt;ah_config.ath_hal_pll_pwr_save </a>
<a name="ln1226">                &amp; AR_PCIE_PLL_PWRSAVE_CONTROL)</a>
<a name="ln1227">            {</a>
<a name="ln1228">                /* Sleep Setting */</a>
<a name="ln1229">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln1230">                    AR_PCIE_PLL_PWRSAVE_ON_D3) </a>
<a name="ln1231">                {</a>
<a name="ln1232">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln1233">                        ar9485_poseidon1_0_pcie_phy_clkreq_enable_L1,</a>
<a name="ln1234">                        ARRAY_LENGTH(</a>
<a name="ln1235">                           ar9485_poseidon1_0_pcie_phy_clkreq_enable_L1),</a>
<a name="ln1236">                        2);</a>
<a name="ln1237">                } else {</a>
<a name="ln1238">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln1239">                        ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1,</a>
<a name="ln1240">                        ARRAY_LENGTH(</a>
<a name="ln1241">                           ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1),</a>
<a name="ln1242">                        2);</a>
<a name="ln1243">                }    </a>
<a name="ln1244">                /* Awake Setting */</a>
<a name="ln1245">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln1246">                    AR_PCIE_PLL_PWRSAVE_ON_D0)</a>
<a name="ln1247">                {</a>
<a name="ln1248">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln1249">                        ar9485_poseidon1_0_pcie_phy_clkreq_enable_L1,</a>
<a name="ln1250">                        ARRAY_LENGTH(</a>
<a name="ln1251">                           ar9485_poseidon1_0_pcie_phy_clkreq_enable_L1),</a>
<a name="ln1252">                        2);</a>
<a name="ln1253">                } else {</a>
<a name="ln1254">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln1255">                        ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1,</a>
<a name="ln1256">                        ARRAY_LENGTH(</a>
<a name="ln1257">                           ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1),</a>
<a name="ln1258">                        2);</a>
<a name="ln1259">                }    </a>
<a name="ln1260">                </a>
<a name="ln1261">            } else {</a>
<a name="ln1262">                /*Use driver default setting*/</a>
<a name="ln1263">                /* Sleep Setting */</a>
<a name="ln1264">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln1265">                    ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1,</a>
<a name="ln1266">                    ARRAY_LENGTH(</a>
<a name="ln1267">                        ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1), </a>
<a name="ln1268">                    2);</a>
<a name="ln1269">                /* Awake Setting */</a>
<a name="ln1270">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln1271">                    ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1,</a>
<a name="ln1272">                    ARRAY_LENGTH(</a>
<a name="ln1273">                        ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1), </a>
<a name="ln1274">                    2);</a>
<a name="ln1275">            }</a>
<a name="ln1276">        } else {</a>
<a name="ln1277">            /* Pci-e Clock Request = 0 */</a>
<a name="ln1278">            if (ah-&gt;ah_config.ath_hal_pll_pwr_save </a>
<a name="ln1279">                &amp; AR_PCIE_PLL_PWRSAVE_CONTROL)</a>
<a name="ln1280">            {</a>
<a name="ln1281">                /* Sleep Setting */</a>
<a name="ln1282">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln1283">                    AR_PCIE_PLL_PWRSAVE_ON_D3) </a>
<a name="ln1284">                {</a>
<a name="ln1285">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln1286">                        ar9485_poseidon1_0_pcie_phy_clkreq_disable_L1,</a>
<a name="ln1287">                        ARRAY_LENGTH(</a>
<a name="ln1288">                          ar9485_poseidon1_0_pcie_phy_clkreq_disable_L1),</a>
<a name="ln1289">                        2);</a>
<a name="ln1290">                } else {</a>
<a name="ln1291">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln1292">                        ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1,</a>
<a name="ln1293">                        ARRAY_LENGTH(</a>
<a name="ln1294">                          ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1),</a>
<a name="ln1295">                        2);</a>
<a name="ln1296">                }    </a>
<a name="ln1297">                /* Awake Setting */</a>
<a name="ln1298">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln1299">                    AR_PCIE_PLL_PWRSAVE_ON_D0)</a>
<a name="ln1300">                {</a>
<a name="ln1301">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln1302">                        ar9485_poseidon1_0_pcie_phy_clkreq_disable_L1,</a>
<a name="ln1303">                        ARRAY_LENGTH(</a>
<a name="ln1304">                          ar9485_poseidon1_0_pcie_phy_clkreq_disable_L1),</a>
<a name="ln1305">                        2);</a>
<a name="ln1306">                } else {</a>
<a name="ln1307">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln1308">                        ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1,</a>
<a name="ln1309">                        ARRAY_LENGTH(</a>
<a name="ln1310">                          ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1),</a>
<a name="ln1311">                        2);</a>
<a name="ln1312">                }    </a>
<a name="ln1313">                </a>
<a name="ln1314">            } else {</a>
<a name="ln1315">                /*Use driver default setting*/</a>
<a name="ln1316">                /* Sleep Setting */</a>
<a name="ln1317">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln1318">                    ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1,</a>
<a name="ln1319">                    ARRAY_LENGTH(</a>
<a name="ln1320">                        ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1), </a>
<a name="ln1321">                    2);</a>
<a name="ln1322">                /* Awake Setting */</a>
<a name="ln1323">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln1324">                    ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1,</a>
<a name="ln1325">                    ARRAY_LENGTH(</a>
<a name="ln1326">                        ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1), </a>
<a name="ln1327">                    2);</a>
<a name="ln1328">            }</a>
<a name="ln1329">        }</a>
<a name="ln1330">        /* pcie ps setting will honor registry setting, default is 0 */</a>
<a name="ln1331">        /*ah-&gt;ah_config.ath_hal_pcie_power_save_enable = 0;*/</a>
<a name="ln1332">    </a>
<a name="ln1333">#if 0 /* ATH_WOW */</a>
<a name="ln1334">        /* SerDes values during WOW sleep */</a>
<a name="ln1335">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_wow, ar9300_pcie_phy_awow,</a>
<a name="ln1336">                       ARRAY_LENGTH(ar9300_pcie_phy_awow), 2);</a>
<a name="ln1337">#endif</a>
<a name="ln1338"> </a>
<a name="ln1339">    } else if (AR_SREV_WASP(ah)) {</a>
<a name="ln1340">        /* mac */</a>
<a name="ln1341">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1342">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln1343">            ar9340_wasp_1p0_mac_core,</a>
<a name="ln1344">            ARRAY_LENGTH(ar9340_wasp_1p0_mac_core), 2);</a>
<a name="ln1345">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_POST],</a>
<a name="ln1346">            ar9340_wasp_1p0_mac_postamble,</a>
<a name="ln1347">            ARRAY_LENGTH(ar9340_wasp_1p0_mac_postamble), 5);</a>
<a name="ln1348"> </a>
<a name="ln1349">        /* bb */</a>
<a name="ln1350">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1351">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_CORE],</a>
<a name="ln1352">            ar9340_wasp_1p0_baseband_core,</a>
<a name="ln1353">            ARRAY_LENGTH(ar9340_wasp_1p0_baseband_core), 2);</a>
<a name="ln1354">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln1355">            ar9340_wasp_1p0_baseband_postamble,</a>
<a name="ln1356">            ARRAY_LENGTH(ar9340_wasp_1p0_baseband_postamble), 5);</a>
<a name="ln1357"> </a>
<a name="ln1358">        /* radio */</a>
<a name="ln1359">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1360">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_CORE],</a>
<a name="ln1361">            ar9340_wasp_1p0_radio_core,</a>
<a name="ln1362">            ARRAY_LENGTH(ar9340_wasp_1p0_radio_core), 2);</a>
<a name="ln1363">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_POST],</a>
<a name="ln1364">            ar9340_wasp_1p0_radio_postamble,</a>
<a name="ln1365">            ARRAY_LENGTH(ar9340_wasp_1p0_radio_postamble), 5);</a>
<a name="ln1366"> </a>
<a name="ln1367">        /* soc */</a>
<a name="ln1368">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln1369">            ar9340_wasp_1p0_soc_preamble,</a>
<a name="ln1370">            ARRAY_LENGTH(ar9340_wasp_1p0_soc_preamble), 2);</a>
<a name="ln1371">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_CORE], NULL, 0, 0);</a>
<a name="ln1372">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_POST],</a>
<a name="ln1373">            ar9340_wasp_1p0_soc_postamble,</a>
<a name="ln1374">            ARRAY_LENGTH(ar9340_wasp_1p0_soc_postamble), 5);</a>
<a name="ln1375"> </a>
<a name="ln1376">        /* rx/tx gain */</a>
<a name="ln1377">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln1378">            ar9340Common_wo_xlna_rx_gain_table_wasp_1p0,</a>
<a name="ln1379">            ARRAY_LENGTH(ar9340Common_wo_xlna_rx_gain_table_wasp_1p0), 2);</a>
<a name="ln1380">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln1381">            ar9340Modes_high_ob_db_tx_gain_table_wasp_1p0,</a>
<a name="ln1382">            ARRAY_LENGTH(ar9340Modes_high_ob_db_tx_gain_table_wasp_1p0), 5);</a>
<a name="ln1383"> </a>
<a name="ln1384">        ah-&gt;ah_config.ath_hal_pcie_power_save_enable = 0;</a>
<a name="ln1385"> </a>
<a name="ln1386">        /* Fast clock modal settings */</a>
<a name="ln1387">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional,</a>
<a name="ln1388">            ar9340Modes_fast_clock_wasp_1p0,</a>
<a name="ln1389">            ARRAY_LENGTH(ar9340Modes_fast_clock_wasp_1p0), 3);</a>
<a name="ln1390"> </a>
<a name="ln1391">        /* XXX TODO: need to add this for freebsd; it's missing from the current .ini files */</a>
<a name="ln1392">#if 0</a>
<a name="ln1393">        /* Japan 2484Mhz CCK settings */</a>
<a name="ln1394">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_japan2484,</a>
<a name="ln1395">            ar9340_wasp_1p0_baseband_core_txfir_coeff_japan_2484,</a>
<a name="ln1396">            ARRAY_LENGTH(</a>
<a name="ln1397">                ar9340_wasp_1p0_baseband_core_txfir_coeff_japan_2484), 2);</a>
<a name="ln1398">#endif</a>
<a name="ln1399"> </a>
<a name="ln1400">        /* Additional setttings for 40Mhz */</a>
<a name="ln1401">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional_40mhz, </a>
<a name="ln1402">            ar9340_wasp_1p0_radio_core_40M,</a>
<a name="ln1403">            ARRAY_LENGTH(ar9340_wasp_1p0_radio_core_40M), 2);</a>
<a name="ln1404"> </a>
<a name="ln1405">        /* DFS */</a>
<a name="ln1406">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_dfs,</a>
<a name="ln1407">            ar9340_wasp_1p0_baseband_postamble_dfs_channel,</a>
<a name="ln1408">            ARRAY_LENGTH(ar9340_wasp_1p0_baseband_postamble_dfs_channel), 3);</a>
<a name="ln1409">    } else if (AR_SREV_SCORPION(ah)) {</a>
<a name="ln1410">        /* mac */</a>
<a name="ln1411">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1412">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln1413">                        ar955x_scorpion_1p0_mac_core,</a>
<a name="ln1414">                        ARRAY_LENGTH(ar955x_scorpion_1p0_mac_core), 2);</a>
<a name="ln1415">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_POST],</a>
<a name="ln1416">                        ar955x_scorpion_1p0_mac_postamble,</a>
<a name="ln1417">                        ARRAY_LENGTH(ar955x_scorpion_1p0_mac_postamble), 5);</a>
<a name="ln1418"> </a>
<a name="ln1419">        /* bb */</a>
<a name="ln1420">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1421">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_CORE],</a>
<a name="ln1422">                        ar955x_scorpion_1p0_baseband_core,</a>
<a name="ln1423">                        ARRAY_LENGTH(ar955x_scorpion_1p0_baseband_core), 2);</a>
<a name="ln1424">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln1425">                        ar955x_scorpion_1p0_baseband_postamble,</a>
<a name="ln1426">                        ARRAY_LENGTH(ar955x_scorpion_1p0_baseband_postamble), 5);</a>
<a name="ln1427"> </a>
<a name="ln1428">        /* radio */</a>
<a name="ln1429">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1430">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_CORE],</a>
<a name="ln1431">                        ar955x_scorpion_1p0_radio_core,</a>
<a name="ln1432">                        ARRAY_LENGTH(ar955x_scorpion_1p0_radio_core), 2);</a>
<a name="ln1433">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_POST],</a>
<a name="ln1434">                        ar955x_scorpion_1p0_radio_postamble,</a>
<a name="ln1435">                        ARRAY_LENGTH(ar955x_scorpion_1p0_radio_postamble), 5);</a>
<a name="ln1436"> </a>
<a name="ln1437">        /* soc */</a>
<a name="ln1438">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln1439">                        ar955x_scorpion_1p0_soc_preamble,</a>
<a name="ln1440">                        ARRAY_LENGTH(ar955x_scorpion_1p0_soc_preamble), 2);</a>
<a name="ln1441">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_CORE], NULL, 0, 0);</a>
<a name="ln1442">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_POST],</a>
<a name="ln1443">                        ar955x_scorpion_1p0_soc_postamble,</a>
<a name="ln1444">                        ARRAY_LENGTH(ar955x_scorpion_1p0_soc_postamble), 5);</a>
<a name="ln1445"> </a>
<a name="ln1446">        /* rx/tx gain */</a>
<a name="ln1447">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln1448">                        ar955xCommon_wo_xlna_rx_gain_table_scorpion_1p0,</a>
<a name="ln1449">                        ARRAY_LENGTH(ar955xCommon_wo_xlna_rx_gain_table_scorpion_1p0), 2);</a>
<a name="ln1450">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_bounds,</a>
<a name="ln1451">                        ar955xCommon_wo_xlna_rx_gain_bounds_scorpion_1p0,</a>
<a name="ln1452">                        ARRAY_LENGTH(ar955xCommon_wo_xlna_rx_gain_bounds_scorpion_1p0), 5);</a>
<a name="ln1453">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln1454">                        ar955xModes_no_xpa_tx_gain_table_scorpion_1p0,</a>
<a name="ln1455">                        ARRAY_LENGTH(ar955xModes_no_xpa_tx_gain_table_scorpion_1p0), 5);</a>
<a name="ln1456"> </a>
<a name="ln1457">        /*ath_hal_pciePowerSaveEnable should be 2 for OWL/Condor and 0 for merlin */</a>
<a name="ln1458">        ah-&gt;ah_config.ath_hal_pcie_power_save_enable = 0;</a>
<a name="ln1459"> </a>
<a name="ln1460">        /* Fast clock modal settings */</a>
<a name="ln1461">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional,</a>
<a name="ln1462">                        ar955xModes_fast_clock_scorpion_1p0,</a>
<a name="ln1463">                        ARRAY_LENGTH(ar955xModes_fast_clock_scorpion_1p0), 3);</a>
<a name="ln1464"> </a>
<a name="ln1465">        /* Additional setttings for 40Mhz */</a>
<a name="ln1466">        //INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional_40M,</a>
<a name="ln1467">        //                ar955x_scorpion_1p0_radio_core_40M,</a>
<a name="ln1468">        //                ARRAY_LENGTH(ar955x_scorpion_1p0_radio_core_40M), 2);</a>
<a name="ln1469">    } else if (AR_SREV_HONEYBEE(ah)) {</a>
<a name="ln1470">        /* mac */</a>
<a name="ln1471">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1472">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln1473">                        qca953x_honeybee_1p0_mac_core,</a>
<a name="ln1474">                        ARRAY_LENGTH(qca953x_honeybee_1p0_mac_core), 2);</a>
<a name="ln1475">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_POST],</a>
<a name="ln1476">                        qca953x_honeybee_1p0_mac_postamble,</a>
<a name="ln1477">                        ARRAY_LENGTH(qca953x_honeybee_1p0_mac_postamble), 5);</a>
<a name="ln1478"> </a>
<a name="ln1479">        /* bb */</a>
<a name="ln1480">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1481">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_CORE],</a>
<a name="ln1482">                        qca953x_honeybee_1p0_baseband_core,</a>
<a name="ln1483">                        ARRAY_LENGTH(qca953x_honeybee_1p0_baseband_core), 2);</a>
<a name="ln1484">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln1485">                        qca953x_honeybee_1p0_baseband_postamble,</a>
<a name="ln1486">                        ARRAY_LENGTH(qca953x_honeybee_1p0_baseband_postamble), 5);</a>
<a name="ln1487"> </a>
<a name="ln1488">        /* radio */</a>
<a name="ln1489">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1490">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_CORE],</a>
<a name="ln1491">                        qca953x_honeybee_1p0_radio_core,</a>
<a name="ln1492">                        ARRAY_LENGTH(qca953x_honeybee_1p0_radio_core), 2);</a>
<a name="ln1493">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_POST],</a>
<a name="ln1494">                        qca953x_honeybee_1p0_radio_postamble,</a>
<a name="ln1495">                        ARRAY_LENGTH(qca953x_honeybee_1p0_radio_postamble), 5);</a>
<a name="ln1496"> </a>
<a name="ln1497">        /* soc */</a>
<a name="ln1498">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln1499">                        qca953x_honeybee_1p0_soc_preamble,</a>
<a name="ln1500">                        ARRAY_LENGTH(qca953x_honeybee_1p0_soc_preamble), 2);</a>
<a name="ln1501">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_CORE], NULL, 0, 0);</a>
<a name="ln1502">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_POST],</a>
<a name="ln1503">                        qca953x_honeybee_1p0_soc_postamble,</a>
<a name="ln1504">                        ARRAY_LENGTH(qca953x_honeybee_1p0_soc_postamble), 5);</a>
<a name="ln1505"> </a>
<a name="ln1506">        /* rx/tx gain */</a>
<a name="ln1507">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln1508">                        qca953xCommon_wo_xlna_rx_gain_table_honeybee_1p0,</a>
<a name="ln1509">                        ARRAY_LENGTH(qca953xCommon_wo_xlna_rx_gain_table_honeybee_1p0), 2);</a>
<a name="ln1510">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_bounds,</a>
<a name="ln1511">                        qca953xCommon_wo_xlna_rx_gain_bounds_honeybee_1p0,</a>
<a name="ln1512">                        ARRAY_LENGTH(qca953xCommon_wo_xlna_rx_gain_bounds_honeybee_1p0), 5);</a>
<a name="ln1513">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln1514">                        qca953xModes_no_xpa_tx_gain_table_honeybee_1p0,</a>
<a name="ln1515">                        ARRAY_LENGTH(qca953xModes_no_xpa_tx_gain_table_honeybee_1p0), 2);</a>
<a name="ln1516"> </a>
<a name="ln1517">        /*ath_hal_pciePowerSaveEnable should be 2 for OWL/Condor and 0 for merlin */</a>
<a name="ln1518">        ah-&gt;ah_config.ath_hal_pcie_power_save_enable = 0;</a>
<a name="ln1519"> </a>
<a name="ln1520">        /* Fast clock modal settings */</a>
<a name="ln1521">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional,</a>
<a name="ln1522">                        qca953xModes_fast_clock_honeybee_1p0,</a>
<a name="ln1523">                        ARRAY_LENGTH(qca953xModes_fast_clock_honeybee_1p0), 3);</a>
<a name="ln1524"> </a>
<a name="ln1525">        /* Additional setttings for 40Mhz */</a>
<a name="ln1526">        //INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional_40M,</a>
<a name="ln1527">        //                qca953x_honeybee_1p0_radio_core_40M,</a>
<a name="ln1528">        //                ARRAY_LENGTH(qca953x_honeybee_1p0_radio_core_40M), 2);</a>
<a name="ln1529"> </a>
<a name="ln1530">    } else if (AR_SREV_JUPITER_10(ah)) {</a>
<a name="ln1531">        /* Jupiter: new INI format (pre, core, post arrays per subsystem) */</a>
<a name="ln1532"> </a>
<a name="ln1533">        /* mac */</a>
<a name="ln1534">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1535">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln1536">            ar9300_jupiter_1p0_mac_core, </a>
<a name="ln1537">            ARRAY_LENGTH(ar9300_jupiter_1p0_mac_core), 2);</a>
<a name="ln1538">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_POST],</a>
<a name="ln1539">            ar9300_jupiter_1p0_mac_postamble,</a>
<a name="ln1540">            ARRAY_LENGTH(ar9300_jupiter_1p0_mac_postamble), 5);</a>
<a name="ln1541">                       </a>
<a name="ln1542">        /* bb */</a>
<a name="ln1543">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1544">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_CORE],</a>
<a name="ln1545">            ar9300_jupiter_1p0_baseband_core,</a>
<a name="ln1546">            ARRAY_LENGTH(ar9300_jupiter_1p0_baseband_core), 2);</a>
<a name="ln1547">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln1548">            ar9300_jupiter_1p0_baseband_postamble,</a>
<a name="ln1549">            ARRAY_LENGTH(ar9300_jupiter_1p0_baseband_postamble), 5);</a>
<a name="ln1550"> </a>
<a name="ln1551">        /* radio */</a>
<a name="ln1552">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1553">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_CORE],</a>
<a name="ln1554">            ar9300_jupiter_1p0_radio_core, </a>
<a name="ln1555">            ARRAY_LENGTH(ar9300_jupiter_1p0_radio_core), 2);</a>
<a name="ln1556">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_POST],</a>
<a name="ln1557">            ar9300_jupiter_1p0_radio_postamble, </a>
<a name="ln1558">            ARRAY_LENGTH(ar9300_jupiter_1p0_radio_postamble), 5);</a>
<a name="ln1559"> </a>
<a name="ln1560">        /* soc */</a>
<a name="ln1561">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln1562">            ar9300_jupiter_1p0_soc_preamble, </a>
<a name="ln1563">            ARRAY_LENGTH(ar9300_jupiter_1p0_soc_preamble), 2);</a>
<a name="ln1564">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_CORE], NULL, 0, 0);</a>
<a name="ln1565">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_POST],</a>
<a name="ln1566">            ar9300_jupiter_1p0_soc_postamble, </a>
<a name="ln1567">            ARRAY_LENGTH(ar9300_jupiter_1p0_soc_postamble), 5);</a>
<a name="ln1568"> </a>
<a name="ln1569">        /* rx/tx gain */</a>
<a name="ln1570">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, </a>
<a name="ln1571">            ar9300_common_rx_gain_table_jupiter_1p0,</a>
<a name="ln1572">            ARRAY_LENGTH(ar9300_common_rx_gain_table_jupiter_1p0), 2);</a>
<a name="ln1573"> </a>
<a name="ln1574">        /* Load PCIE SERDES settings from INI */</a>
<a name="ln1575">        if (ah-&gt;ah_config.ath_hal_pcie_clock_req) {</a>
<a name="ln1576">            /* Pci-e Clock Request = 1 */</a>
<a name="ln1577">            /*</a>
<a name="ln1578">             * PLL ON + clkreq enable is not a valid combination,</a>
<a name="ln1579">             * thus to ignore ath_hal_pll_pwr_save, use PLL OFF.</a>
<a name="ln1580">             */</a>
<a name="ln1581">            {</a>
<a name="ln1582">                /*Use driver default setting*/</a>
<a name="ln1583">                /* Awake -&gt; Sleep Setting */</a>
<a name="ln1584">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln1585">                    ar9300_pcie_phy_clkreq_enable_L1_jupiter_1p0,</a>
<a name="ln1586">                    ARRAY_LENGTH(ar9300_pcie_phy_clkreq_enable_L1_jupiter_1p0),</a>
<a name="ln1587">                    2);</a>
<a name="ln1588">                /* Sleep -&gt; Awake Setting */</a>
<a name="ln1589">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln1590">                    ar9300_pcie_phy_clkreq_enable_L1_jupiter_1p0,</a>
<a name="ln1591">                    ARRAY_LENGTH(ar9300_pcie_phy_clkreq_enable_L1_jupiter_1p0),</a>
<a name="ln1592">                    2);</a>
<a name="ln1593">            }</a>
<a name="ln1594">        }</a>
<a name="ln1595">        else {</a>
<a name="ln1596">            /*</a>
<a name="ln1597">             * Since Jupiter 1.0 and 2.0 share the same device id and will be</a>
<a name="ln1598">             * installed with same INF, but Jupiter 1.0 has issue with PLL OFF.</a>
<a name="ln1599">             *</a>
<a name="ln1600">             * Force Jupiter 1.0 to use ON/ON setting.</a>
<a name="ln1601">             */</a>
<a name="ln1602">            ah-&gt;ah_config.ath_hal_pll_pwr_save = 0;</a>
<a name="ln1603">            /* Pci-e Clock Request = 0 */</a>
<a name="ln1604">            if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln1605">                AR_PCIE_PLL_PWRSAVE_CONTROL)</a>
<a name="ln1606">            {</a>
<a name="ln1607">                /* Awake -&gt; Sleep Setting */</a>
<a name="ln1608">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln1609">                     AR_PCIE_PLL_PWRSAVE_ON_D3) </a>
<a name="ln1610">                {</a>
<a name="ln1611">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln1612">                        ar9300_pcie_phy_clkreq_disable_L1_jupiter_1p0,</a>
<a name="ln1613">                        ARRAY_LENGTH(</a>
<a name="ln1614">                            ar9300_pcie_phy_clkreq_disable_L1_jupiter_1p0),</a>
<a name="ln1615">                        2);</a>
<a name="ln1616">                }</a>
<a name="ln1617">                else {</a>
<a name="ln1618">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln1619">                        ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0,</a>
<a name="ln1620">                        ARRAY_LENGTH(</a>
<a name="ln1621">                          ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0),</a>
<a name="ln1622">                        2);</a>
<a name="ln1623">                }    </a>
<a name="ln1624">                /* Sleep -&gt; Awake Setting */</a>
<a name="ln1625">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln1626">                    AR_PCIE_PLL_PWRSAVE_ON_D0)</a>
<a name="ln1627">                {</a>
<a name="ln1628">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln1629">                        ar9300_pcie_phy_clkreq_disable_L1_jupiter_1p0,</a>
<a name="ln1630">                        ARRAY_LENGTH(</a>
<a name="ln1631">                            ar9300_pcie_phy_clkreq_disable_L1_jupiter_1p0),</a>
<a name="ln1632">                        2);</a>
<a name="ln1633">                }</a>
<a name="ln1634">                else {</a>
<a name="ln1635">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln1636">                        ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0,</a>
<a name="ln1637">                        ARRAY_LENGTH(</a>
<a name="ln1638">                          ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0),</a>
<a name="ln1639">                        2);</a>
<a name="ln1640">                }    </a>
<a name="ln1641">                </a>
<a name="ln1642">            }</a>
<a name="ln1643">            else {</a>
<a name="ln1644">                /*Use driver default setting*/</a>
<a name="ln1645">                /* Awake -&gt; Sleep Setting */</a>
<a name="ln1646">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln1647">                    ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0,</a>
<a name="ln1648">                    ARRAY_LENGTH(</a>
<a name="ln1649">                        ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0),</a>
<a name="ln1650">                    2);</a>
<a name="ln1651">                /* Sleep -&gt; Awake Setting */</a>
<a name="ln1652">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln1653">                    ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0,</a>
<a name="ln1654">                    ARRAY_LENGTH(</a>
<a name="ln1655">                        ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0),</a>
<a name="ln1656">                    2);</a>
<a name="ln1657">            }</a>
<a name="ln1658">        }</a>
<a name="ln1659">        /* </a>
<a name="ln1660">         * ath_hal_pcie_power_save_enable should be 2 for OWL/Condor and </a>
<a name="ln1661">         * 0 for merlin </a>
<a name="ln1662">         */</a>
<a name="ln1663">        ah-&gt;ah_config.ath_hal_pcie_power_save_enable = 0;</a>
<a name="ln1664"> </a>
<a name="ln1665">#if 0 // ATH_WOW</a>
<a name="ln1666">        /* SerDes values during WOW sleep */</a>
<a name="ln1667">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_wow, ar9300_pcie_phy_AWOW,</a>
<a name="ln1668">            ARRAY_LENGTH(ar9300_pcie_phy_AWOW), 2);</a>
<a name="ln1669">#endif</a>
<a name="ln1670"> </a>
<a name="ln1671">        /* Fast clock modal settings */</a>
<a name="ln1672">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional, </a>
<a name="ln1673">            ar9300_modes_fast_clock_jupiter_1p0,</a>
<a name="ln1674">            ARRAY_LENGTH(ar9300_modes_fast_clock_jupiter_1p0), 3);</a>
<a name="ln1675">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_japan2484,</a>
<a name="ln1676">            ar9300_jupiter_1p0_baseband_core_txfir_coeff_japan_2484,</a>
<a name="ln1677">            ARRAY_LENGTH(</a>
<a name="ln1678">            ar9300_jupiter_1p0_baseband_core_txfir_coeff_japan_2484), 2);</a>
<a name="ln1679"> </a>
<a name="ln1680">    }</a>
<a name="ln1681">    else if (AR_SREV_JUPITER_20_OR_LATER(ah)) {</a>
<a name="ln1682">        /* Jupiter: new INI format (pre, core, post arrays per subsystem) */</a>
<a name="ln1683"> </a>
<a name="ln1684">        /* FreeBSD: just override the registers for jupiter 2.1 */</a>
<a name="ln1685">        /* XXX TODO: refactor this stuff out; reinit all the 2.1 registers */</a>
<a name="ln1686"> </a>
<a name="ln1687">        /* mac */</a>
<a name="ln1688">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1689"> </a>
<a name="ln1690">        if (AR_SREV_JUPITER_21(ah)) {</a>
<a name="ln1691">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln1692">              ar9462_2p1_mac_core,</a>
<a name="ln1693">              ARRAY_LENGTH(ar9462_2p1_mac_core), 2);</a>
<a name="ln1694">        } else {</a>
<a name="ln1695">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln1696">                ar9300_jupiter_2p0_mac_core, </a>
<a name="ln1697">                ARRAY_LENGTH(ar9300_jupiter_2p0_mac_core), 2);</a>
<a name="ln1698">        }</a>
<a name="ln1699"> </a>
<a name="ln1700">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_POST],</a>
<a name="ln1701">            ar9300_jupiter_2p0_mac_postamble,</a>
<a name="ln1702">            ARRAY_LENGTH(ar9300_jupiter_2p0_mac_postamble), 5);</a>
<a name="ln1703">                       </a>
<a name="ln1704">        /* bb */</a>
<a name="ln1705">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1706">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_CORE],</a>
<a name="ln1707">            ar9300_jupiter_2p0_baseband_core,</a>
<a name="ln1708">            ARRAY_LENGTH(ar9300_jupiter_2p0_baseband_core), 2);</a>
<a name="ln1709"> </a>
<a name="ln1710">        if (AR_SREV_JUPITER_21(ah)) {</a>
<a name="ln1711">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln1712">                ar9462_2p1_baseband_postamble,</a>
<a name="ln1713">                ARRAY_LENGTH(ar9462_2p1_baseband_postamble), 5);</a>
<a name="ln1714">        } else {</a>
<a name="ln1715">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln1716">                ar9300_jupiter_2p0_baseband_postamble,</a>
<a name="ln1717">                ARRAY_LENGTH(ar9300_jupiter_2p0_baseband_postamble), 5);</a>
<a name="ln1718">        }</a>
<a name="ln1719"> </a>
<a name="ln1720">        /* radio */</a>
<a name="ln1721">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1722">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_CORE],</a>
<a name="ln1723">            ar9300_jupiter_2p0_radio_core, </a>
<a name="ln1724">            ARRAY_LENGTH(ar9300_jupiter_2p0_radio_core), 2);</a>
<a name="ln1725">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_POST],</a>
<a name="ln1726">            ar9300_jupiter_2p0_radio_postamble, </a>
<a name="ln1727">            ARRAY_LENGTH(ar9300_jupiter_2p0_radio_postamble), 5);</a>
<a name="ln1728">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio_post_sys2ant,</a>
<a name="ln1729">            ar9300_jupiter_2p0_radio_postamble_sys2ant, </a>
<a name="ln1730">            ARRAY_LENGTH(ar9300_jupiter_2p0_radio_postamble_sys2ant), 5);</a>
<a name="ln1731"> </a>
<a name="ln1732">        /* soc */</a>
<a name="ln1733">        if (AR_SREV_JUPITER_21(ah)) {</a>
<a name="ln1734">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln1735">              ar9462_2p1_soc_preamble,</a>
<a name="ln1736">              ARRAY_LENGTH(ar9462_2p1_soc_preamble), 2);</a>
<a name="ln1737">        } else {</a>
<a name="ln1738">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln1739">              ar9300_jupiter_2p0_soc_preamble, </a>
<a name="ln1740">              ARRAY_LENGTH(ar9300_jupiter_2p0_soc_preamble), 2);</a>
<a name="ln1741">        }</a>
<a name="ln1742">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_CORE], NULL, 0, 0);</a>
<a name="ln1743">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_POST],</a>
<a name="ln1744">            ar9300_jupiter_2p0_soc_postamble, </a>
<a name="ln1745">            ARRAY_LENGTH(ar9300_jupiter_2p0_soc_postamble), 5);</a>
<a name="ln1746"> </a>
<a name="ln1747">        /* rx/tx gain */</a>
<a name="ln1748">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, </a>
<a name="ln1749">            ar9300Common_rx_gain_table_jupiter_2p0,</a>
<a name="ln1750">            ARRAY_LENGTH(ar9300Common_rx_gain_table_jupiter_2p0), 2);</a>
<a name="ln1751"> </a>
<a name="ln1752">        /* BTCOEX */</a>
<a name="ln1753">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_BTCOEX_MAX_TXPWR,</a>
<a name="ln1754">            ar9300_jupiter_2p0_BTCOEX_MAX_TXPWR_table, </a>
<a name="ln1755">            ARRAY_LENGTH(ar9300_jupiter_2p0_BTCOEX_MAX_TXPWR_table), 2);</a>
<a name="ln1756"> </a>
<a name="ln1757">        /* Load PCIE SERDES settings from INI */</a>
<a name="ln1758">        if (ah-&gt;ah_config.ath_hal_pcie_clock_req) {</a>
<a name="ln1759">            /* Pci-e Clock Request = 1 */</a>
<a name="ln1760">            /*</a>
<a name="ln1761">             * PLL ON + clkreq enable is not a valid combination,</a>
<a name="ln1762">             * thus to ignore ath_hal_pll_pwr_save, use PLL OFF.</a>
<a name="ln1763">             */</a>
<a name="ln1764">            {</a>
<a name="ln1765">                /*Use driver default setting*/</a>
<a name="ln1766">                /* Awake -&gt; Sleep Setting */</a>
<a name="ln1767">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln1768">                    ar9300_PciePhy_clkreq_enable_L1_jupiter_2p0,</a>
<a name="ln1769">                    ARRAY_LENGTH(ar9300_PciePhy_clkreq_enable_L1_jupiter_2p0),</a>
<a name="ln1770">                    2);</a>
<a name="ln1771">                /* Sleep -&gt; Awake Setting */</a>
<a name="ln1772">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln1773">                    ar9300_PciePhy_clkreq_enable_L1_jupiter_2p0,</a>
<a name="ln1774">                    ARRAY_LENGTH(ar9300_PciePhy_clkreq_enable_L1_jupiter_2p0),</a>
<a name="ln1775">                    2);</a>
<a name="ln1776">            }</a>
<a name="ln1777">        }</a>
<a name="ln1778">        else {</a>
<a name="ln1779">            /* Pci-e Clock Request = 0 */</a>
<a name="ln1780">            if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln1781">                AR_PCIE_PLL_PWRSAVE_CONTROL)</a>
<a name="ln1782">            {</a>
<a name="ln1783">                /* Awake -&gt; Sleep Setting */</a>
<a name="ln1784">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln1785">                     AR_PCIE_PLL_PWRSAVE_ON_D3) </a>
<a name="ln1786">                {</a>
<a name="ln1787">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln1788">                        ar9300_PciePhy_clkreq_disable_L1_jupiter_2p0,</a>
<a name="ln1789">                        ARRAY_LENGTH(</a>
<a name="ln1790">                            ar9300_PciePhy_clkreq_disable_L1_jupiter_2p0),</a>
<a name="ln1791">                        2);</a>
<a name="ln1792">                }</a>
<a name="ln1793">                else {</a>
<a name="ln1794">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln1795">                        ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0,</a>
<a name="ln1796">                        ARRAY_LENGTH(</a>
<a name="ln1797">                          ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0),</a>
<a name="ln1798">                        2);</a>
<a name="ln1799">                }    </a>
<a name="ln1800">                /* Sleep -&gt; Awake Setting */</a>
<a name="ln1801">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln1802">                    AR_PCIE_PLL_PWRSAVE_ON_D0)</a>
<a name="ln1803">                {</a>
<a name="ln1804">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln1805">                        ar9300_PciePhy_clkreq_disable_L1_jupiter_2p0,</a>
<a name="ln1806">                        ARRAY_LENGTH(</a>
<a name="ln1807">                            ar9300_PciePhy_clkreq_disable_L1_jupiter_2p0),</a>
<a name="ln1808">                        2);</a>
<a name="ln1809">                }</a>
<a name="ln1810">                else {</a>
<a name="ln1811">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln1812">                        ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0,</a>
<a name="ln1813">                        ARRAY_LENGTH(</a>
<a name="ln1814">                          ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0),</a>
<a name="ln1815">                        2);</a>
<a name="ln1816">                }    </a>
<a name="ln1817">                </a>
<a name="ln1818">            }</a>
<a name="ln1819">            else {</a>
<a name="ln1820">                /*Use driver default setting*/</a>
<a name="ln1821">                /* Awake -&gt; Sleep Setting */</a>
<a name="ln1822">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln1823">                    ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0,</a>
<a name="ln1824">                    ARRAY_LENGTH(</a>
<a name="ln1825">                        ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0),</a>
<a name="ln1826">                    2);</a>
<a name="ln1827">                /* Sleep -&gt; Awake Setting */</a>
<a name="ln1828">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln1829">                    ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0,</a>
<a name="ln1830">                    ARRAY_LENGTH(</a>
<a name="ln1831">                        ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0),</a>
<a name="ln1832">                    2);</a>
<a name="ln1833">            }</a>
<a name="ln1834">        }</a>
<a name="ln1835"> </a>
<a name="ln1836">        /* </a>
<a name="ln1837">         * ath_hal_pcie_power_save_enable should be 2 for OWL/Condor and </a>
<a name="ln1838">         * 0 for merlin </a>
<a name="ln1839">         */</a>
<a name="ln1840">        ah-&gt;ah_config.ath_hal_pcie_power_save_enable = 0;</a>
<a name="ln1841"> </a>
<a name="ln1842">#if 0 // ATH_WOW</a>
<a name="ln1843">        /* SerDes values during WOW sleep */</a>
<a name="ln1844">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_wow, ar9300_pcie_phy_AWOW,</a>
<a name="ln1845">            ARRAY_LENGTH(ar9300_pcie_phy_AWOW), 2);</a>
<a name="ln1846">#endif</a>
<a name="ln1847"> </a>
<a name="ln1848">        /* Fast clock modal settings */</a>
<a name="ln1849">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional, </a>
<a name="ln1850">            ar9300Modes_fast_clock_jupiter_2p0,</a>
<a name="ln1851">            ARRAY_LENGTH(ar9300Modes_fast_clock_jupiter_2p0), 3);</a>
<a name="ln1852">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_japan2484,</a>
<a name="ln1853">            ar9300_jupiter_2p0_baseband_core_txfir_coeff_japan_2484,</a>
<a name="ln1854">            ARRAY_LENGTH(</a>
<a name="ln1855">            ar9300_jupiter_2p0_baseband_core_txfir_coeff_japan_2484), 2);</a>
<a name="ln1856"> </a>
<a name="ln1857">    } else if (AR_SREV_APHRODITE(ah)) {</a>
<a name="ln1858">        /* Aphrodite: new INI format (pre, core, post arrays per subsystem) */</a>
<a name="ln1859"> </a>
<a name="ln1860">        /* mac */</a>
<a name="ln1861">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1862">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln1863">            ar956X_aphrodite_1p0_mac_core, </a>
<a name="ln1864">            ARRAY_LENGTH(ar956X_aphrodite_1p0_mac_core), 2);</a>
<a name="ln1865">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_POST],</a>
<a name="ln1866">            ar956X_aphrodite_1p0_mac_postamble,</a>
<a name="ln1867">            ARRAY_LENGTH(ar956X_aphrodite_1p0_mac_postamble), 5);</a>
<a name="ln1868"> </a>
<a name="ln1869">        /* bb */</a>
<a name="ln1870">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1871">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_CORE],</a>
<a name="ln1872">            ar956X_aphrodite_1p0_baseband_core,</a>
<a name="ln1873">            ARRAY_LENGTH(ar956X_aphrodite_1p0_baseband_core), 2);</a>
<a name="ln1874">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln1875">            ar956X_aphrodite_1p0_baseband_postamble,</a>
<a name="ln1876">            ARRAY_LENGTH(ar956X_aphrodite_1p0_baseband_postamble), 5);</a>
<a name="ln1877"> </a>
<a name="ln1878">//mark jupiter have but aphrodite don't have</a>
<a name="ln1879">//        /* radio */</a>
<a name="ln1880">//        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1881">//        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_CORE],</a>
<a name="ln1882">//            ar9300_aphrodite_1p0_radio_core, </a>
<a name="ln1883">//            ARRAY_LENGTH(ar9300_aphrodite_1p0_radio_core), 2);</a>
<a name="ln1884">//        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_POST],</a>
<a name="ln1885">//            ar9300_aphrodite_1p0_radio_postamble, </a>
<a name="ln1886">//            ARRAY_LENGTH(ar9300_aphrodite_1p0_radio_postamble), 5);</a>
<a name="ln1887"> </a>
<a name="ln1888">        /* soc */</a>
<a name="ln1889">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln1890">            ar956X_aphrodite_1p0_soc_preamble, </a>
<a name="ln1891">            ARRAY_LENGTH(ar956X_aphrodite_1p0_soc_preamble), 2);</a>
<a name="ln1892">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_CORE], NULL, 0, 0);</a>
<a name="ln1893">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_POST],</a>
<a name="ln1894">            ar956X_aphrodite_1p0_soc_postamble, </a>
<a name="ln1895">            ARRAY_LENGTH(ar956X_aphrodite_1p0_soc_postamble), 5);</a>
<a name="ln1896"> </a>
<a name="ln1897">        /* rx/tx gain */</a>
<a name="ln1898">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, </a>
<a name="ln1899">            ar956XCommon_rx_gain_table_aphrodite_1p0,</a>
<a name="ln1900">            ARRAY_LENGTH(ar956XCommon_rx_gain_table_aphrodite_1p0), 2);</a>
<a name="ln1901">        //INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain, </a>
<a name="ln1902">        //    ar956XModes_lowest_ob_db_tx_gain_table_aphrodite_1p0,</a>
<a name="ln1903">        //    ARRAY_LENGTH(ar956XModes_lowest_ob_db_tx_gain_table_aphrodite_1p0),</a>
<a name="ln1904">        //    5);</a>
<a name="ln1905"> </a>
<a name="ln1906"> </a>
<a name="ln1907">        /* </a>
<a name="ln1908">         * ath_hal_pcie_power_save_enable should be 2 for OWL/Condor and </a>
<a name="ln1909">         * 0 for merlin </a>
<a name="ln1910">         */</a>
<a name="ln1911">        ah-&gt;ah_config.ath_hal_pcie_power_save_enable = 0;</a>
<a name="ln1912"> </a>
<a name="ln1913">#if 0 // ATH_WOW</a>
<a name="ln1914">        /* SerDes values during WOW sleep */</a>
<a name="ln1915">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_wow, ar9300_pcie_phy_AWOW,</a>
<a name="ln1916">            ARRAY_LENGTH(ar9300_pcie_phy_AWOW), 2);</a>
<a name="ln1917">#endif</a>
<a name="ln1918">       /* Fast clock modal settings */</a>
<a name="ln1919">       INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional, </a>
<a name="ln1920">            ar956XModes_fast_clock_aphrodite_1p0,</a>
<a name="ln1921">            ARRAY_LENGTH(ar956XModes_fast_clock_aphrodite_1p0), 3);</a>
<a name="ln1922"> </a>
<a name="ln1923">    } else if (AR_SREV_AR9580(ah)) {</a>
<a name="ln1924">        /*</a>
<a name="ln1925">         * AR9580/Peacock -</a>
<a name="ln1926">         * new INI format (pre, core, post arrays per subsystem)</a>
<a name="ln1927">         */</a>
<a name="ln1928"> </a>
<a name="ln1929">        /* mac */</a>
<a name="ln1930">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1931">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln1932">            ar9300_ar9580_1p0_mac_core,</a>
<a name="ln1933">            ARRAY_LENGTH(ar9300_ar9580_1p0_mac_core), 2);</a>
<a name="ln1934">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_POST],</a>
<a name="ln1935">            ar9300_ar9580_1p0_mac_postamble,</a>
<a name="ln1936">            ARRAY_LENGTH(ar9300_ar9580_1p0_mac_postamble), 5);</a>
<a name="ln1937"> </a>
<a name="ln1938">        /* bb */</a>
<a name="ln1939">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1940">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_CORE],</a>
<a name="ln1941">            ar9300_ar9580_1p0_baseband_core,</a>
<a name="ln1942">            ARRAY_LENGTH(ar9300_ar9580_1p0_baseband_core), 2);</a>
<a name="ln1943">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln1944">            ar9300_ar9580_1p0_baseband_postamble,</a>
<a name="ln1945">            ARRAY_LENGTH(ar9300_ar9580_1p0_baseband_postamble), 5);</a>
<a name="ln1946"> </a>
<a name="ln1947">        /* radio */</a>
<a name="ln1948">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln1949">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_CORE],</a>
<a name="ln1950">            ar9300_ar9580_1p0_radio_core,</a>
<a name="ln1951">            ARRAY_LENGTH(ar9300_ar9580_1p0_radio_core), 2);</a>
<a name="ln1952">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_POST],</a>
<a name="ln1953">            ar9300_ar9580_1p0_radio_postamble,</a>
<a name="ln1954">            ARRAY_LENGTH(ar9300_ar9580_1p0_radio_postamble), 5);</a>
<a name="ln1955"> </a>
<a name="ln1956">        /* soc */</a>
<a name="ln1957">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln1958">            ar9300_ar9580_1p0_soc_preamble,</a>
<a name="ln1959">            ARRAY_LENGTH(ar9300_ar9580_1p0_soc_preamble), 2);</a>
<a name="ln1960">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_CORE], NULL, 0, 0);</a>
<a name="ln1961">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_POST],</a>
<a name="ln1962">            ar9300_ar9580_1p0_soc_postamble,</a>
<a name="ln1963">            ARRAY_LENGTH(ar9300_ar9580_1p0_soc_postamble), 5);</a>
<a name="ln1964"> </a>
<a name="ln1965">        /* rx/tx gain */</a>
<a name="ln1966">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln1967">            ar9300_common_rx_gain_table_ar9580_1p0,</a>
<a name="ln1968">            ARRAY_LENGTH(ar9300_common_rx_gain_table_ar9580_1p0), 2);</a>
<a name="ln1969">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln1970">            ar9300Modes_lowest_ob_db_tx_gain_table_ar9580_1p0,</a>
<a name="ln1971">            ARRAY_LENGTH(ar9300Modes_lowest_ob_db_tx_gain_table_ar9580_1p0), 5);</a>
<a name="ln1972"> </a>
<a name="ln1973">        /* DFS */</a>
<a name="ln1974">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_dfs,</a>
<a name="ln1975">            ar9300_ar9580_1p0_baseband_postamble_dfs_channel,</a>
<a name="ln1976">            ARRAY_LENGTH(ar9300_ar9580_1p0_baseband_postamble_dfs_channel), 3);</a>
<a name="ln1977"> </a>
<a name="ln1978"> </a>
<a name="ln1979">        /* Load PCIE SERDES settings from INI */</a>
<a name="ln1980"> </a>
<a name="ln1981">        /*D3 Setting */</a>
<a name="ln1982">        if  (ah-&gt;ah_config.ath_hal_pcie_clock_req) {</a>
<a name="ln1983">            if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln1984">                AR_PCIE_PLL_PWRSAVE_CONTROL)</a>
<a name="ln1985">            { //registry control</a>
<a name="ln1986">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln1987">                    AR_PCIE_PLL_PWRSAVE_ON_D3)</a>
<a name="ln1988">                { //bit1, in to D3</a>
<a name="ln1989">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln1990">                        ar9300PciePhy_clkreq_enable_L1_ar9580_1p0,</a>
<a name="ln1991">                        ARRAY_LENGTH(ar9300PciePhy_clkreq_enable_L1_ar9580_1p0),</a>
<a name="ln1992">                    2);</a>
<a name="ln1993">                } else {</a>
<a name="ln1994">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln1995">                        ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0,</a>
<a name="ln1996">                        ARRAY_LENGTH(</a>
<a name="ln1997">                            ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0),</a>
<a name="ln1998">                    2);</a>
<a name="ln1999">                }</a>
<a name="ln2000">            } else {//no registry control, default is pll on</a>
<a name="ln2001">                INIT_INI_ARRAY(</a>
<a name="ln2002">                    &amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln2003">                    ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0,</a>
<a name="ln2004">                    ARRAY_LENGTH(</a>
<a name="ln2005">                        ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0),</a>
<a name="ln2006">                    2);</a>
<a name="ln2007">            }</a>
<a name="ln2008">        } else {</a>
<a name="ln2009">            if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln2010">                AR_PCIE_PLL_PWRSAVE_CONTROL)</a>
<a name="ln2011">            { //registry control</a>
<a name="ln2012">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln2013">                    AR_PCIE_PLL_PWRSAVE_ON_D3)</a>
<a name="ln2014">                { //bit1, in to D3</a>
<a name="ln2015">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln2016">                        ar9300PciePhy_clkreq_disable_L1_ar9580_1p0,</a>
<a name="ln2017">                        ARRAY_LENGTH(</a>
<a name="ln2018">                            ar9300PciePhy_clkreq_disable_L1_ar9580_1p0),</a>
<a name="ln2019">                        2);</a>
<a name="ln2020">                } else {</a>
<a name="ln2021">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln2022">                        ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0,</a>
<a name="ln2023">                        ARRAY_LENGTH(</a>
<a name="ln2024">                            ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0),</a>
<a name="ln2025">                        2);</a>
<a name="ln2026">                }</a>
<a name="ln2027">            } else {//no registry control, default is pll on</a>
<a name="ln2028">                INIT_INI_ARRAY(</a>
<a name="ln2029">                    &amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln2030">                    ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0,</a>
<a name="ln2031">                    ARRAY_LENGTH(</a>
<a name="ln2032">                        ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0),</a>
<a name="ln2033">                    2);</a>
<a name="ln2034">            }</a>
<a name="ln2035">        }</a>
<a name="ln2036"> </a>
<a name="ln2037">        /*D0 Setting */</a>
<a name="ln2038">        if  (ah-&gt;ah_config.ath_hal_pcie_clock_req) {</a>
<a name="ln2039">             if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln2040">                AR_PCIE_PLL_PWRSAVE_CONTROL)</a>
<a name="ln2041">             { //registry control</a>
<a name="ln2042">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln2043">                    AR_PCIE_PLL_PWRSAVE_ON_D0)</a>
<a name="ln2044">                { //bit2, out of D3</a>
<a name="ln2045">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln2046">                        ar9300PciePhy_clkreq_enable_L1_ar9580_1p0,</a>
<a name="ln2047">                        ARRAY_LENGTH(ar9300PciePhy_clkreq_enable_L1_ar9580_1p0),</a>
<a name="ln2048">                    2);</a>
<a name="ln2049"> </a>
<a name="ln2050">                } else {</a>
<a name="ln2051">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln2052">                        ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0,</a>
<a name="ln2053">                        ARRAY_LENGTH(</a>
<a name="ln2054">                            ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0),</a>
<a name="ln2055">                    2);</a>
<a name="ln2056">                }</a>
<a name="ln2057">            } else { //no registry control, default is pll on</a>
<a name="ln2058">                INIT_INI_ARRAY(</a>
<a name="ln2059">                    &amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln2060">                    ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0,</a>
<a name="ln2061">                    ARRAY_LENGTH(</a>
<a name="ln2062">                        ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0),</a>
<a name="ln2063">                    2);</a>
<a name="ln2064">            }</a>
<a name="ln2065">        } else {</a>
<a name="ln2066">            if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln2067">                AR_PCIE_PLL_PWRSAVE_CONTROL)</a>
<a name="ln2068">            {//registry control</a>
<a name="ln2069">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp;</a>
<a name="ln2070">                    AR_PCIE_PLL_PWRSAVE_ON_D0)</a>
<a name="ln2071">                {//bit2, out of D3</a>
<a name="ln2072">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln2073">                        ar9300PciePhy_clkreq_disable_L1_ar9580_1p0,</a>
<a name="ln2074">                       ARRAY_LENGTH(ar9300PciePhy_clkreq_disable_L1_ar9580_1p0),</a>
<a name="ln2075">                    2);</a>
<a name="ln2076">                } else {</a>
<a name="ln2077">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln2078">                        ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0,</a>
<a name="ln2079">                        ARRAY_LENGTH(</a>
<a name="ln2080">                            ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0),</a>
<a name="ln2081">                    2);</a>
<a name="ln2082">                }</a>
<a name="ln2083">            } else { //no registry control, default is pll on</a>
<a name="ln2084">                INIT_INI_ARRAY(</a>
<a name="ln2085">                    &amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln2086">                    ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0,</a>
<a name="ln2087">                    ARRAY_LENGTH(</a>
<a name="ln2088">                        ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0),</a>
<a name="ln2089">                    2);</a>
<a name="ln2090">            }</a>
<a name="ln2091">        }</a>
<a name="ln2092"> </a>
<a name="ln2093">        ah-&gt;ah_config.ath_hal_pcie_power_save_enable = 0;</a>
<a name="ln2094"> </a>
<a name="ln2095">#if 0 /* ATH_WOW */</a>
<a name="ln2096">        /* SerDes values during WOW sleep */</a>
<a name="ln2097">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_wow, ar9300_pcie_phy_awow,</a>
<a name="ln2098">                       ARRAY_LENGTH(ar9300_pcie_phy_awow), 2);</a>
<a name="ln2099">#endif</a>
<a name="ln2100"> </a>
<a name="ln2101">        /* Fast clock modal settings */</a>
<a name="ln2102">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional,</a>
<a name="ln2103">            ar9300Modes_fast_clock_ar9580_1p0,</a>
<a name="ln2104">            ARRAY_LENGTH(ar9300Modes_fast_clock_ar9580_1p0), 3);</a>
<a name="ln2105">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_japan2484,</a>
<a name="ln2106">            ar9300_ar9580_1p0_baseband_core_txfir_coeff_japan_2484,</a>
<a name="ln2107">            ARRAY_LENGTH(</a>
<a name="ln2108">                ar9300_ar9580_1p0_baseband_core_txfir_coeff_japan_2484), 2);</a>
<a name="ln2109"> </a>
<a name="ln2110">    } else {</a>
<a name="ln2111">        /*</a>
<a name="ln2112">         * Osprey 2.2 -  new INI format (pre, core, post arrays per subsystem)</a>
<a name="ln2113">         */</a>
<a name="ln2114"> </a>
<a name="ln2115">        /* mac */</a>
<a name="ln2116">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln2117">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_CORE],</a>
<a name="ln2118">            ar9300_osprey_2p2_mac_core,</a>
<a name="ln2119">            ARRAY_LENGTH(ar9300_osprey_2p2_mac_core), 2);</a>
<a name="ln2120">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_mac[ATH_INI_POST],</a>
<a name="ln2121">            ar9300_osprey_2p2_mac_postamble,</a>
<a name="ln2122">            ARRAY_LENGTH(ar9300_osprey_2p2_mac_postamble), 5);</a>
<a name="ln2123"> </a>
<a name="ln2124">        /* bb */</a>
<a name="ln2125">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln2126">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_CORE],</a>
<a name="ln2127">            ar9300_osprey_2p2_baseband_core,</a>
<a name="ln2128">            ARRAY_LENGTH(ar9300_osprey_2p2_baseband_core), 2);</a>
<a name="ln2129">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_bb[ATH_INI_POST],</a>
<a name="ln2130">            ar9300_osprey_2p2_baseband_postamble,</a>
<a name="ln2131">            ARRAY_LENGTH(ar9300_osprey_2p2_baseband_postamble), 5);</a>
<a name="ln2132"> </a>
<a name="ln2133">        /* radio */</a>
<a name="ln2134">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);</a>
<a name="ln2135">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_CORE],</a>
<a name="ln2136">            ar9300_osprey_2p2_radio_core,</a>
<a name="ln2137">            ARRAY_LENGTH(ar9300_osprey_2p2_radio_core), 2);</a>
<a name="ln2138">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_radio[ATH_INI_POST],</a>
<a name="ln2139">            ar9300_osprey_2p2_radio_postamble,</a>
<a name="ln2140">            ARRAY_LENGTH(ar9300_osprey_2p2_radio_postamble), 5);</a>
<a name="ln2141"> </a>
<a name="ln2142">        /* soc */</a>
<a name="ln2143">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_PRE],</a>
<a name="ln2144">            ar9300_osprey_2p2_soc_preamble,</a>
<a name="ln2145">            ARRAY_LENGTH(ar9300_osprey_2p2_soc_preamble), 2);</a>
<a name="ln2146">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_CORE], NULL, 0, 0);</a>
<a name="ln2147">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_soc[ATH_INI_POST],</a>
<a name="ln2148">            ar9300_osprey_2p2_soc_postamble,</a>
<a name="ln2149">            ARRAY_LENGTH(ar9300_osprey_2p2_soc_postamble), 5);</a>
<a name="ln2150"> </a>
<a name="ln2151">        /* rx/tx gain */</a>
<a name="ln2152">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln2153">            ar9300_common_rx_gain_table_osprey_2p2,</a>
<a name="ln2154">            ARRAY_LENGTH(ar9300_common_rx_gain_table_osprey_2p2), 2);</a>
<a name="ln2155">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln2156">            ar9300_modes_lowest_ob_db_tx_gain_table_osprey_2p2,</a>
<a name="ln2157">            ARRAY_LENGTH(ar9300_modes_lowest_ob_db_tx_gain_table_osprey_2p2), 5);</a>
<a name="ln2158"> </a>
<a name="ln2159">        /* DFS */</a>
<a name="ln2160">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_dfs,</a>
<a name="ln2161">            ar9300_osprey_2p2_baseband_postamble_dfs_channel,</a>
<a name="ln2162">            ARRAY_LENGTH(ar9300_osprey_2p2_baseband_postamble_dfs_channel), 3);</a>
<a name="ln2163"> </a>
<a name="ln2164">        /* Load PCIE SERDES settings from INI */</a>
<a name="ln2165"> </a>
<a name="ln2166">        /*D3 Setting */</a>
<a name="ln2167">        if  (ah-&gt;ah_config.ath_hal_pcie_clock_req) {</a>
<a name="ln2168">            if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln2169">                AR_PCIE_PLL_PWRSAVE_CONTROL) </a>
<a name="ln2170">            { //registry control</a>
<a name="ln2171">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln2172">                    AR_PCIE_PLL_PWRSAVE_ON_D3) </a>
<a name="ln2173">                { //bit1, in to D3</a>
<a name="ln2174">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln2175">                        ar9300PciePhy_clkreq_enable_L1_osprey_2p2,</a>
<a name="ln2176">                        ARRAY_LENGTH(ar9300PciePhy_clkreq_enable_L1_osprey_2p2),</a>
<a name="ln2177">                    2);</a>
<a name="ln2178">                } else {</a>
<a name="ln2179">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln2180">                        ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2,</a>
<a name="ln2181">                        ARRAY_LENGTH(</a>
<a name="ln2182">                            ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2),</a>
<a name="ln2183">                    2);</a>
<a name="ln2184">                }</a>
<a name="ln2185">             } else {//no registry control, default is pll on</a>
<a name="ln2186">#ifndef ATH_BUS_PM</a>
<a name="ln2187">                    INIT_INI_ARRAY(</a>
<a name="ln2188">                        &amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln2189">                        ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2,</a>
<a name="ln2190">                        ARRAY_LENGTH(</a>
<a name="ln2191">                            ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2),</a>
<a name="ln2192">                    2);</a>
<a name="ln2193">#else</a>
<a name="ln2194">        //no registry control, default is pll off</a>
<a name="ln2195">        INIT_INI_ARRAY(</a>
<a name="ln2196">                &amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln2197">                ar9300PciePhy_clkreq_disable_L1_osprey_2p2,</a>
<a name="ln2198">                ARRAY_LENGTH(</a>
<a name="ln2199">                    ar9300PciePhy_clkreq_disable_L1_osprey_2p2),</a>
<a name="ln2200">                  2);</a>
<a name="ln2201">#endif</a>
<a name="ln2202"> </a>
<a name="ln2203">            }</a>
<a name="ln2204">        } else {</a>
<a name="ln2205">            if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln2206">                AR_PCIE_PLL_PWRSAVE_CONTROL) </a>
<a name="ln2207">            { //registry control</a>
<a name="ln2208">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln2209">                    AR_PCIE_PLL_PWRSAVE_ON_D3) </a>
<a name="ln2210">                { //bit1, in to D3</a>
<a name="ln2211">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln2212">                        ar9300PciePhy_clkreq_disable_L1_osprey_2p2,</a>
<a name="ln2213">                        ARRAY_LENGTH(</a>
<a name="ln2214">                            ar9300PciePhy_clkreq_disable_L1_osprey_2p2),</a>
<a name="ln2215">                        2);</a>
<a name="ln2216">                } else {</a>
<a name="ln2217">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, </a>
<a name="ln2218">                       ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2,</a>
<a name="ln2219">                       ARRAY_LENGTH(</a>
<a name="ln2220">                           ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2),</a>
<a name="ln2221">                       2);</a>
<a name="ln2222">                }</a>
<a name="ln2223">             } else {</a>
<a name="ln2224">#ifndef ATH_BUS_PM</a>
<a name="ln2225">        //no registry control, default is pll on</a>
<a name="ln2226">                INIT_INI_ARRAY(</a>
<a name="ln2227">                    &amp;ahp-&gt;ah_ini_pcie_serdes,</a>
<a name="ln2228">                    ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2,</a>
<a name="ln2229">                    ARRAY_LENGTH(</a>
<a name="ln2230">                        ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2),</a>
<a name="ln2231">                    2);</a>
<a name="ln2232">#else</a>
<a name="ln2233">        //no registry control, default is pll off</a>
<a name="ln2234">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes, ar9300PciePhy_clkreq_disable_L1_osprey_2p2,</a>
<a name="ln2235">                           ARRAY_LENGTH(ar9300PciePhy_clkreq_disable_L1_osprey_2p2), 2);</a>
<a name="ln2236">#endif</a>
<a name="ln2237">            }</a>
<a name="ln2238">        }</a>
<a name="ln2239"> </a>
<a name="ln2240">        /*D0 Setting */</a>
<a name="ln2241">        if  (ah-&gt;ah_config.ath_hal_pcie_clock_req) {</a>
<a name="ln2242">             if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln2243">                AR_PCIE_PLL_PWRSAVE_CONTROL) </a>
<a name="ln2244">             { //registry control</a>
<a name="ln2245">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln2246">                    AR_PCIE_PLL_PWRSAVE_ON_D0)</a>
<a name="ln2247">                { //bit2, out of D3</a>
<a name="ln2248">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln2249">                        ar9300PciePhy_clkreq_enable_L1_osprey_2p2,</a>
<a name="ln2250">                        ARRAY_LENGTH(ar9300PciePhy_clkreq_enable_L1_osprey_2p2),</a>
<a name="ln2251">                    2);</a>
<a name="ln2252"> </a>
<a name="ln2253">                } else {</a>
<a name="ln2254">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln2255">                        ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2,</a>
<a name="ln2256">                        ARRAY_LENGTH(</a>
<a name="ln2257">                            ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2),</a>
<a name="ln2258">                    2);</a>
<a name="ln2259">                }</a>
<a name="ln2260">            } else { //no registry control, default is pll on</a>
<a name="ln2261">                INIT_INI_ARRAY(</a>
<a name="ln2262">                    &amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln2263">                    ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2,</a>
<a name="ln2264">                    ARRAY_LENGTH(</a>
<a name="ln2265">                        ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2),</a>
<a name="ln2266">                    2);</a>
<a name="ln2267">            }</a>
<a name="ln2268">        } else {</a>
<a name="ln2269">            if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln2270">                AR_PCIE_PLL_PWRSAVE_CONTROL) </a>
<a name="ln2271">            {//registry control</a>
<a name="ln2272">                if (ah-&gt;ah_config.ath_hal_pll_pwr_save &amp; </a>
<a name="ln2273">                    AR_PCIE_PLL_PWRSAVE_ON_D0)</a>
<a name="ln2274">                {//bit2, out of D3</a>
<a name="ln2275">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln2276">                        ar9300PciePhy_clkreq_disable_L1_osprey_2p2,</a>
<a name="ln2277">                       ARRAY_LENGTH(ar9300PciePhy_clkreq_disable_L1_osprey_2p2),</a>
<a name="ln2278">                    2);</a>
<a name="ln2279">                } else {</a>
<a name="ln2280">                    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, </a>
<a name="ln2281">                        ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2,</a>
<a name="ln2282">                        ARRAY_LENGTH(</a>
<a name="ln2283">                            ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2),</a>
<a name="ln2284">                    2);</a>
<a name="ln2285">                }</a>
<a name="ln2286">            } else { //no registry control, default is pll on</a>
<a name="ln2287">                INIT_INI_ARRAY(</a>
<a name="ln2288">                    &amp;ahp-&gt;ah_ini_pcie_serdes_low_power,</a>
<a name="ln2289">                    ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2,</a>
<a name="ln2290">                    ARRAY_LENGTH(</a>
<a name="ln2291">                        ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2),</a>
<a name="ln2292">                    2);</a>
<a name="ln2293">            }</a>
<a name="ln2294">        }</a>
<a name="ln2295"> </a>
<a name="ln2296">        ah-&gt;ah_config.ath_hal_pcie_power_save_enable = 0;</a>
<a name="ln2297"> </a>
<a name="ln2298">#ifdef ATH_BUS_PM</a>
<a name="ln2299">        /*Use HAL to config PCI powersave by writing into the SerDes Registers */</a>
<a name="ln2300">        ah-&gt;ah_config.ath_hal_pcie_ser_des_write = 1;</a>
<a name="ln2301">#endif</a>
<a name="ln2302"> </a>
<a name="ln2303">#if 0 /* ATH_WOW */</a>
<a name="ln2304">        /* SerDes values during WOW sleep */</a>
<a name="ln2305">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_pcie_serdes_wow, ar9300_pcie_phy_awow,</a>
<a name="ln2306">                       ARRAY_LENGTH(ar9300_pcie_phy_awow), 2);</a>
<a name="ln2307">#endif</a>
<a name="ln2308"> </a>
<a name="ln2309">        /* Fast clock modal settings */</a>
<a name="ln2310">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_additional,</a>
<a name="ln2311">            ar9300Modes_fast_clock_osprey_2p2,</a>
<a name="ln2312">            ARRAY_LENGTH(ar9300Modes_fast_clock_osprey_2p2), 3);</a>
<a name="ln2313">        INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_japan2484,</a>
<a name="ln2314">            ar9300_osprey_2p2_baseband_core_txfir_coeff_japan_2484,</a>
<a name="ln2315">            ARRAY_LENGTH(</a>
<a name="ln2316">                ar9300_osprey_2p2_baseband_core_txfir_coeff_japan_2484), 2);</a>
<a name="ln2317"> </a>
<a name="ln2318">    }</a>
<a name="ln2319"> </a>
<a name="ln2320">    if(AR_SREV_WASP(ah) || AR_SREV_SCORPION(ah))</a>
<a name="ln2321">    {</a>
<a name="ln2322">#define AR_SOC_RST_OTP_INTF  0xB80600B4</a>
<a name="ln2323">#define REG_READ(_reg)       *((volatile u_int32_t *)(_reg))</a>
<a name="ln2324"> </a>
<a name="ln2325">        ahp-&gt;ah_enterprise_mode = REG_READ(AR_SOC_RST_OTP_INTF);</a>
<a name="ln2326">        if (AR_SREV_SCORPION(ah)) {</a>
<a name="ln2327">            ahp-&gt;ah_enterprise_mode = ahp-&gt;ah_enterprise_mode &lt;&lt; 12;</a>
<a name="ln2328">        }</a>
<a name="ln2329">        ath_hal_printf (ah, &quot;Enterprise mode: 0x%08x\n&quot;, ahp-&gt;ah_enterprise_mode);</a>
<a name="ln2330">#undef REG_READ</a>
<a name="ln2331">#undef AR_SOC_RST_OTP_INTF</a>
<a name="ln2332">    } else {</a>
<a name="ln2333">        ahp-&gt;ah_enterprise_mode = OS_REG_READ(ah, AR_ENT_OTP);</a>
<a name="ln2334">    }</a>
<a name="ln2335"> </a>
<a name="ln2336"> </a>
<a name="ln2337">    if (ahpriv-&gt;ah_ispcie) {</a>
<a name="ln2338">        ar9300_config_pci_power_save(ah, 0, 0);</a>
<a name="ln2339">    } else {</a>
<a name="ln2340">        ar9300_disable_pcie_phy(ah);</a>
<a name="ln2341">    }</a>
<a name="ln2342">#if 0</a>
<a name="ln2343">    ath_hal_printf(ah, &quot;%s: calling ar9300_hw_attach\n&quot;, __func__);</a>
<a name="ln2344">#endif</a>
<a name="ln2345">    ecode = ar9300_hw_attach(ah);</a>
<a name="ln2346">    if (ecode != HAL_OK) {</a>
<a name="ln2347">        goto bad;</a>
<a name="ln2348">    }</a>
<a name="ln2349"> </a>
<a name="ln2350">    /* set gain table pointers according to values read from the eeprom */</a>
<a name="ln2351">    ar9300_tx_gain_table_apply(ah);</a>
<a name="ln2352">    ar9300_rx_gain_table_apply(ah);</a>
<a name="ln2353"> </a>
<a name="ln2354">    /*</a>
<a name="ln2355">    **</a>
<a name="ln2356">    ** Got everything we need now to setup the capabilities.</a>
<a name="ln2357">    */</a>
<a name="ln2358"> </a>
<a name="ln2359">    if (!ar9300_fill_capability_info(ah)) {</a>
<a name="ln2360">        HALDEBUG(ah, HAL_DEBUG_RESET,</a>
<a name="ln2361">            &quot;%s:failed ar9300_fill_capability_info\n&quot;, __func__);</a>
<a name="ln2362">        ecode = HAL_EEREAD;</a>
<a name="ln2363">        goto bad;</a>
<a name="ln2364">    }</a>
<a name="ln2365">    ecode = ar9300_init_mac_addr(ah);</a>
<a name="ln2366">    if (ecode != HAL_OK) {</a>
<a name="ln2367">        HALDEBUG(ah, HAL_DEBUG_RESET,</a>
<a name="ln2368">            &quot;%s: failed initializing mac address\n&quot;, __func__);</a>
<a name="ln2369">        goto bad;</a>
<a name="ln2370">    }</a>
<a name="ln2371"> </a>
<a name="ln2372">    /*</a>
<a name="ln2373">     * Initialize receive buffer size to MAC default</a>
<a name="ln2374">     */</a>
<a name="ln2375">    ahp-&gt;rx_buf_size = HAL_RXBUFSIZE_DEFAULT;</a>
<a name="ln2376"> </a>
<a name="ln2377">#if ATH_WOW</a>
<a name="ln2378">#if 0</a>
<a name="ln2379">    /*</a>
<a name="ln2380">     * Needs to be removed once we stop using XB92 XXX</a>
<a name="ln2381">     * FIXME: Check with latest boards too - SriniK</a>
<a name="ln2382">     */</a>
<a name="ln2383">    ar9300_wow_set_gpio_reset_low(ah);</a>
<a name="ln2384">#endif</a>
<a name="ln2385"> </a>
<a name="ln2386">    /*</a>
<a name="ln2387">     * Clear the Wow Status.</a>
<a name="ln2388">     */</a>
<a name="ln2389">    OS_REG_WRITE(ah, AR_HOSTIF_REG(ah, AR_PCIE_PM_CTRL),</a>
<a name="ln2390">        OS_REG_READ(ah, AR_HOSTIF_REG(ah, AR_PCIE_PM_CTRL)) |</a>
<a name="ln2391">        AR_PMCTRL_WOW_PME_CLR);</a>
<a name="ln2392">    OS_REG_WRITE(ah, AR_WOW_PATTERN_REG,</a>
<a name="ln2393">        AR_WOW_CLEAR_EVENTS(OS_REG_READ(ah, AR_WOW_PATTERN_REG)));</a>
<a name="ln2394">#endif</a>
<a name="ln2395"> </a>
<a name="ln2396">    /*</a>
<a name="ln2397">     * Set the cur_trig_level to a value that works all modes - 11a/b/g or 11n</a>
<a name="ln2398">     * with aggregation enabled or disabled.</a>
<a name="ln2399">     */</a>
<a name="ln2400">    ahp-&gt;ah_tx_trig_level = (AR_FTRIG_512B &gt;&gt; AR_FTRIG_S);</a>
<a name="ln2401"> </a>
<a name="ln2402">    if (AR_SREV_HORNET(ah)) {</a>
<a name="ln2403">        ahp-&gt;nf_2GHz.nominal = AR_PHY_CCA_NOM_VAL_HORNET_2GHZ;</a>
<a name="ln2404">        ahp-&gt;nf_2GHz.max     = AR_PHY_CCA_MAX_GOOD_VAL_OSPREY_2GHZ;</a>
<a name="ln2405">        ahp-&gt;nf_2GHz.min     = AR_PHY_CCA_MIN_GOOD_VAL_OSPREY_2GHZ;</a>
<a name="ln2406">        ahp-&gt;nf_5GHz.nominal = AR_PHY_CCA_NOM_VAL_OSPREY_5GHZ;</a>
<a name="ln2407">        ahp-&gt;nf_5GHz.max     = AR_PHY_CCA_MAX_GOOD_VAL_OSPREY_5GHZ;</a>
<a name="ln2408">        ahp-&gt;nf_5GHz.min     = AR_PHY_CCA_MIN_GOOD_VAL_OSPREY_5GHZ;</a>
<a name="ln2409">        ahp-&gt;nf_cw_int_delta = AR_PHY_CCA_CW_INT_DELTA;</a>
<a name="ln2410">    } else if(AR_SREV_JUPITER(ah) || AR_SREV_APHRODITE(ah)){</a>
<a name="ln2411">        ahp-&gt;nf_2GHz.nominal = AR_PHY_CCA_NOM_VAL_JUPITER_2GHZ;</a>
<a name="ln2412">        ahp-&gt;nf_2GHz.max     = AR_PHY_CCA_MAX_GOOD_VAL_OSPREY_2GHZ;</a>
<a name="ln2413">        ahp-&gt;nf_2GHz.min     = AR_PHY_CCA_MIN_GOOD_VAL_JUPITER_2GHZ;</a>
<a name="ln2414">        ahp-&gt;nf_5GHz.nominal = AR_PHY_CCA_NOM_VAL_JUPITER_5GHZ;</a>
<a name="ln2415">        ahp-&gt;nf_5GHz.max     = AR_PHY_CCA_MAX_GOOD_VAL_OSPREY_5GHZ;</a>
<a name="ln2416">        ahp-&gt;nf_5GHz.min     = AR_PHY_CCA_MIN_GOOD_VAL_JUPITER_5GHZ;</a>
<a name="ln2417">        ahp-&gt;nf_cw_int_delta = AR_PHY_CCA_CW_INT_DELTA;</a>
<a name="ln2418">    }	else {</a>
<a name="ln2419">        ahp-&gt;nf_2GHz.nominal = AR_PHY_CCA_NOM_VAL_OSPREY_2GHZ;</a>
<a name="ln2420">        ahp-&gt;nf_2GHz.max     = AR_PHY_CCA_MAX_GOOD_VAL_OSPREY_2GHZ;</a>
<a name="ln2421">        ahp-&gt;nf_2GHz.min     = AR_PHY_CCA_MIN_GOOD_VAL_OSPREY_2GHZ;</a>
<a name="ln2422">        if (AR_SREV_AR9580(ah) || AR_SREV_WASP(ah) || AR_SREV_SCORPION(ah)) {</a>
<a name="ln2423">            ahp-&gt;nf_5GHz.nominal = AR_PHY_CCA_NOM_VAL_PEACOCK_5GHZ;</a>
<a name="ln2424">        } else {</a>
<a name="ln2425">            ahp-&gt;nf_5GHz.nominal = AR_PHY_CCA_NOM_VAL_OSPREY_5GHZ;</a>
<a name="ln2426">        }</a>
<a name="ln2427">        ahp-&gt;nf_5GHz.max     = AR_PHY_CCA_MAX_GOOD_VAL_OSPREY_5GHZ;</a>
<a name="ln2428">        ahp-&gt;nf_5GHz.min     = AR_PHY_CCA_MIN_GOOD_VAL_OSPREY_5GHZ;</a>
<a name="ln2429">        ahp-&gt;nf_cw_int_delta = AR_PHY_CCA_CW_INT_DELTA;</a>
<a name="ln2430">     }</a>
<a name="ln2431"> </a>
<a name="ln2432"> </a>
<a name="ln2433"> </a>
<a name="ln2434"> </a>
<a name="ln2435">    /* init BB Panic Watchdog timeout */</a>
<a name="ln2436">    if (AR_SREV_HORNET(ah)) {</a>
<a name="ln2437">        ahp-&gt;ah_bb_panic_timeout_ms = HAL_BB_PANIC_WD_TMO_HORNET;</a>
<a name="ln2438">    } else {</a>
<a name="ln2439">        ahp-&gt;ah_bb_panic_timeout_ms = HAL_BB_PANIC_WD_TMO;</a>
<a name="ln2440">    }</a>
<a name="ln2441"> </a>
<a name="ln2442"> </a>
<a name="ln2443">    /*</a>
<a name="ln2444">     * Determine whether tx IQ calibration HW should be enabled,</a>
<a name="ln2445">     * and whether tx IQ calibration should be performed during</a>
<a name="ln2446">     * AGC calibration, or separately.</a>
<a name="ln2447">     */</a>
<a name="ln2448">    if (AR_SREV_JUPITER(ah) || AR_SREV_APHRODITE(ah)) {</a>
<a name="ln2449">        /*</a>
<a name="ln2450">         * Register not initialized yet. This flag will be re-initialized</a>
<a name="ln2451">         * after INI loading following each reset.</a>
<a name="ln2452">         */</a>
<a name="ln2453">        ahp-&gt;tx_iq_cal_enable = 1;</a>
<a name="ln2454">        /* if tx IQ cal is enabled, do it together with AGC cal */</a>
<a name="ln2455">        ahp-&gt;tx_iq_cal_during_agc_cal = 1;</a>
<a name="ln2456">    } else if (AR_SREV_POSEIDON_OR_LATER(ah) &amp;&amp; !AR_SREV_WASP(ah)) {</a>
<a name="ln2457">        ahp-&gt;tx_iq_cal_enable = 1;</a>
<a name="ln2458">        ahp-&gt;tx_iq_cal_during_agc_cal = 1;</a>
<a name="ln2459">    } else {</a>
<a name="ln2460">        /* osprey, hornet, wasp */</a>
<a name="ln2461">        ahp-&gt;tx_iq_cal_enable = 1;</a>
<a name="ln2462">        ahp-&gt;tx_iq_cal_during_agc_cal = 0;</a>
<a name="ln2463">    }</a>
<a name="ln2464">    return ah;</a>
<a name="ln2465"> </a>
<a name="ln2466">bad:</a>
<a name="ln2467">    if (ahp) {</a>
<a name="ln2468">        ar9300_detach((struct ath_hal *) ahp);</a>
<a name="ln2469">    }</a>
<a name="ln2470">    if (status) {</a>
<a name="ln2471">        *status = ecode;</a>
<a name="ln2472">    }</a>
<a name="ln2473">    return AH_NULL;</a>
<a name="ln2474">}</a>
<a name="ln2475"> </a>
<a name="ln2476">void</a>
<a name="ln2477">ar9300_detach(struct ath_hal *ah)</a>
<a name="ln2478">{</a>
<a name="ln2479">    HALASSERT(ah != AH_NULL);</a>
<a name="ln2480">    HALASSERT(ah-&gt;ah_magic == AR9300_MAGIC);</a>
<a name="ln2481"> </a>
<a name="ln2482">    /* Make sure that chip is awake before writing to it */</a>
<a name="ln2483">    if (!ar9300_set_power_mode(ah, HAL_PM_AWAKE, AH_TRUE)) {</a>
<a name="ln2484">        HALDEBUG(ah, HAL_DEBUG_UNMASKABLE,</a>
<a name="ln2485">                 &quot;%s: failed to wake up chip\n&quot;,</a>
<a name="ln2486">                 __func__);</a>
<a name="ln2487">    }</a>
<a name="ln2488"> </a>
<a name="ln2489">    ar9300_hw_detach(ah);</a>
<a name="ln2490">    ar9300_set_power_mode(ah, HAL_PM_FULL_SLEEP, AH_TRUE);</a>
<a name="ln2491"> </a>
<a name="ln2492">//    ath_hal_hdprintf_deregister(ah);</a>
<a name="ln2493"> </a>
<a name="ln2494">    if (AH9300(ah)-&gt;ah_cal_mem)</a>
<a name="ln2495">        ath_hal_free(AH9300(ah)-&gt;ah_cal_mem);</a>
<a name="ln2496">    AH9300(ah)-&gt;ah_cal_mem = AH_NULL;</a>
<a name="ln2497"> </a>
<a name="ln2498">    ath_hal_free(ah);</a>
<a name="ln2499">}</a>
<a name="ln2500"> </a>
<a name="ln2501">struct ath_hal_9300 *</a>
<a name="ln2502">ar9300_new_state(u_int16_t devid, HAL_SOFTC sc,</a>
<a name="ln2503">    HAL_BUS_TAG st, HAL_BUS_HANDLE sh,</a>
<a name="ln2504">    uint16_t *eepromdata,</a>
<a name="ln2505">    HAL_OPS_CONFIG *ah_config,</a>
<a name="ln2506">    HAL_STATUS *status)</a>
<a name="ln2507">{</a>
<a name="ln2508">    static const u_int8_t defbssidmask[IEEE80211_ADDR_LEN] =</a>
<a name="ln2509">        { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff };</a>
<a name="ln2510">    struct ath_hal_9300 *ahp;</a>
<a name="ln2511">    struct ath_hal *ah;</a>
<a name="ln2512"> </a>
<a name="ln2513">    /* NB: memory is returned zero'd */</a>
<a name="ln2514">    ahp = ath_hal_malloc(sizeof(struct ath_hal_9300));</a>
<a name="ln2515">    if (ahp == AH_NULL) {</a>
<a name="ln2516">        HALDEBUG(AH_NULL, HAL_DEBUG_UNMASKABLE,</a>
<a name="ln2517">                 &quot;%s: cannot allocate memory for state block\n&quot;,</a>
<a name="ln2518">                 __func__);</a>
<a name="ln2519">        *status = HAL_ENOMEM;</a>
<a name="ln2520">        return AH_NULL;</a>
<a name="ln2521">    }</a>
<a name="ln2522"> </a>
<a name="ln2523">    ah = &amp;ahp-&gt;ah_priv.h;</a>
<a name="ln2524">    /* set initial values */</a>
<a name="ln2525"> </a>
<a name="ln2526">    /* stub everything first */</a>
<a name="ln2527">    ar9300_set_stub_functions(ah);</a>
<a name="ln2528"> </a>
<a name="ln2529">    /* setup the FreeBSD HAL methods */</a>
<a name="ln2530">    ar9300_attach_freebsd_ops(ah);</a>
<a name="ln2531"> </a>
<a name="ln2532">    /* These are private to this particular file, so .. */</a>
<a name="ln2533">    ah-&gt;ah_disablePCIE = ar9300_disable_pcie_phy;</a>
<a name="ln2534">    AH_PRIVATE(ah)-&gt;ah_getNfAdjust = ar9300_get_nf_adjust;</a>
<a name="ln2535">    AH_PRIVATE(ah)-&gt;ah_getChipPowerLimits = ar9300_get_chip_power_limits;</a>
<a name="ln2536"> </a>
<a name="ln2537">#if 0</a>
<a name="ln2538">    /* Attach Osprey structure as default hal structure */</a>
<a name="ln2539">    OS_MEMCPY(&amp;ahp-&gt;ah_priv.priv, &amp;ar9300hal, sizeof(ahp-&gt;ah_priv.priv));</a>
<a name="ln2540">#endif</a>
<a name="ln2541"> </a>
<a name="ln2542">#if 0</a>
<a name="ln2543">    AH_PRIVATE(ah)-&gt;amem_handle = amem_handle;</a>
<a name="ln2544">    AH_PRIVATE(ah)-&gt;ah_osdev = osdev;</a>
<a name="ln2545">#endif</a>
<a name="ln2546">    ah-&gt;ah_sc = sc;</a>
<a name="ln2547">    ah-&gt;ah_st = st;</a>
<a name="ln2548">    ah-&gt;ah_sh = sh;</a>
<a name="ln2549">    ah-&gt;ah_magic = AR9300_MAGIC;</a>
<a name="ln2550">    AH_PRIVATE(ah)-&gt;ah_devid = devid;</a>
<a name="ln2551"> </a>
<a name="ln2552">    AH_PRIVATE(ah)-&gt;ah_flags = 0;</a>
<a name="ln2553">   </a>
<a name="ln2554">    /*</a>
<a name="ln2555">    ** Initialize factory defaults in the private space</a>
<a name="ln2556">    */</a>
<a name="ln2557">//    ath_hal_factory_defaults(AH_PRIVATE(ah), hal_conf_parm);</a>
<a name="ln2558">    ar9300_config_defaults_freebsd(ah, ah_config);</a>
<a name="ln2559"> </a>
<a name="ln2560">    /* XXX FreeBSD: cal is always in EEPROM */</a>
<a name="ln2561">#if 0</a>
<a name="ln2562">    if (!hal_conf_parm-&gt;calInFlash) {</a>
<a name="ln2563">        AH_PRIVATE(ah)-&gt;ah_flags |= AH_USE_EEPROM;</a>
<a name="ln2564">    }</a>
<a name="ln2565">#endif</a>
<a name="ln2566">    AH_PRIVATE(ah)-&gt;ah_flags |= AH_USE_EEPROM;</a>
<a name="ln2567">   </a>
<a name="ln2568">#if 0</a>
<a name="ln2569">    if (ar9300_eep_data_in_flash(ah)) {</a>
<a name="ln2570">        ahp-&gt;ah_priv.priv.ah_eeprom_read  = ar9300_flash_read;</a>
<a name="ln2571">        ahp-&gt;ah_priv.priv.ah_eeprom_dump  = AH_NULL;</a>
<a name="ln2572">    } else {</a>
<a name="ln2573">        ahp-&gt;ah_priv.priv.ah_eeprom_read  = ar9300_eeprom_read_word;</a>
<a name="ln2574">    }</a>
<a name="ln2575">#endif</a>
<a name="ln2576"> </a>
<a name="ln2577">    /* XXX FreeBSD - for now, just supports EEPROM reading */</a>
<a name="ln2578">    ahp-&gt;ah_priv.ah_eepromRead = ar9300_eeprom_read_word;</a>
<a name="ln2579"> </a>
<a name="ln2580">    AH_PRIVATE(ah)-&gt;ah_powerLimit = MAX_RATE_POWER;</a>
<a name="ln2581">    AH_PRIVATE(ah)-&gt;ah_tpScale = HAL_TP_SCALE_MAX;  /* no scaling */</a>
<a name="ln2582"> </a>
<a name="ln2583">    ahp-&gt;ah_atim_window = 0;         /* [0..1000] */</a>
<a name="ln2584"> </a>
<a name="ln2585">    ahp-&gt;ah_diversity_control =</a>
<a name="ln2586">        ah-&gt;ah_config.ath_hal_diversity_control;</a>
<a name="ln2587">    ahp-&gt;ah_antenna_switch_swap =</a>
<a name="ln2588">        ah-&gt;ah_config.ath_hal_antenna_switch_swap;</a>
<a name="ln2589"> </a>
<a name="ln2590">    /*</a>
<a name="ln2591">     * Enable MIC handling.</a>
<a name="ln2592">     */</a>
<a name="ln2593">    ahp-&gt;ah_sta_id1_defaults = AR_STA_ID1_CRPT_MIC_ENABLE;</a>
<a name="ln2594">    ahp-&gt;ah_enable32k_hz_clock = DONT_USE_32KHZ;/* XXX */</a>
<a name="ln2595">    ahp-&gt;ah_slot_time = (u_int) -1;</a>
<a name="ln2596">    ahp-&gt;ah_ack_timeout = (u_int) -1;</a>
<a name="ln2597">    OS_MEMCPY(&amp;ahp-&gt;ah_bssid_mask, defbssidmask, IEEE80211_ADDR_LEN);</a>
<a name="ln2598"> </a>
<a name="ln2599">    /*</a>
<a name="ln2600">     * 11g-specific stuff</a>
<a name="ln2601">     */</a>
<a name="ln2602">    ahp-&gt;ah_g_beacon_rate = 0;        /* adhoc beacon fixed rate */</a>
<a name="ln2603"> </a>
<a name="ln2604">    /* SM power mode: Attach time, disable any setting */</a>
<a name="ln2605">    ahp-&gt;ah_sm_power_mode = HAL_SMPS_DEFAULT;</a>
<a name="ln2606"> </a>
<a name="ln2607">    return ahp;</a>
<a name="ln2608">}</a>
<a name="ln2609"> </a>
<a name="ln2610">HAL_BOOL</a>
<a name="ln2611">ar9300_chip_test(struct ath_hal *ah)</a>
<a name="ln2612">{</a>
<a name="ln2613">    /*u_int32_t reg_addr[2] = { AR_STA_ID0, AR_PHY_BASE+(8 &lt;&lt; 2) };*/</a>
<a name="ln2614">    u_int32_t reg_addr[2] = { AR_STA_ID0 };</a>
<a name="ln2615">    u_int32_t reg_hold[2];</a>
<a name="ln2616">    u_int32_t pattern_data[4] =</a>
<a name="ln2617">        { 0x55555555, 0xaaaaaaaa, 0x66666666, 0x99999999 };</a>
<a name="ln2618">    int i, j;</a>
<a name="ln2619"> </a>
<a name="ln2620">    /* Test PHY &amp; MAC registers */</a>
<a name="ln2621">    for (i = 0; i &lt; 1; i++) {</a>
<a name="ln2622">        u_int32_t addr = reg_addr[i];</a>
<a name="ln2623">        u_int32_t wr_data, rd_data;</a>
<a name="ln2624"> </a>
<a name="ln2625">        reg_hold[i] = OS_REG_READ(ah, addr);</a>
<a name="ln2626">        for (j = 0; j &lt; 0x100; j++) {</a>
<a name="ln2627">            wr_data = (j &lt;&lt; 16) | j;</a>
<a name="ln2628">            OS_REG_WRITE(ah, addr, wr_data);</a>
<a name="ln2629">            rd_data = OS_REG_READ(ah, addr);</a>
<a name="ln2630">            if (rd_data != wr_data) {</a>
<a name="ln2631">                HALDEBUG(ah, HAL_DEBUG_REGIO,</a>
<a name="ln2632">                    &quot;%s: address test failed addr: &quot;</a>
<a name="ln2633">                    &quot;0x%08x - wr:0x%08x != rd:0x%08x\n&quot;,</a>
<a name="ln2634">                    __func__, addr, wr_data, rd_data);</a>
<a name="ln2635">                return AH_FALSE;</a>
<a name="ln2636">            }</a>
<a name="ln2637">        }</a>
<a name="ln2638">        for (j = 0; j &lt; 4; j++) {</a>
<a name="ln2639">            wr_data = pattern_data[j];</a>
<a name="ln2640">            OS_REG_WRITE(ah, addr, wr_data);</a>
<a name="ln2641">            rd_data = OS_REG_READ(ah, addr);</a>
<a name="ln2642">            if (wr_data != rd_data) {</a>
<a name="ln2643">                HALDEBUG(ah, HAL_DEBUG_REGIO,</a>
<a name="ln2644">                    &quot;%s: address test failed addr: &quot;</a>
<a name="ln2645">                    &quot;0x%08x - wr:0x%08x != rd:0x%08x\n&quot;,</a>
<a name="ln2646">                    __func__, addr, wr_data, rd_data);</a>
<a name="ln2647">                return AH_FALSE;</a>
<a name="ln2648">            }</a>
<a name="ln2649">        }</a>
<a name="ln2650">        OS_REG_WRITE(ah, reg_addr[i], reg_hold[i]);</a>
<a name="ln2651">    }</a>
<a name="ln2652">    OS_DELAY(100);</a>
<a name="ln2653">    return AH_TRUE;</a>
<a name="ln2654">}</a>
<a name="ln2655"> </a>
<a name="ln2656">/*</a>
<a name="ln2657"> * Store the channel edges for the requested operational mode</a>
<a name="ln2658"> */</a>
<a name="ln2659">HAL_BOOL</a>
<a name="ln2660">ar9300_get_channel_edges(struct ath_hal *ah,</a>
<a name="ln2661">    u_int16_t flags, u_int16_t *low, u_int16_t *high)</a>
<a name="ln2662">{</a>
<a name="ln2663">    struct ath_hal_private *ahpriv = AH_PRIVATE(ah);</a>
<a name="ln2664">    HAL_CAPABILITIES *p_cap = &amp;ahpriv-&gt;ah_caps;</a>
<a name="ln2665"> </a>
<a name="ln2666">    if (flags &amp; IEEE80211_CHAN_5GHZ) {</a>
<a name="ln2667">        *low = p_cap-&gt;halLow5GhzChan;</a>
<a name="ln2668">        *high = p_cap-&gt;halHigh5GhzChan;</a>
<a name="ln2669">        return AH_TRUE;</a>
<a name="ln2670">    }</a>
<a name="ln2671">    if ((flags &amp; IEEE80211_CHAN_2GHZ)) {</a>
<a name="ln2672">        *low = p_cap-&gt;halLow2GhzChan;</a>
<a name="ln2673">        *high = p_cap-&gt;halHigh2GhzChan;</a>
<a name="ln2674"> </a>
<a name="ln2675">        return AH_TRUE;</a>
<a name="ln2676">    }</a>
<a name="ln2677">    return AH_FALSE;</a>
<a name="ln2678">}</a>
<a name="ln2679"> </a>
<a name="ln2680">HAL_BOOL</a>
<a name="ln2681">ar9300_regulatory_domain_override(struct ath_hal *ah, u_int16_t regdmn)</a>
<a name="ln2682">{</a>
<a name="ln2683">    AH_PRIVATE(ah)-&gt;ah_currentRD = regdmn;</a>
<a name="ln2684">    return AH_TRUE;</a>
<a name="ln2685">}</a>
<a name="ln2686"> </a>
<a name="ln2687">/*</a>
<a name="ln2688"> * Fill all software cached or static hardware state information.</a>
<a name="ln2689"> * Return failure if capabilities are to come from EEPROM and</a>
<a name="ln2690"> * cannot be read.</a>
<a name="ln2691"> */</a>
<a name="ln2692">HAL_BOOL</a>
<a name="ln2693">ar9300_fill_capability_info(struct ath_hal *ah)</a>
<a name="ln2694">{</a>
<a name="ln2695">#define AR_KEYTABLE_SIZE    128</a>
<a name="ln2696">    struct ath_hal_9300 *ahp = AH9300(ah);</a>
<a name="ln2697">    struct ath_hal_private *ahpriv = AH_PRIVATE(ah);</a>
<a name="ln2698">    HAL_CAPABILITIES *p_cap = &amp;ahpriv-&gt;ah_caps;</a>
<a name="ln2699">    u_int16_t cap_field = 0, eeval;</a>
<a name="ln2700"> </a>
<a name="ln2701">    ahpriv-&gt;ah_devType = (u_int16_t)ar9300_eeprom_get(ahp, EEP_DEV_TYPE);</a>
<a name="ln2702">    eeval = ar9300_eeprom_get(ahp, EEP_REG_0);</a>
<a name="ln2703"> </a>
<a name="ln2704">    /* XXX record serial number */</a>
<a name="ln2705">    AH_PRIVATE(ah)-&gt;ah_currentRD = eeval;</a>
<a name="ln2706"> </a>
<a name="ln2707">    /* Always enable fast clock; leave it up to EEPROM and channel */</a>
<a name="ln2708">    p_cap-&gt;halSupportsFastClock5GHz = AH_TRUE;</a>
<a name="ln2709"> </a>
<a name="ln2710">    p_cap-&gt;halIntrMitigation = AH_TRUE;</a>
<a name="ln2711">    eeval = ar9300_eeprom_get(ahp, EEP_REG_1);</a>
<a name="ln2712">    AH_PRIVATE(ah)-&gt;ah_currentRDext = eeval | AR9300_RDEXT_DEFAULT;</a>
<a name="ln2713"> </a>
<a name="ln2714">    /* Read the capability EEPROM location */</a>
<a name="ln2715">    cap_field = ar9300_eeprom_get(ahp, EEP_OP_CAP);</a>
<a name="ln2716"> </a>
<a name="ln2717">    /* Construct wireless mode from EEPROM */</a>
<a name="ln2718">    p_cap-&gt;halWirelessModes = 0;</a>
<a name="ln2719">    eeval = ar9300_eeprom_get(ahp, EEP_OP_MODE);</a>
<a name="ln2720"> </a>
<a name="ln2721">    /*</a>
<a name="ln2722">     * XXX FreeBSD specific: for now, set ath_hal_ht_enable to 1,</a>
<a name="ln2723">     * or we won't have 11n support.</a>
<a name="ln2724">     */</a>
<a name="ln2725">    ah-&gt;ah_config.ath_hal_ht_enable = 1;</a>
<a name="ln2726"> </a>
<a name="ln2727">    if (eeval &amp; AR9300_OPFLAGS_11A) {</a>
<a name="ln2728">        p_cap-&gt;halWirelessModes |= HAL_MODE_11A |</a>
<a name="ln2729">            ((!ah-&gt;ah_config.ath_hal_ht_enable ||</a>
<a name="ln2730">              (eeval &amp; AR9300_OPFLAGS_N_5G_HT20)) ?  0 :</a>
<a name="ln2731">             (HAL_MODE_11NA_HT20 | ((eeval &amp; AR9300_OPFLAGS_N_5G_HT40) ? 0 :</a>
<a name="ln2732">                                    (HAL_MODE_11NA_HT40PLUS | HAL_MODE_11NA_HT40MINUS))));</a>
<a name="ln2733">    }</a>
<a name="ln2734">    if (eeval &amp; AR9300_OPFLAGS_11G) {</a>
<a name="ln2735">        p_cap-&gt;halWirelessModes |= HAL_MODE_11B | HAL_MODE_11G |</a>
<a name="ln2736">            ((!ah-&gt;ah_config.ath_hal_ht_enable ||</a>
<a name="ln2737">              (eeval &amp; AR9300_OPFLAGS_N_2G_HT20)) ?  0 :</a>
<a name="ln2738">             (HAL_MODE_11NG_HT20 | ((eeval &amp; AR9300_OPFLAGS_N_2G_HT40) ? 0 :</a>
<a name="ln2739">                                    (HAL_MODE_11NG_HT40PLUS | HAL_MODE_11NG_HT40MINUS))));</a>
<a name="ln2740">    }</a>
<a name="ln2741"> </a>
<a name="ln2742">    /* Get chainamsks from eeprom */</a>
<a name="ln2743">    p_cap-&gt;halTxChainMask = ar9300_eeprom_get(ahp, EEP_TX_MASK);</a>
<a name="ln2744">    p_cap-&gt;halRxChainMask = ar9300_eeprom_get(ahp, EEP_RX_MASK);</a>
<a name="ln2745"> </a>
<a name="ln2746"> </a>
<a name="ln2747"> </a>
<a name="ln2748">#define owl_get_ntxchains(_txchainmask) \</a>
<a name="ln2749">    (((_txchainmask &gt;&gt; 2) &amp; 1) + ((_txchainmask &gt;&gt; 1) &amp; 1) + (_txchainmask &amp; 1))</a>
<a name="ln2750"> </a>
<a name="ln2751">    /* FreeBSD: Update number of TX/RX streams */</a>
<a name="ln2752">    p_cap-&gt;halTxStreams = owl_get_ntxchains(p_cap-&gt;halTxChainMask);</a>
<a name="ln2753">    p_cap-&gt;halRxStreams = owl_get_ntxchains(p_cap-&gt;halRxChainMask);</a>
<a name="ln2754"> </a>
<a name="ln2755"> </a>
<a name="ln2756">    /*</a>
<a name="ln2757">     * This being a newer chip supports TKIP non-splitmic mode.</a>
<a name="ln2758">     *</a>
<a name="ln2759">     */</a>
<a name="ln2760">    ahp-&gt;ah_misc_mode |= AR_PCU_MIC_NEW_LOC_ENA;</a>
<a name="ln2761">    p_cap-&gt;halTkipMicTxRxKeySupport = AH_TRUE;</a>
<a name="ln2762"> </a>
<a name="ln2763">    p_cap-&gt;halLow2GhzChan = 2312;</a>
<a name="ln2764">    p_cap-&gt;halHigh2GhzChan = 2732;</a>
<a name="ln2765"> </a>
<a name="ln2766">    p_cap-&gt;halLow5GhzChan = 4920;</a>
<a name="ln2767">    p_cap-&gt;halHigh5GhzChan = 6100;</a>
<a name="ln2768"> </a>
<a name="ln2769">    p_cap-&gt;halCipherCkipSupport = AH_FALSE;</a>
<a name="ln2770">    p_cap-&gt;halCipherTkipSupport = AH_TRUE;</a>
<a name="ln2771">    p_cap-&gt;halCipherAesCcmSupport = AH_TRUE;</a>
<a name="ln2772"> </a>
<a name="ln2773">    p_cap-&gt;halMicCkipSupport = AH_FALSE;</a>
<a name="ln2774">    p_cap-&gt;halMicTkipSupport = AH_TRUE;</a>
<a name="ln2775">    p_cap-&gt;halMicAesCcmSupport = AH_TRUE;</a>
<a name="ln2776"> </a>
<a name="ln2777">    p_cap-&gt;halChanSpreadSupport = AH_TRUE;</a>
<a name="ln2778">    p_cap-&gt;halSleepAfterBeaconBroken = AH_TRUE;</a>
<a name="ln2779"> </a>
<a name="ln2780">    p_cap-&gt;halBurstSupport = AH_TRUE;</a>
<a name="ln2781">    p_cap-&gt;halChapTuningSupport = AH_TRUE;</a>
<a name="ln2782">    p_cap-&gt;halTurboPrimeSupport = AH_TRUE;</a>
<a name="ln2783">    p_cap-&gt;halFastFramesSupport = AH_TRUE;</a>
<a name="ln2784"> </a>
<a name="ln2785">    p_cap-&gt;halTurboGSupport = p_cap-&gt;halWirelessModes &amp; HAL_MODE_108G;</a>
<a name="ln2786"> </a>
<a name="ln2787">//    p_cap-&gt;hal_xr_support = AH_FALSE;</a>
<a name="ln2788"> </a>
<a name="ln2789">    p_cap-&gt;halHTSupport =</a>
<a name="ln2790">        ah-&gt;ah_config.ath_hal_ht_enable ?  AH_TRUE : AH_FALSE;</a>
<a name="ln2791"> </a>
<a name="ln2792">    p_cap-&gt;halGTTSupport = AH_TRUE;</a>
<a name="ln2793">    p_cap-&gt;halPSPollBroken = AH_TRUE;    /* XXX fixed in later revs? */</a>
<a name="ln2794">    p_cap-&gt;halNumMRRetries = 4;		/* Hardware supports 4 MRR */</a>
<a name="ln2795">    p_cap-&gt;halHTSGI20Support = AH_TRUE;</a>
<a name="ln2796">    p_cap-&gt;halVEOLSupport = AH_TRUE;</a>
<a name="ln2797">    p_cap-&gt;halBssIdMaskSupport = AH_TRUE;</a>
<a name="ln2798">    /* Bug 26802, fixed in later revs? */</a>
<a name="ln2799">    p_cap-&gt;halMcastKeySrchSupport = AH_TRUE;</a>
<a name="ln2800">    p_cap-&gt;halTsfAddSupport = AH_TRUE;</a>
<a name="ln2801"> </a>
<a name="ln2802">    if (cap_field &amp; AR_EEPROM_EEPCAP_MAXQCU) {</a>
<a name="ln2803">        p_cap-&gt;halTotalQueues = MS(cap_field, AR_EEPROM_EEPCAP_MAXQCU);</a>
<a name="ln2804">    } else {</a>
<a name="ln2805">        p_cap-&gt;halTotalQueues = HAL_NUM_TX_QUEUES;</a>
<a name="ln2806">    }</a>
<a name="ln2807"> </a>
<a name="ln2808">    if (cap_field &amp; AR_EEPROM_EEPCAP_KC_ENTRIES) {</a>
<a name="ln2809">        p_cap-&gt;halKeyCacheSize =</a>
<a name="ln2810">            1 &lt;&lt; MS(cap_field, AR_EEPROM_EEPCAP_KC_ENTRIES);</a>
<a name="ln2811">    } else {</a>
<a name="ln2812">        p_cap-&gt;halKeyCacheSize = AR_KEYTABLE_SIZE;</a>
<a name="ln2813">    }</a>
<a name="ln2814">    p_cap-&gt;halFastCCSupport = AH_TRUE;</a>
<a name="ln2815">//    p_cap-&gt;hal_num_mr_retries = 4;</a>
<a name="ln2816">//    ahp-&gt;hal_tx_trig_level_max = MAX_TX_FIFO_THRESHOLD;</a>
<a name="ln2817"> </a>
<a name="ln2818">    p_cap-&gt;halNumGpioPins = AR9382_MAX_GPIO_PIN_NUM;</a>
<a name="ln2819"> </a>
<a name="ln2820">#if 0</a>
<a name="ln2821">    /* XXX Verify support in Osprey */</a>
<a name="ln2822">    if (AR_SREV_MERLIN_10_OR_LATER(ah)) {</a>
<a name="ln2823">        p_cap-&gt;halWowSupport = AH_TRUE;</a>
<a name="ln2824">        p_cap-&gt;hal_wow_match_pattern_exact = AH_TRUE;</a>
<a name="ln2825">        if (AR_SREV_MERLIN(ah)) {</a>
<a name="ln2826">            p_cap-&gt;hal_wow_pattern_match_dword = AH_TRUE;</a>
<a name="ln2827">        }</a>
<a name="ln2828">    } else {</a>
<a name="ln2829">        p_cap-&gt;halWowSupport = AH_FALSE;</a>
<a name="ln2830">        p_cap-&gt;hal_wow_match_pattern_exact = AH_FALSE;</a>
<a name="ln2831">    }</a>
<a name="ln2832">#endif</a>
<a name="ln2833">    p_cap-&gt;halWowSupport = AH_TRUE;</a>
<a name="ln2834">    p_cap-&gt;halWowMatchPatternExact = AH_TRUE;</a>
<a name="ln2835">    if (AR_SREV_POSEIDON(ah)) {</a>
<a name="ln2836">        p_cap-&gt;halWowMatchPatternExact = AH_TRUE;</a>
<a name="ln2837">    }</a>
<a name="ln2838"> </a>
<a name="ln2839">    p_cap-&gt;halCSTSupport = AH_TRUE;</a>
<a name="ln2840"> </a>
<a name="ln2841">    p_cap-&gt;halRifsRxSupport = AH_TRUE;</a>
<a name="ln2842">    p_cap-&gt;halRifsTxSupport = AH_TRUE;</a>
<a name="ln2843"> </a>
<a name="ln2844">#define	IEEE80211_AMPDU_LIMIT_MAX (65536)</a>
<a name="ln2845">    p_cap-&gt;halRtsAggrLimit = IEEE80211_AMPDU_LIMIT_MAX;</a>
<a name="ln2846">#undef IEEE80211_AMPDU_LIMIT_MAX</a>
<a name="ln2847"> </a>
<a name="ln2848">    p_cap-&gt;halMfpSupport = ah-&gt;ah_config.ath_hal_mfp_support;</a>
<a name="ln2849"> </a>
<a name="ln2850">    p_cap-&gt;halForcePpmSupport = AH_TRUE;</a>
<a name="ln2851">    p_cap-&gt;halHwBeaconProcSupport = AH_TRUE;</a>
<a name="ln2852">    </a>
<a name="ln2853">    /* ar9300 - has the HW UAPSD trigger support,</a>
<a name="ln2854">     * but it has the following limitations</a>
<a name="ln2855">     * The power state change from the following</a>
<a name="ln2856">     * frames are not put in High priority queue.</a>
<a name="ln2857">     *     i) Mgmt frames</a>
<a name="ln2858">     *     ii) NoN QoS frames</a>
<a name="ln2859">     *     iii) QoS frames form the access categories for which</a>
<a name="ln2860">     *          UAPSD is not enabled.</a>
<a name="ln2861">     * so we can not enable this feature currently.</a>
<a name="ln2862">     * could be enabled, if these limitations are fixed</a>
<a name="ln2863">     * in later versions of ar9300 chips</a>
<a name="ln2864">     */</a>
<a name="ln2865">    p_cap-&gt;halHasUapsdSupport = AH_FALSE;</a>
<a name="ln2866"> </a>
<a name="ln2867">    /* Number of buffers that can be help in a single TxD */</a>
<a name="ln2868">    p_cap-&gt;halNumTxMaps = 4;</a>
<a name="ln2869"> </a>
<a name="ln2870">    p_cap-&gt;halTxDescLen = sizeof(struct ar9300_txc);</a>
<a name="ln2871">    p_cap-&gt;halTxStatusLen = sizeof(struct ar9300_txs);</a>
<a name="ln2872">    p_cap-&gt;halRxStatusLen = sizeof(struct ar9300_rxs);</a>
<a name="ln2873"> </a>
<a name="ln2874">    p_cap-&gt;halRxHpFifoDepth = HAL_HP_RXFIFO_DEPTH;</a>
<a name="ln2875">    p_cap-&gt;halRxLpFifoDepth = HAL_LP_RXFIFO_DEPTH;</a>
<a name="ln2876"> </a>
<a name="ln2877">    /* Enable extension channel DFS support */</a>
<a name="ln2878">    p_cap-&gt;halUseCombinedRadarRssi = AH_TRUE;</a>
<a name="ln2879">    p_cap-&gt;halExtChanDfsSupport = AH_TRUE;</a>
<a name="ln2880">#if ATH_SUPPORT_SPECTRAL</a>
<a name="ln2881">    p_cap-&gt;halSpectralScanSupport = AH_TRUE;</a>
<a name="ln2882">#endif</a>
<a name="ln2883">    ahpriv-&gt;ah_rfsilent = ar9300_eeprom_get(ahp, EEP_RF_SILENT);</a>
<a name="ln2884">    if (ahpriv-&gt;ah_rfsilent &amp; EEP_RFSILENT_ENABLED) {</a>
<a name="ln2885">        ahp-&gt;ah_gpio_select = MS(ahpriv-&gt;ah_rfsilent, EEP_RFSILENT_GPIO_SEL);</a>
<a name="ln2886">        ahp-&gt;ah_polarity   = MS(ahpriv-&gt;ah_rfsilent, EEP_RFSILENT_POLARITY);</a>
<a name="ln2887"> </a>
<a name="ln2888">        ath_hal_enable_rfkill(ah, AH_TRUE);</a>
<a name="ln2889">        p_cap-&gt;halRfSilentSupport = AH_TRUE;</a>
<a name="ln2890">    }</a>
<a name="ln2891"> </a>
<a name="ln2892">    /* XXX */</a>
<a name="ln2893">    p_cap-&gt;halWpsPushButtonSupport = AH_FALSE;</a>
<a name="ln2894"> </a>
<a name="ln2895">#ifdef ATH_BT_COEX</a>
<a name="ln2896">    p_cap-&gt;halBtCoexSupport = AH_TRUE;</a>
<a name="ln2897">    p_cap-&gt;halBtCoexApsmWar = AH_FALSE;</a>
<a name="ln2898">#endif</a>
<a name="ln2899"> </a>
<a name="ln2900">    p_cap-&gt;halGenTimerSupport = AH_TRUE;</a>
<a name="ln2901">    ahp-&gt;ah_avail_gen_timers = ~((1 &lt;&lt; AR_FIRST_NDP_TIMER) - 1);</a>
<a name="ln2902">    ahp-&gt;ah_avail_gen_timers &amp;= (1 &lt;&lt; AR_NUM_GEN_TIMERS) - 1;</a>
<a name="ln2903">    /*</a>
<a name="ln2904">     * According to Kyungwan, generic timer 0 and 8 are special</a>
<a name="ln2905">     * timers. Remove timer 8 from the available gen timer list.</a>
<a name="ln2906">     * Jupiter testing shows timer won't trigger with timer 8.</a>
<a name="ln2907">     */</a>
<a name="ln2908">    ahp-&gt;ah_avail_gen_timers &amp;= ~(1 &lt;&lt; AR_GEN_TIMER_RESERVED);</a>
<a name="ln2909"> </a>
<a name="ln2910">    if (AR_SREV_JUPITER(ah) || AR_SREV_APHRODITE(ah)) {</a>
<a name="ln2911">#if ATH_SUPPORT_MCI</a>
<a name="ln2912">        if (ah-&gt;ah_config.ath_hal_mci_config &amp; ATH_MCI_CONFIG_DISABLE_MCI) </a>
<a name="ln2913">        {</a>
<a name="ln2914">            p_cap-&gt;halMciSupport = AH_FALSE;</a>
<a name="ln2915">        }</a>
<a name="ln2916">        else</a>
<a name="ln2917">#endif</a>
<a name="ln2918">        {</a>
<a name="ln2919">            p_cap-&gt;halMciSupport = (ahp-&gt;ah_enterprise_mode &amp; </a>
<a name="ln2920">                            AR_ENT_OTP_49GHZ_DISABLE) ? AH_FALSE: AH_TRUE;</a>
<a name="ln2921">        }</a>
<a name="ln2922">        HALDEBUG(AH_NULL, HAL_DEBUG_UNMASKABLE,</a>
<a name="ln2923">                 &quot;%s: (MCI) MCI support = %d\n&quot;,</a>
<a name="ln2924">                 __func__, p_cap-&gt;halMciSupport);</a>
<a name="ln2925">    }</a>
<a name="ln2926">    else {</a>
<a name="ln2927">        p_cap-&gt;halMciSupport = AH_FALSE;</a>
<a name="ln2928">    }</a>
<a name="ln2929"> </a>
<a name="ln2930">    /* XXX TODO: jupiter 2.1? */</a>
<a name="ln2931">    if (AR_SREV_JUPITER_20(ah)) {</a>
<a name="ln2932">        p_cap-&gt;halRadioRetentionSupport = AH_TRUE;</a>
<a name="ln2933">    } else {</a>
<a name="ln2934">        p_cap-&gt;halRadioRetentionSupport = AH_FALSE;</a>
<a name="ln2935">    }</a>
<a name="ln2936"> </a>
<a name="ln2937">    p_cap-&gt;halAutoSleepSupport = AH_TRUE;</a>
<a name="ln2938"> </a>
<a name="ln2939">    p_cap-&gt;halMbssidAggrSupport = AH_TRUE;</a>
<a name="ln2940">//    p_cap-&gt;hal_proxy_sta_support = AH_TRUE;</a>
<a name="ln2941"> </a>
<a name="ln2942">    /* XXX Mark it true after it is verfied as fixed */</a>
<a name="ln2943">    p_cap-&gt;hal4kbSplitTransSupport = AH_FALSE;</a>
<a name="ln2944"> </a>
<a name="ln2945">    /* Read regulatory domain flag */</a>
<a name="ln2946">    if (AH_PRIVATE(ah)-&gt;ah_currentRDext &amp; (1 &lt;&lt; REG_EXT_JAPAN_MIDBAND)) {</a>
<a name="ln2947">        /*</a>
<a name="ln2948">         * If REG_EXT_JAPAN_MIDBAND is set, turn on U1 EVEN, U2, and MIDBAND.</a>
<a name="ln2949">         */</a>
<a name="ln2950">        p_cap-&gt;halRegCap =</a>
<a name="ln2951">            AR_EEPROM_EEREGCAP_EN_KK_NEW_11A |</a>
<a name="ln2952">            AR_EEPROM_EEREGCAP_EN_KK_U1_EVEN |</a>
<a name="ln2953">            AR_EEPROM_EEREGCAP_EN_KK_U2      |</a>
<a name="ln2954">            AR_EEPROM_EEREGCAP_EN_KK_MIDBAND;</a>
<a name="ln2955">    } else {</a>
<a name="ln2956">        p_cap-&gt;halRegCap =</a>
<a name="ln2957">            AR_EEPROM_EEREGCAP_EN_KK_NEW_11A | AR_EEPROM_EEREGCAP_EN_KK_U1_EVEN;</a>
<a name="ln2958">    }</a>
<a name="ln2959"> </a>
<a name="ln2960">    /* For AR9300 and above, midband channels are always supported */</a>
<a name="ln2961">    p_cap-&gt;halRegCap |= AR_EEPROM_EEREGCAP_EN_FCC_MIDBAND;</a>
<a name="ln2962"> </a>
<a name="ln2963">    p_cap-&gt;halNumAntCfg5GHz =</a>
<a name="ln2964">        ar9300_eeprom_get_num_ant_config(ahp, HAL_FREQ_BAND_5GHZ);</a>
<a name="ln2965">    p_cap-&gt;halNumAntCfg2GHz =</a>
<a name="ln2966">        ar9300_eeprom_get_num_ant_config(ahp, HAL_FREQ_BAND_2GHZ);</a>
<a name="ln2967"> </a>
<a name="ln2968">    /* STBC supported */</a>
<a name="ln2969">    p_cap-&gt;halRxStbcSupport = 1; /* number of streams for STBC recieve. */</a>
<a name="ln2970">    if (AR_SREV_HORNET(ah) || AR_SREV_POSEIDON(ah) || AR_SREV_APHRODITE(ah)) {</a>
<a name="ln2971">        p_cap-&gt;halTxStbcSupport = 0;</a>
<a name="ln2972">    } else {</a>
<a name="ln2973">        p_cap-&gt;halTxStbcSupport = 1;</a>
<a name="ln2974">    }</a>
<a name="ln2975"> </a>
<a name="ln2976">    p_cap-&gt;halEnhancedDmaSupport = AH_TRUE;</a>
<a name="ln2977">    p_cap-&gt;halEnhancedDfsSupport = AH_TRUE;</a>
<a name="ln2978"> </a>
<a name="ln2979">    /*</a>
<a name="ln2980">     *  EV61133 (missing interrupts due to AR_ISR_RAC).</a>
<a name="ln2981">     *  Fixed in Osprey 2.0.</a>
<a name="ln2982">     */</a>
<a name="ln2983">    p_cap-&gt;halIsrRacSupport = AH_TRUE;</a>
<a name="ln2984"> </a>
<a name="ln2985">    /* XXX FreeBSD won't support TKIP and WEP aggregation */</a>
<a name="ln2986">#if 0</a>
<a name="ln2987">    p_cap-&gt;hal_wep_tkip_aggr_support = AH_TRUE;</a>
<a name="ln2988">    p_cap-&gt;hal_wep_tkip_aggr_num_tx_delim = 10;    /* TBD */</a>
<a name="ln2989">    p_cap-&gt;hal_wep_tkip_aggr_num_rx_delim = 10;    /* TBD */</a>
<a name="ln2990">    p_cap-&gt;hal_wep_tkip_max_ht_rate = 15;         /* TBD */</a>
<a name="ln2991">#endif</a>
<a name="ln2992"> </a>
<a name="ln2993">    /*</a>
<a name="ln2994">     * XXX FreeBSD won't need these; but eventually add them</a>
<a name="ln2995">     * and add the WARs - AGGR extra delim WAR is useful to know</a>
<a name="ln2996">     * about.</a>
<a name="ln2997">     */</a>
<a name="ln2998">#if 0</a>
<a name="ln2999">    p_cap-&gt;hal_cfend_fix_support = AH_FALSE;</a>
<a name="ln3000">    p_cap-&gt;hal_aggr_extra_delim_war = AH_FALSE;</a>
<a name="ln3001">#endif</a>
<a name="ln3002">    p_cap-&gt;halTxTstampPrecision = 32;</a>
<a name="ln3003">    p_cap-&gt;halRxTstampPrecision = 32;</a>
<a name="ln3004">    p_cap-&gt;halRxTxAbortSupport = AH_TRUE;</a>
<a name="ln3005">    p_cap-&gt;hal_ani_poll_interval = AR9300_ANI_POLLINTERVAL;</a>
<a name="ln3006">    p_cap-&gt;hal_channel_switch_time_usec = AR9300_CHANNEL_SWITCH_TIME_USEC;</a>
<a name="ln3007">  </a>
<a name="ln3008">    /* Transmit Beamforming supported, fill capabilities */</a>
<a name="ln3009">    p_cap-&gt;halPaprdEnabled = ar9300_eeprom_get(ahp, EEP_PAPRD_ENABLED);</a>
<a name="ln3010">    p_cap-&gt;halChanHalfRate =</a>
<a name="ln3011">        !(ahp-&gt;ah_enterprise_mode &amp; AR_ENT_OTP_10MHZ_DISABLE);</a>
<a name="ln3012">    p_cap-&gt;halChanQuarterRate =</a>
<a name="ln3013">        !(ahp-&gt;ah_enterprise_mode &amp; AR_ENT_OTP_5MHZ_DISABLE);</a>
<a name="ln3014">	</a>
<a name="ln3015">    if(AR_SREV_JUPITER(ah) || AR_SREV_APHRODITE(ah)){</a>
<a name="ln3016">        /* There is no AR_ENT_OTP_49GHZ_DISABLE feature in Jupiter, now the bit is used to disable BT. */		</a>
<a name="ln3017">        p_cap-&gt;hal49GhzSupport = 1;</a>
<a name="ln3018">    } else {</a>
<a name="ln3019">        p_cap-&gt;hal49GhzSupport = !(ahp-&gt;ah_enterprise_mode &amp; AR_ENT_OTP_49GHZ_DISABLE);</a>
<a name="ln3020">    }</a>
<a name="ln3021"> </a>
<a name="ln3022">    if (AR_SREV_POSEIDON(ah) || AR_SREV_HORNET(ah) || AR_SREV_APHRODITE(ah)) {</a>
<a name="ln3023">        /* LDPC supported */</a>
<a name="ln3024">        /* Poseidon doesn't support LDPC, or it will cause receiver CRC Error */</a>
<a name="ln3025">        p_cap-&gt;halLDPCSupport = AH_FALSE;</a>
<a name="ln3026">        /* PCI_E LCR offset */</a>
<a name="ln3027">        if (AR_SREV_POSEIDON(ah)) {</a>
<a name="ln3028">            p_cap-&gt;hal_pcie_lcr_offset = 0x80; /*for Poseidon*/</a>
<a name="ln3029">        }</a>
<a name="ln3030">        /*WAR method for APSM L0s with Poseidon 1.0*/</a>
<a name="ln3031">        if (AR_SREV_POSEIDON_10(ah)) {</a>
<a name="ln3032">            p_cap-&gt;hal_pcie_lcr_extsync_en = AH_TRUE;</a>
<a name="ln3033">        }</a>
<a name="ln3034">    } else {</a>
<a name="ln3035">        p_cap-&gt;halLDPCSupport = AH_TRUE;</a>
<a name="ln3036">    }</a>
<a name="ln3037">    </a>
<a name="ln3038">    /* XXX is this a flag, or a chainmask number? */</a>
<a name="ln3039">    p_cap-&gt;halApmEnable = !! ar9300_eeprom_get(ahp, EEP_CHAIN_MASK_REDUCE);</a>
<a name="ln3040">#if ATH_ANT_DIV_COMB        </a>
<a name="ln3041">    if (AR_SREV_HORNET(ah) || AR_SREV_POSEIDON_11_OR_LATER(ah) || AR_SREV_APHRODITE(ah)) {</a>
<a name="ln3042">        if (ahp-&gt;ah_diversity_control == HAL_ANT_VARIABLE) {</a>
<a name="ln3043">            u_int8_t ant_div_control1 = </a>
<a name="ln3044">                ar9300_eeprom_get(ahp, EEP_ANTDIV_control);</a>
<a name="ln3045">            /* if enable_lnadiv is 0x1 and enable_fast_div is 0x1, </a>
<a name="ln3046">             * we enable the diversity-combining algorithm. </a>
<a name="ln3047">             */</a>
<a name="ln3048">            if ((ant_div_control1 &gt;&gt; 0x6) == 0x3) {</a>
<a name="ln3049">                p_cap-&gt;halAntDivCombSupport = AH_TRUE;</a>
<a name="ln3050">            }            </a>
<a name="ln3051">            p_cap-&gt;halAntDivCombSupportOrg = p_cap-&gt;halAntDivCombSupport;</a>
<a name="ln3052">        }</a>
<a name="ln3053">    }</a>
<a name="ln3054">#endif /* ATH_ANT_DIV_COMB */</a>
<a name="ln3055"> </a>
<a name="ln3056">    /*</a>
<a name="ln3057">     * FreeBSD: enable LNA mixing if the chip is Hornet or Poseidon.</a>
<a name="ln3058">     */</a>
<a name="ln3059">    if (AR_SREV_HORNET(ah) || AR_SREV_POSEIDON_11_OR_LATER(ah)) {</a>
<a name="ln3060">        p_cap-&gt;halRxUsingLnaMixing = AH_TRUE;</a>
<a name="ln3061">    }</a>
<a name="ln3062"> </a>
<a name="ln3063">    /*</a>
<a name="ln3064">     * AR5416 and later NICs support MYBEACON filtering.</a>
<a name="ln3065">     */</a>
<a name="ln3066">    p_cap-&gt;halRxDoMyBeacon = AH_TRUE;</a>
<a name="ln3067"> </a>
<a name="ln3068">#if ATH_WOW_OFFLOAD</a>
<a name="ln3069">    if (AR_SREV_JUPITER_20_OR_LATER(ah) || AR_SREV_APHRODITE(ah)) {</a>
<a name="ln3070">        p_cap-&gt;hal_wow_gtk_offload_support    = AH_TRUE;</a>
<a name="ln3071">        p_cap-&gt;hal_wow_arp_offload_support    = AH_TRUE;</a>
<a name="ln3072">        p_cap-&gt;hal_wow_ns_offload_support     = AH_TRUE;</a>
<a name="ln3073">        p_cap-&gt;hal_wow_4way_hs_wakeup_support = AH_TRUE;</a>
<a name="ln3074">        p_cap-&gt;hal_wow_acer_magic_support     = AH_TRUE;</a>
<a name="ln3075">        p_cap-&gt;hal_wow_acer_swka_support      = AH_TRUE;</a>
<a name="ln3076">    } else {</a>
<a name="ln3077">        p_cap-&gt;hal_wow_gtk_offload_support    = AH_FALSE;</a>
<a name="ln3078">        p_cap-&gt;hal_wow_arp_offload_support    = AH_FALSE;</a>
<a name="ln3079">        p_cap-&gt;hal_wow_ns_offload_support     = AH_FALSE;</a>
<a name="ln3080">        p_cap-&gt;hal_wow_4way_hs_wakeup_support = AH_FALSE;</a>
<a name="ln3081">        p_cap-&gt;hal_wow_acer_magic_support     = AH_FALSE;</a>
<a name="ln3082">        p_cap-&gt;hal_wow_acer_swka_support      = AH_FALSE;</a>
<a name="ln3083">    }</a>
<a name="ln3084">#endif /* ATH_WOW_OFFLOAD */</a>
<a name="ln3085"> </a>
<a name="ln3086"> </a>
<a name="ln3087">    return AH_TRUE;</a>
<a name="ln3088">#undef AR_KEYTABLE_SIZE</a>
<a name="ln3089">}</a>
<a name="ln3090"> </a>
<a name="ln3091">#if 0</a>
<a name="ln3092">static HAL_BOOL</a>
<a name="ln3093">ar9300_get_chip_power_limits(struct ath_hal *ah, HAL_CHANNEL *chans,</a>
<a name="ln3094">    u_int32_t nchans)</a>
<a name="ln3095">{</a>
<a name="ln3096">    struct ath_hal_9300 *ahp = AH9300(ah);</a>
<a name="ln3097"> </a>
<a name="ln3098">    return ahp-&gt;ah_rf_hal.get_chip_power_lim(ah, chans, nchans);</a>
<a name="ln3099">}</a>
<a name="ln3100">#endif</a>
<a name="ln3101">/* XXX FreeBSD */</a>
<a name="ln3102"> </a>
<a name="ln3103">static HAL_BOOL</a>
<a name="ln3104">ar9300_get_chip_power_limits(struct ath_hal *ah,</a>
<a name="ln3105">    struct ieee80211_channel *chan)</a>
<a name="ln3106">{</a>
<a name="ln3107"> </a>
<a name="ln3108">	chan-&gt;ic_maxpower = AR9300_MAX_RATE_POWER;</a>
<a name="ln3109">	chan-&gt;ic_minpower = 0;</a>
<a name="ln3110"> </a>
<a name="ln3111">	return AH_TRUE;</a>
<a name="ln3112">}</a>
<a name="ln3113"> </a>
<a name="ln3114">/*</a>
<a name="ln3115"> * Disable PLL when in L0s as well as receiver clock when in L1.</a>
<a name="ln3116"> * This power saving option must be enabled through the Serdes.</a>
<a name="ln3117"> *</a>
<a name="ln3118"> * Programming the Serdes must go through the same 288 bit serial shift</a>
<a name="ln3119"> * register as the other analog registers.  Hence the 9 writes.</a>
<a name="ln3120"> *</a>
<a name="ln3121"> * XXX Clean up the magic numbers.</a>
<a name="ln3122"> */</a>
<a name="ln3123">void</a>
<a name="ln3124">ar9300_config_pci_power_save(struct ath_hal *ah, int restore, int power_off)</a>
<a name="ln3125">{</a>
<a name="ln3126">    struct ath_hal_9300 *ahp = AH9300(ah);</a>
<a name="ln3127">    int i;</a>
<a name="ln3128"> </a>
<a name="ln3129">    if (AH_PRIVATE(ah)-&gt;ah_ispcie != AH_TRUE) {</a>
<a name="ln3130">        return;</a>
<a name="ln3131">    }</a>
<a name="ln3132"> </a>
<a name="ln3133">    /*</a>
<a name="ln3134">     * Increase L1 Entry Latency. Some WB222 boards don't have</a>
<a name="ln3135">     * this change in eeprom/OTP.</a>
<a name="ln3136">     */</a>
<a name="ln3137">    if (AR_SREV_JUPITER(ah)) {</a>
<a name="ln3138">        u_int32_t val = ah-&gt;ah_config.ath_hal_war70c;</a>
<a name="ln3139">        if ((val &amp; 0xff000000) == 0x17000000) {</a>
<a name="ln3140">            val &amp;= 0x00ffffff;</a>
<a name="ln3141">            val |= 0x27000000;</a>
<a name="ln3142">            OS_REG_WRITE(ah, 0x570c, val);</a>
<a name="ln3143">        }</a>
<a name="ln3144">    }</a>
<a name="ln3145"> </a>
<a name="ln3146">    /* Do not touch SERDES registers */</a>
<a name="ln3147">    if (ah-&gt;ah_config.ath_hal_pcie_power_save_enable == 2) {</a>
<a name="ln3148">        return;</a>
<a name="ln3149">    }</a>
<a name="ln3150"> </a>
<a name="ln3151">    /* Nothing to do on restore for 11N */</a>
<a name="ln3152">    if (!restore) {</a>
<a name="ln3153">        /* set bit 19 to allow forcing of pcie core into L1 state */</a>
<a name="ln3154">        OS_REG_SET_BIT(ah,</a>
<a name="ln3155">            AR_HOSTIF_REG(ah, AR_PCIE_PM_CTRL), AR_PCIE_PM_CTRL_ENA);</a>
<a name="ln3156"> </a>
<a name="ln3157">        /*</a>
<a name="ln3158">         * Set PCIE workaround config only if requested, else use the reset</a>
<a name="ln3159">         * value of this register.</a>
<a name="ln3160">         */</a>
<a name="ln3161">        if (ah-&gt;ah_config.ath_hal_pcie_waen) {</a>
<a name="ln3162">            OS_REG_WRITE(ah,</a>
<a name="ln3163">                AR_HOSTIF_REG(ah, AR_WA),</a>
<a name="ln3164">                ah-&gt;ah_config.ath_hal_pcie_waen);</a>
<a name="ln3165">        } else {</a>
<a name="ln3166">            /* Set Bits 17 and 14 in the AR_WA register. */</a>
<a name="ln3167">            OS_REG_WRITE(ah, AR_HOSTIF_REG(ah, AR_WA), ahp-&gt;ah_wa_reg_val);</a>
<a name="ln3168">        }</a>
<a name="ln3169">    }</a>
<a name="ln3170"> </a>
<a name="ln3171">    /* Configure PCIE after Ini init. SERDES values now come from ini file */</a>
<a name="ln3172">    if (ah-&gt;ah_config.ath_hal_pcie_ser_des_write) {</a>
<a name="ln3173">        if (power_off) {</a>
<a name="ln3174">            for (i = 0; i &lt; ahp-&gt;ah_ini_pcie_serdes.ia_rows; i++) {</a>
<a name="ln3175">                OS_REG_WRITE(ah,</a>
<a name="ln3176">                    INI_RA(&amp;ahp-&gt;ah_ini_pcie_serdes, i, 0),</a>
<a name="ln3177">                    INI_RA(&amp;ahp-&gt;ah_ini_pcie_serdes, i, 1));</a>
<a name="ln3178">            }</a>
<a name="ln3179">        } else {</a>
<a name="ln3180">            for (i = 0; i &lt; ahp-&gt;ah_ini_pcie_serdes_low_power.ia_rows; i++) {</a>
<a name="ln3181">                OS_REG_WRITE(ah,</a>
<a name="ln3182">                    INI_RA(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, i, 0),</a>
<a name="ln3183">                    INI_RA(&amp;ahp-&gt;ah_ini_pcie_serdes_low_power, i, 1));</a>
<a name="ln3184">            }</a>
<a name="ln3185">        }</a>
<a name="ln3186">    }</a>
<a name="ln3187"> </a>
<a name="ln3188">}</a>
<a name="ln3189"> </a>
<a name="ln3190">/*</a>
<a name="ln3191"> * Recipe from charles to turn off PCIe PHY in PCI mode for power savings</a>
<a name="ln3192"> */</a>
<a name="ln3193">void</a>
<a name="ln3194">ar9300_disable_pcie_phy(struct ath_hal *ah)</a>
<a name="ln3195">{</a>
<a name="ln3196">    /* Osprey does not support PCI mode */</a>
<a name="ln3197">}</a>
<a name="ln3198"> </a>
<a name="ln3199">static inline HAL_STATUS</a>
<a name="ln3200">ar9300_init_mac_addr(struct ath_hal *ah)</a>
<a name="ln3201">{</a>
<a name="ln3202">    u_int32_t sum;</a>
<a name="ln3203">    int i;</a>
<a name="ln3204">    u_int16_t eeval;</a>
<a name="ln3205">    struct ath_hal_9300 *ahp = AH9300(ah);</a>
<a name="ln3206">    u_int32_t EEP_MAC [] = { EEP_MAC_LSW, EEP_MAC_MID, EEP_MAC_MSW };</a>
<a name="ln3207"> </a>
<a name="ln3208">    sum = 0;</a>
<a name="ln3209">    for (i = 0; i &lt; 3; i++) {</a>
<a name="ln3210">        eeval = ar9300_eeprom_get(ahp, EEP_MAC[i]);</a>
<a name="ln3211">        sum += eeval;</a>
<a name="ln3212">        ahp-&gt;ah_macaddr[2*i] = eeval &gt;&gt; 8;</a>
<a name="ln3213">        ahp-&gt;ah_macaddr[2*i + 1] = eeval &amp; 0xff;</a>
<a name="ln3214">    }</a>
<a name="ln3215">    if (sum == 0 || sum == 0xffff*3) {</a>
<a name="ln3216">        HALDEBUG(ah, HAL_DEBUG_EEPROM, &quot;%s: mac address read failed: %s\n&quot;,</a>
<a name="ln3217">            __func__, ath_hal_ether_sprintf(ahp-&gt;ah_macaddr));</a>
<a name="ln3218">        return HAL_EEBADMAC;</a>
<a name="ln3219">    }</a>
<a name="ln3220"> </a>
<a name="ln3221">    return HAL_OK;</a>
<a name="ln3222">}</a>
<a name="ln3223"> </a>
<a name="ln3224">/*</a>
<a name="ln3225"> * Code for the &quot;real&quot; chip i.e. non-emulation. Review and revisit</a>
<a name="ln3226"> * when actual hardware is at hand.</a>
<a name="ln3227"> */</a>
<a name="ln3228">static inline HAL_STATUS</a>
<a name="ln3229">ar9300_hw_attach(struct ath_hal *ah)</a>
<a name="ln3230">{</a>
<a name="ln3231">    HAL_STATUS ecode;</a>
<a name="ln3232"> </a>
<a name="ln3233">    if (!ar9300_chip_test(ah)) {</a>
<a name="ln3234">        HALDEBUG(ah, HAL_DEBUG_REGIO,</a>
<a name="ln3235">            &quot;%s: hardware self-test failed\n&quot;, __func__);</a>
<a name="ln3236">        return HAL_ESELFTEST;</a>
<a name="ln3237">    }</a>
<a name="ln3238"> </a>
<a name="ln3239">#if 0</a>
<a name="ln3240">    ath_hal_printf(ah, &quot;%s: calling ar9300_eeprom_attach\n&quot;, __func__);</a>
<a name="ln3241">#endif</a>
<a name="ln3242">    ecode = ar9300_eeprom_attach(ah);</a>
<a name="ln3243">    ath_hal_printf(ah, &quot;%s: ar9300_eeprom_attach returned %d\n&quot;, __func__, ecode);</a>
<a name="ln3244">    if (ecode != HAL_OK) {</a>
<a name="ln3245">        return ecode;</a>
<a name="ln3246">    }</a>
<a name="ln3247">    if (!ar9300_rf_attach(ah, &amp;ecode)) {</a>
<a name="ln3248">        HALDEBUG(ah, HAL_DEBUG_RESET, &quot;%s: RF setup failed, status %u\n&quot;,</a>
<a name="ln3249">            __func__, ecode);</a>
<a name="ln3250">    }</a>
<a name="ln3251"> </a>
<a name="ln3252">    if (ecode != HAL_OK) {</a>
<a name="ln3253">        return ecode;</a>
<a name="ln3254">    }</a>
<a name="ln3255">    ar9300_ani_attach(ah);</a>
<a name="ln3256"> </a>
<a name="ln3257">    return HAL_OK;</a>
<a name="ln3258">}</a>
<a name="ln3259"> </a>
<a name="ln3260">static inline void</a>
<a name="ln3261">ar9300_hw_detach(struct ath_hal *ah)</a>
<a name="ln3262">{</a>
<a name="ln3263">    /* XXX EEPROM allocated state */</a>
<a name="ln3264">    ar9300_ani_detach(ah);</a>
<a name="ln3265">}</a>
<a name="ln3266"> </a>
<a name="ln3267">static int16_t</a>
<a name="ln3268">ar9300_get_nf_adjust(struct ath_hal *ah, const HAL_CHANNEL_INTERNAL *c)</a>
<a name="ln3269">{</a>
<a name="ln3270">    return 0;</a>
<a name="ln3271">}</a>
<a name="ln3272"> </a>
<a name="ln3273">void</a>
<a name="ln3274">ar9300_set_immunity(struct ath_hal *ah, HAL_BOOL enable)</a>
<a name="ln3275">{</a>
<a name="ln3276">    struct ath_hal_9300 *ahp = AH9300(ah);</a>
<a name="ln3277">    u_int32_t m1_thresh_low = enable ? 127 : ahp-&gt;ah_immunity_vals[0],</a>
<a name="ln3278">              m2_thresh_low = enable ? 127 : ahp-&gt;ah_immunity_vals[1],</a>
<a name="ln3279">              m1_thresh = enable ? 127 : ahp-&gt;ah_immunity_vals[2],</a>
<a name="ln3280">              m2_thresh = enable ? 127 : ahp-&gt;ah_immunity_vals[3],</a>
<a name="ln3281">              m2_count_thr = enable ? 31 : ahp-&gt;ah_immunity_vals[4],</a>
<a name="ln3282">              m2_count_thr_low = enable ? 63 : ahp-&gt;ah_immunity_vals[5];</a>
<a name="ln3283"> </a>
<a name="ln3284">    if (ahp-&gt;ah_immunity_on == enable) {</a>
<a name="ln3285">        return;</a>
<a name="ln3286">    }</a>
<a name="ln3287"> </a>
<a name="ln3288">    ahp-&gt;ah_immunity_on = enable;</a>
<a name="ln3289"> </a>
<a name="ln3290">    OS_REG_RMW_FIELD(ah, AR_PHY_SFCORR_LOW,</a>
<a name="ln3291">                     AR_PHY_SFCORR_LOW_M1_THRESH_LOW, m1_thresh_low);</a>
<a name="ln3292">    OS_REG_RMW_FIELD(ah, AR_PHY_SFCORR_LOW,</a>
<a name="ln3293">                     AR_PHY_SFCORR_LOW_M2_THRESH_LOW, m2_thresh_low);</a>
<a name="ln3294">    OS_REG_RMW_FIELD(ah, AR_PHY_SFCORR,</a>
<a name="ln3295">                     AR_PHY_SFCORR_M1_THRESH, m1_thresh);</a>
<a name="ln3296">    OS_REG_RMW_FIELD(ah, AR_PHY_SFCORR,</a>
<a name="ln3297">                     AR_PHY_SFCORR_M2_THRESH, m2_thresh);</a>
<a name="ln3298">    OS_REG_RMW_FIELD(ah, AR_PHY_SFCORR,</a>
<a name="ln3299">                     AR_PHY_SFCORR_M2COUNT_THR, m2_count_thr);</a>
<a name="ln3300">    OS_REG_RMW_FIELD(ah, AR_PHY_SFCORR_LOW,</a>
<a name="ln3301">                     AR_PHY_SFCORR_LOW_M2COUNT_THR_LOW, m2_count_thr_low);</a>
<a name="ln3302"> </a>
<a name="ln3303">    OS_REG_RMW_FIELD(ah, AR_PHY_SFCORR_EXT,</a>
<a name="ln3304">                     AR_PHY_SFCORR_EXT_M1_THRESH_LOW, m1_thresh_low);</a>
<a name="ln3305">    OS_REG_RMW_FIELD(ah, AR_PHY_SFCORR_EXT,</a>
<a name="ln3306">                     AR_PHY_SFCORR_EXT_M2_THRESH_LOW, m2_thresh_low);</a>
<a name="ln3307">    OS_REG_RMW_FIELD(ah, AR_PHY_SFCORR_EXT,</a>
<a name="ln3308">                     AR_PHY_SFCORR_EXT_M1_THRESH, m1_thresh);</a>
<a name="ln3309">    OS_REG_RMW_FIELD(ah, AR_PHY_SFCORR_EXT,</a>
<a name="ln3310">                     AR_PHY_SFCORR_EXT_M2_THRESH, m2_thresh);</a>
<a name="ln3311"> </a>
<a name="ln3312">    if (!enable) {</a>
<a name="ln3313">        OS_REG_SET_BIT(ah, AR_PHY_SFCORR_LOW,</a>
<a name="ln3314">                       AR_PHY_SFCORR_LOW_USE_SELF_CORR_LOW);</a>
<a name="ln3315">    } else {</a>
<a name="ln3316">        OS_REG_CLR_BIT(ah, AR_PHY_SFCORR_LOW,</a>
<a name="ln3317">                       AR_PHY_SFCORR_LOW_USE_SELF_CORR_LOW);</a>
<a name="ln3318">    }</a>
<a name="ln3319">}</a>
<a name="ln3320"> </a>
<a name="ln3321">/* XXX FreeBSD: I'm not sure how to implement this.. */</a>
<a name="ln3322">#if 0</a>
<a name="ln3323">int</a>
<a name="ln3324">ar9300_get_cal_intervals(struct ath_hal *ah, HAL_CALIBRATION_TIMER **timerp,</a>
<a name="ln3325">    HAL_CAL_QUERY query)</a>
<a name="ln3326">{</a>
<a name="ln3327">#define AR9300_IS_CHAIN_RX_IQCAL_INVALID(_ah, _reg) \</a>
<a name="ln3328">    ((OS_REG_READ((_ah), _reg) &amp; 0x3fff) == 0)</a>
<a name="ln3329">#define AR9300_IS_RX_IQCAL_DISABLED(_ah) \</a>
<a name="ln3330">    (!(OS_REG_READ((_ah), AR_PHY_RX_IQCAL_CORR_B0) &amp; \</a>
<a name="ln3331">    AR_PHY_RX_IQCAL_CORR_IQCORR_ENABLE))</a>
<a name="ln3332">/* Avoid comilation warnings. Variables are not used when EMULATION. */</a>
<a name="ln3333">    struct ath_hal_9300 *ahp = AH9300(ah);</a>
<a name="ln3334">    u_int8_t rxchainmask = ahp-&gt;ah_rx_chainmask, i;</a>
<a name="ln3335">    int rx_iqcal_invalid = 0, num_chains = 0;</a>
<a name="ln3336">    static const u_int32_t offset_array[3] = {</a>
<a name="ln3337">        AR_PHY_RX_IQCAL_CORR_B0,</a>
<a name="ln3338">        AR_PHY_RX_IQCAL_CORR_B1,</a>
<a name="ln3339">        AR_PHY_RX_IQCAL_CORR_B2};</a>
<a name="ln3340"> </a>
<a name="ln3341">    *timerp = ar9300_cals;</a>
<a name="ln3342"> </a>
<a name="ln3343">    switch (query) {</a>
<a name="ln3344">    case HAL_QUERY_CALS:</a>
<a name="ln3345">        return AR9300_NUM_CAL_TYPES;</a>
<a name="ln3346">    case HAL_QUERY_RERUN_CALS:</a>
<a name="ln3347">        for (i = 0; i &lt; AR9300_MAX_CHAINS; i++) {</a>
<a name="ln3348">            if (rxchainmask &amp; (1 &lt;&lt; i)) {</a>
<a name="ln3349">                num_chains++;</a>
<a name="ln3350">            }</a>
<a name="ln3351">        }</a>
<a name="ln3352">        for (i = 0; i &lt; num_chains; i++) {</a>
<a name="ln3353">            if (AR_SREV_POSEIDON(ah) || AR_SREV_APHRODITE(ah)) {</a>
<a name="ln3354">                HALASSERT(num_chains == 0x1);</a>
<a name="ln3355">            }</a>
<a name="ln3356">            if (AR9300_IS_CHAIN_RX_IQCAL_INVALID(ah, offset_array[i])) {</a>
<a name="ln3357">                rx_iqcal_invalid = 1;</a>
<a name="ln3358">            }</a>
<a name="ln3359">        }</a>
<a name="ln3360">        if (AR9300_IS_RX_IQCAL_DISABLED(ah)) {</a>
<a name="ln3361">            rx_iqcal_invalid = 1;</a>
<a name="ln3362">        }</a>
<a name="ln3363"> </a>
<a name="ln3364">        return rx_iqcal_invalid;</a>
<a name="ln3365">    default:</a>
<a name="ln3366">        HALASSERT(0);</a>
<a name="ln3367">    }</a>
<a name="ln3368">    return 0;</a>
<a name="ln3369">}</a>
<a name="ln3370">#endif</a>
<a name="ln3371"> </a>
<a name="ln3372">#if ATH_TRAFFIC_FAST_RECOVER</a>
<a name="ln3373">#define PLL3              0x16188</a>
<a name="ln3374">#define PLL3_DO_MEAS_MASK 0x40000000</a>
<a name="ln3375">#define PLL4              0x1618c</a>
<a name="ln3376">#define PLL4_MEAS_DONE    0x8</a>
<a name="ln3377">#define SQSUM_DVC_MASK    0x007ffff8</a>
<a name="ln3378">unsigned long</a>
<a name="ln3379">ar9300_get_pll3_sqsum_dvc(struct ath_hal *ah)</a>
<a name="ln3380">{</a>
<a name="ln3381">    if (AR_SREV_HORNET(ah) || AR_SREV_POSEIDON(ah) || AR_SREV_WASP(ah) || AR_SREV_SCORPION(ah)) {</a>
<a name="ln3382">        OS_REG_WRITE(ah, PLL3, (OS_REG_READ(ah, PLL3) &amp; ~(PLL3_DO_MEAS_MASK)));</a>
<a name="ln3383">        OS_DELAY(100);</a>
<a name="ln3384">        OS_REG_WRITE(ah, PLL3, (OS_REG_READ(ah, PLL3) | PLL3_DO_MEAS_MASK));</a>
<a name="ln3385"> </a>
<a name="ln3386">        while ( (OS_REG_READ(ah, PLL4) &amp; PLL4_MEAS_DONE) == 0) {</a>
<a name="ln3387">            OS_DELAY(100);</a>
<a name="ln3388">        }</a>
<a name="ln3389"> </a>
<a name="ln3390">        return (( OS_REG_READ(ah, PLL3) &amp; SQSUM_DVC_MASK ) &gt;&gt; 3);</a>
<a name="ln3391">    } else {</a>
<a name="ln3392">        HALDEBUG(ah, HAL_DEBUG_UNMASKABLE,</a>
<a name="ln3393">                 &quot;%s: unable to get pll3_sqsum_dvc\n&quot;,</a>
<a name="ln3394">                 __func__);</a>
<a name="ln3395">        return 0;</a>
<a name="ln3396">    }</a>
<a name="ln3397">}</a>
<a name="ln3398">#endif</a>
<a name="ln3399"> </a>
<a name="ln3400"> </a>
<a name="ln3401">#define RX_GAIN_TABLE_LENGTH	128</a>
<a name="ln3402">// this will be called if rfGainCAP is enabled and rfGainCAP setting is changed,</a>
<a name="ln3403">// or rxGainTable setting is changed</a>
<a name="ln3404">HAL_BOOL ar9300_rf_gain_cap_apply(struct ath_hal *ah, int is_2GHz)</a>
<a name="ln3405">{</a>
<a name="ln3406">	int i, done = 0, i_rx_gain = 32;</a>
<a name="ln3407">    u_int32_t rf_gain_cap;</a>
<a name="ln3408">    u_int32_t rx_gain_value, a_Byte, rx_gain_value_caped;</a>
<a name="ln3409">	static u_int32_t  rx_gain_table[RX_GAIN_TABLE_LENGTH * 2][2];</a>
<a name="ln3410">    ar9300_eeprom_t *eep = &amp;AH9300(ah)-&gt;ah_eeprom;</a>
<a name="ln3411">    struct ath_hal_9300 *ahp = AH9300(ah);</a>
<a name="ln3412"> </a>
<a name="ln3413">    if ( !((eep-&gt;base_eep_header.misc_configuration &amp; 0x80) &gt;&gt; 7) )</a>
<a name="ln3414">        return AH_FALSE;</a>
<a name="ln3415">		  </a>
<a name="ln3416">    if (is_2GHz)</a>
<a name="ln3417">    {</a>
<a name="ln3418">        rf_gain_cap = (u_int32_t) eep-&gt;modal_header_2g.rf_gain_cap;    </a>
<a name="ln3419">    }</a>
<a name="ln3420">    else</a>
<a name="ln3421">    {</a>
<a name="ln3422">        rf_gain_cap = (u_int32_t) eep-&gt;modal_header_5g.rf_gain_cap;       </a>
<a name="ln3423">	}</a>
<a name="ln3424"> </a>
<a name="ln3425">	if (rf_gain_cap == 0)</a>
<a name="ln3426">        return AH_FALSE;</a>
<a name="ln3427"> </a>
<a name="ln3428">	for (i = 0; i&lt; RX_GAIN_TABLE_LENGTH * 2; i++)</a>
<a name="ln3429">	{</a>
<a name="ln3430">        if (AR_SREV_AR9580(ah)) </a>
<a name="ln3431">        {</a>
<a name="ln3432">            // BB_rx_ocgain2</a>
<a name="ln3433">            i_rx_gain = 128 + 32;</a>
<a name="ln3434">            switch (ar9300_rx_gain_index_get(ah))</a>
<a name="ln3435">            {</a>
<a name="ln3436">            case 0:</a>
<a name="ln3437">                rx_gain_table[i][0] = </a>
<a name="ln3438">					ar9300_common_rx_gain_table_ar9580_1p0[i][0];</a>
<a name="ln3439">                rx_gain_table[i][1] = </a>
<a name="ln3440">					ar9300_common_rx_gain_table_ar9580_1p0[i][1];</a>
<a name="ln3441">                break;</a>
<a name="ln3442">            case 1:</a>
<a name="ln3443">                rx_gain_table[i][0] = </a>
<a name="ln3444">					ar9300_common_wo_xlna_rx_gain_table_ar9580_1p0[i][0];</a>
<a name="ln3445">                rx_gain_table[i][1] = </a>
<a name="ln3446">					ar9300_common_wo_xlna_rx_gain_table_ar9580_1p0[i][1];</a>
<a name="ln3447">                break;</a>
<a name="ln3448">			}</a>
<a name="ln3449">        } </a>
<a name="ln3450">        else if (AR_SREV_OSPREY_22(ah)) </a>
<a name="ln3451">        { </a>
<a name="ln3452">            i_rx_gain = 128 + 32;</a>
<a name="ln3453">            switch (ar9300_rx_gain_index_get(ah))</a>
<a name="ln3454">            {</a>
<a name="ln3455">            case 0:</a>
<a name="ln3456">                rx_gain_table[i][0] = ar9300_common_rx_gain_table_osprey_2p2[i][0];</a>
<a name="ln3457">                rx_gain_table[i][1] = ar9300_common_rx_gain_table_osprey_2p2[i][1];</a>
<a name="ln3458">                break;</a>
<a name="ln3459">            case 1:</a>
<a name="ln3460">                rx_gain_table[i][0] = </a>
<a name="ln3461">					ar9300Common_wo_xlna_rx_gain_table_osprey_2p2[i][0];</a>
<a name="ln3462">                rx_gain_table[i][1] = </a>
<a name="ln3463">					ar9300Common_wo_xlna_rx_gain_table_osprey_2p2[i][1];</a>
<a name="ln3464">                break;</a>
<a name="ln3465">			}</a>
<a name="ln3466">        }</a>
<a name="ln3467">        else</a>
<a name="ln3468">        {</a>
<a name="ln3469">            return AH_FALSE;</a>
<a name="ln3470">        }</a>
<a name="ln3471">    }</a>
<a name="ln3472">    </a>
<a name="ln3473">    while (1) </a>
<a name="ln3474">	{</a>
<a name="ln3475">        rx_gain_value = rx_gain_table[i_rx_gain][1];</a>
<a name="ln3476">        rx_gain_value_caped = rx_gain_value;</a>
<a name="ln3477">        a_Byte = rx_gain_value &amp; (0x000000FF);</a>
<a name="ln3478">        if (a_Byte&gt;rf_gain_cap) </a>
<a name="ln3479">        {</a>
<a name="ln3480">        	rx_gain_value_caped = (rx_gain_value_caped &amp; </a>
<a name="ln3481">				(0xFFFFFF00)) + rf_gain_cap;</a>
<a name="ln3482">        }</a>
<a name="ln3483">        a_Byte = rx_gain_value &amp; (0x0000FF00);</a>
<a name="ln3484">        if ( a_Byte &gt; ( rf_gain_cap &lt;&lt; 8 ) ) </a>
<a name="ln3485">        {</a>
<a name="ln3486">        	rx_gain_value_caped = (rx_gain_value_caped &amp; </a>
<a name="ln3487">				(0xFFFF00FF)) + (rf_gain_cap&lt;&lt;8);</a>
<a name="ln3488">        }</a>
<a name="ln3489">        a_Byte = rx_gain_value &amp; (0x00FF0000);</a>
<a name="ln3490">        if ( a_Byte &gt; ( rf_gain_cap &lt;&lt; 16 ) ) </a>
<a name="ln3491">        {</a>
<a name="ln3492">        	rx_gain_value_caped = (rx_gain_value_caped &amp; </a>
<a name="ln3493">				(0xFF00FFFF)) + (rf_gain_cap&lt;&lt;16);</a>
<a name="ln3494">        }</a>
<a name="ln3495">        a_Byte = rx_gain_value &amp; (0xFF000000);</a>
<a name="ln3496">        if ( a_Byte &gt; ( rf_gain_cap &lt;&lt; 24 ) ) </a>
<a name="ln3497">        {</a>
<a name="ln3498">        	rx_gain_value_caped = (rx_gain_value_caped &amp; </a>
<a name="ln3499">				(0x00FFFFFF)) + (rf_gain_cap&lt;&lt;24);</a>
<a name="ln3500">        } </a>
<a name="ln3501">        else </a>
<a name="ln3502">        {</a>
<a name="ln3503">            done = 1;</a>
<a name="ln3504">        }</a>
<a name="ln3505">		HALDEBUG(ah, HAL_DEBUG_RESET,</a>
<a name="ln3506">			&quot;%s: rx_gain_address: %x, rx_gain_value: %x	rx_gain_value_caped: %x\n&quot;,</a>
<a name="ln3507">			__func__, rx_gain_table[i_rx_gain][0], rx_gain_value, rx_gain_value_caped);</a>
<a name="ln3508">        if (rx_gain_value_caped != rx_gain_value)</a>
<a name="ln3509">		{</a>
<a name="ln3510">            rx_gain_table[i_rx_gain][1] = rx_gain_value_caped;</a>
<a name="ln3511">		}</a>
<a name="ln3512">        if (done == 1)</a>
<a name="ln3513">            break;</a>
<a name="ln3514">        i_rx_gain ++;</a>
<a name="ln3515">	}</a>
<a name="ln3516">    INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, rx_gain_table, ARRAY_LENGTH(rx_gain_table), 2);</a>
<a name="ln3517">    return AH_TRUE;</a>
<a name="ln3518">}</a>
<a name="ln3519"> </a>
<a name="ln3520"> </a>
<a name="ln3521">void ar9300_rx_gain_table_apply(struct ath_hal *ah)</a>
<a name="ln3522">{</a>
<a name="ln3523">    struct ath_hal_9300 *ahp = AH9300(ah);</a>
<a name="ln3524">//struct ath_hal_private *ahpriv = AH_PRIVATE(ah);</a>
<a name="ln3525">    u_int32_t xlan_gpio_cfg;</a>
<a name="ln3526">    u_int8_t  i;</a>
<a name="ln3527"> </a>
<a name="ln3528">    if (AR_SREV_OSPREY(ah) || AR_SREV_AR9580(ah))</a>
<a name="ln3529">    {</a>
<a name="ln3530">		// this will be called if rxGainTable setting is changed</a>
<a name="ln3531">        if (ar9300_rf_gain_cap_apply(ah, 1))</a>
<a name="ln3532">            return;</a>
<a name="ln3533">	}</a>
<a name="ln3534"> </a>
<a name="ln3535">    switch (ar9300_rx_gain_index_get(ah))</a>
<a name="ln3536">    {</a>
<a name="ln3537">    case 2:</a>
<a name="ln3538">        if (AR_SREV_JUPITER_10(ah)) {</a>
<a name="ln3539">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, </a>
<a name="ln3540">                ar9300_common_mixed_rx_gain_table_jupiter_1p0,</a>
<a name="ln3541">                ARRAY_LENGTH(ar9300_common_mixed_rx_gain_table_jupiter_1p0), 2);</a>
<a name="ln3542">            break;</a>
<a name="ln3543">        }</a>
<a name="ln3544">        else if (AR_SREV_JUPITER_20(ah)) {</a>
<a name="ln3545">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, </a>
<a name="ln3546">                ar9300Common_mixed_rx_gain_table_jupiter_2p0,</a>
<a name="ln3547">                ARRAY_LENGTH(ar9300Common_mixed_rx_gain_table_jupiter_2p0), 2);</a>
<a name="ln3548">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_bb_core,</a>
<a name="ln3549">                ar9462_2p0_baseband_core_mix_rxgain,</a>
<a name="ln3550">                ARRAY_LENGTH(ar9462_2p0_baseband_core_mix_rxgain), 2);</a>
<a name="ln3551">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_bb_postamble,</a>
<a name="ln3552">                ar9462_2p0_baseband_postamble_mix_rxgain,</a>
<a name="ln3553">                ARRAY_LENGTH(ar9462_2p0_baseband_postamble_mix_rxgain), 2);</a>
<a name="ln3554">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_xlna,</a>
<a name="ln3555">                ar9462_2p0_baseband_postamble_5g_xlna,</a>
<a name="ln3556">                ARRAY_LENGTH(ar9462_2p0_baseband_postamble_5g_xlna), 2);</a>
<a name="ln3557">            break;</a>
<a name="ln3558">        }</a>
<a name="ln3559">        else if (AR_SREV_JUPITER_21(ah)) {</a>
<a name="ln3560">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, </a>
<a name="ln3561">                ar9462_2p1_common_mixed_rx_gain,</a>
<a name="ln3562">                ARRAY_LENGTH(ar9462_2p1_common_mixed_rx_gain), 2);</a>
<a name="ln3563">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_bb_core,</a>
<a name="ln3564">                ar9462_2p1_baseband_core_mix_rxgain,</a>
<a name="ln3565">                ARRAY_LENGTH(ar9462_2p1_baseband_core_mix_rxgain), 2);</a>
<a name="ln3566">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_bb_postamble,</a>
<a name="ln3567">                ar9462_2p1_baseband_postamble_mix_rxgain,</a>
<a name="ln3568">                ARRAY_LENGTH(ar9462_2p1_baseband_postamble_mix_rxgain), 2);</a>
<a name="ln3569">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_xlna,</a>
<a name="ln3570">                ar9462_2p1_baseband_postamble_5g_xlna,</a>
<a name="ln3571">                ARRAY_LENGTH(ar9462_2p1_baseband_postamble_5g_xlna), 2);</a>
<a name="ln3572"> </a>
<a name="ln3573">            break;</a>
<a name="ln3574">        }</a>
<a name="ln3575">    case 3:</a>
<a name="ln3576">        if (AR_SREV_JUPITER_21(ah)) {</a>
<a name="ln3577">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3578">                ar9462_2p1_common_5g_xlna_only_rxgain,</a>
<a name="ln3579">                ARRAY_LENGTH(ar9462_2p1_common_5g_xlna_only_rxgain), 2);</a>
<a name="ln3580">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_xlna,</a>
<a name="ln3581">                ar9462_2p1_baseband_postamble_5g_xlna,</a>
<a name="ln3582">                ARRAY_LENGTH(ar9462_2p1_baseband_postamble_5g_xlna), 2);</a>
<a name="ln3583">        } else if (AR_SREV_JUPITER_20(ah)) {</a>
<a name="ln3584">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3585">                ar9462_2p0_common_5g_xlna_only_rxgain,</a>
<a name="ln3586">                ARRAY_LENGTH(ar9462_2p0_common_5g_xlna_only_rxgain), 2);</a>
<a name="ln3587">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_xlna,</a>
<a name="ln3588">                ar9462_2p0_baseband_postamble_5g_xlna,</a>
<a name="ln3589">                ARRAY_LENGTH(ar9462_2p0_baseband_postamble_5g_xlna), 2);</a>
<a name="ln3590">        }</a>
<a name="ln3591">        break;</a>
<a name="ln3592">    case 0:</a>
<a name="ln3593">    default:</a>
<a name="ln3594">        if (AR_SREV_HORNET_12(ah)) {</a>
<a name="ln3595">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3596">                ar9331_common_rx_gain_hornet1_2, </a>
<a name="ln3597">                ARRAY_LENGTH(ar9331_common_rx_gain_hornet1_2), 2);</a>
<a name="ln3598">        } else if (AR_SREV_HORNET_11(ah)) {</a>
<a name="ln3599">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3600">                ar9331_common_rx_gain_hornet1_1, </a>
<a name="ln3601">                ARRAY_LENGTH(ar9331_common_rx_gain_hornet1_1), 2);</a>
<a name="ln3602">        } else if (AR_SREV_POSEIDON_11_OR_LATER(ah)) {</a>
<a name="ln3603">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3604">                ar9485_common_wo_xlna_rx_gain_poseidon1_1,</a>
<a name="ln3605">                ARRAY_LENGTH(ar9485_common_wo_xlna_rx_gain_poseidon1_1), 2);</a>
<a name="ln3606">            /* XXX FreeBSD: this needs to be revisited!! */</a>
<a name="ln3607">            xlan_gpio_cfg = ah-&gt;ah_config.ath_hal_ext_lna_ctl_gpio;</a>
<a name="ln3608">            if (xlan_gpio_cfg) {</a>
<a name="ln3609">                for (i = 0; i &lt; 32; i++) {</a>
<a name="ln3610">                    if (xlan_gpio_cfg &amp; (1 &lt;&lt; i)) {</a>
<a name="ln3611">                        /*</a>
<a name="ln3612">                         * XXX FreeBSD: definitely make sure this</a>
<a name="ln3613">                         * results in the correct value being written</a>
<a name="ln3614">                         * to the hardware, or weird crap is very likely</a>
<a name="ln3615">                         * to occur!</a>
<a name="ln3616">                         */</a>
<a name="ln3617">                        ath_hal_gpioCfgOutput(ah, i,</a>
<a name="ln3618">                            HAL_GPIO_OUTPUT_MUX_PCIE_ATTENTION_LED);</a>
<a name="ln3619">                    }</a>
<a name="ln3620">                }</a>
<a name="ln3621">            }</a>
<a name="ln3622"> </a>
<a name="ln3623">        } else if (AR_SREV_POSEIDON(ah)) {</a>
<a name="ln3624">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3625">                ar9485Common_wo_xlna_rx_gain_poseidon1_0,</a>
<a name="ln3626">                ARRAY_LENGTH(ar9485Common_wo_xlna_rx_gain_poseidon1_0), 2);</a>
<a name="ln3627">        } else if (AR_SREV_JUPITER_10(ah)) {</a>
<a name="ln3628">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, </a>
<a name="ln3629">                ar9300_common_rx_gain_table_jupiter_1p0,</a>
<a name="ln3630">                ARRAY_LENGTH(ar9300_common_rx_gain_table_jupiter_1p0), 2);</a>
<a name="ln3631">        } else if (AR_SREV_JUPITER_20(ah)) {</a>
<a name="ln3632">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, </a>
<a name="ln3633">                ar9300Common_rx_gain_table_jupiter_2p0,</a>
<a name="ln3634">                ARRAY_LENGTH(ar9300Common_rx_gain_table_jupiter_2p0), 2);</a>
<a name="ln3635">        } else if (AR_SREV_JUPITER_21(ah)) {</a>
<a name="ln3636">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3637">                ar9462_2p1_common_rx_gain,</a>
<a name="ln3638">                ARRAY_LENGTH(ar9462_2p1_common_rx_gain), 2);</a>
<a name="ln3639">        } else if (AR_SREV_AR9580(ah)) {</a>
<a name="ln3640">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3641">                ar9300_common_rx_gain_table_ar9580_1p0,</a>
<a name="ln3642">                ARRAY_LENGTH(ar9300_common_rx_gain_table_ar9580_1p0), 2);</a>
<a name="ln3643">        } else if (AR_SREV_WASP(ah)) {</a>
<a name="ln3644">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3645">                ar9340Common_rx_gain_table_wasp_1p0,</a>
<a name="ln3646">                ARRAY_LENGTH(ar9340Common_rx_gain_table_wasp_1p0), 2);</a>
<a name="ln3647">        } else if (AR_SREV_SCORPION(ah)) {</a>
<a name="ln3648">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3649">                ar955xCommon_rx_gain_table_scorpion_1p0,</a>
<a name="ln3650">                ARRAY_LENGTH(ar955xCommon_rx_gain_table_scorpion_1p0), 2);</a>
<a name="ln3651">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_bounds,</a>
<a name="ln3652">                ar955xCommon_rx_gain_bounds_scorpion_1p0,</a>
<a name="ln3653">                ARRAY_LENGTH(ar955xCommon_rx_gain_bounds_scorpion_1p0), 5);</a>
<a name="ln3654">        } else if (AR_SREV_HONEYBEE(ah)) {</a>
<a name="ln3655">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3656">                qca953xCommon_rx_gain_table_honeybee_1p0,</a>
<a name="ln3657">                ARRAY_LENGTH(qca953xCommon_rx_gain_table_honeybee_1p0), 2);</a>
<a name="ln3658">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_bounds,</a>
<a name="ln3659">                qca953xCommon_rx_gain_bounds_honeybee_1p0,</a>
<a name="ln3660">                ARRAY_LENGTH(qca953xCommon_rx_gain_bounds_honeybee_1p0), 5);</a>
<a name="ln3661">        } else {</a>
<a name="ln3662">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3663">                ar9300_common_rx_gain_table_osprey_2p2,</a>
<a name="ln3664">                ARRAY_LENGTH(ar9300_common_rx_gain_table_osprey_2p2), 2);</a>
<a name="ln3665">        }</a>
<a name="ln3666">        break;</a>
<a name="ln3667">    case 1:</a>
<a name="ln3668">        if (AR_SREV_HORNET_12(ah)) {</a>
<a name="ln3669">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3670">                ar9331_common_wo_xlna_rx_gain_hornet1_2,</a>
<a name="ln3671">                ARRAY_LENGTH(ar9331_common_wo_xlna_rx_gain_hornet1_2), 2);</a>
<a name="ln3672">        } else if (AR_SREV_HORNET_11(ah)) {</a>
<a name="ln3673">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3674">                ar9331_common_wo_xlna_rx_gain_hornet1_1,</a>
<a name="ln3675">                ARRAY_LENGTH(ar9331_common_wo_xlna_rx_gain_hornet1_1), 2);</a>
<a name="ln3676">        } else if (AR_SREV_POSEIDON_11_OR_LATER(ah)) {</a>
<a name="ln3677">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3678">                ar9485_common_wo_xlna_rx_gain_poseidon1_1,</a>
<a name="ln3679">                ARRAY_LENGTH(ar9485_common_wo_xlna_rx_gain_poseidon1_1), 2);</a>
<a name="ln3680">        } else if (AR_SREV_POSEIDON(ah)) {</a>
<a name="ln3681">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3682">                ar9485Common_wo_xlna_rx_gain_poseidon1_0,</a>
<a name="ln3683">                ARRAY_LENGTH(ar9485Common_wo_xlna_rx_gain_poseidon1_0), 2);</a>
<a name="ln3684">        } else if (AR_SREV_JUPITER_10(ah)) {</a>
<a name="ln3685">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, </a>
<a name="ln3686">                ar9300_common_wo_xlna_rx_gain_table_jupiter_1p0,</a>
<a name="ln3687">                ARRAY_LENGTH(ar9300_common_wo_xlna_rx_gain_table_jupiter_1p0),</a>
<a name="ln3688">                2);</a>
<a name="ln3689">        } else if (AR_SREV_JUPITER_20(ah)) {</a>
<a name="ln3690">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, </a>
<a name="ln3691">                ar9300Common_wo_xlna_rx_gain_table_jupiter_2p0,</a>
<a name="ln3692">                ARRAY_LENGTH(ar9300Common_wo_xlna_rx_gain_table_jupiter_2p0),</a>
<a name="ln3693">                2);</a>
<a name="ln3694">        } else if (AR_SREV_JUPITER_21(ah)) {</a>
<a name="ln3695">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3696">                ar9462_2p1_common_wo_xlna_rx_gain,</a>
<a name="ln3697">                ARRAY_LENGTH(ar9462_2p1_common_wo_xlna_rx_gain),</a>
<a name="ln3698">                2);</a>
<a name="ln3699">        } else if (AR_SREV_APHRODITE(ah)) {</a>
<a name="ln3700">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain, </a>
<a name="ln3701">                ar956XCommon_wo_xlna_rx_gain_table_aphrodite_1p0,</a>
<a name="ln3702">                ARRAY_LENGTH(ar956XCommon_wo_xlna_rx_gain_table_aphrodite_1p0),</a>
<a name="ln3703">                2);</a>
<a name="ln3704">        } else if (AR_SREV_AR9580(ah)) {</a>
<a name="ln3705">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3706">                ar9300_common_wo_xlna_rx_gain_table_ar9580_1p0,</a>
<a name="ln3707">                ARRAY_LENGTH(ar9300_common_wo_xlna_rx_gain_table_ar9580_1p0), 2);</a>
<a name="ln3708">        } else if (AR_SREV_WASP(ah)) {</a>
<a name="ln3709">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3710">                ar9340Common_wo_xlna_rx_gain_table_wasp_1p0,</a>
<a name="ln3711">                ARRAY_LENGTH(ar9340Common_wo_xlna_rx_gain_table_wasp_1p0), 2);</a>
<a name="ln3712">        } else if (AR_SREV_SCORPION(ah)) {</a>
<a name="ln3713">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3714">                ar955xCommon_wo_xlna_rx_gain_table_scorpion_1p0,</a>
<a name="ln3715">                ARRAY_LENGTH(ar955xCommon_wo_xlna_rx_gain_table_scorpion_1p0), 2);</a>
<a name="ln3716">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_bounds,</a>
<a name="ln3717">                ar955xCommon_wo_xlna_rx_gain_bounds_scorpion_1p0,</a>
<a name="ln3718">                ARRAY_LENGTH(ar955xCommon_wo_xlna_rx_gain_bounds_scorpion_1p0), 5);</a>
<a name="ln3719">        } else if (AR_SREV_HONEYBEE(ah)) {</a>
<a name="ln3720">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3721">                qca953xCommon_wo_xlna_rx_gain_table_honeybee_1p0,</a>
<a name="ln3722">                ARRAY_LENGTH(qca953xCommon_wo_xlna_rx_gain_table_honeybee_1p0), 2);</a>
<a name="ln3723">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain_bounds,</a>
<a name="ln3724">                qca953xCommon_wo_xlna_rx_gain_bounds_honeybee_1p0,</a>
<a name="ln3725">                ARRAY_LENGTH(qca953xCommon_wo_xlna_rx_gain_bounds_honeybee_1p0), 5);</a>
<a name="ln3726">        } else {</a>
<a name="ln3727">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_rxgain,</a>
<a name="ln3728">                ar9300Common_wo_xlna_rx_gain_table_osprey_2p2,</a>
<a name="ln3729">                ARRAY_LENGTH(ar9300Common_wo_xlna_rx_gain_table_osprey_2p2), 2);</a>
<a name="ln3730">        }</a>
<a name="ln3731">        break;</a>
<a name="ln3732">    }</a>
<a name="ln3733">}</a>
<a name="ln3734"> </a>
<a name="ln3735">void ar9300_tx_gain_table_apply(struct ath_hal *ah)</a>
<a name="ln3736">{</a>
<a name="ln3737">    struct ath_hal_9300 *ahp = AH9300(ah);</a>
<a name="ln3738"> </a>
<a name="ln3739">    switch (ar9300_tx_gain_index_get(ah))</a>
<a name="ln3740">    {</a>
<a name="ln3741">    case 0:</a>
<a name="ln3742">    default:</a>
<a name="ln3743">        if (AR_SREV_HORNET_12(ah)) {</a>
<a name="ln3744">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3745">                ar9331_modes_lowest_ob_db_tx_gain_hornet1_2, </a>
<a name="ln3746">                ARRAY_LENGTH(ar9331_modes_lowest_ob_db_tx_gain_hornet1_2), 5);</a>
<a name="ln3747">        } else if (AR_SREV_HORNET_11(ah)) {</a>
<a name="ln3748">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3749">                ar9331_modes_lowest_ob_db_tx_gain_hornet1_1, </a>
<a name="ln3750">                ARRAY_LENGTH(ar9331_modes_lowest_ob_db_tx_gain_hornet1_1), 5);</a>
<a name="ln3751">        } else if (AR_SREV_POSEIDON_11_OR_LATER(ah)) {</a>
<a name="ln3752">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3753">                ar9485_modes_lowest_ob_db_tx_gain_poseidon1_1, </a>
<a name="ln3754">                ARRAY_LENGTH(ar9485_modes_lowest_ob_db_tx_gain_poseidon1_1), 5);</a>
<a name="ln3755">        } else if (AR_SREV_POSEIDON(ah)) {</a>
<a name="ln3756">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3757">                ar9485Modes_lowest_ob_db_tx_gain_poseidon1_0, </a>
<a name="ln3758">                ARRAY_LENGTH(ar9485Modes_lowest_ob_db_tx_gain_poseidon1_0), 5);</a>
<a name="ln3759">        } else if (AR_SREV_AR9580(ah)) {</a>
<a name="ln3760">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3761">                ar9300Modes_lowest_ob_db_tx_gain_table_ar9580_1p0,</a>
<a name="ln3762">                ARRAY_LENGTH(ar9300Modes_lowest_ob_db_tx_gain_table_ar9580_1p0),</a>
<a name="ln3763">                5);</a>
<a name="ln3764">        } else if (AR_SREV_WASP(ah)) {</a>
<a name="ln3765">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3766">                ar9340Modes_lowest_ob_db_tx_gain_table_wasp_1p0,</a>
<a name="ln3767">                ARRAY_LENGTH(ar9340Modes_lowest_ob_db_tx_gain_table_wasp_1p0),</a>
<a name="ln3768">                5);</a>
<a name="ln3769">        } else if (AR_SREV_SCORPION(ah)) {</a>
<a name="ln3770">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3771">                ar955xModes_xpa_tx_gain_table_scorpion_1p0,</a>
<a name="ln3772">                ARRAY_LENGTH(ar955xModes_xpa_tx_gain_table_scorpion_1p0),</a>
<a name="ln3773">                9);</a>
<a name="ln3774">        } else if (AR_SREV_JUPITER_10(ah)) {</a>
<a name="ln3775">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3776">                ar9300_modes_low_ob_db_tx_gain_table_jupiter_1p0,</a>
<a name="ln3777">                ARRAY_LENGTH(ar9300_modes_low_ob_db_tx_gain_table_jupiter_1p0),</a>
<a name="ln3778">                5);</a>
<a name="ln3779">         } else if (AR_SREV_JUPITER_20(ah)) {</a>
<a name="ln3780">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3781">                ar9300Modes_low_ob_db_tx_gain_table_jupiter_2p0,</a>
<a name="ln3782">                ARRAY_LENGTH(ar9300Modes_low_ob_db_tx_gain_table_jupiter_2p0),</a>
<a name="ln3783">                5);</a>
<a name="ln3784">       } else if (AR_SREV_JUPITER_21(ah)) {</a>
<a name="ln3785">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3786">                ar9462_2p1_modes_low_ob_db_tx_gain,</a>
<a name="ln3787">                ARRAY_LENGTH(ar9462_2p1_modes_low_ob_db_tx_gain),</a>
<a name="ln3788">                5);</a>
<a name="ln3789">        } else if (AR_SREV_HONEYBEE(ah)) {</a>
<a name="ln3790">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3791">           	qca953xModes_xpa_tx_gain_table_honeybee_1p0,</a>
<a name="ln3792">                ARRAY_LENGTH(qca953xModes_xpa_tx_gain_table_honeybee_1p0),</a>
<a name="ln3793">                2);</a>
<a name="ln3794">        } else if (AR_SREV_APHRODITE(ah)) {</a>
<a name="ln3795">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3796">                ar956XModes_low_ob_db_tx_gain_table_aphrodite_1p0,</a>
<a name="ln3797">                ARRAY_LENGTH(ar956XModes_low_ob_db_tx_gain_table_aphrodite_1p0),</a>
<a name="ln3798">                5);</a>
<a name="ln3799">        } else {</a>
<a name="ln3800">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3801">                ar9300_modes_lowest_ob_db_tx_gain_table_osprey_2p2,</a>
<a name="ln3802">                ARRAY_LENGTH(ar9300_modes_lowest_ob_db_tx_gain_table_osprey_2p2),</a>
<a name="ln3803">                5);</a>
<a name="ln3804">        }</a>
<a name="ln3805">        break;</a>
<a name="ln3806">    case 1:</a>
<a name="ln3807">        if (AR_SREV_HORNET_12(ah)) {</a>
<a name="ln3808">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3809">                ar9331_modes_high_ob_db_tx_gain_hornet1_2, </a>
<a name="ln3810">                ARRAY_LENGTH(ar9331_modes_high_ob_db_tx_gain_hornet1_2), 5);</a>
<a name="ln3811">        } else if (AR_SREV_HORNET_11(ah)) {</a>
<a name="ln3812">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3813">                ar9331_modes_high_ob_db_tx_gain_hornet1_1, </a>
<a name="ln3814">                ARRAY_LENGTH(ar9331_modes_high_ob_db_tx_gain_hornet1_1), 5);</a>
<a name="ln3815">        } else if (AR_SREV_POSEIDON_11_OR_LATER(ah)) {</a>
<a name="ln3816">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3817">                ar9485_modes_high_ob_db_tx_gain_poseidon1_1, </a>
<a name="ln3818">                ARRAY_LENGTH(ar9485_modes_high_ob_db_tx_gain_poseidon1_1), 5);</a>
<a name="ln3819">        } else if (AR_SREV_POSEIDON(ah)) {</a>
<a name="ln3820">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3821">                ar9485Modes_high_ob_db_tx_gain_poseidon1_0, </a>
<a name="ln3822">                ARRAY_LENGTH(ar9485Modes_high_ob_db_tx_gain_poseidon1_0), 5);</a>
<a name="ln3823">        } else if (AR_SREV_AR9580(ah)) {</a>
<a name="ln3824">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3825">                ar9300Modes_high_ob_db_tx_gain_table_ar9580_1p0,</a>
<a name="ln3826">                ARRAY_LENGTH(ar9300Modes_high_ob_db_tx_gain_table_ar9580_1p0),</a>
<a name="ln3827">                5);</a>
<a name="ln3828">        } else if (AR_SREV_WASP(ah)) {</a>
<a name="ln3829">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3830">                ar9340Modes_high_ob_db_tx_gain_table_wasp_1p0,</a>
<a name="ln3831">                ARRAY_LENGTH(ar9340Modes_high_ob_db_tx_gain_table_wasp_1p0), 5);</a>
<a name="ln3832">        } else if (AR_SREV_SCORPION(ah)) {</a>
<a name="ln3833">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3834">                ar955xModes_no_xpa_tx_gain_table_scorpion_1p0,</a>
<a name="ln3835">                ARRAY_LENGTH(ar955xModes_no_xpa_tx_gain_table_scorpion_1p0), 9);</a>
<a name="ln3836">        } else if (AR_SREV_JUPITER_10(ah)) {</a>
<a name="ln3837">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3838">                ar9300_modes_high_ob_db_tx_gain_table_jupiter_1p0,</a>
<a name="ln3839">                ARRAY_LENGTH(</a>
<a name="ln3840">                ar9300_modes_high_ob_db_tx_gain_table_jupiter_1p0), 5);</a>
<a name="ln3841">        } else if (AR_SREV_JUPITER_20(ah)) {</a>
<a name="ln3842">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3843">                ar9300Modes_high_ob_db_tx_gain_table_jupiter_2p0,</a>
<a name="ln3844">                ARRAY_LENGTH(</a>
<a name="ln3845">                ar9300Modes_high_ob_db_tx_gain_table_jupiter_2p0), 5);</a>
<a name="ln3846">        } else if (AR_SREV_JUPITER_21(ah)) {</a>
<a name="ln3847">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3848">                ar9462_2p1_modes_high_ob_db_tx_gain,</a>
<a name="ln3849">                ARRAY_LENGTH(</a>
<a name="ln3850">                ar9462_2p1_modes_high_ob_db_tx_gain), 5);</a>
<a name="ln3851">        } else if (AR_SREV_APHRODITE(ah)) {</a>
<a name="ln3852">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3853">                ar956XModes_high_ob_db_tx_gain_table_aphrodite_1p0,</a>
<a name="ln3854">                ARRAY_LENGTH(</a>
<a name="ln3855">                ar956XModes_high_ob_db_tx_gain_table_aphrodite_1p0), 5);</a>
<a name="ln3856">        } else if (AR_SREV_HONEYBEE(ah)) {</a>
<a name="ln3857">            if (AR_SREV_HONEYBEE_11(ah)) {</a>
<a name="ln3858">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3859">                    qca953xModes_no_xpa_tx_gain_table_honeybee_1p1,</a>
<a name="ln3860">                    ARRAY_LENGTH(qca953xModes_no_xpa_tx_gain_table_honeybee_1p1), 2);</a>
<a name="ln3861">            } else {</a>
<a name="ln3862">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3863">                    qca953xModes_no_xpa_tx_gain_table_honeybee_1p0,</a>
<a name="ln3864">                    ARRAY_LENGTH(qca953xModes_no_xpa_tx_gain_table_honeybee_1p0), 2);</a>
<a name="ln3865">            }</a>
<a name="ln3866">        } else {</a>
<a name="ln3867">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3868">                ar9300Modes_high_ob_db_tx_gain_table_osprey_2p2,</a>
<a name="ln3869">                ARRAY_LENGTH(ar9300Modes_high_ob_db_tx_gain_table_osprey_2p2),</a>
<a name="ln3870">                5);</a>
<a name="ln3871">        }</a>
<a name="ln3872">        break;</a>
<a name="ln3873">    case 2:</a>
<a name="ln3874">        if (AR_SREV_HORNET_12(ah)) {</a>
<a name="ln3875">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3876">                ar9331_modes_low_ob_db_tx_gain_hornet1_2, </a>
<a name="ln3877">                ARRAY_LENGTH(ar9331_modes_low_ob_db_tx_gain_hornet1_2), 5);</a>
<a name="ln3878">        } else if (AR_SREV_HORNET_11(ah)) {</a>
<a name="ln3879">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3880">                ar9331_modes_low_ob_db_tx_gain_hornet1_1, </a>
<a name="ln3881">                ARRAY_LENGTH(ar9331_modes_low_ob_db_tx_gain_hornet1_1), 5);</a>
<a name="ln3882">        } else if (AR_SREV_POSEIDON_11_OR_LATER(ah)) {</a>
<a name="ln3883">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3884">                ar9485_modes_low_ob_db_tx_gain_poseidon1_1, </a>
<a name="ln3885">                ARRAY_LENGTH(ar9485_modes_low_ob_db_tx_gain_poseidon1_1), 5);</a>
<a name="ln3886">        } else if (AR_SREV_POSEIDON(ah)) {</a>
<a name="ln3887">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3888">                ar9485Modes_low_ob_db_tx_gain_poseidon1_0, </a>
<a name="ln3889">                ARRAY_LENGTH(ar9485Modes_low_ob_db_tx_gain_poseidon1_0), 5);</a>
<a name="ln3890">        } else if (AR_SREV_AR9580(ah)) {</a>
<a name="ln3891">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3892">                ar9300Modes_low_ob_db_tx_gain_table_ar9580_1p0,</a>
<a name="ln3893">                ARRAY_LENGTH(ar9300Modes_low_ob_db_tx_gain_table_ar9580_1p0),</a>
<a name="ln3894">                5);</a>
<a name="ln3895">        } else if (AR_SREV_WASP(ah)) {</a>
<a name="ln3896">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3897">                ar9340Modes_low_ob_db_tx_gain_table_wasp_1p0,</a>
<a name="ln3898">                ARRAY_LENGTH(ar9340Modes_low_ob_db_tx_gain_table_wasp_1p0), 5);</a>
<a name="ln3899">        } else if (AR_SREV_APHRODITE(ah)) {</a>
<a name="ln3900">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3901">                ar956XModes_low_ob_db_tx_gain_table_aphrodite_1p0, </a>
<a name="ln3902">                ARRAY_LENGTH(ar956XModes_low_ob_db_tx_gain_table_aphrodite_1p0), 5);</a>
<a name="ln3903">        } else {</a>
<a name="ln3904">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3905">                ar9300Modes_low_ob_db_tx_gain_table_osprey_2p2,</a>
<a name="ln3906">                ARRAY_LENGTH(ar9300Modes_low_ob_db_tx_gain_table_osprey_2p2),</a>
<a name="ln3907">                5);</a>
<a name="ln3908">        }</a>
<a name="ln3909">        break;</a>
<a name="ln3910">    case 3:</a>
<a name="ln3911">        if (AR_SREV_HORNET_12(ah)) {</a>
<a name="ln3912">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3913">                ar9331_modes_high_power_tx_gain_hornet1_2, </a>
<a name="ln3914">                ARRAY_LENGTH(ar9331_modes_high_power_tx_gain_hornet1_2), 5);</a>
<a name="ln3915">        } else if (AR_SREV_HORNET_11(ah)) {</a>
<a name="ln3916">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3917">                ar9331_modes_high_power_tx_gain_hornet1_1, </a>
<a name="ln3918">                ARRAY_LENGTH(ar9331_modes_high_power_tx_gain_hornet1_1), 5);</a>
<a name="ln3919">        } else if (AR_SREV_POSEIDON_11_OR_LATER(ah)) {</a>
<a name="ln3920">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3921">                ar9485_modes_high_power_tx_gain_poseidon1_1, </a>
<a name="ln3922">                ARRAY_LENGTH(ar9485_modes_high_power_tx_gain_poseidon1_1), 5);</a>
<a name="ln3923">        } else if (AR_SREV_POSEIDON(ah)) {</a>
<a name="ln3924">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3925">                ar9485Modes_high_power_tx_gain_poseidon1_0, </a>
<a name="ln3926">                ARRAY_LENGTH(ar9485Modes_high_power_tx_gain_poseidon1_0), 5);</a>
<a name="ln3927">        } else if (AR_SREV_AR9580(ah)) {</a>
<a name="ln3928">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3929">                ar9300Modes_high_power_tx_gain_table_ar9580_1p0,</a>
<a name="ln3930">                ARRAY_LENGTH(ar9300Modes_high_power_tx_gain_table_ar9580_1p0),</a>
<a name="ln3931">                5);</a>
<a name="ln3932">        } else if (AR_SREV_WASP(ah)) {</a>
<a name="ln3933">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3934">                ar9340Modes_high_power_tx_gain_table_wasp_1p0,</a>
<a name="ln3935">                ARRAY_LENGTH(ar9340Modes_high_power_tx_gain_table_wasp_1p0),</a>
<a name="ln3936">                5);</a>
<a name="ln3937">        } else if (AR_SREV_APHRODITE(ah)) {</a>
<a name="ln3938">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3939">                ar956XModes_high_power_tx_gain_table_aphrodite_1p0, </a>
<a name="ln3940">                ARRAY_LENGTH(ar956XModes_high_power_tx_gain_table_aphrodite_1p0), 5);</a>
<a name="ln3941">        } else {</a>
<a name="ln3942">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3943">                ar9300Modes_high_power_tx_gain_table_osprey_2p2,</a>
<a name="ln3944">                ARRAY_LENGTH(ar9300Modes_high_power_tx_gain_table_osprey_2p2),</a>
<a name="ln3945">                5);</a>
<a name="ln3946">        }</a>
<a name="ln3947">        break;</a>
<a name="ln3948">    case 4:</a>
<a name="ln3949">        if (AR_SREV_WASP(ah)) {</a>
<a name="ln3950">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3951">                ar9340Modes_mixed_ob_db_tx_gain_table_wasp_1p0,</a>
<a name="ln3952">                ARRAY_LENGTH(ar9340Modes_mixed_ob_db_tx_gain_table_wasp_1p0),</a>
<a name="ln3953">                5);</a>
<a name="ln3954">        } else if (AR_SREV_AR9580(ah)) {</a>
<a name="ln3955">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3956">                ar9300_modes_mixed_ob_db_tx_gain_table_ar9580_1p0,</a>
<a name="ln3957">                ARRAY_LENGTH(ar9300_modes_mixed_ob_db_tx_gain_table_ar9580_1p0),</a>
<a name="ln3958">                5);</a>
<a name="ln3959">        } else {</a>
<a name="ln3960">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain, </a>
<a name="ln3961">		ar9300Modes_mixed_ob_db_tx_gain_table_osprey_2p2,</a>
<a name="ln3962">                ARRAY_LENGTH(ar9300Modes_mixed_ob_db_tx_gain_table_osprey_2p2),</a>
<a name="ln3963">		 5);</a>
<a name="ln3964">        }</a>
<a name="ln3965">        break;</a>
<a name="ln3966">    case 5:</a>
<a name="ln3967">        /* HW Green TX */</a>
<a name="ln3968">        if (AR_SREV_POSEIDON(ah)) {</a>
<a name="ln3969">            if (AR_SREV_POSEIDON_11_OR_LATER(ah)) {</a>
<a name="ln3970">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain, </a>
<a name="ln3971">                    ar9485_modes_green_ob_db_tx_gain_poseidon1_1,</a>
<a name="ln3972">                    sizeof(ar9485_modes_green_ob_db_tx_gain_poseidon1_1) /</a>
<a name="ln3973">                    sizeof(ar9485_modes_green_ob_db_tx_gain_poseidon1_1[0]), 5);</a>
<a name="ln3974">            } else {</a>
<a name="ln3975">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain, </a>
<a name="ln3976">                    ar9485_modes_green_ob_db_tx_gain_poseidon1_0,</a>
<a name="ln3977">                    sizeof(ar9485_modes_green_ob_db_tx_gain_poseidon1_0) /</a>
<a name="ln3978">                    sizeof(ar9485_modes_green_ob_db_tx_gain_poseidon1_0[0]), 5);</a>
<a name="ln3979">            }</a>
<a name="ln3980">            ahp-&gt;ah_hw_green_tx_enable = 1;</a>
<a name="ln3981">        }</a>
<a name="ln3982">        else if (AR_SREV_WASP(ah)) {</a>
<a name="ln3983">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain, </a>
<a name="ln3984">            ar9340_modes_ub124_tx_gain_table_wasp_1p0,</a>
<a name="ln3985">            sizeof(ar9340_modes_ub124_tx_gain_table_wasp_1p0) /</a>
<a name="ln3986">            sizeof(ar9340_modes_ub124_tx_gain_table_wasp_1p0[0]), 5);</a>
<a name="ln3987">        }</a>
<a name="ln3988">        else if (AR_SREV_AR9580(ah)) {</a>
<a name="ln3989">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3990">                ar9300_modes_type5_tx_gain_table_ar9580_1p0,</a>
<a name="ln3991">                ARRAY_LENGTH( ar9300_modes_type5_tx_gain_table_ar9580_1p0),</a>
<a name="ln3992">                5);</a>
<a name="ln3993">        } </a>
<a name="ln3994">        else if (AR_SREV_OSPREY_22(ah)) {</a>
<a name="ln3995">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln3996">                ar9300_modes_number_5_tx_gain_table_osprey_2p2,</a>
<a name="ln3997">                ARRAY_LENGTH( ar9300_modes_number_5_tx_gain_table_osprey_2p2),</a>
<a name="ln3998">                5);</a>
<a name="ln3999">        }</a>
<a name="ln4000">        break;</a>
<a name="ln4001">	case 6:</a>
<a name="ln4002">        if (AR_SREV_WASP(ah)) {</a>
<a name="ln4003">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln4004">            ar9340_modes_low_ob_db_and_spur_tx_gain_table_wasp_1p0,</a>
<a name="ln4005">            sizeof(ar9340_modes_low_ob_db_and_spur_tx_gain_table_wasp_1p0) /</a>
<a name="ln4006">            sizeof(ar9340_modes_low_ob_db_and_spur_tx_gain_table_wasp_1p0[0]), 5);</a>
<a name="ln4007">        }</a>
<a name="ln4008">        /* HW Green TX */</a>
<a name="ln4009">        else if (AR_SREV_POSEIDON(ah)) {</a>
<a name="ln4010">            if (AR_SREV_POSEIDON_11_OR_LATER(ah)) {</a>
<a name="ln4011">                INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain, </a>
<a name="ln4012">                ar9485_modes_green_spur_ob_db_tx_gain_poseidon1_1,</a>
<a name="ln4013">                sizeof(ar9485_modes_green_spur_ob_db_tx_gain_poseidon1_1) /</a>
<a name="ln4014">                sizeof(ar9485_modes_green_spur_ob_db_tx_gain_poseidon1_1[0]),</a>
<a name="ln4015">                5);</a>
<a name="ln4016">            }</a>
<a name="ln4017">            ahp-&gt;ah_hw_green_tx_enable = 1;</a>
<a name="ln4018">	}</a>
<a name="ln4019">        else if (AR_SREV_AR9580(ah)) {</a>
<a name="ln4020">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain,</a>
<a name="ln4021">                ar9300_modes_type6_tx_gain_table_ar9580_1p0,</a>
<a name="ln4022">                ARRAY_LENGTH( ar9300_modes_type6_tx_gain_table_ar9580_1p0),</a>
<a name="ln4023">                5);</a>
<a name="ln4024">        }</a>
<a name="ln4025">        break;</a>
<a name="ln4026">	case 7:</a>
<a name="ln4027">		if (AR_SREV_WASP(ah)) {</a>
<a name="ln4028">            INIT_INI_ARRAY(&amp;ahp-&gt;ah_ini_modes_txgain, </a>
<a name="ln4029">            ar9340Modes_cus227_tx_gain_table_wasp_1p0,</a>
<a name="ln4030">            sizeof(ar9340Modes_cus227_tx_gain_table_wasp_1p0) /</a>
<a name="ln4031">            sizeof(ar9340Modes_cus227_tx_gain_table_wasp_1p0[0]), 5);</a>
<a name="ln4032">		}</a>
<a name="ln4033">		break;</a>
<a name="ln4034">    }</a>
<a name="ln4035">}</a>
<a name="ln4036"> </a>
<a name="ln4037">#if ATH_ANT_DIV_COMB</a>
<a name="ln4038">void</a>
<a name="ln4039">ar9300_ant_div_comb_get_config(struct ath_hal *ah,</a>
<a name="ln4040">    HAL_ANT_COMB_CONFIG *div_comb_conf)</a>
<a name="ln4041">{</a>
<a name="ln4042">    u_int32_t reg_val = OS_REG_READ(ah, AR_PHY_MC_GAIN_CTRL);</a>
<a name="ln4043">    div_comb_conf-&gt;main_lna_conf = </a>
<a name="ln4044">        MULTICHAIN_GAIN_CTRL__ANT_DIV_MAIN_LNACONF__READ(reg_val);</a>
<a name="ln4045">    div_comb_conf-&gt;alt_lna_conf = </a>
<a name="ln4046">        MULTICHAIN_GAIN_CTRL__ANT_DIV_ALT_LNACONF__READ(reg_val);</a>
<a name="ln4047">    div_comb_conf-&gt;fast_div_bias = </a>
<a name="ln4048">        MULTICHAIN_GAIN_CTRL__ANT_FAST_DIV_BIAS__READ(reg_val); </a>
<a name="ln4049">    if (AR_SREV_HORNET_11(ah)) {</a>
<a name="ln4050">        div_comb_conf-&gt;antdiv_configgroup = HAL_ANTDIV_CONFIG_GROUP_1;</a>
<a name="ln4051">    } else if (AR_SREV_POSEIDON_11_OR_LATER(ah)) {</a>
<a name="ln4052">        div_comb_conf-&gt;antdiv_configgroup = HAL_ANTDIV_CONFIG_GROUP_2;</a>
<a name="ln4053">    } else {</a>
<a name="ln4054">        div_comb_conf-&gt;antdiv_configgroup = DEFAULT_ANTDIV_CONFIG_GROUP;</a>
<a name="ln4055">    }</a>
<a name="ln4056"> </a>
<a name="ln4057">    /*</a>
<a name="ln4058">     * XXX TODO: allow the HAL to override the rssithres and fast_div_bias</a>
<a name="ln4059">     * values (eg CUS198.)</a>
<a name="ln4060">     */</a>
<a name="ln4061">}</a>
<a name="ln4062"> </a>
<a name="ln4063">void</a>
<a name="ln4064">ar9300_ant_div_comb_set_config(struct ath_hal *ah,</a>
<a name="ln4065">    HAL_ANT_COMB_CONFIG *div_comb_conf)</a>
<a name="ln4066">{</a>
<a name="ln4067">    u_int32_t reg_val;</a>
<a name="ln4068">    struct ath_hal_9300 *ahp = AH9300(ah);</a>
<a name="ln4069"> </a>
<a name="ln4070">    /* DO NOTHING when set to fixed antenna for manufacturing purpose */</a>
<a name="ln4071">    if (AR_SREV_POSEIDON(ah) &amp;&amp; ( ahp-&gt;ah_diversity_control == HAL_ANT_FIXED_A </a>
<a name="ln4072">         || ahp-&gt;ah_diversity_control == HAL_ANT_FIXED_B)) {</a>
<a name="ln4073">        return;</a>
<a name="ln4074">    }</a>
<a name="ln4075">    reg_val = OS_REG_READ(ah, AR_PHY_MC_GAIN_CTRL);</a>
<a name="ln4076">    reg_val &amp;= ~(MULTICHAIN_GAIN_CTRL__ANT_DIV_MAIN_LNACONF__MASK    | </a>
<a name="ln4077">                MULTICHAIN_GAIN_CTRL__ANT_DIV_ALT_LNACONF__MASK     |</a>
<a name="ln4078">                MULTICHAIN_GAIN_CTRL__ANT_FAST_DIV_BIAS__MASK       |</a>
<a name="ln4079">                MULTICHAIN_GAIN_CTRL__ANT_DIV_MAIN_GAINTB__MASK     |</a>
<a name="ln4080">                MULTICHAIN_GAIN_CTRL__ANT_DIV_ALT_GAINTB__MASK );</a>
<a name="ln4081">    reg_val |=</a>
<a name="ln4082">        MULTICHAIN_GAIN_CTRL__ANT_DIV_MAIN_GAINTB__WRITE(</a>
<a name="ln4083">        div_comb_conf-&gt;main_gaintb);</a>
<a name="ln4084">    reg_val |=</a>
<a name="ln4085">        MULTICHAIN_GAIN_CTRL__ANT_DIV_ALT_GAINTB__WRITE(</a>
<a name="ln4086">        div_comb_conf-&gt;alt_gaintb);</a>
<a name="ln4087">    reg_val |= </a>
<a name="ln4088">        MULTICHAIN_GAIN_CTRL__ANT_DIV_MAIN_LNACONF__WRITE(</a>
<a name="ln4089">        div_comb_conf-&gt;main_lna_conf);</a>
<a name="ln4090">    reg_val |= </a>
<a name="ln4091">        MULTICHAIN_GAIN_CTRL__ANT_DIV_ALT_LNACONF__WRITE(</a>
<a name="ln4092">        div_comb_conf-&gt;alt_lna_conf);</a>
<a name="ln4093">    reg_val |= </a>
<a name="ln4094">        MULTICHAIN_GAIN_CTRL__ANT_FAST_DIV_BIAS__WRITE(</a>
<a name="ln4095">        div_comb_conf-&gt;fast_div_bias);</a>
<a name="ln4096">    OS_REG_WRITE(ah, AR_PHY_MC_GAIN_CTRL, reg_val);</a>
<a name="ln4097"> </a>
<a name="ln4098">}</a>
<a name="ln4099">#endif /* ATH_ANT_DIV_COMB */</a>
<a name="ln4100"> </a>
<a name="ln4101">static void </a>
<a name="ln4102">ar9300_init_hostif_offsets(struct ath_hal *ah)</a>
<a name="ln4103">{</a>
<a name="ln4104">    AR_HOSTIF_REG(ah, AR_RC) =</a>
<a name="ln4105">        AR9300_HOSTIF_OFFSET(HOST_INTF_RESET_CONTROL);</a>
<a name="ln4106">    AR_HOSTIF_REG(ah, AR_WA) =</a>
<a name="ln4107">        AR9300_HOSTIF_OFFSET(HOST_INTF_WORK_AROUND);                   </a>
<a name="ln4108">    AR_HOSTIF_REG(ah, AR_PM_STATE) =</a>
<a name="ln4109">        AR9300_HOSTIF_OFFSET(HOST_INTF_PM_STATE);</a>
<a name="ln4110">    AR_HOSTIF_REG(ah, AR_H_INFOL) =</a>
<a name="ln4111">        AR9300_HOSTIF_OFFSET(HOST_INTF_CXPL_DEBUG_INFOL);</a>
<a name="ln4112">    AR_HOSTIF_REG(ah, AR_H_INFOH) =</a>
<a name="ln4113">        AR9300_HOSTIF_OFFSET(HOST_INTF_CXPL_DEBUG_INFOH);</a>
<a name="ln4114">    AR_HOSTIF_REG(ah, AR_PCIE_PM_CTRL) =</a>
<a name="ln4115">        AR9300_HOSTIF_OFFSET(HOST_INTF_PM_CTRL);</a>
<a name="ln4116">    AR_HOSTIF_REG(ah, AR_HOST_TIMEOUT) =</a>
<a name="ln4117">        AR9300_HOSTIF_OFFSET(HOST_INTF_TIMEOUT);</a>
<a name="ln4118">    AR_HOSTIF_REG(ah, AR_EEPROM) =</a>
<a name="ln4119">        AR9300_HOSTIF_OFFSET(HOST_INTF_EEPROM_CTRL);</a>
<a name="ln4120">    AR_HOSTIF_REG(ah, AR_SREV) =</a>
<a name="ln4121">        AR9300_HOSTIF_OFFSET(HOST_INTF_SREV);</a>
<a name="ln4122">    AR_HOSTIF_REG(ah, AR_INTR_SYNC_CAUSE) =</a>
<a name="ln4123">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_SYNC_CAUSE);</a>
<a name="ln4124">    AR_HOSTIF_REG(ah, AR_INTR_SYNC_CAUSE_CLR) =</a>
<a name="ln4125">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_SYNC_CAUSE);</a>
<a name="ln4126">    AR_HOSTIF_REG(ah, AR_INTR_SYNC_ENABLE) =</a>
<a name="ln4127">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_SYNC_ENABLE);</a>
<a name="ln4128">    AR_HOSTIF_REG(ah, AR_INTR_ASYNC_MASK) =</a>
<a name="ln4129">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_ASYNC_MASK);</a>
<a name="ln4130">    AR_HOSTIF_REG(ah, AR_INTR_SYNC_MASK) =</a>
<a name="ln4131">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_SYNC_MASK);</a>
<a name="ln4132">    AR_HOSTIF_REG(ah, AR_INTR_ASYNC_CAUSE_CLR) =</a>
<a name="ln4133">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_ASYNC_CAUSE);</a>
<a name="ln4134">    AR_HOSTIF_REG(ah, AR_INTR_ASYNC_CAUSE) =</a>
<a name="ln4135">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_ASYNC_CAUSE);</a>
<a name="ln4136">    AR_HOSTIF_REG(ah, AR_INTR_ASYNC_ENABLE) =</a>
<a name="ln4137">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_ASYNC_ENABLE);</a>
<a name="ln4138">    AR_HOSTIF_REG(ah, AR_PCIE_SERDES) =</a>
<a name="ln4139">        AR9300_HOSTIF_OFFSET(HOST_INTF_PCIE_PHY_RW);</a>
<a name="ln4140">    AR_HOSTIF_REG(ah, AR_PCIE_SERDES2) =</a>
<a name="ln4141">        AR9300_HOSTIF_OFFSET(HOST_INTF_PCIE_PHY_LOAD);</a>
<a name="ln4142">    AR_HOSTIF_REG(ah, AR_GPIO_OUT) =</a>
<a name="ln4143">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_OUT);</a>
<a name="ln4144">    AR_HOSTIF_REG(ah, AR_GPIO_IN) =</a>
<a name="ln4145">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_IN);</a>
<a name="ln4146">    AR_HOSTIF_REG(ah, AR_GPIO_OE_OUT) =</a>
<a name="ln4147">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_OE);</a>
<a name="ln4148">    AR_HOSTIF_REG(ah, AR_GPIO_OE1_OUT) =</a>
<a name="ln4149">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_OE1);</a>
<a name="ln4150">    AR_HOSTIF_REG(ah, AR_GPIO_INTR_POL) =</a>
<a name="ln4151">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_INTR_POLAR);</a>
<a name="ln4152">    AR_HOSTIF_REG(ah, AR_GPIO_INPUT_EN_VAL) =</a>
<a name="ln4153">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_INPUT_VALUE);</a>
<a name="ln4154">    AR_HOSTIF_REG(ah, AR_GPIO_INPUT_MUX1) =</a>
<a name="ln4155">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_INPUT_MUX1);</a>
<a name="ln4156">    AR_HOSTIF_REG(ah, AR_GPIO_INPUT_MUX2) =</a>
<a name="ln4157">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_INPUT_MUX2);</a>
<a name="ln4158">    AR_HOSTIF_REG(ah, AR_GPIO_OUTPUT_MUX1) =</a>
<a name="ln4159">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_OUTPUT_MUX1);</a>
<a name="ln4160">    AR_HOSTIF_REG(ah, AR_GPIO_OUTPUT_MUX2) =</a>
<a name="ln4161">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_OUTPUT_MUX2);</a>
<a name="ln4162">    AR_HOSTIF_REG(ah, AR_GPIO_OUTPUT_MUX3) =</a>
<a name="ln4163">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_OUTPUT_MUX3);</a>
<a name="ln4164">    AR_HOSTIF_REG(ah, AR_INPUT_STATE) =</a>
<a name="ln4165">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_INPUT_STATE);</a>
<a name="ln4166">    AR_HOSTIF_REG(ah, AR_SPARE) =</a>
<a name="ln4167">        AR9300_HOSTIF_OFFSET(HOST_INTF_SPARE);</a>
<a name="ln4168">    AR_HOSTIF_REG(ah, AR_PCIE_CORE_RESET_EN) =</a>
<a name="ln4169">        AR9300_HOSTIF_OFFSET(HOST_INTF_PCIE_CORE_RST_EN);</a>
<a name="ln4170">    AR_HOSTIF_REG(ah, AR_CLKRUN) =</a>
<a name="ln4171">        AR9300_HOSTIF_OFFSET(HOST_INTF_CLKRUN);</a>
<a name="ln4172">    AR_HOSTIF_REG(ah, AR_EEPROM_STATUS_DATA) =</a>
<a name="ln4173">        AR9300_HOSTIF_OFFSET(HOST_INTF_EEPROM_STS);</a>
<a name="ln4174">    AR_HOSTIF_REG(ah, AR_OBS) =</a>
<a name="ln4175">        AR9300_HOSTIF_OFFSET(HOST_INTF_OBS_CTRL);</a>
<a name="ln4176">    AR_HOSTIF_REG(ah, AR_RFSILENT) =</a>
<a name="ln4177">        AR9300_HOSTIF_OFFSET(HOST_INTF_RFSILENT);</a>
<a name="ln4178">    AR_HOSTIF_REG(ah, AR_GPIO_PDPU) =</a>
<a name="ln4179">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_PDPU);</a>
<a name="ln4180">    AR_HOSTIF_REG(ah, AR_GPIO_DS) =</a>
<a name="ln4181">        AR9300_HOSTIF_OFFSET(HOST_INTF_GPIO_DS);</a>
<a name="ln4182">    AR_HOSTIF_REG(ah, AR_MISC) =</a>
<a name="ln4183">        AR9300_HOSTIF_OFFSET(HOST_INTF_MISC);</a>
<a name="ln4184">    AR_HOSTIF_REG(ah, AR_PCIE_MSI) =</a>
<a name="ln4185">        AR9300_HOSTIF_OFFSET(HOST_INTF_PCIE_MSI);</a>
<a name="ln4186">#if 0   /* Offsets are not defined in reg_map structure */ </a>
<a name="ln4187">    AR_HOSTIF_REG(ah, AR_TSF_SNAPSHOT_BT_ACTIVE) =</a>
<a name="ln4188">        AR9300_HOSTIF_OFFSET(HOST_INTF_TSF_SNAPSHOT_BT_ACTIVE);</a>
<a name="ln4189">    AR_HOSTIF_REG(ah, AR_TSF_SNAPSHOT_BT_PRIORITY) =</a>
<a name="ln4190">        AR9300_HOSTIF_OFFSET(HOST_INTF_TSF_SNAPSHOT_BT_PRIORITY);</a>
<a name="ln4191">    AR_HOSTIF_REG(ah, AR_TSF_SNAPSHOT_BT_CNTL) =</a>
<a name="ln4192">        AR9300_HOSTIF_OFFSET(HOST_INTF_MAC_TSF_SNAPSHOT_BT_CNTL);</a>
<a name="ln4193">#endif</a>
<a name="ln4194">    AR_HOSTIF_REG(ah, AR_PCIE_PHY_LATENCY_NFTS_ADJ) =</a>
<a name="ln4195">        AR9300_HOSTIF_OFFSET(HOST_INTF_PCIE_PHY_LATENCY_NFTS_ADJ);</a>
<a name="ln4196">    AR_HOSTIF_REG(ah, AR_TDMA_CCA_CNTL) =</a>
<a name="ln4197">        AR9300_HOSTIF_OFFSET(HOST_INTF_MAC_TDMA_CCA_CNTL);</a>
<a name="ln4198">    AR_HOSTIF_REG(ah, AR_TXAPSYNC) =</a>
<a name="ln4199">        AR9300_HOSTIF_OFFSET(HOST_INTF_MAC_TXAPSYNC);</a>
<a name="ln4200">    AR_HOSTIF_REG(ah, AR_TXSYNC_INIT_SYNC_TMR) =</a>
<a name="ln4201">        AR9300_HOSTIF_OFFSET(HOST_INTF_MAC_TXSYNC_INITIAL_SYNC_TMR);</a>
<a name="ln4202">    AR_HOSTIF_REG(ah, AR_INTR_PRIO_SYNC_CAUSE) =</a>
<a name="ln4203">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_PRIORITY_SYNC_CAUSE);</a>
<a name="ln4204">    AR_HOSTIF_REG(ah, AR_INTR_PRIO_SYNC_ENABLE) =</a>
<a name="ln4205">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_PRIORITY_SYNC_ENABLE);</a>
<a name="ln4206">    AR_HOSTIF_REG(ah, AR_INTR_PRIO_ASYNC_MASK) =</a>
<a name="ln4207">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_PRIORITY_ASYNC_MASK);</a>
<a name="ln4208">    AR_HOSTIF_REG(ah, AR_INTR_PRIO_SYNC_MASK) =</a>
<a name="ln4209">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_PRIORITY_SYNC_MASK);</a>
<a name="ln4210">    AR_HOSTIF_REG(ah, AR_INTR_PRIO_ASYNC_CAUSE) =</a>
<a name="ln4211">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_PRIORITY_ASYNC_CAUSE);</a>
<a name="ln4212">    AR_HOSTIF_REG(ah, AR_INTR_PRIO_ASYNC_ENABLE) =</a>
<a name="ln4213">        AR9300_HOSTIF_OFFSET(HOST_INTF_INTR_PRIORITY_ASYNC_ENABLE);</a>
<a name="ln4214">}</a>
<a name="ln4215"> </a>
<a name="ln4216">static void </a>
<a name="ln4217">ar9340_init_hostif_offsets(struct ath_hal *ah)</a>
<a name="ln4218">{</a>
<a name="ln4219">    AR_HOSTIF_REG(ah, AR_RC) =</a>
<a name="ln4220">        AR9340_HOSTIF_OFFSET(HOST_INTF_RESET_CONTROL);</a>
<a name="ln4221">    AR_HOSTIF_REG(ah, AR_WA) =</a>
<a name="ln4222">        AR9340_HOSTIF_OFFSET(HOST_INTF_WORK_AROUND);                   </a>
<a name="ln4223">    AR_HOSTIF_REG(ah, AR_PCIE_PM_CTRL) =</a>
<a name="ln4224">        AR9340_HOSTIF_OFFSET(HOST_INTF_PM_CTRL);</a>
<a name="ln4225">    AR_HOSTIF_REG(ah, AR_HOST_TIMEOUT) =</a>
<a name="ln4226">        AR9340_HOSTIF_OFFSET(HOST_INTF_TIMEOUT);</a>
<a name="ln4227">    AR_HOSTIF_REG(ah, AR_SREV) =</a>
<a name="ln4228">        AR9340_HOSTIF_OFFSET(HOST_INTF_SREV);</a>
<a name="ln4229">    AR_HOSTIF_REG(ah, AR_INTR_SYNC_CAUSE) =</a>
<a name="ln4230">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_SYNC_CAUSE);</a>
<a name="ln4231">    AR_HOSTIF_REG(ah, AR_INTR_SYNC_CAUSE_CLR) =</a>
<a name="ln4232">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_SYNC_CAUSE);</a>
<a name="ln4233">    AR_HOSTIF_REG(ah, AR_INTR_SYNC_ENABLE) =</a>
<a name="ln4234">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_SYNC_ENABLE);</a>
<a name="ln4235">    AR_HOSTIF_REG(ah, AR_INTR_ASYNC_MASK) =</a>
<a name="ln4236">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_ASYNC_MASK);</a>
<a name="ln4237">    AR_HOSTIF_REG(ah, AR_INTR_SYNC_MASK) =</a>
<a name="ln4238">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_SYNC_MASK);</a>
<a name="ln4239">    AR_HOSTIF_REG(ah, AR_INTR_ASYNC_CAUSE_CLR) =</a>
<a name="ln4240">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_ASYNC_CAUSE);</a>
<a name="ln4241">    AR_HOSTIF_REG(ah, AR_INTR_ASYNC_CAUSE) =</a>
<a name="ln4242">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_ASYNC_CAUSE);</a>
<a name="ln4243">    AR_HOSTIF_REG(ah, AR_INTR_ASYNC_ENABLE) =</a>
<a name="ln4244">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_ASYNC_ENABLE);</a>
<a name="ln4245">    AR_HOSTIF_REG(ah, AR_GPIO_OUT) =</a>
<a name="ln4246">        AR9340_HOSTIF_OFFSET(HOST_INTF_GPIO_OUT);</a>
<a name="ln4247">    AR_HOSTIF_REG(ah, AR_GPIO_IN) =</a>
<a name="ln4248">        AR9340_HOSTIF_OFFSET(HOST_INTF_GPIO_IN);</a>
<a name="ln4249">    AR_HOSTIF_REG(ah, AR_GPIO_OE_OUT) =</a>
<a name="ln4250">        AR9340_HOSTIF_OFFSET(HOST_INTF_GPIO_OE);</a>
<a name="ln4251">    AR_HOSTIF_REG(ah, AR_GPIO_OE1_OUT) =</a>
<a name="ln4252">        AR9340_HOSTIF_OFFSET(HOST_INTF_GPIO_OE1);</a>
<a name="ln4253">    AR_HOSTIF_REG(ah, AR_GPIO_INTR_POL) =</a>
<a name="ln4254">        AR9340_HOSTIF_OFFSET(HOST_INTF_GPIO_INTR_POLAR);</a>
<a name="ln4255">    AR_HOSTIF_REG(ah, AR_GPIO_INPUT_EN_VAL) =</a>
<a name="ln4256">        AR9340_HOSTIF_OFFSET(HOST_INTF_GPIO_INPUT_VALUE);</a>
<a name="ln4257">    AR_HOSTIF_REG(ah, AR_GPIO_INPUT_MUX1) =</a>
<a name="ln4258">        AR9340_HOSTIF_OFFSET(HOST_INTF_GPIO_INPUT_MUX1);</a>
<a name="ln4259">    AR_HOSTIF_REG(ah, AR_GPIO_INPUT_MUX2) =</a>
<a name="ln4260">        AR9340_HOSTIF_OFFSET(HOST_INTF_GPIO_INPUT_MUX2);</a>
<a name="ln4261">    AR_HOSTIF_REG(ah, AR_GPIO_OUTPUT_MUX1) =</a>
<a name="ln4262">        AR9340_HOSTIF_OFFSET(HOST_INTF_GPIO_OUTPUT_MUX1);</a>
<a name="ln4263">    AR_HOSTIF_REG(ah, AR_GPIO_OUTPUT_MUX2) =</a>
<a name="ln4264">        AR9340_HOSTIF_OFFSET(HOST_INTF_GPIO_OUTPUT_MUX2);</a>
<a name="ln4265">    AR_HOSTIF_REG(ah, AR_GPIO_OUTPUT_MUX3) =</a>
<a name="ln4266">        AR9340_HOSTIF_OFFSET(HOST_INTF_GPIO_OUTPUT_MUX3);</a>
<a name="ln4267">    AR_HOSTIF_REG(ah, AR_INPUT_STATE) =</a>
<a name="ln4268">        AR9340_HOSTIF_OFFSET(HOST_INTF_GPIO_INPUT_STATE);</a>
<a name="ln4269">    AR_HOSTIF_REG(ah, AR_CLKRUN) =</a>
<a name="ln4270">        AR9340_HOSTIF_OFFSET(HOST_INTF_CLKRUN);</a>
<a name="ln4271">    AR_HOSTIF_REG(ah, AR_EEPROM_STATUS_DATA) =</a>
<a name="ln4272">        AR9340_HOSTIF_OFFSET(HOST_INTF_EEPROM_STS);</a>
<a name="ln4273">    AR_HOSTIF_REG(ah, AR_OBS) =</a>
<a name="ln4274">        AR9340_HOSTIF_OFFSET(HOST_INTF_OBS_CTRL);</a>
<a name="ln4275">    AR_HOSTIF_REG(ah, AR_RFSILENT) =</a>
<a name="ln4276">        AR9340_HOSTIF_OFFSET(HOST_INTF_RFSILENT);</a>
<a name="ln4277">    AR_HOSTIF_REG(ah, AR_MISC) =</a>
<a name="ln4278">        AR9340_HOSTIF_OFFSET(HOST_INTF_MISC);</a>
<a name="ln4279">    AR_HOSTIF_REG(ah, AR_PCIE_MSI) =</a>
<a name="ln4280">        AR9340_HOSTIF_OFFSET(HOST_INTF_PCIE_MSI);</a>
<a name="ln4281">    AR_HOSTIF_REG(ah, AR_TDMA_CCA_CNTL) =</a>
<a name="ln4282">        AR9340_HOSTIF_OFFSET(HOST_INTF_MAC_TDMA_CCA_CNTL);</a>
<a name="ln4283">    AR_HOSTIF_REG(ah, AR_TXAPSYNC) =</a>
<a name="ln4284">        AR9340_HOSTIF_OFFSET(HOST_INTF_MAC_TXAPSYNC);</a>
<a name="ln4285">    AR_HOSTIF_REG(ah, AR_TXSYNC_INIT_SYNC_TMR) =</a>
<a name="ln4286">        AR9340_HOSTIF_OFFSET(HOST_INTF_MAC_TXSYNC_INITIAL_SYNC_TMR);</a>
<a name="ln4287">    AR_HOSTIF_REG(ah, AR_INTR_PRIO_SYNC_CAUSE) =</a>
<a name="ln4288">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_PRIORITY_SYNC_CAUSE);</a>
<a name="ln4289">    AR_HOSTIF_REG(ah, AR_INTR_PRIO_SYNC_ENABLE) =</a>
<a name="ln4290">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_PRIORITY_SYNC_ENABLE);</a>
<a name="ln4291">    AR_HOSTIF_REG(ah, AR_INTR_PRIO_ASYNC_MASK) =</a>
<a name="ln4292">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_PRIORITY_ASYNC_MASK);</a>
<a name="ln4293">    AR_HOSTIF_REG(ah, AR_INTR_PRIO_SYNC_MASK) =</a>
<a name="ln4294">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_PRIORITY_SYNC_MASK);</a>
<a name="ln4295">    AR_HOSTIF_REG(ah, AR_INTR_PRIO_ASYNC_CAUSE) =</a>
<a name="ln4296">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_PRIORITY_ASYNC_CAUSE);</a>
<a name="ln4297">    AR_HOSTIF_REG(ah, AR_INTR_PRIO_ASYNC_ENABLE) =</a>
<a name="ln4298">        AR9340_HOSTIF_OFFSET(HOST_INTF_INTR_PRIORITY_ASYNC_ENABLE);</a>
<a name="ln4299">}</a>
<a name="ln4300"> </a>
<a name="ln4301">/* </a>
<a name="ln4302"> * Host interface register offsets are different for Osprey and Wasp </a>
<a name="ln4303"> * and hence store the offsets in hal structure</a>
<a name="ln4304"> */</a>
<a name="ln4305">static int ar9300_init_offsets(struct ath_hal *ah, u_int16_t devid)</a>
<a name="ln4306">{</a>
<a name="ln4307">    if (devid == AR9300_DEVID_AR9340) {</a>
<a name="ln4308">        ar9340_init_hostif_offsets(ah);</a>
<a name="ln4309">    } else {</a>
<a name="ln4310">        ar9300_init_hostif_offsets(ah);</a>
<a name="ln4311">    }</a>
<a name="ln4312">    return 0;</a>
<a name="ln4313">}</a>
<a name="ln4314"> </a>
<a name="ln4315"> </a>
<a name="ln4316">static const char*</a>
<a name="ln4317">ar9300_probe(uint16_t vendorid, uint16_t devid)</a>
<a name="ln4318">{</a>
<a name="ln4319">    if (vendorid != ATHEROS_VENDOR_ID)</a>
<a name="ln4320">        return AH_NULL;</a>
<a name="ln4321"> </a>
<a name="ln4322">    switch (devid) {</a>
<a name="ln4323">    case AR9300_DEVID_AR9380_PCIE: /* PCIE (Osprey) */</a>
<a name="ln4324">        return &quot;Atheros AR938x&quot;;</a>
<a name="ln4325">    case AR9300_DEVID_AR9340: /* Wasp */</a>
<a name="ln4326">        return &quot;Atheros AR934x&quot;;</a>
<a name="ln4327">    case AR9300_DEVID_AR9485_PCIE: /* Poseidon */</a>
<a name="ln4328">        return &quot;Atheros AR9485&quot;;</a>
<a name="ln4329">    case AR9300_DEVID_AR9580_PCIE: /* Peacock */</a>
<a name="ln4330">        return &quot;Atheros AR9580&quot;;</a>
<a name="ln4331">    case AR9300_DEVID_AR946X_PCIE: /* AR9462, AR9463, AR9482 */</a>
<a name="ln4332">        return &quot;Atheros AR946x/AR948x&quot;;</a>
<a name="ln4333">    case AR9300_DEVID_AR9330: /* Hornet */</a>
<a name="ln4334">        return &quot;Atheros AR933x&quot;;</a>
<a name="ln4335">    case AR9300_DEVID_QCA955X: /* Scorpion */</a>
<a name="ln4336">        return &quot;Qualcomm Atheros QCA955x&quot;;</a>
<a name="ln4337">    case AR9300_DEVID_QCA9565: /* Aphrodite */</a>
<a name="ln4338">         return &quot;Qualcomm Atheros AR9565&quot;;</a>
<a name="ln4339">    case AR9300_DEVID_QCA953X: /* Honeybee */</a>
<a name="ln4340">         return &quot;Qualcomm Atheros QCA953x&quot;;</a>
<a name="ln4341">    case AR9300_DEVID_AR1111_PCIE:</a>
<a name="ln4342">         return &quot;Atheros AR1111&quot;;</a>
<a name="ln4343">    default:</a>
<a name="ln4344">        return AH_NULL;</a>
<a name="ln4345">    }</a>
<a name="ln4346"> </a>
<a name="ln4347">    return AH_NULL;</a>
<a name="ln4348">}</a>
<a name="ln4349"> </a>
<a name="ln4350">AH_CHIP(AR9300, ar9300_probe, ar9300_attach);</a>
<a name="ln4351"> </a>

</code></pre>
<div class="balloon" rel="1604"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v547/" target="_blank">V547</a> Expression is always false.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
