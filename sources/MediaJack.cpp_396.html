
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>MediaJack.cpp</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2"> * Copyright (c) 1999-2000, Eric Moon.</a>
<a name="ln3"> * All rights reserved.</a>
<a name="ln4"> *</a>
<a name="ln5"> * Redistribution and use in source and binary forms, with or without</a>
<a name="ln6"> * modification, are permitted provided that the following conditions</a>
<a name="ln7"> * are met:</a>
<a name="ln8"> *</a>
<a name="ln9"> * 1. Redistributions of source code must retain the above copyright</a>
<a name="ln10"> *    notice, this list of conditions, and the following disclaimer.</a>
<a name="ln11"> *</a>
<a name="ln12"> * 2. Redistributions in binary form must reproduce the above copyright</a>
<a name="ln13"> *    notice, this list of conditions, and the following disclaimer in the</a>
<a name="ln14"> *    documentation and/or other materials provided with the distribution.</a>
<a name="ln15"> *</a>
<a name="ln16"> * 3. The name of the author may not be used to endorse or promote products</a>
<a name="ln17"> *    derived from this software without specific prior written permission.</a>
<a name="ln18"> *</a>
<a name="ln19"> * THIS SOFTWARE IS PROVIDED BY THE AUTHOR &quot;AS IS&quot; AND ANY EXPRESS OR</a>
<a name="ln20"> * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</a>
<a name="ln21"> * OF TITLE, NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS FOR A PARTICULAR</a>
<a name="ln22"> * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY</a>
<a name="ln23"> * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</a>
<a name="ln24"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</a>
<a name="ln25"> * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED</a>
<a name="ln26"> * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR</a>
<a name="ln27"> * TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</a>
<a name="ln28"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</a>
<a name="ln29"> */</a>
<a name="ln30"> </a>
<a name="ln31"> </a>
<a name="ln32">// MediaJack.cpp</a>
<a name="ln33">// c.lenz 10oct99</a>
<a name="ln34"> </a>
<a name="ln35">#include &quot;MediaJack.h&quot;</a>
<a name="ln36">// MediaRoutingView</a>
<a name="ln37">#include &quot;MediaRoutingDefs.h&quot;</a>
<a name="ln38">#include &quot;MediaRoutingView.h&quot;</a>
<a name="ln39">#include &quot;MediaWire.h&quot;</a>
<a name="ln40">// InfoWindow</a>
<a name="ln41">#include &quot;InfoWindowManager.h&quot;</a>
<a name="ln42">// Support</a>
<a name="ln43">#include &quot;cortex_ui.h&quot;</a>
<a name="ln44">#include &quot;MediaString.h&quot;</a>
<a name="ln45">// TipManager</a>
<a name="ln46">#include &quot;TipManager.h&quot;</a>
<a name="ln47"> </a>
<a name="ln48">// Application Kit</a>
<a name="ln49">#include &lt;Application.h&gt;</a>
<a name="ln50">// Interface Kit</a>
<a name="ln51">#include &lt;Bitmap.h&gt;</a>
<a name="ln52">#include &lt;MenuItem.h&gt;</a>
<a name="ln53">#include &lt;PopUpMenu.h&gt;</a>
<a name="ln54"> </a>
<a name="ln55">__USE_CORTEX_NAMESPACE</a>
<a name="ln56"> </a>
<a name="ln57">#include &lt;Debug.h&gt;</a>
<a name="ln58">#define D_METHOD(x) //PRINT (x)</a>
<a name="ln59">#define D_DRAW(x) //PRINT (x)</a>
<a name="ln60">#define D_MOUSE(x) //PRINT (x)</a>
<a name="ln61"> </a>
<a name="ln62">// -------------------------------------------------------- //</a>
<a name="ln63">// constants</a>
<a name="ln64">// -------------------------------------------------------- //</a>
<a name="ln65"> </a>
<a name="ln66">float MediaJack::M_DEFAULT_WIDTH				= 5.0;</a>
<a name="ln67">float MediaJack::M_DEFAULT_HEIGHT				= 10.0;</a>
<a name="ln68">const float MediaJack::M_DEFAULT_GAP			= 5.0;</a>
<a name="ln69">const int32 MediaJack::M_MAX_ABBR_LENGTH		= 3;</a>
<a name="ln70"> </a>
<a name="ln71">// -------------------------------------------------------- //</a>
<a name="ln72">// *** ctor/dtor</a>
<a name="ln73">// -------------------------------------------------------- //</a>
<a name="ln74"> </a>
<a name="ln75">MediaJack::MediaJack(</a>
<a name="ln76">	media_input input)</a>
<a name="ln77">	: DiagramEndPoint(BRect(0.0, 0.0, M_DEFAULT_WIDTH, M_DEFAULT_HEIGHT)),</a>
<a name="ln78">	  m_jackType(M_INPUT),</a>
<a name="ln79">	  m_bitmap(0),</a>
<a name="ln80">	  m_index(input.destination.id),</a>
<a name="ln81">	  m_node(input.node),</a>
<a name="ln82">	  m_source(input.source),</a>
<a name="ln83">	  m_destination(input.destination),</a>
<a name="ln84">	  m_format(input.format),</a>
<a name="ln85">	  m_label(input.name),</a>
<a name="ln86">	  m_abbreviation(&quot;&quot;)</a>
<a name="ln87">{</a>
<a name="ln88">	D_METHOD((&quot;MediaJack::MediaJack()\n&quot;));</a>
<a name="ln89">	makeSelectable(false);</a>
<a name="ln90">	if (m_label == &quot;&quot;)</a>
<a name="ln91">		m_label = &quot;Input&quot;;</a>
<a name="ln92">	_updateAbbreviation();</a>
<a name="ln93">}</a>
<a name="ln94"> </a>
<a name="ln95">MediaJack::MediaJack(</a>
<a name="ln96">	media_output output)</a>
<a name="ln97">	: DiagramEndPoint(BRect(0.0, 0.0, M_DEFAULT_WIDTH, M_DEFAULT_HEIGHT)),</a>
<a name="ln98">	  m_jackType(M_OUTPUT),</a>
<a name="ln99">	  m_bitmap(0),</a>
<a name="ln100">	  m_index(output.source.id),</a>
<a name="ln101">	  m_node(output.node),</a>
<a name="ln102">	  m_source(output.source),</a>
<a name="ln103">	  m_destination(output.destination),</a>
<a name="ln104">	  m_format(output.format),</a>
<a name="ln105">	  m_label(output.name),</a>
<a name="ln106">	  m_abbreviation(&quot;&quot;)</a>
<a name="ln107">{</a>
<a name="ln108">	D_METHOD((&quot;MediaJack::MediaJack()\n&quot;));</a>
<a name="ln109">	makeSelectable(false);</a>
<a name="ln110">	if (m_label == &quot;&quot;)</a>
<a name="ln111">		m_label = &quot;Output&quot;;</a>
<a name="ln112">	_updateAbbreviation();</a>
<a name="ln113">}</a>
<a name="ln114"> </a>
<a name="ln115">MediaJack::~MediaJack()</a>
<a name="ln116">{</a>
<a name="ln117">	D_METHOD((&quot;MediaJack::~MediaJack()\n&quot;));</a>
<a name="ln118">	delete m_bitmap;</a>
<a name="ln119">}</a>
<a name="ln120"> </a>
<a name="ln121">// -------------------------------------------------------- //</a>
<a name="ln122">// *** accessors</a>
<a name="ln123">// -------------------------------------------------------- //</a>
<a name="ln124"> </a>
<a name="ln125">status_t MediaJack::getInput(</a>
<a name="ln126">	media_input *input) const</a>
<a name="ln127">{</a>
<a name="ln128">	D_METHOD((&quot;MediaJack::getInput()\n&quot;));</a>
<a name="ln129">	if (isInput())</a>
<a name="ln130">	{</a>
<a name="ln131">		input-&gt;node = m_node;</a>
<a name="ln132">		input-&gt;source = m_source;</a>
<a name="ln133">		input-&gt;destination = m_destination;</a>
<a name="ln134">		input-&gt;format = m_format;</a>
<a name="ln135">		strlcpy(input-&gt;name, m_label.String(), B_MEDIA_NAME_LENGTH);</a>
<a name="ln136">		return B_OK;</a>
<a name="ln137">	}</a>
<a name="ln138">	return B_ERROR;</a>
<a name="ln139">}</a>
<a name="ln140"> </a>
<a name="ln141">status_t MediaJack::getOutput(</a>
<a name="ln142">	media_output *output) const</a>
<a name="ln143">{</a>
<a name="ln144">	D_METHOD((&quot;MediaJack::getOutput()\n&quot;));</a>
<a name="ln145">	if (isOutput())</a>
<a name="ln146">	{</a>
<a name="ln147">		output-&gt;node = m_node;</a>
<a name="ln148">		output-&gt;source = m_source;</a>
<a name="ln149">		output-&gt;destination = m_destination;</a>
<a name="ln150">		output-&gt;format = m_format;</a>
<a name="ln151">		strlcpy(output-&gt;name, m_label.String(), B_MEDIA_NAME_LENGTH);</a>
<a name="ln152">		return B_OK;</a>
<a name="ln153">	}</a>
<a name="ln154">	return B_ERROR;</a>
<a name="ln155">}</a>
<a name="ln156"> </a>
<a name="ln157">// -------------------------------------------------------- //</a>
<a name="ln158">// *** derived from DiagramEndPoint (public)</a>
<a name="ln159">// -------------------------------------------------------- //</a>
<a name="ln160"> </a>
<a name="ln161">void MediaJack::attachedToDiagram()</a>
<a name="ln162">{</a>
<a name="ln163">	D_METHOD((&quot;MediaJack::attachedToDiagram()\n&quot;));</a>
<a name="ln164">	_updateBitmap();</a>
<a name="ln165">}</a>
<a name="ln166"> </a>
<a name="ln167">void MediaJack::detachedFromDiagram()</a>
<a name="ln168">{</a>
<a name="ln169">	D_METHOD((&quot;MediaJack::detachedFromDiagram()\n&quot;));</a>
<a name="ln170"> </a>
<a name="ln171">	// make sure we're no longer displaying a tooltip</a>
<a name="ln172">	TipManager *tips = TipManager::Instance();</a>
<a name="ln173">	tips-&gt;hideTip(view()-&gt;ConvertToScreen(Frame()));</a>
<a name="ln174">}</a>
<a name="ln175"> </a>
<a name="ln176">void MediaJack::drawEndPoint()</a>
<a name="ln177">{</a>
<a name="ln178">	D_DRAW((&quot;MediaJack::drawEndPoint()\n&quot;));</a>
<a name="ln179"> </a>
<a name="ln180">	if (m_bitmap)</a>
<a name="ln181">	{</a>
<a name="ln182">		view()-&gt;DrawBitmap(m_bitmap, Frame().LeftTop());</a>
<a name="ln183">	}</a>
<a name="ln184">}</a>
<a name="ln185"> </a>
<a name="ln186">BPoint MediaJack::connectionPoint() const</a>
<a name="ln187">{</a>
<a name="ln188">	D_METHOD((&quot;MediaJack::connectionPoint()\n&quot;));</a>
<a name="ln189"> </a>
<a name="ln190">	switch (dynamic_cast&lt;MediaRoutingView *&gt;(view())-&gt;getLayout())</a>
<a name="ln191">	{</a>
<a name="ln192">		case MediaRoutingView::M_ICON_VIEW:</a>
<a name="ln193">		{</a>
<a name="ln194">			if (isInput())</a>
<a name="ln195">			{</a>
<a name="ln196">				return BPoint(Frame().left - 1.0, Frame().top + Frame().Height() / 2.0);</a>
<a name="ln197">			}</a>
<a name="ln198">			else if (isOutput())</a>
<a name="ln199">			{</a>
<a name="ln200">				return BPoint(Frame().right + 1.0, Frame().top + Frame().Height() / 2.0);</a>
<a name="ln201">			}</a>
<a name="ln202">			break;</a>
<a name="ln203">		}</a>
<a name="ln204">		case MediaRoutingView::M_MINI_ICON_VIEW:</a>
<a name="ln205">		{</a>
<a name="ln206">			if (isInput())</a>
<a name="ln207">			{</a>
<a name="ln208">				return BPoint(Frame().left + Frame().Width() / 2.0, Frame().top - 1.0);</a>
<a name="ln209">			}</a>
<a name="ln210">			else if (isOutput())</a>
<a name="ln211">			{</a>
<a name="ln212">				return BPoint(Frame().left + Frame().Width() / 2.0, Frame().bottom + 1.0);</a>
<a name="ln213">			}</a>
<a name="ln214">			break;</a>
<a name="ln215">		}</a>
<a name="ln216">	}</a>
<a name="ln217">	return BPoint(-1.0, -1.0);</a>
<a name="ln218">}</a>
<a name="ln219"> </a>
<a name="ln220">bool MediaJack::connectionRequested(</a>
<a name="ln221">	DiagramEndPoint *which)</a>
<a name="ln222">{</a>
<a name="ln223">	D_METHOD((&quot;MediaJack::connectionRequested()\n&quot;));</a>
<a name="ln224"> </a>
<a name="ln225">	MediaJack *otherJack = dynamic_cast&lt;MediaJack *&gt;(which);</a>
<a name="ln226">	if (otherJack &amp;&amp; (otherJack-&gt;m_jackType != m_jackType) &amp;&amp; !isConnected())</a>
<a name="ln227">	{</a>
<a name="ln228">		return true;</a>
<a name="ln229">	}</a>
<a name="ln230">	return false;</a>
<a name="ln231">}</a>
<a name="ln232"> </a>
<a name="ln233">void MediaJack::MouseDown(</a>
<a name="ln234">	BPoint point,</a>
<a name="ln235">	uint32 buttons,</a>
<a name="ln236">	uint32 clicks)</a>
<a name="ln237">{</a>
<a name="ln238">	D_MOUSE((&quot;MediaJack::MouseOver()\n&quot;));</a>
<a name="ln239"> </a>
<a name="ln240">	// if connected, redirect to the wire</a>
<a name="ln241">	if (isConnected())</a>
<a name="ln242">	{</a>
<a name="ln243">		dynamic_cast&lt;MediaWire *&gt;(wire())-&gt;MouseDown(point, buttons, clicks);</a>
<a name="ln244">		return;</a>
<a name="ln245">	}</a>
<a name="ln246"> </a>
<a name="ln247">	// else we handle the mouse event ourselves</a>
<a name="ln248">	switch (buttons)</a>
<a name="ln249">	{</a>
<a name="ln250">		case B_SECONDARY_MOUSE_BUTTON:</a>
<a name="ln251">		{</a>
<a name="ln252">			showContextMenu(point);</a>
<a name="ln253">			break;</a>
<a name="ln254">		}</a>
<a name="ln255">		default:</a>
<a name="ln256">		{</a>
<a name="ln257">			DiagramEndPoint::MouseDown(point, buttons, clicks);</a>
<a name="ln258">		}</a>
<a name="ln259">	}</a>
<a name="ln260">}</a>
<a name="ln261"> </a>
<a name="ln262">void MediaJack::MouseOver(</a>
<a name="ln263">	BPoint point,</a>
<a name="ln264">	uint32 transit)</a>
<a name="ln265">{</a>
<a name="ln266">	D_MOUSE((&quot;MediaJack::MouseOver()\n&quot;));</a>
<a name="ln267">	switch (transit)</a>
<a name="ln268">	{</a>
<a name="ln269">		case B_ENTERED_VIEW:</a>
<a name="ln270">		{</a>
<a name="ln271">			be_app-&gt;SetCursor(M_CABLE_CURSOR);</a>
<a name="ln272">			TipManager *tips = TipManager::Instance();</a>
<a name="ln273">			BString tipText = m_label.String();</a>
<a name="ln274">			tipText &lt;&lt; &quot; (&quot; &lt;&lt; MediaString::getStringFor(m_format.type) &lt;&lt; &quot;)&quot;;</a>
<a name="ln275">			tips-&gt;showTip(tipText.String(),view()-&gt;ConvertToScreen(Frame()),</a>
<a name="ln276">						  TipManager::LEFT_OFFSET_FROM_POINTER, BPoint(12.0, 8.0));</a>
<a name="ln277">			break;</a>
<a name="ln278">		}</a>
<a name="ln279">		case B_EXITED_VIEW:</a>
<a name="ln280">		{</a>
<a name="ln281">			if (!view()-&gt;isWireTracking())</a>
<a name="ln282">			{</a>
<a name="ln283">				be_app-&gt;SetCursor(B_HAND_CURSOR);</a>
<a name="ln284">			}</a>
<a name="ln285">			break;</a>
<a name="ln286">		}</a>
<a name="ln287">	}</a>
<a name="ln288">}</a>
<a name="ln289"> </a>
<a name="ln290">void MediaJack::MessageDragged(</a>
<a name="ln291">	BPoint point,</a>
<a name="ln292">	uint32 transit,</a>
<a name="ln293">	const BMessage *message)</a>
<a name="ln294">{</a>
<a name="ln295">	D_MOUSE((&quot;MediaJack::MessageDragged()\n&quot;));</a>
<a name="ln296">	switch (transit)</a>
<a name="ln297">	{</a>
<a name="ln298">		case B_ENTERED_VIEW:</a>
<a name="ln299">		{</a>
<a name="ln300">			be_app-&gt;SetCursor(M_CABLE_CURSOR);</a>
<a name="ln301">			break;</a>
<a name="ln302">		}</a>
<a name="ln303">		case B_EXITED_VIEW:</a>
<a name="ln304">		{</a>
<a name="ln305">			if (!view()-&gt;isWireTracking())</a>
<a name="ln306">			{</a>
<a name="ln307">				be_app-&gt;SetCursor(B_HAND_CURSOR);</a>
<a name="ln308">			}</a>
<a name="ln309">			break;</a>
<a name="ln310">		}</a>
<a name="ln311">	}</a>
<a name="ln312">	DiagramEndPoint::MessageDragged(point, transit, message);</a>
<a name="ln313">}</a>
<a name="ln314"> </a>
<a name="ln315">void MediaJack::selected()</a>
<a name="ln316">{</a>
<a name="ln317">	D_METHOD((&quot;MediaJack::selected()\n&quot;));</a>
<a name="ln318">	_updateBitmap();</a>
<a name="ln319">	view()-&gt;Invalidate(Frame());</a>
<a name="ln320">}</a>
<a name="ln321"> </a>
<a name="ln322">void MediaJack::deselected()</a>
<a name="ln323">{</a>
<a name="ln324">	D_METHOD((&quot;MediaJack::deselected()\n&quot;));</a>
<a name="ln325">	_updateBitmap();</a>
<a name="ln326">	view()-&gt;Invalidate(Frame());</a>
<a name="ln327">}</a>
<a name="ln328"> </a>
<a name="ln329">void MediaJack::connected()</a>
<a name="ln330">{</a>
<a name="ln331">	D_METHOD((&quot;MediaJack::connected()\n&quot;));</a>
<a name="ln332">	_updateBitmap();</a>
<a name="ln333">	view()-&gt;Invalidate(Frame());</a>
<a name="ln334">}</a>
<a name="ln335"> </a>
<a name="ln336">void MediaJack::disconnected()</a>
<a name="ln337">{</a>
<a name="ln338">	D_METHOD((&quot;MediaJack::disconnected()\n&quot;));</a>
<a name="ln339">	_updateBitmap();</a>
<a name="ln340">	view()-&gt;Invalidate(Frame());</a>
<a name="ln341">}</a>
<a name="ln342"> </a>
<a name="ln343">// -------------------------------------------------------- //</a>
<a name="ln344">// *** operations (public)</a>
<a name="ln345">// -------------------------------------------------------- //</a>
<a name="ln346"> </a>
<a name="ln347">void MediaJack::layoutChanged(</a>
<a name="ln348">	int32 layout)</a>
<a name="ln349">{</a>
<a name="ln350">	D_METHOD((&quot;MediaJack::layoutChanged\n&quot;));</a>
<a name="ln351">	resizeTo(M_DEFAULT_WIDTH, M_DEFAULT_HEIGHT);</a>
<a name="ln352">	_updateBitmap();</a>
<a name="ln353">}</a>
<a name="ln354"> </a>
<a name="ln355">void MediaJack::setPosition(</a>
<a name="ln356">	float offset,</a>
<a name="ln357">	float leftTopBoundary,</a>
<a name="ln358">	float rightBottomBoundary,</a>
<a name="ln359">	BRegion *updateRegion)</a>
<a name="ln360">{</a>
<a name="ln361">	D_METHOD((&quot;MediaJack::setPosition\n&quot;));</a>
<a name="ln362">	switch (dynamic_cast&lt;MediaRoutingView *&gt;(view())-&gt;getLayout())</a>
<a name="ln363">	{</a>
<a name="ln364">		case MediaRoutingView::M_ICON_VIEW:</a>
<a name="ln365">		{</a>
<a name="ln366">			if (isInput())</a>
<a name="ln367">			{</a>
<a name="ln368">				moveTo(BPoint(leftTopBoundary, offset), updateRegion);</a>
<a name="ln369">			}</a>
<a name="ln370">			else if (isOutput())</a>
<a name="ln371">			{</a>
<a name="ln372">				moveTo(BPoint(rightBottomBoundary - Frame().Width(), offset), updateRegion);</a>
<a name="ln373">			}</a>
<a name="ln374">			break;</a>
<a name="ln375">		}</a>
<a name="ln376">		case MediaRoutingView::M_MINI_ICON_VIEW:</a>
<a name="ln377">		{</a>
<a name="ln378">			if (isInput())</a>
<a name="ln379">			{</a>
<a name="ln380">				moveTo(BPoint(offset, leftTopBoundary), updateRegion);</a>
<a name="ln381">			}</a>
<a name="ln382">			else if (isOutput())</a>
<a name="ln383">			{</a>
<a name="ln384">				moveTo(BPoint(offset, rightBottomBoundary - Frame().Height()), updateRegion);</a>
<a name="ln385">			}</a>
<a name="ln386">			break;</a>
<a name="ln387">		}</a>
<a name="ln388">	}</a>
<a name="ln389">}</a>
<a name="ln390"> </a>
<a name="ln391">// -------------------------------------------------------- //</a>
<a name="ln392">// *** internal methods (private)</a>
<a name="ln393">// -------------------------------------------------------- //</a>
<a name="ln394"> </a>
<a name="ln395">void MediaJack::_updateBitmap()</a>
<a name="ln396">{</a>
<a name="ln397">	D_METHOD((&quot;MediaJack::_updateBitmap()\n&quot;));</a>
<a name="ln398"> </a>
<a name="ln399">	if (m_bitmap)</a>
<a name="ln400">	{</a>
<a name="ln401">		delete m_bitmap;</a>
<a name="ln402">	}</a>
<a name="ln403">	BBitmap *tempBitmap = new BBitmap(Frame().OffsetToCopy(0.0, 0.0), B_CMAP8, true);</a>
<a name="ln404">	tempBitmap-&gt;Lock();</a>
<a name="ln405">	{</a>
<a name="ln406">		BView *tempView = new BView(tempBitmap-&gt;Bounds(), &quot;&quot;, B_FOLLOW_NONE, 0);</a>
<a name="ln407">		tempBitmap-&gt;AddChild(tempView);</a>
<a name="ln408">		tempView-&gt;SetOrigin(0.0, 0.0);</a>
<a name="ln409"> </a>
<a name="ln410">		MediaRoutingView* mediaView = dynamic_cast&lt;MediaRoutingView*&gt;(view());</a>
<a name="ln411">		int32 layout = mediaView ? mediaView-&gt;getLayout() : MediaRoutingView::M_ICON_VIEW;</a>
<a name="ln412"> </a>
<a name="ln413">		_drawInto(tempView, tempView-&gt;Bounds(), layout);</a>
<a name="ln414"> </a>
<a name="ln415">		tempView-&gt;Sync();</a>
<a name="ln416">		tempBitmap-&gt;RemoveChild(tempView);</a>
<a name="ln417">		delete tempView;</a>
<a name="ln418">	}</a>
<a name="ln419">	tempBitmap-&gt;Unlock();</a>
<a name="ln420">	m_bitmap = new BBitmap(tempBitmap);</a>
<a name="ln421">	delete tempBitmap;</a>
<a name="ln422">}</a>
<a name="ln423"> </a>
<a name="ln424">void MediaJack::_drawInto(</a>
<a name="ln425">	BView *target,</a>
<a name="ln426">	BRect targetRect,</a>
<a name="ln427">	int32 layout)</a>
<a name="ln428">{</a>
<a name="ln429">	D_METHOD((&quot;MediaJack::_drawInto()\n&quot;));</a>
<a name="ln430"> </a>
<a name="ln431">	bool selected = isConnecting() || isSelected();</a>
<a name="ln432">	switch (layout)</a>
<a name="ln433">	{</a>
<a name="ln434">		case MediaRoutingView::M_ICON_VIEW:</a>
<a name="ln435">		{</a>
<a name="ln436">			if (isInput())</a>
<a name="ln437">			{</a>
<a name="ln438">				BRect r;</a>
<a name="ln439">				BPoint p;</a>
<a name="ln440"> </a>
<a name="ln441">				// fill rect</a>
<a name="ln442">				r = targetRect;</a>
<a name="ln443">				target-&gt;SetLowColor(M_GRAY_COLOR);</a>
<a name="ln444">				r.left += 2.0;</a>
<a name="ln445">				target-&gt;FillRect(r, B_SOLID_LOW);</a>
<a name="ln446"> </a>
<a name="ln447">				// draw connection point</a>
<a name="ln448">				r = targetRect;</a>
<a name="ln449">				p.Set(0.0, Frame().Height() / 2.0 - 2.0);</a>
<a name="ln450">				target-&gt;BeginLineArray(4);</a>
<a name="ln451">				{</a>
<a name="ln452">					target-&gt;AddLine(r.LeftTop(),</a>
<a name="ln453">									p,</a>
<a name="ln454">									M_DARK_GRAY_COLOR);</a>
<a name="ln455">					target-&gt;AddLine(r.LeftTop() + BPoint(1.0, 0.0),</a>
<a name="ln456">									p + BPoint(1.0, 0.0),</a>
<a name="ln457">									M_LIGHT_GRAY_COLOR);</a>
<a name="ln458">					target-&gt;AddLine(p + BPoint(0.0, 5.0),</a>
<a name="ln459">									r.LeftBottom(),</a>
<a name="ln460">									M_DARK_GRAY_COLOR);</a>
<a name="ln461">					target-&gt;AddLine(p + BPoint(1.0, 5.0),</a>
<a name="ln462">									r.LeftBottom() + BPoint(1.0, 0.0),</a>
<a name="ln463">									M_LIGHT_GRAY_COLOR);</a>
<a name="ln464">				}</a>
<a name="ln465">				target-&gt;EndLineArray();</a>
<a name="ln466"> </a>
<a name="ln467">				if (isConnected() || isConnecting())</a>
<a name="ln468">				{</a>
<a name="ln469">					target-&gt;BeginLineArray(11);</a>
<a name="ln470">					{</a>
<a name="ln471">						target-&gt;AddLine(p, p, M_DARK_GRAY_COLOR);</a>
<a name="ln472">						target-&gt;AddLine(p + BPoint(0.0, 4.0), p + BPoint(0.0, 4.0), M_DARK_GRAY_COLOR);</a>
<a name="ln473">						target-&gt;AddLine(p + BPoint(1.0, 0.0), p + BPoint(4.0, 0.0), M_DARK_GRAY_COLOR);</a>
<a name="ln474">						target-&gt;AddLine(p + BPoint(1.0, 4.0), p + BPoint(4.0, 4.0), M_LIGHT_GRAY_COLOR);</a>
<a name="ln475">						target-&gt;AddLine(p + BPoint(4.0, 1.0), p + BPoint(4.0, 3.0), M_LIGHT_GRAY_COLOR);</a>
<a name="ln476">						target-&gt;AddLine(p + BPoint(0.0, 1.0), p + BPoint(2.0, 1.0), selected ? M_BLUE_COLOR : M_DARK_GRAY_COLOR);</a>
<a name="ln477">						target-&gt;AddLine(p + BPoint(3.0, 1.0), p + BPoint(3.0, 1.0), M_MED_GRAY_COLOR);</a>
<a name="ln478">						target-&gt;AddLine(p + BPoint(0.0, 2.0), p + BPoint(2.0, 2.0), selected ? M_LIGHT_BLUE_COLOR : M_LIGHT_GRAY_COLOR);</a>
<a name="ln479">						target-&gt;AddLine(p + BPoint(3.0, 2.0), p + BPoint(3.0, 2.0), selected ? M_BLUE_COLOR : M_DARK_GRAY_COLOR);</a>
<a name="ln480">						target-&gt;AddLine(p + BPoint(0.0, 3.0), p + BPoint(2.0, 3.0), selected ? M_BLUE_COLOR : M_DARK_GRAY_COLOR);</a>
<a name="ln481">						target-&gt;AddLine(p + BPoint(3.0, 3.0), p + BPoint(3.0, 3.0), M_MED_GRAY_COLOR);</a>
<a name="ln482">					}</a>
<a name="ln483">					target-&gt;EndLineArray();</a>
<a name="ln484">				}</a>
<a name="ln485">				else</a>
<a name="ln486">				{</a>
<a name="ln487">					target-&gt;BeginLineArray(7);</a>
<a name="ln488">					{</a>
<a name="ln489">						target-&gt;AddLine(p, p + BPoint(0.0, 4.0), M_DARK_GRAY_COLOR);</a>
<a name="ln490">						target-&gt;AddLine(p + BPoint(1.0, 0.0), p + BPoint(4.0, 0.0), M_DARK_GRAY_COLOR);</a>
<a name="ln491">						target-&gt;AddLine(p + BPoint(1.0, 4.0), p + BPoint(4.0, 4.0), M_LIGHT_GRAY_COLOR);</a>
<a name="ln492">						target-&gt;AddLine(p + BPoint(4.0, 1.0), p + BPoint(4.0, 3.0), M_LIGHT_GRAY_COLOR);</a>
<a name="ln493">						target-&gt;AddLine(p + BPoint(1.0, 1.0), p + BPoint(3.0, 1.0), M_MED_GRAY_COLOR);</a>
<a name="ln494">						target-&gt;AddLine(p + BPoint(1.0, 2.0), p + BPoint(3.0, 2.0), M_MED_GRAY_COLOR);</a>
<a name="ln495">						target-&gt;AddLine(p + BPoint(1.0, 3.0), p + BPoint(3.0, 3.0), M_MED_GRAY_COLOR);</a>
<a name="ln496">					}</a>
<a name="ln497">					target-&gt;EndLineArray();</a>
<a name="ln498">				}</a>
<a name="ln499"> </a>
<a name="ln500">				// draw abbreviation string</a>
<a name="ln501">				BFont font(be_plain_font);</a>
<a name="ln502">				font_height fh;</a>
<a name="ln503">				font.SetSize(font.Size() - 2.0);</a>
<a name="ln504">				font.GetHeight(&amp;fh);</a>
<a name="ln505">				p.x += 7.0;</a>
<a name="ln506">				p.y = (Frame().Height() / 2.0) + (fh.ascent / 2.0);</a>
<a name="ln507">				target-&gt;SetFont(&amp;font);</a>
<a name="ln508">				target-&gt;SetDrawingMode(B_OP_OVER);</a>
<a name="ln509">				target-&gt;SetHighColor((isConnected() || isConnecting()) ?</a>
<a name="ln510">									  M_MED_GRAY_COLOR :</a>
<a name="ln511">									  M_DARK_GRAY_COLOR);</a>
<a name="ln512">				target-&gt;DrawString(m_abbreviation.String(), p);</a>
<a name="ln513">			}</a>
<a name="ln514">			else if (isOutput())</a>
<a name="ln515">			{</a>
<a name="ln516">				BRect r;</a>
<a name="ln517">				BPoint p;</a>
<a name="ln518"> </a>
<a name="ln519">				// fill rect</a>
<a name="ln520">				r = targetRect;</a>
<a name="ln521">				target-&gt;SetLowColor(M_GRAY_COLOR);</a>
<a name="ln522">				r.right -= 2.0;</a>
<a name="ln523">				target-&gt;FillRect(r, B_SOLID_LOW);</a>
<a name="ln524"> </a>
<a name="ln525">				// draw connection point</a>
<a name="ln526">				r = targetRect;</a>
<a name="ln527">				p.Set(targetRect.right - 4.0, Frame().Height() / 2.0 - 2.0);</a>
<a name="ln528">				target-&gt;BeginLineArray(4);</a>
<a name="ln529">				{</a>
<a name="ln530">					target-&gt;AddLine(r.RightTop(),</a>
<a name="ln531">									p + BPoint(4.0, 0.0),</a>
<a name="ln532">									M_DARK_GRAY_COLOR);</a>
<a name="ln533">					target-&gt;AddLine(r.RightTop() + BPoint(-1.0, 0.0),</a>
<a name="ln534">									p + BPoint(3.0, 0.0),</a>
<a name="ln535">									M_MED_GRAY_COLOR);</a>
<a name="ln536">					target-&gt;AddLine(p + BPoint(4.0, 5.0),</a>
<a name="ln537">									r.RightBottom(),</a>
<a name="ln538">									M_DARK_GRAY_COLOR);</a>
<a name="ln539">					target-&gt;AddLine(p + BPoint(3.0, 5.0),</a>
<a name="ln540">									r.RightBottom() + BPoint(-1.0, 0.0),</a>
<a name="ln541">									M_MED_GRAY_COLOR);</a>
<a name="ln542">				}</a>
<a name="ln543">				target-&gt;EndLineArray();</a>
<a name="ln544"> </a>
<a name="ln545">				if (isConnected() || isConnecting())</a>
<a name="ln546">				{</a>
<a name="ln547">					target-&gt;BeginLineArray(11);</a>
<a name="ln548">					target-&gt;AddLine(p + BPoint(4.0, 0.0), p + BPoint(4.0, 0.0), M_DARK_GRAY_COLOR);</a>
<a name="ln549">					target-&gt;AddLine(p + BPoint(4.0, 4.0), p + BPoint(4.0, 4.0), M_DARK_GRAY_COLOR);</a>
<a name="ln550">					target-&gt;AddLine(p, p + BPoint(3.0, 0.0), M_DARK_GRAY_COLOR);</a>
<a name="ln551">					target-&gt;AddLine(p + BPoint(0.0, 1.0), p + BPoint(0.0, 3.0), M_DARK_GRAY_COLOR);</a>
<a name="ln552">					target-&gt;AddLine(p + BPoint(0.0, 4.0), p + BPoint(3.0, 4.0), M_LIGHT_GRAY_COLOR);</a>
<a name="ln553">					target-&gt;AddLine(p + BPoint(1.0, 1.0), p + BPoint(1.0, 1.0), M_MED_GRAY_COLOR);</a>
<a name="ln554">					target-&gt;AddLine(p + BPoint(2.0, 1.0), p + BPoint(4.0, 1.0), selected ? M_BLUE_COLOR : M_DARK_GRAY_COLOR);</a>
<a name="ln555">					target-&gt;AddLine(p + BPoint(1.0, 2.0), p + BPoint(1.0, 2.0), selected ? M_BLUE_COLOR : M_DARK_GRAY_COLOR);</a>
<a name="ln556">					target-&gt;AddLine(p + BPoint(2.0, 2.0), p + BPoint(4.0, 2.0), selected ? M_LIGHT_BLUE_COLOR : M_LIGHT_GRAY_COLOR);</a>
<a name="ln557">					target-&gt;AddLine(p + BPoint(1.0, 3.0), p + BPoint(1.0, 3.0), M_MED_GRAY_COLOR);</a>
<a name="ln558">					target-&gt;AddLine(p + BPoint(2.0, 3.0), p + BPoint(4.0, 3.0), selected ? M_BLUE_COLOR : M_DARK_GRAY_COLOR);</a>
<a name="ln559">					target-&gt;EndLineArray();</a>
<a name="ln560">				}</a>
<a name="ln561">				else</a>
<a name="ln562">				{</a>
<a name="ln563">					target-&gt;BeginLineArray(7);</a>
<a name="ln564">					target-&gt;AddLine(p + BPoint(4.0, 0.0), p + BPoint(4.0, 4.0), M_DARK_GRAY_COLOR);</a>
<a name="ln565">					target-&gt;AddLine(p, p + BPoint(3.0, 0.0), M_DARK_GRAY_COLOR);</a>
<a name="ln566">					target-&gt;AddLine(p + BPoint(0.0, 1.0), p + BPoint(0.0, 3.0), M_DARK_GRAY_COLOR);</a>
<a name="ln567">					target-&gt;AddLine(p + BPoint(0.0, 4.0), p + BPoint(3.0, 4.0), M_LIGHT_GRAY_COLOR);</a>
<a name="ln568">					target-&gt;AddLine(p + BPoint(1.0, 1.0), p + BPoint(3.0, 1.0), M_MED_GRAY_COLOR);</a>
<a name="ln569">					target-&gt;AddLine(p + BPoint(1.0, 2.0), p + BPoint(3.0, 2.0), M_MED_GRAY_COLOR);</a>
<a name="ln570">					target-&gt;AddLine(p + BPoint(1.0, 3.0), p + BPoint(3.0, 3.0), M_MED_GRAY_COLOR);</a>
<a name="ln571">					target-&gt;EndLineArray();</a>
<a name="ln572">				}</a>
<a name="ln573"> </a>
<a name="ln574">				// draw abbreviation string</a>
<a name="ln575">				BFont font(be_plain_font);</a>
<a name="ln576">				font_height fh;</a>
<a name="ln577">				font.SetSize(font.Size() - 2.0);</a>
<a name="ln578">				font.GetHeight(&amp;fh);</a>
<a name="ln579">				p.x -= font.StringWidth(m_abbreviation.String()) + 2.0;</a>
<a name="ln580">				p.y = (Frame().Height() / 2.0) + (fh.ascent / 2.0);</a>
<a name="ln581">				target-&gt;SetFont(&amp;font);</a>
<a name="ln582">				target-&gt;SetDrawingMode(B_OP_OVER);</a>
<a name="ln583">				target-&gt;SetHighColor((isConnected() || isConnecting()) ?</a>
<a name="ln584">									  M_MED_GRAY_COLOR :</a>
<a name="ln585">									  M_DARK_GRAY_COLOR);</a>
<a name="ln586">				target-&gt;DrawString(m_abbreviation.String(), p);</a>
<a name="ln587">			}</a>
<a name="ln588">			break;</a>
<a name="ln589">		}</a>
<a name="ln590">		case MediaRoutingView::M_MINI_ICON_VIEW:</a>
<a name="ln591">		{</a>
<a name="ln592">			if (isInput())</a>
<a name="ln593">			{</a>
<a name="ln594">				BRect r;</a>
<a name="ln595">				BPoint p;</a>
<a name="ln596"> </a>
<a name="ln597">				// fill rect</a>
<a name="ln598">				r = targetRect;</a>
<a name="ln599">				target-&gt;SetLowColor(M_GRAY_COLOR);</a>
<a name="ln600">				r.top += 2.0;</a>
<a name="ln601">				target-&gt;FillRect(r, B_SOLID_LOW);</a>
<a name="ln602"> </a>
<a name="ln603">				// draw connection point</a>
<a name="ln604">				r = targetRect;</a>
<a name="ln605">				p.Set(Frame().Width() / 2.0 - 2.0, 0.0);</a>
<a name="ln606">				target-&gt;BeginLineArray(4);</a>
<a name="ln607">				{</a>
<a name="ln608">					target-&gt;AddLine(r.LeftTop(),</a>
<a name="ln609">									p,</a>
<a name="ln610">									M_DARK_GRAY_COLOR);</a>
<a name="ln611">					target-&gt;AddLine(r.LeftTop() + BPoint(0.0, 1.0),</a>
<a name="ln612">									p + BPoint(0.0, 1.0),</a>
<a name="ln613">									M_LIGHT_GRAY_COLOR);</a>
<a name="ln614">					target-&gt;AddLine(p + BPoint(5.0, 0.0),</a>
<a name="ln615">									r.RightTop(),</a>
<a name="ln616">									M_DARK_GRAY_COLOR);</a>
<a name="ln617">					target-&gt;AddLine(p + BPoint(5.0, 1.0),</a>
<a name="ln618">									r.RightTop() + BPoint(0.0, 1.0),</a>
<a name="ln619">									M_LIGHT_GRAY_COLOR);</a>
<a name="ln620">				}</a>
<a name="ln621">				target-&gt;EndLineArray();</a>
<a name="ln622">				if (isConnected() || isConnecting())</a>
<a name="ln623">				{</a>
<a name="ln624">					target-&gt;BeginLineArray(11);</a>
<a name="ln625">					target-&gt;AddLine(p, p, M_DARK_GRAY_COLOR);</a>
<a name="ln626">					target-&gt;AddLine(p + BPoint(4.0, 0.0), p + BPoint(4.0, 0.0), M_DARK_GRAY_COLOR);</a>
<a name="ln627">					target-&gt;AddLine(p + BPoint(0.0, 1.0), p + BPoint(0.0, 4.0), M_DARK_GRAY_COLOR);</a>
<a name="ln628">					target-&gt;AddLine(p + BPoint(4.0, 1.0), p + BPoint(4.0, 4.0), M_LIGHT_GRAY_COLOR);</a>
<a name="ln629">					target-&gt;AddLine(p + BPoint(1.0, 4.0), p + BPoint(3.0, 4.0), M_LIGHT_GRAY_COLOR);</a>
<a name="ln630">					target-&gt;AddLine(p + BPoint(1.0, 0.0), p + BPoint(1.0, 2.0), selected ? M_BLUE_COLOR : M_DARK_GRAY_COLOR);</a>
<a name="ln631">					target-&gt;AddLine(p + BPoint(1.0, 3.0), p + BPoint(1.0, 3.0), M_MED_GRAY_COLOR);</a>
<a name="ln632">					target-&gt;AddLine(p + BPoint(2.0, 0.0), p + BPoint(2.0, 2.0), selected ? M_LIGHT_BLUE_COLOR : M_LIGHT_GRAY_COLOR);</a>
<a name="ln633">					target-&gt;AddLine(p + BPoint(2.0, 3.0), p + BPoint(2.0, 3.0), selected ? M_BLUE_COLOR : M_DARK_GRAY_COLOR);</a>
<a name="ln634">					target-&gt;AddLine(p + BPoint(3.0, 0.0), p + BPoint(3.0, 2.0), selected ? M_BLUE_COLOR : M_DARK_GRAY_COLOR);</a>
<a name="ln635">					target-&gt;AddLine(p + BPoint(3.0, 3.0), p + BPoint(3.0, 3.0), M_MED_GRAY_COLOR);</a>
<a name="ln636">					target-&gt;EndLineArray();</a>
<a name="ln637">				}</a>
<a name="ln638">				else</a>
<a name="ln639">				{</a>
<a name="ln640">					target-&gt;BeginLineArray(7);</a>
<a name="ln641">					target-&gt;AddLine(p, p + BPoint(4.0, 0.0), M_DARK_GRAY_COLOR);</a>
<a name="ln642">					target-&gt;AddLine(p + BPoint(0.0, 1.0), p + BPoint(0.0, 4.0), M_DARK_GRAY_COLOR);</a>
<a name="ln643">					target-&gt;AddLine(p + BPoint(4.0, 1.0), p + BPoint(4.0, 4.0), M_LIGHT_GRAY_COLOR);</a>
<a name="ln644">					target-&gt;AddLine(p + BPoint(1.0, 4.0), p + BPoint(3.0, 4.0), M_LIGHT_GRAY_COLOR);</a>
<a name="ln645">					target-&gt;AddLine(p + BPoint(1.0, 1.0), p + BPoint(1.0, 3.0), M_MED_GRAY_COLOR);</a>
<a name="ln646">					target-&gt;AddLine(p + BPoint(2.0, 1.0), p + BPoint(2.0, 3.0), M_MED_GRAY_COLOR);</a>
<a name="ln647">					target-&gt;AddLine(p + BPoint(3.0, 1.0), p + BPoint(3.0, 3.0), M_MED_GRAY_COLOR);</a>
<a name="ln648">					target-&gt;EndLineArray();</a>
<a name="ln649">				}</a>
<a name="ln650">			}</a>
<a name="ln651">			else if (isOutput())</a>
<a name="ln652">			{</a>
<a name="ln653">				BRect r;</a>
<a name="ln654">				BPoint p;</a>
<a name="ln655"> </a>
<a name="ln656">				// fill rect</a>
<a name="ln657">				r = targetRect;</a>
<a name="ln658">				target-&gt;SetLowColor(M_GRAY_COLOR);</a>
<a name="ln659">				r.bottom -= 2.0;</a>
<a name="ln660">				target-&gt;FillRect(r, B_SOLID_LOW);</a>
<a name="ln661"> </a>
<a name="ln662">				// draw connection point</a>
<a name="ln663">				r = targetRect;</a>
<a name="ln664">				p.Set(Frame().Width() / 2.0 - 2.0, targetRect.bottom - 4.0);</a>
<a name="ln665">				target-&gt;BeginLineArray(4);</a>
<a name="ln666">				{</a>
<a name="ln667">					target-&gt;AddLine(r.LeftBottom(),</a>
<a name="ln668">									p + BPoint(0.0, 4.0),</a>
<a name="ln669">									M_DARK_GRAY_COLOR);</a>
<a name="ln670">					target-&gt;AddLine(r.LeftBottom() + BPoint(0.0, -1.0),</a>
<a name="ln671">									p + BPoint(0.0, 3.0),</a>
<a name="ln672">									M_MED_GRAY_COLOR);</a>
<a name="ln673">					target-&gt;AddLine(p + BPoint(5.0, 4.0),</a>
<a name="ln674">									r.RightBottom(),</a>
<a name="ln675">									M_DARK_GRAY_COLOR);</a>
<a name="ln676">					target-&gt;AddLine(p + BPoint(5.0, 3.0),</a>
<a name="ln677">									r.RightBottom() + BPoint(0.0, -1.0),</a>
<a name="ln678">									M_MED_GRAY_COLOR);</a>
<a name="ln679">				}</a>
<a name="ln680">				target-&gt;EndLineArray();</a>
<a name="ln681">				if (isConnected() || isConnecting())</a>
<a name="ln682">				{</a>
<a name="ln683">					target-&gt;BeginLineArray(11);</a>
<a name="ln684">					target-&gt;AddLine(p + BPoint(0.0, 4.0), p + BPoint(0.0, 4.0), M_DARK_GRAY_COLOR);</a>
<a name="ln685">					target-&gt;AddLine(p + BPoint(4.0, 4.0), p + BPoint(4.0, 4.0), M_DARK_GRAY_COLOR);</a>
<a name="ln686">					target-&gt;AddLine(p, p + BPoint(0.0, 3.0), M_DARK_GRAY_COLOR);</a>
<a name="ln687">					target-&gt;AddLine(p + BPoint(1.0, 0.0), p + BPoint(3.0, 0.0), M_DARK_GRAY_COLOR);</a>
<a name="ln688">					target-&gt;AddLine(p + BPoint(4.0, 0.0), p + BPoint(4.0, 3.0), M_LIGHT_GRAY_COLOR);</a>
<a name="ln689">					target-&gt;AddLine(p + BPoint(1.0, 1.0), p + BPoint(1.0, 1.0), M_MED_GRAY_COLOR);</a>
<a name="ln690">					target-&gt;AddLine(p + BPoint(1.0, 2.0), p + BPoint(1.0, 4.0), selected ? M_BLUE_COLOR : M_DARK_GRAY_COLOR);</a>
<a name="ln691">					target-&gt;AddLine(p + BPoint(2.0, 1.0), p + BPoint(2.0, 1.0), selected ? M_BLUE_COLOR : M_DARK_GRAY_COLOR);</a>
<a name="ln692">					target-&gt;AddLine(p + BPoint(2.0, 2.0), p + BPoint(2.0, 4.0), selected ? M_LIGHT_BLUE_COLOR : M_LIGHT_GRAY_COLOR);</a>
<a name="ln693">					target-&gt;AddLine(p + BPoint(3.0, 1.0), p + BPoint(3.0, 1.0), M_MED_GRAY_COLOR);</a>
<a name="ln694">					target-&gt;AddLine(p + BPoint(3.0, 2.0), p + BPoint(3.0, 4.0), selected ? M_BLUE_COLOR : M_DARK_GRAY_COLOR);</a>
<a name="ln695">					target-&gt;EndLineArray();</a>
<a name="ln696">				}</a>
<a name="ln697">				else</a>
<a name="ln698">				{</a>
<a name="ln699">					target-&gt;BeginLineArray(7);</a>
<a name="ln700">					target-&gt;AddLine(p + BPoint(0.0, 4.0), p + BPoint(4.0, 4.0), M_DARK_GRAY_COLOR);</a>
<a name="ln701">					target-&gt;AddLine(p, p + BPoint(0.0, 3.0), M_DARK_GRAY_COLOR);</a>
<a name="ln702">					target-&gt;AddLine(p + BPoint(1.0, 0.0), p + BPoint(3.0, 0.0), M_DARK_GRAY_COLOR);</a>
<a name="ln703">					target-&gt;AddLine(p + BPoint(4.0, 0.0), p + BPoint(4.0, 3.0), M_LIGHT_GRAY_COLOR);</a>
<a name="ln704">					target-&gt;AddLine(p + BPoint(1.0, 1.0), p + BPoint(1.0, 3.0), M_MED_GRAY_COLOR);</a>
<a name="ln705">					target-&gt;AddLine(p + BPoint(2.0, 1.0), p + BPoint(2.0, 3.0), M_MED_GRAY_COLOR);</a>
<a name="ln706">					target-&gt;AddLine(p + BPoint(3.0, 1.0), p + BPoint(3.0, 3.0), M_MED_GRAY_COLOR);</a>
<a name="ln707">					target-&gt;EndLineArray();</a>
<a name="ln708">				}</a>
<a name="ln709">			}</a>
<a name="ln710">			break;</a>
<a name="ln711">		}</a>
<a name="ln712">	}</a>
<a name="ln713">}</a>
<a name="ln714"> </a>
<a name="ln715">void MediaJack::_updateAbbreviation()</a>
<a name="ln716">{</a>
<a name="ln717">	D_METHOD((&quot;MediaJack::_updateAbbreviation()\n&quot;));</a>
<a name="ln718"> </a>
<a name="ln719">	int32 offset;</a>
<a name="ln720">	m_abbreviation = &quot;&quot;;</a>
<a name="ln721">	m_abbreviation += m_label[0];</a>
<a name="ln722">	offset = m_label.FindFirst(&quot; &quot;) + 1;</a>
<a name="ln723">	if ((offset &gt; 1) &amp;&amp; (offset &lt; m_label.CountChars() - 1))</a>
<a name="ln724">		m_abbreviation += m_label[offset];</a>
<a name="ln725">	else</a>
<a name="ln726">		m_abbreviation += m_label[1];</a>
<a name="ln727">	offset = m_label.CountChars() - 1;</a>
<a name="ln728">	m_abbreviation += m_label[offset];</a>
<a name="ln729">}</a>
<a name="ln730"> </a>
<a name="ln731">// -------------------------------------------------------- //</a>
<a name="ln732">// *** internal operations (protected)</a>
<a name="ln733">// -------------------------------------------------------- //</a>
<a name="ln734"> </a>
<a name="ln735">void MediaJack::showContextMenu(</a>
<a name="ln736">	BPoint point)</a>
<a name="ln737">{</a>
<a name="ln738">	D_METHOD((&quot;MediaJack::showContextMenu()\n&quot;));</a>
<a name="ln739"> </a>
<a name="ln740">	BPopUpMenu *menu = new BPopUpMenu(&quot;MediaJack PopUp&quot;, false, false, B_ITEMS_IN_COLUMN);</a>
<a name="ln741">	menu-&gt;SetFont(be_plain_font);</a>
<a name="ln742">	BMenuItem *item;</a>
<a name="ln743"> </a>
<a name="ln744">	// add the &quot;Get Info&quot; item</a>
<a name="ln745">	if (isInput())</a>
<a name="ln746">	{</a>
<a name="ln747">		media_input input;</a>
<a name="ln748">		getInput(&amp;input);</a>
<a name="ln749">		BMessage *message = new BMessage(InfoWindowManager::M_INFO_WINDOW_REQUESTED);</a>
<a name="ln750">		message-&gt;AddData(&quot;input&quot;, B_RAW_TYPE,</a>
<a name="ln751">						 reinterpret_cast&lt;const void *&gt;(&amp;input), sizeof(input));</a>
<a name="ln752">		menu-&gt;AddItem(item = new BMenuItem(&quot;Get info&quot;, message));</a>
<a name="ln753">	}</a>
<a name="ln754">	else if (isOutput())</a>
<a name="ln755">	{</a>
<a name="ln756">		media_output output;</a>
<a name="ln757">		getOutput(&amp;output);</a>
<a name="ln758">		BMessage *message = new BMessage(InfoWindowManager::M_INFO_WINDOW_REQUESTED);</a>
<a name="ln759">		message-&gt;AddData(&quot;output&quot;, B_RAW_TYPE,</a>
<a name="ln760">						 reinterpret_cast&lt;const void *&gt;(&amp;output), sizeof(output));</a>
<a name="ln761">		menu-&gt;AddItem(item = new BMenuItem(&quot;Get info&quot;, message));</a>
<a name="ln762">	}</a>
<a name="ln763"> </a>
<a name="ln764">	menu-&gt;SetTargetForItems(view());</a>
<a name="ln765">	view()-&gt;ConvertToScreen(&amp;point);</a>
<a name="ln766">	point -= BPoint(1.0, 1.0);</a>
<a name="ln767">	menu-&gt;Go(point, true, true, true);</a>
<a name="ln768">}</a>
<a name="ln769"> </a>
<a name="ln770">// -------------------------------------------------------- //</a>
<a name="ln771">// *** sorting methods (friend)</a>
<a name="ln772">// -------------------------------------------------------- //</a>
<a name="ln773"> </a>
<a name="ln774">int __CORTEX_NAMESPACE__ compareTypeAndID(</a>
<a name="ln775">	const void *lValue,</a>
<a name="ln776">	const void *rValue)</a>
<a name="ln777">{</a>
<a name="ln778">	int retValue = 0;</a>
<a name="ln779">	const MediaJack *lJack = *(reinterpret_cast&lt;MediaJack * const*&gt;(reinterpret_cast&lt;void * const*&gt;(lValue)));</a>
<a name="ln780">	const MediaJack *rJack = *(reinterpret_cast&lt;MediaJack * const*&gt;(reinterpret_cast&lt;void * const*&gt;(rValue)));</a>
<a name="ln781">	if (lJack &amp;&amp; rJack)</a>
<a name="ln782">	{</a>
<a name="ln783">		if (lJack-&gt;m_jackType &lt; rJack-&gt;m_jackType)</a>
<a name="ln784">		{</a>
<a name="ln785">			return -1;</a>
<a name="ln786">		}</a>
<a name="ln787">		if (lJack-&gt;m_jackType == rJack-&gt;m_jackType)</a>
<a name="ln788">		{</a>
<a name="ln789">			if (lJack-&gt;m_index &lt; rJack-&gt;m_index)</a>
<a name="ln790">			{</a>
<a name="ln791">				return -1;</a>
<a name="ln792">			}</a>
<a name="ln793">			else</a>
<a name="ln794">			{</a>
<a name="ln795">				return 1;</a>
<a name="ln796">			}</a>
<a name="ln797">		}</a>
<a name="ln798">		else if (lJack-&gt;m_jackType &gt; rJack-&gt;m_jackType)</a>
<a name="ln799">		{</a>
<a name="ln800">			retValue = 1;</a>
<a name="ln801">		}</a>
<a name="ln802">	}</a>
<a name="ln803">	return retValue;</a>
<a name="ln804">}</a>
<a name="ln805"> </a>
<a name="ln806">// END -- LiveNodeView.cpp --</a>

</code></pre>
<div class="balloon" rel="768"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v773/" target="_blank">V773</a> Visibility scope of the 'menu' pointer was exited without releasing the memory. A memory leak is possible.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
