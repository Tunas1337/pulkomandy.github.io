
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>MediaNodePanel.cpp</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2"> * Copyright (c) 1999-2000, Eric Moon.</a>
<a name="ln3"> * All rights reserved.</a>
<a name="ln4"> *</a>
<a name="ln5"> * Redistribution and use in source and binary forms, with or without</a>
<a name="ln6"> * modification, are permitted provided that the following conditions</a>
<a name="ln7"> * are met:</a>
<a name="ln8"> *</a>
<a name="ln9"> * 1. Redistributions of source code must retain the above copyright</a>
<a name="ln10"> *    notice, this list of conditions, and the following disclaimer.</a>
<a name="ln11"> *</a>
<a name="ln12"> * 2. Redistributions in binary form must reproduce the above copyright</a>
<a name="ln13"> *    notice, this list of conditions, and the following disclaimer in the</a>
<a name="ln14"> *    documentation and/or other materials provided with the distribution.</a>
<a name="ln15"> *</a>
<a name="ln16"> * 3. The name of the author may not be used to endorse or promote products</a>
<a name="ln17"> *    derived from this software without specific prior written permission.</a>
<a name="ln18"> *</a>
<a name="ln19"> * THIS SOFTWARE IS PROVIDED BY THE AUTHOR &quot;AS IS&quot; AND ANY EXPRESS OR</a>
<a name="ln20"> * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</a>
<a name="ln21"> * OF TITLE, NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS FOR A PARTICULAR</a>
<a name="ln22"> * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY</a>
<a name="ln23"> * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</a>
<a name="ln24"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</a>
<a name="ln25"> * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED</a>
<a name="ln26"> * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR</a>
<a name="ln27"> * TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</a>
<a name="ln28"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</a>
<a name="ln29"> */</a>
<a name="ln30"> </a>
<a name="ln31"> </a>
<a name="ln32">// MediaNodePanel.cpp</a>
<a name="ln33">// c.lenz 10oct99</a>
<a name="ln34"> </a>
<a name="ln35">#include &quot;MediaNodePanel.h&quot;</a>
<a name="ln36">// InfoWindow</a>
<a name="ln37">#include &quot;InfoWindowManager.h&quot;</a>
<a name="ln38">// MediaRoutingView</a>
<a name="ln39">#include &quot;MediaRoutingView.h&quot;</a>
<a name="ln40">#include &quot;MediaWire.h&quot;</a>
<a name="ln41">#include &quot;RouteAppNodeManager.h&quot;</a>
<a name="ln42">// NodeManager</a>
<a name="ln43">#include &quot;NodeRef.h&quot;</a>
<a name="ln44">#include &quot;NodeGroup.h&quot;</a>
<a name="ln45">// ParameterWindow</a>
<a name="ln46">#include &quot;ParameterWindow.h&quot; </a>
<a name="ln47">// Support</a>
<a name="ln48">#include &quot;cortex_ui.h&quot;</a>
<a name="ln49">#include &quot;MediaIcon.h&quot;</a>
<a name="ln50">#include &quot;MediaString.h&quot;</a>
<a name="ln51">// RouteApp</a>
<a name="ln52">#include &quot;RouteWindow.h&quot;</a>
<a name="ln53">// TipManager</a>
<a name="ln54">#include &quot;TipManager.h&quot;</a>
<a name="ln55"> </a>
<a name="ln56">// App Kit</a>
<a name="ln57">#include &lt;Application.h&gt;</a>
<a name="ln58">#include &lt;Roster.h&gt;</a>
<a name="ln59">// Interface Kit</a>
<a name="ln60">#include &lt;MenuItem.h&gt;</a>
<a name="ln61">#include &lt;PopUpMenu.h&gt;</a>
<a name="ln62">// Media Kit</a>
<a name="ln63">#include &lt;MediaDefs.h&gt;</a>
<a name="ln64">#include &lt;MediaRoster.h&gt;</a>
<a name="ln65"> </a>
<a name="ln66">using namespace std;</a>
<a name="ln67"> </a>
<a name="ln68">__USE_CORTEX_NAMESPACE</a>
<a name="ln69"> </a>
<a name="ln70">#include &lt;Debug.h&gt;</a>
<a name="ln71">#define D_METHOD(x) //PRINT (x)</a>
<a name="ln72">#define D_MESSAGE(x) //PRINT (x)</a>
<a name="ln73">#define D_DRAW(x) //PRINT (x)</a>
<a name="ln74"> </a>
<a name="ln75">// -------------------------------------------------------- //</a>
<a name="ln76">// constants</a>
<a name="ln77">// -------------------------------------------------------- //</a>
<a name="ln78"> </a>
<a name="ln79">float	MediaNodePanel::M_DEFAULT_WIDTH		= 90.0;</a>
<a name="ln80">float	MediaNodePanel::M_DEFAULT_HEIGHT	= 60.0;</a>
<a name="ln81">float	MediaNodePanel::M_LABEL_H_MARGIN	= 3.0;</a>
<a name="ln82">float	MediaNodePanel::M_LABEL_V_MARGIN	= 3.0;</a>
<a name="ln83">float	MediaNodePanel::M_BODY_H_MARGIN		= 5.0;</a>
<a name="ln84">float	MediaNodePanel::M_BODY_V_MARGIN		= 5.0;</a>
<a name="ln85"> </a>
<a name="ln86">// [e.moon 7dec99]</a>
<a name="ln87">const BPoint MediaNodePanel::s_invalidPosition(-200.0, -200.0);</a>
<a name="ln88"> </a>
<a name="ln89">// -------------------------------------------------------- //</a>
<a name="ln90">// *** ctor/dtor</a>
<a name="ln91">// -------------------------------------------------------- //</a>
<a name="ln92"> </a>
<a name="ln93">MediaNodePanel::MediaNodePanel(</a>
<a name="ln94">	BPoint position,</a>
<a name="ln95">	NodeRef *nodeRef)</a>
<a name="ln96">	: DiagramBox(BRect(position, position + BPoint(M_DEFAULT_WIDTH, M_DEFAULT_HEIGHT))),</a>
<a name="ln97">	  BHandler(nodeRef-&gt;name()),</a>
<a name="ln98">	  ref(nodeRef),</a>
<a name="ln99">	  m_bitmap(0),</a>
<a name="ln100">	  m_icon(0),</a>
<a name="ln101">	  m_alternatePosition(s_invalidPosition)</a>
<a name="ln102">{</a>
<a name="ln103">	D_METHOD((&quot;MediaNodePanel::MediaNodePanel()\n&quot;));</a>
<a name="ln104">	ASSERT(ref);</a>
<a name="ln105">}</a>
<a name="ln106"> </a>
<a name="ln107">MediaNodePanel::~MediaNodePanel()</a>
<a name="ln108">{</a>
<a name="ln109">	D_METHOD((&quot;MediaNodePanel::~MediaNodePanel()\n&quot;));</a>
<a name="ln110">	if (m_icon)</a>
<a name="ln111">	{</a>
<a name="ln112">		delete m_icon;</a>
<a name="ln113">	}</a>
<a name="ln114">	if (m_bitmap)</a>
<a name="ln115">	{</a>
<a name="ln116">		delete m_bitmap;</a>
<a name="ln117">	}</a>
<a name="ln118">}</a>
<a name="ln119"> </a>
<a name="ln120">// -------------------------------------------------------- //</a>
<a name="ln121">// *** derived from DiagramBox</a>
<a name="ln122">// -------------------------------------------------------- //</a>
<a name="ln123"> </a>
<a name="ln124">void MediaNodePanel::attachedToDiagram()</a>
<a name="ln125">{</a>
<a name="ln126">	D_METHOD((&quot;MediaNodePanel::attachedToDiagram()\n&quot;));</a>
<a name="ln127"> </a>
<a name="ln128">	resizeTo(M_DEFAULT_WIDTH, M_DEFAULT_HEIGHT);</a>
<a name="ln129">	_updateIcon(dynamic_cast&lt;MediaRoutingView *&gt;(view())-&gt;getLayout());</a>
<a name="ln130">	_prepareLabel();</a>
<a name="ln131">	populateInit();</a>
<a name="ln132">	arrangeIOJacks();</a>
<a name="ln133"> </a>
<a name="ln134">	view()-&gt;Looper()-&gt;AddHandler(this);</a>
<a name="ln135">}</a>
<a name="ln136"> </a>
<a name="ln137">void MediaNodePanel::detachedFromDiagram()</a>
<a name="ln138">{</a>
<a name="ln139">	D_METHOD((&quot;MediaNodePanel::detachedFromDiagram()\n&quot;));</a>
<a name="ln140"> </a>
<a name="ln141">	BRect labelRect = m_labelRect.OffsetByCopy(Frame().LeftTop());</a>
<a name="ln142">	if (m_mouseOverLabel &amp;&amp; m_labelTruncated)</a>
<a name="ln143">	{</a>
<a name="ln144">		TipManager *tips = TipManager::Instance();</a>
<a name="ln145">		tips-&gt;hideTip(view()-&gt;ConvertToScreen(labelRect));</a>
<a name="ln146">	}</a>
<a name="ln147"> </a>
<a name="ln148">	view()-&gt;Looper()-&gt;RemoveHandler(this);</a>
<a name="ln149">}</a>
<a name="ln150"> </a>
<a name="ln151">void MediaNodePanel::DrawBox()</a>
<a name="ln152">{</a>
<a name="ln153">	D_DRAW((&quot;MediaNodePanel::DrawBox()\n&quot;));</a>
<a name="ln154">	if (m_bitmap)</a>
<a name="ln155">	{</a>
<a name="ln156">		view()-&gt;DrawBitmap(m_bitmap, Frame().LeftTop());</a>
<a name="ln157">	}</a>
<a name="ln158">}</a>
<a name="ln159"> </a>
<a name="ln160">void MediaNodePanel::MouseDown(</a>
<a name="ln161">	BPoint point,</a>
<a name="ln162">	uint32 buttons,</a>
<a name="ln163">	uint32 clicks)</a>
<a name="ln164">{</a>
<a name="ln165">	D_METHOD((&quot;MediaNodePanel::MouseDown()\n&quot;));</a>
<a name="ln166"> </a>
<a name="ln167">	_inherited::MouseDown(point, buttons, clicks);</a>
<a name="ln168"> </a>
<a name="ln169">	// +++ REALLY BAD WORKAROUND</a>
<a name="ln170">	MediaJack *jack = dynamic_cast&lt;MediaJack *&gt;(_LastItemUnder());</a>
<a name="ln171">	if (jack &amp;&amp; jack-&gt;Frame().Contains(point))</a>
<a name="ln172">	{</a>
<a name="ln173">		return;</a>
<a name="ln174">	}</a>
<a name="ln175"> </a>
<a name="ln176">	switch (buttons) {</a>
<a name="ln177">		case B_PRIMARY_MOUSE_BUTTON:</a>
<a name="ln178">		{</a>
<a name="ln179">			if (clicks == 2) {</a>
<a name="ln180">				if (ref-&gt;kind() &amp; B_CONTROLLABLE) {</a>
<a name="ln181">					BMessage message(MediaRoutingView::M_NODE_TWEAK_PARAMETERS);</a>
<a name="ln182">					DiagramView* v = view();</a>
<a name="ln183">					BMessenger(v).SendMessage(&amp;message);</a>
<a name="ln184">				}</a>
<a name="ln185">			}</a>
<a name="ln186">			break;</a>
<a name="ln187">		}</a>
<a name="ln188">		case B_SECONDARY_MOUSE_BUTTON:</a>
<a name="ln189">		{</a>
<a name="ln190">			if (clicks == 1) {</a>
<a name="ln191">				showContextMenu(point);</a>
<a name="ln192">			}</a>
<a name="ln193">			break;</a>
<a name="ln194">		}</a>
<a name="ln195">	}</a>
<a name="ln196">}</a>
<a name="ln197"> </a>
<a name="ln198">void MediaNodePanel::MouseOver(</a>
<a name="ln199">	BPoint point,</a>
<a name="ln200">	uint32 transit)</a>
<a name="ln201">{</a>
<a name="ln202">	D_METHOD((&quot;MediaNodePanel::MouseOver()\n&quot;));</a>
<a name="ln203">	_inherited::MouseOver(point, transit);</a>
<a name="ln204"> </a>
<a name="ln205">	switch (transit)</a>
<a name="ln206">	{</a>
<a name="ln207">		case B_ENTERED_VIEW:</a>
<a name="ln208">		{</a>
<a name="ln209">			break;</a>
<a name="ln210">		}</a>
<a name="ln211">		case B_INSIDE_VIEW:</a>
<a name="ln212">		{</a>
<a name="ln213">			BRect labelRect = m_labelRect.OffsetByCopy(Frame().LeftTop());</a>
<a name="ln214">			if (labelRect.Contains(point))</a>
<a name="ln215">			{</a>
<a name="ln216">				if (!m_mouseOverLabel &amp;&amp; m_labelTruncated)</a>
<a name="ln217">				{</a>
<a name="ln218">					TipManager *tips = TipManager::Instance();</a>
<a name="ln219">					tips-&gt;showTip(m_fullLabel.String(), view()-&gt;ConvertToScreen(labelRect));</a>
<a name="ln220">					m_mouseOverLabel = true;</a>
<a name="ln221">				}</a>
<a name="ln222">			}</a>
<a name="ln223">			else</a>
<a name="ln224">			{</a>
<a name="ln225">				m_mouseOverLabel = false;</a>
<a name="ln226">			}</a>
<a name="ln227">			break;</a>
<a name="ln228">		}</a>
<a name="ln229">		case B_EXITED_VIEW:</a>
<a name="ln230">		{</a>
<a name="ln231">			m_mouseOverLabel = false;</a>
<a name="ln232">			break;</a>
<a name="ln233">		}</a>
<a name="ln234">	}</a>
<a name="ln235">}</a>
<a name="ln236"> </a>
<a name="ln237">void MediaNodePanel::MessageDropped(</a>
<a name="ln238">	BPoint point,</a>
<a name="ln239">	BMessage *message)</a>
<a name="ln240">{</a>
<a name="ln241">	D_METHOD((&quot;MediaNodePanel::MessageDropped()\n&quot;));</a>
<a name="ln242"> </a>
<a name="ln243">	// +++ REALLY BAD WORKAROUND</a>
<a name="ln244">	MediaJack *jack = dynamic_cast&lt;MediaJack *&gt;(ItemUnder(point));</a>
<a name="ln245">	if (jack)</a>
<a name="ln246">	{</a>
<a name="ln247">		jack-&gt;MessageDropped(point, message);</a>
<a name="ln248">		return;</a>
<a name="ln249">	}</a>
<a name="ln250">	else</a>
<a name="ln251">	{</a>
<a name="ln252">		be_app-&gt;SetCursor(B_HAND_CURSOR);</a>
<a name="ln253">	}</a>
<a name="ln254">}</a>
<a name="ln255"> </a>
<a name="ln256">void MediaNodePanel::selected()</a>
<a name="ln257">{</a>
<a name="ln258">	D_METHOD((&quot;MediaNodePanel::selected()\n&quot;));</a>
<a name="ln259">	_updateBitmap();</a>
<a name="ln260">}</a>
<a name="ln261"> </a>
<a name="ln262">void MediaNodePanel::deselected()</a>
<a name="ln263">{</a>
<a name="ln264">	D_METHOD((&quot;MediaNodePanel::deselected()\n&quot;));</a>
<a name="ln265">	_updateBitmap();</a>
<a name="ln266">}</a>
<a name="ln267"> </a>
<a name="ln268">// ---------------------------------------------------------------- //</a>
<a name="ln269">// *** updating</a>
<a name="ln270">// ---------------------------------------------------------------- //</a>
<a name="ln271"> </a>
<a name="ln272">void MediaNodePanel::layoutChanged(</a>
<a name="ln273">	int32 layout)</a>
<a name="ln274">{</a>
<a name="ln275">	D_METHOD((&quot;MediaNodePanel::layoutChanged()\n&quot;));</a>
<a name="ln276"> </a>
<a name="ln277">	BPoint p = Frame().LeftTop();</a>
<a name="ln278">	if (m_alternatePosition == s_invalidPosition)</a>
<a name="ln279">	{</a>
<a name="ln280">		m_alternatePosition = dynamic_cast&lt;MediaRoutingView *&gt;</a>
<a name="ln281">							  (view())-&gt;findFreePositionFor(this);</a>
<a name="ln282">	}</a>
<a name="ln283">	moveTo(m_alternatePosition);</a>
<a name="ln284">	m_alternatePosition = p;</a>
<a name="ln285"> </a>
<a name="ln286">	resizeTo(M_DEFAULT_WIDTH, M_DEFAULT_HEIGHT);</a>
<a name="ln287">	for (uint32 i = 0; i &lt; CountItems(); i++)</a>
<a name="ln288">	{</a>
<a name="ln289">		MediaJack *jack = dynamic_cast&lt;MediaJack *&gt;(ItemAt(i));</a>
<a name="ln290">		jack-&gt;layoutChanged(layout);</a>
<a name="ln291">	}</a>
<a name="ln292">	_updateIcon(layout);</a>
<a name="ln293">	_prepareLabel();</a>
<a name="ln294">	arrangeIOJacks();</a>
<a name="ln295">	_updateBitmap();</a>
<a name="ln296">}</a>
<a name="ln297"> </a>
<a name="ln298">void MediaNodePanel::populateInit()</a>
<a name="ln299">{</a>
<a name="ln300">	D_METHOD((&quot;MediaNodePanel::populateInit()\n&quot;));</a>
<a name="ln301">	if (ref-&gt;kind() &amp; B_BUFFER_CONSUMER)</a>
<a name="ln302">	{</a>
<a name="ln303">		vector&lt;media_input&gt; freeInputs;</a>
<a name="ln304">		ref-&gt;getFreeInputs(freeInputs);</a>
<a name="ln305">		for (uint32 i = 0; i &lt; freeInputs.size(); i++)</a>
<a name="ln306">		{</a>
<a name="ln307">			AddItem(new MediaJack(freeInputs[i]));</a>
<a name="ln308">		}</a>
<a name="ln309">	}</a>
<a name="ln310">	if (ref-&gt;kind() &amp; B_BUFFER_PRODUCER)</a>
<a name="ln311">	{</a>
<a name="ln312">		vector&lt;media_output&gt; freeOutputs;</a>
<a name="ln313">		ref-&gt;getFreeOutputs(freeOutputs);</a>
<a name="ln314">		for (uint32 i = 0; i &lt; freeOutputs.size(); i++)</a>
<a name="ln315">		{</a>
<a name="ln316">			AddItem(new MediaJack(freeOutputs[i]));</a>
<a name="ln317">		}</a>
<a name="ln318">	}</a>
<a name="ln319">}</a>
<a name="ln320"> </a>
<a name="ln321">void MediaNodePanel::updateIOJacks()</a>
<a name="ln322">{</a>
<a name="ln323">	D_METHOD((&quot;MediaNodePanel::updateIOJacks()\n&quot;));</a>
<a name="ln324"> </a>
<a name="ln325">	// remove all free inputs/outputs, they may be outdated</a>
<a name="ln326">	for (uint32 i = 0; i &lt; CountItems(); i++)</a>
<a name="ln327">	{</a>
<a name="ln328">		MediaJack *jack = dynamic_cast&lt;MediaJack *&gt;(ItemAt(i));</a>
<a name="ln329">		if (jack &amp;&amp; !jack-&gt;isConnected())</a>
<a name="ln330">		{</a>
<a name="ln331">			RemoveItem(jack);</a>
<a name="ln332">			delete jack;</a>
<a name="ln333">			i--; // account for reindexing in the BList</a>
<a name="ln334">		}</a>
<a name="ln335">	}</a>
<a name="ln336"> </a>
<a name="ln337">	// add free inputs</a>
<a name="ln338">	if (ref-&gt;kind() &amp; B_BUFFER_CONSUMER)</a>
<a name="ln339">	{</a>
<a name="ln340">		vector&lt;media_input&gt; freeInputs;</a>
<a name="ln341">		ref-&gt;getFreeInputs(freeInputs);</a>
<a name="ln342">		for (uint32 i = 0; i &lt; freeInputs.size(); i++)</a>
<a name="ln343">		{</a>
<a name="ln344">			MediaJack *jack;</a>
<a name="ln345">			AddItem(jack = new MediaJack(freeInputs[i]));</a>
<a name="ln346">		}</a>
<a name="ln347">	}</a>
<a name="ln348"> </a>
<a name="ln349">	// add free outputs</a>
<a name="ln350">	if (ref-&gt;kind() &amp; B_BUFFER_PRODUCER)</a>
<a name="ln351">	{</a>
<a name="ln352">		vector&lt;media_output&gt; freeOutputs;</a>
<a name="ln353">		ref-&gt;getFreeOutputs(freeOutputs);</a>
<a name="ln354">		for (uint32 i = 0; i &lt; freeOutputs.size(); i++)</a>
<a name="ln355">		{</a>
<a name="ln356">			MediaJack *jack;</a>
<a name="ln357">			AddItem(jack = new MediaJack(freeOutputs[i]));</a>
<a name="ln358">		}</a>
<a name="ln359">	}</a>
<a name="ln360"> </a>
<a name="ln361">	// the supported media types might have changed -&gt; this could</a>
<a name="ln362">	// require changing the icon</a>
<a name="ln363">	_updateIcon(dynamic_cast&lt;MediaRoutingView *&gt;(view())-&gt;getLayout());</a>
<a name="ln364">}</a>
<a name="ln365"> </a>
<a name="ln366">void MediaNodePanel::arrangeIOJacks()</a>
<a name="ln367">{</a>
<a name="ln368">	D_METHOD((&quot;MediaNodePanel::arrangeIOJacks()\n&quot;));</a>
<a name="ln369">	SortItems(DiagramItem::M_ENDPOINT, &amp;compareTypeAndID);</a>
<a name="ln370"> </a>
<a name="ln371">	switch (dynamic_cast&lt;MediaRoutingView *&gt;(view())-&gt;getLayout())</a>
<a name="ln372">	{</a>
<a name="ln373">		case MediaRoutingView::M_ICON_VIEW:</a>
<a name="ln374">		{</a>
<a name="ln375">			BRegion updateRegion;</a>
<a name="ln376">			float align = 1.0;</a>
<a name="ln377">			view()-&gt;GetItemAlignment(0, &amp;align);</a>
<a name="ln378"> </a>
<a name="ln379">			// adjust this panel's size</a>
<a name="ln380">			int32 numInputs = 0, numOutputs = 0;</a>
<a name="ln381">			for (uint32 i = 0; i &lt; CountItems(); i++)</a>
<a name="ln382">			{</a>
<a name="ln383">				MediaJack *jack = dynamic_cast&lt;MediaJack *&gt;(ItemAt(i));</a>
<a name="ln384">				if (jack)</a>
<a name="ln385">				{</a>
<a name="ln386">					if (jack-&gt;isInput())</a>
<a name="ln387">					{</a>
<a name="ln388">						numInputs++;</a>
<a name="ln389">					}</a>
<a name="ln390">					if (jack-&gt;isOutput())</a>
<a name="ln391">					{</a>
<a name="ln392">						numOutputs++;</a>
<a name="ln393">					}</a>
<a name="ln394">				}</a>
<a name="ln395">			}</a>
<a name="ln396">			float minHeight = MediaJack::M_DEFAULT_HEIGHT + MediaJack::M_DEFAULT_GAP;</a>
<a name="ln397">			minHeight *= numInputs &gt; numOutputs ? numInputs : numOutputs;</a>
<a name="ln398">			minHeight += m_labelRect.Height();</a>
<a name="ln399">			minHeight += 2 * MediaJack::M_DEFAULT_GAP;</a>
<a name="ln400">			minHeight = ((int)minHeight / (int)align) * align + align;</a>
<a name="ln401">			if ((Frame().Height() &lt; minHeight)</a>
<a name="ln402">			 || ((Frame().Height() &gt; minHeight)</a>
<a name="ln403">			 &amp;&amp; (minHeight &gt;= MediaNodePanel::M_DEFAULT_HEIGHT)))</a>
<a name="ln404">			{</a>
<a name="ln405">				updateRegion.Include(Frame());</a>
<a name="ln406">				resizeTo(Frame().Width(), minHeight);</a>
<a name="ln407">				updateRegion.Include(Frame());</a>
<a name="ln408">				_prepareLabel();		</a>
<a name="ln409">			}</a>
<a name="ln410"> </a>
<a name="ln411">			// adjust the placement of the jacks</a>
<a name="ln412">			BRect r = m_bodyRect;</a>
<a name="ln413">			r.bottom -= M_BODY_V_MARGIN;</a>
<a name="ln414">			float inputOffset = 0.0, outputOffset = 0.0;</a>
<a name="ln415">			float center = Frame().top + r.top + (r.Height() / 2.0);</a>
<a name="ln416">			center += MediaJack::M_DEFAULT_GAP - (MediaJack::M_DEFAULT_HEIGHT / 2.0);</a>
<a name="ln417">			center = ((int)center / (int)align) * align;</a>
<a name="ln418">			if (numInputs)</a>
<a name="ln419">			{</a>
<a name="ln420">				if (numInputs % 2) // odd number of inputs</a>
<a name="ln421">				{</a>
<a name="ln422">					inputOffset = center - (numInputs / 2) * (MediaJack::M_DEFAULT_HEIGHT + MediaJack::M_DEFAULT_GAP);</a>
<a name="ln423">				}</a>
<a name="ln424">				else // even number of inputs</a>
<a name="ln425">				{</a>
<a name="ln426">					inputOffset = center - ((numInputs + 1) / 2) * (MediaJack::M_DEFAULT_HEIGHT + MediaJack::M_DEFAULT_GAP);</a>
<a name="ln427">				}</a>
<a name="ln428">			}</a>
<a name="ln429">			if (numOutputs)</a>
<a name="ln430">			{</a>
<a name="ln431">				if (numOutputs % 2) // odd number of outputs</a>
<a name="ln432">				{</a>
<a name="ln433">					outputOffset = center - (numOutputs / 2) * (MediaJack::M_DEFAULT_HEIGHT + MediaJack::M_DEFAULT_GAP);</a>
<a name="ln434">				}</a>
<a name="ln435">				else // even number of outputs</a>
<a name="ln436">				{</a>
<a name="ln437">					outputOffset = center - ((numOutputs + 1) / 2) * (MediaJack::M_DEFAULT_HEIGHT + MediaJack::M_DEFAULT_GAP);</a>
<a name="ln438">				}</a>
<a name="ln439">			}</a>
<a name="ln440">			for (uint32 i = 0; i &lt; CountItems(); i++)</a>
<a name="ln441">			{</a>
<a name="ln442">				MediaJack *jack = dynamic_cast&lt;MediaJack *&gt;(ItemAt(i));</a>
<a name="ln443">				if (jack)</a>
<a name="ln444">				{</a>
<a name="ln445">					if (jack-&gt;isInput())</a>
<a name="ln446">					{</a>
<a name="ln447">						jack-&gt;setPosition(inputOffset, Frame().left, Frame().right, &amp;updateRegion);</a>
<a name="ln448">						inputOffset += jack-&gt;Frame().Height() + MediaJack::M_DEFAULT_GAP;</a>
<a name="ln449">					}</a>
<a name="ln450">					if (jack-&gt;isOutput())</a>
<a name="ln451">					{</a>
<a name="ln452">						jack-&gt;setPosition(outputOffset, Frame().left, Frame().right, &amp;updateRegion);</a>
<a name="ln453">						outputOffset += jack-&gt;Frame().Height() + MediaJack::M_DEFAULT_GAP;</a>
<a name="ln454">					}</a>
<a name="ln455">				}</a>
<a name="ln456">			}</a>
<a name="ln457">			for (int32 i = 0; i &lt; updateRegion.CountRects(); i++)</a>
<a name="ln458">			{</a>
<a name="ln459">				view()-&gt;Invalidate(updateRegion.RectAt(i));</a>
<a name="ln460">			}</a>
<a name="ln461">			break;</a>
<a name="ln462">		}</a>
<a name="ln463">		case MediaRoutingView::M_MINI_ICON_VIEW:</a>
<a name="ln464">		{</a>
<a name="ln465">			BRegion updateRegion;</a>
<a name="ln466">			float align = 1.0;</a>
<a name="ln467">			view()-&gt;GetItemAlignment(&amp;align, 0);</a>
<a name="ln468"> </a>
<a name="ln469">			// adjust this panel's size</a>
<a name="ln470">			int32 numInputs = 0, numOutputs = 0;</a>
<a name="ln471">			for (uint32 i = 0; i &lt; CountItems(); i++)</a>
<a name="ln472">			{</a>
<a name="ln473">				MediaJack *jack = dynamic_cast&lt;MediaJack *&gt;(ItemAt(i));</a>
<a name="ln474">				if (jack)</a>
<a name="ln475">				{</a>
<a name="ln476">					if (jack-&gt;isInput())</a>
<a name="ln477">					{</a>
<a name="ln478">						numInputs++;</a>
<a name="ln479">					}</a>
<a name="ln480">					if (jack-&gt;isOutput())</a>
<a name="ln481">					{</a>
<a name="ln482">						numOutputs++;</a>
<a name="ln483">					}</a>
<a name="ln484">				}</a>
<a name="ln485">			}</a>
<a name="ln486">			float minWidth = MediaJack::M_DEFAULT_WIDTH + MediaJack::M_DEFAULT_GAP;</a>
<a name="ln487">			minWidth *= numInputs &gt; numOutputs ? numInputs : numOutputs;</a>
<a name="ln488">			minWidth += m_bodyRect.Width();</a>
<a name="ln489">			minWidth += 2 * MediaJack::M_DEFAULT_GAP;</a>
<a name="ln490">			minWidth = ((int)minWidth / (int)align) * align + align;</a>
<a name="ln491">			if ((Frame().Width() &lt; minWidth)</a>
<a name="ln492">			 || ((Frame().Width() &gt; minWidth)</a>
<a name="ln493">			 &amp;&amp; (minWidth &gt;= MediaNodePanel::M_DEFAULT_WIDTH)))</a>
<a name="ln494">			{</a>
<a name="ln495">				updateRegion.Include(Frame());</a>
<a name="ln496">				resizeTo(minWidth, Frame().Height());</a>
<a name="ln497">				updateRegion.Include(Frame());</a>
<a name="ln498">				_prepareLabel();</a>
<a name="ln499">			}</a>
<a name="ln500">			// adjust the placement of the jacks</a>
<a name="ln501">			float inputOffset = 0.0, outputOffset = 0.0;</a>
<a name="ln502">			float center = Frame().left + m_labelRect.left + (m_labelRect.Width() / 2.0);</a>
<a name="ln503">			center += MediaJack::M_DEFAULT_GAP - (MediaJack::M_DEFAULT_WIDTH / 2.0);</a>
<a name="ln504">			center = ((int)center / (int)align) * align;</a>
<a name="ln505">			if (numInputs)</a>
<a name="ln506">			{</a>
<a name="ln507">				if (numInputs % 2) // odd number of inputs</a>
<a name="ln508">				{</a>
<a name="ln509">					inputOffset = center - (numInputs / 2) * (MediaJack::M_DEFAULT_WIDTH + MediaJack::M_DEFAULT_GAP);</a>
<a name="ln510">				}</a>
<a name="ln511">				else // even number of inputs</a>
<a name="ln512">				{</a>
<a name="ln513">					inputOffset = center - ((numInputs + 1) / 2) * (MediaJack::M_DEFAULT_WIDTH + MediaJack::M_DEFAULT_GAP);</a>
<a name="ln514">				}</a>
<a name="ln515">			}</a>
<a name="ln516">			if (numOutputs)</a>
<a name="ln517">			{</a>
<a name="ln518">				if (numOutputs % 2) // odd number of outputs</a>
<a name="ln519">				{</a>
<a name="ln520">					outputOffset = center - (numOutputs / 2) * (MediaJack::M_DEFAULT_WIDTH + MediaJack::M_DEFAULT_GAP);</a>
<a name="ln521">				}</a>
<a name="ln522">				else // even number of outputs</a>
<a name="ln523">				{</a>
<a name="ln524">					outputOffset = center - ((numOutputs + 1) / 2) * (MediaJack::M_DEFAULT_WIDTH + MediaJack::M_DEFAULT_GAP);</a>
<a name="ln525">				}</a>
<a name="ln526">			}</a>
<a name="ln527">			for (uint32 i = 0; i &lt; CountItems(); i++)</a>
<a name="ln528">			{</a>
<a name="ln529">				MediaJack *jack = dynamic_cast&lt;MediaJack *&gt;(ItemAt(i));</a>
<a name="ln530">				if (jack)</a>
<a name="ln531">				{</a>
<a name="ln532">					if (jack-&gt;isInput())</a>
<a name="ln533">					{</a>
<a name="ln534">						jack-&gt;setPosition(inputOffset, Frame().top, Frame().bottom, &amp;updateRegion);</a>
<a name="ln535">						inputOffset += jack-&gt;Frame().Width() + MediaJack::M_DEFAULT_GAP;</a>
<a name="ln536">					}</a>
<a name="ln537">					if (jack-&gt;isOutput())</a>
<a name="ln538">					{</a>
<a name="ln539">						jack-&gt;setPosition(outputOffset, Frame().top, Frame().bottom, &amp;updateRegion);</a>
<a name="ln540">						outputOffset += jack-&gt;Frame().Width() + MediaJack::M_DEFAULT_GAP;</a>
<a name="ln541">					}</a>
<a name="ln542">				}</a>
<a name="ln543">			}</a>
<a name="ln544">			for (int32 i = 0; i &lt; updateRegion.CountRects(); i++)</a>
<a name="ln545">			{</a>
<a name="ln546">				view()-&gt;Invalidate(updateRegion.RectAt(i));</a>
<a name="ln547">			}</a>
<a name="ln548">			break;</a>
<a name="ln549">		}		</a>
<a name="ln550">	}</a>
<a name="ln551">	_updateBitmap();</a>
<a name="ln552">}</a>
<a name="ln553"> </a>
<a name="ln554">void MediaNodePanel::showContextMenu(</a>
<a name="ln555">	BPoint point)</a>
<a name="ln556">{</a>
<a name="ln557">	D_METHOD((&quot;MediaNodePanel::showContextMenu()\n&quot;));</a>
<a name="ln558"> </a>
<a name="ln559">	BPopUpMenu *menu = new BPopUpMenu(&quot;MediaNodePanel PopUp&quot;, false, false, B_ITEMS_IN_COLUMN);</a>
<a name="ln560">	menu-&gt;SetFont(be_plain_font);</a>
<a name="ln561"> </a>
<a name="ln562">	BMenuItem *item;</a>
<a name="ln563">	BMessage *message;</a>
<a name="ln564"> </a>
<a name="ln565">	// add the &quot;Tweak Parameters&quot; item</a>
<a name="ln566">	message = new BMessage(MediaRoutingView::M_NODE_TWEAK_PARAMETERS);</a>
<a name="ln567">	menu-&gt;AddItem(item = new BMenuItem(&quot;Tweak parameters&quot;, message, 'P'));</a>
<a name="ln568">	if (!(ref-&gt;kind() &amp; B_CONTROLLABLE))</a>
<a name="ln569">	{</a>
<a name="ln570">		item-&gt;SetEnabled(false);</a>
<a name="ln571">	}</a>
<a name="ln572"> </a>
<a name="ln573">	message = new BMessage(InfoWindowManager::M_INFO_WINDOW_REQUESTED);</a>
<a name="ln574">	message-&gt;AddInt32(&quot;nodeID&quot;, ref-&gt;id());</a>
<a name="ln575">	menu-&gt;AddItem(new BMenuItem(&quot;Get info&quot;, message, 'I'));</a>
<a name="ln576">	menu-&gt;AddSeparatorItem();</a>
<a name="ln577"> </a>
<a name="ln578">	menu-&gt;AddItem(item = new BMenuItem(&quot;Release&quot;, new BMessage(MediaRoutingView::M_DELETE_SELECTION), 'T'));</a>
<a name="ln579">	if (!ref-&gt;isInternal())</a>
<a name="ln580">	{</a>
<a name="ln581">		item-&gt;SetEnabled(false);</a>
<a name="ln582">	}</a>
<a name="ln583">	menu-&gt;AddSeparatorItem();</a>
<a name="ln584"> </a>
<a name="ln585">	// add the &quot;Cycle&quot; item</a>
<a name="ln586">	message = new BMessage(MediaRoutingView::M_NODE_CHANGE_CYCLING);</a>
<a name="ln587">	message-&gt;AddBool(&quot;cycle&quot;, !ref-&gt;isCycling());</a>
<a name="ln588">	menu-&gt;AddItem(item = new BMenuItem(&quot;Cycle&quot;, message));</a>
<a name="ln589">	item-&gt;SetMarked(ref-&gt;isCycling());</a>
<a name="ln590">	if (ref-&gt;flags() &amp; NodeRef::NO_SEEK)</a>
<a name="ln591">	{</a>
<a name="ln592">		item-&gt;SetEnabled(false);</a>
<a name="ln593">	}</a>
<a name="ln594"> </a>
<a name="ln595">	// add the &quot;Run Mode&quot; sub menu</a>
<a name="ln596">	BMenu *subMenu = new BMenu(&quot;Run mode&quot;);</a>
<a name="ln597">	subMenu-&gt;SetFont(be_plain_font);</a>
<a name="ln598">	for (uint32 runMode = 1; runMode &lt;= BMediaNode::B_RECORDING; runMode++)</a>
<a name="ln599">	{</a>
<a name="ln600">		BString itemName = MediaString::getStringFor(static_cast&lt;BMediaNode::run_mode&gt;</a>
<a name="ln601">													 (runMode));</a>
<a name="ln602">		message = new BMessage(MediaRoutingView::M_NODE_CHANGE_RUN_MODE);</a>
<a name="ln603">		message-&gt;AddInt32(&quot;run_mode&quot;, runMode);</a>
<a name="ln604">		subMenu-&gt;AddItem(item = new BMenuItem(itemName.String(), message));</a>
<a name="ln605">		if (ref-&gt;runMode() == runMode)</a>
<a name="ln606">		{</a>
<a name="ln607">			item-&gt;SetMarked(true);</a>
<a name="ln608">		}</a>
<a name="ln609">		else if ((ref-&gt;runMode() == 0)</a>
<a name="ln610">			  &amp;&amp; (ref-&gt;group()) &amp;&amp; (ref-&gt;group()-&gt;runMode() == BMediaNode::run_mode(runMode)))</a>
<a name="ln611">		{</a>
<a name="ln612">			item-&gt;SetMarked(true);</a>
<a name="ln613">		}</a>
<a name="ln614">	}</a>
<a name="ln615">	subMenu-&gt;AddSeparatorItem();</a>
<a name="ln616">	message = new BMessage(MediaRoutingView::M_NODE_CHANGE_RUN_MODE);</a>
<a name="ln617">	message-&gt;AddInt32(&quot;run_mode&quot;, 0);</a>
<a name="ln618">	subMenu-&gt;AddItem(item = new BMenuItem(&quot;(same as group)&quot;, message));</a>
<a name="ln619">	if (ref-&gt;group() == 0)</a>
<a name="ln620">	{</a>
<a name="ln621">		item-&gt;SetEnabled(false);</a>
<a name="ln622">	}</a>
<a name="ln623">	else if ((ref-&gt;runMode() &lt; 1) &amp;&amp; (ref-&gt;group()-&gt;runMode() &gt; 0))</a>
<a name="ln624">	{</a>
<a name="ln625">		item-&gt;SetMarked(true);</a>
<a name="ln626">	}</a>
<a name="ln627">	menu-&gt;AddItem(subMenu);</a>
<a name="ln628">	subMenu-&gt;SetTargetForItems(view());</a>
<a name="ln629">	</a>
<a name="ln630">	// [c.lenz 24dec99] hide rarely used commands in a 'Advanced' submenu</a>
<a name="ln631">	subMenu = new BMenu(&quot;Advanced&quot;);</a>
<a name="ln632">	subMenu-&gt;SetFont(be_plain_font);</a>
<a name="ln633">	// [e.moon 5dec99] ad-hoc timesource support</a>
<a name="ln634">	if(ref-&gt;kind() &amp; B_TIME_SOURCE) {</a>
<a name="ln635">		message = new BMessage(MediaRoutingView::M_NODE_START_TIME_SOURCE);</a>
<a name="ln636">		message-&gt;AddInt32(&quot;nodeID&quot;, ref-&gt;id());</a>
<a name="ln637">		subMenu-&gt;AddItem(new BMenuItem(</a>
<a name="ln638">			&quot;Start time source&quot;,</a>
<a name="ln639">			message));</a>
<a name="ln640">		message = new BMessage(MediaRoutingView::M_NODE_START_TIME_SOURCE);</a>
<a name="ln641">		message-&gt;AddInt32(&quot;nodeID&quot;, ref-&gt;id());</a>
<a name="ln642">		subMenu-&gt;AddItem(new BMenuItem(</a>
<a name="ln643">			&quot;Stop time source&quot;,</a>
<a name="ln644">			message));</a>
<a name="ln645">	}</a>
<a name="ln646">	// [c.lenz 24dec99] support for BControllable::StartControlPanel()</a>
<a name="ln647">	if(ref-&gt;kind() &amp; B_CONTROLLABLE) {</a>
<a name="ln648">		if (subMenu-&gt;CountItems() &gt; 0)</a>
<a name="ln649">			subMenu-&gt;AddSeparatorItem();</a>
<a name="ln650">		message = new BMessage(MediaRoutingView::M_NODE_START_CONTROL_PANEL);</a>
<a name="ln651">		subMenu-&gt;AddItem(new BMenuItem(&quot;Start Control Panel&quot;, message,</a>
<a name="ln652">									   'P', B_COMMAND_KEY | B_SHIFT_KEY));</a>
<a name="ln653">	}</a>
<a name="ln654">	// [em 1feb00] group tweaks</a>
<a name="ln655">	if(ref-&gt;group())</a>
<a name="ln656">	{</a>
<a name="ln657">		message = new BMessage(MediaRoutingView::M_GROUP_SET_LOCKED);</a>
<a name="ln658">		message-&gt;AddInt32(&quot;groupID&quot;, ref-&gt;group()-&gt;id());</a>
<a name="ln659">		bool isLocked = (ref-&gt;group()-&gt;groupFlags() &amp; NodeGroup::GROUP_LOCKED);</a>
<a name="ln660">		message-&gt;AddBool(&quot;locked&quot;, !isLocked);</a>
<a name="ln661">		if (subMenu-&gt;CountItems() &gt; 0)</a>
<a name="ln662">			subMenu-&gt;AddSeparatorItem();</a>
<a name="ln663">		subMenu-&gt;AddItem(</a>
<a name="ln664">			new BMenuItem(</a>
<a name="ln665">				isLocked ? &quot;Unlock group&quot; : &quot;Lock group&quot;, message));</a>
<a name="ln666">	}</a>
<a name="ln667">	</a>
<a name="ln668">	if (subMenu-&gt;CountItems() &gt; 0)</a>
<a name="ln669">	{</a>
<a name="ln670">		menu-&gt;AddItem(subMenu);</a>
<a name="ln671">		subMenu-&gt;SetTargetForItems(view());</a>
<a name="ln672">	}</a>
<a name="ln673">	</a>
<a name="ln674">	menu-&gt;SetTargetForItems(view());</a>
<a name="ln675">	view()-&gt;ConvertToScreen(&amp;point);</a>
<a name="ln676">	point -= BPoint(1.0, 1.0);</a>
<a name="ln677">	menu-&gt;Go(point, true, true, true);</a>
<a name="ln678">}</a>
<a name="ln679"> </a>
<a name="ln680">// ---------------------------------------------------------------- //</a>
<a name="ln681">// BHandler impl</a>
<a name="ln682">// ---------------------------------------------------------------- //</a>
<a name="ln683"> </a>
<a name="ln684">void MediaNodePanel::MessageReceived(</a>
<a name="ln685">	BMessage *message)</a>
<a name="ln686">{</a>
<a name="ln687">	D_METHOD((&quot;MediaNodePanel::MessageReceived()\n&quot;));</a>
<a name="ln688">	switch (message-&gt;what)</a>
<a name="ln689">	{</a>
<a name="ln690">		case NodeRef::M_INPUTS_CHANGED:</a>
<a name="ln691">		{</a>
<a name="ln692">			D_MESSAGE((&quot;MediaNodePanel::MessageReceived(NodeRef::M_INPUTS_CHANGED)\n&quot;));</a>
<a name="ln693">			_updateIcon(dynamic_cast&lt;MediaRoutingView *&gt;(view())-&gt;getLayout());</a>
<a name="ln694">			break;</a>
<a name="ln695">		}	</a>
<a name="ln696">		case NodeRef::M_OUTPUTS_CHANGED:</a>
<a name="ln697">		{</a>
<a name="ln698">			D_MESSAGE((&quot;MediaNodePanel::MessageReceived(NodeRef::M_OUTPUTS_CHANGED)\n&quot;));</a>
<a name="ln699">			_updateIcon(dynamic_cast&lt;MediaRoutingView *&gt;(view())-&gt;getLayout());</a>
<a name="ln700">			break;</a>
<a name="ln701">		}	</a>
<a name="ln702">		default:</a>
<a name="ln703">		{</a>
<a name="ln704">			BHandler::MessageReceived(message);</a>
<a name="ln705">			break;</a>
<a name="ln706">		}</a>
<a name="ln707">	}	</a>
<a name="ln708">}</a>
<a name="ln709"> </a>
<a name="ln710">// -------------------------------------------------------- //</a>
<a name="ln711">// *** IStateArchivable</a>
<a name="ln712">// -------------------------------------------------------- //</a>
<a name="ln713"> </a>
<a name="ln714">status_t MediaNodePanel::importState(</a>
<a name="ln715">	const BMessage*						archive) {</a>
<a name="ln716"> </a>
<a name="ln717">	BPoint iconPos(s_invalidPosition);</a>
<a name="ln718">	BPoint miniIconPos(s_invalidPosition);</a>
<a name="ln719"> </a>
<a name="ln720">	MediaRoutingView* v = dynamic_cast&lt;MediaRoutingView*&gt;(view());</a>
<a name="ln721">	ASSERT(v);</a>
<a name="ln722">	MediaRoutingView::layout_t layoutMode = v-&gt;getLayout();</a>
<a name="ln723">	archive-&gt;FindPoint(&quot;iconPos&quot;, &amp;iconPos);</a>
<a name="ln724">	archive-&gt;FindPoint(&quot;miniIconPos&quot;, &amp;miniIconPos);</a>
<a name="ln725">	</a>
<a name="ln726">	switch(layoutMode) {</a>
<a name="ln727">		case MediaRoutingView::M_ICON_VIEW:</a>
<a name="ln728">			if(iconPos != s_invalidPosition)</a>
<a name="ln729">				moveTo(iconPos);</a>
<a name="ln730">			m_alternatePosition = miniIconPos;</a>
<a name="ln731">			break;</a>
<a name="ln732"> </a>
<a name="ln733">		case MediaRoutingView::M_MINI_ICON_VIEW:</a>
<a name="ln734">			if(miniIconPos != s_invalidPosition)</a>
<a name="ln735">				moveTo(miniIconPos);</a>
<a name="ln736">			m_alternatePosition = iconPos;</a>
<a name="ln737">			break;</a>
<a name="ln738">	}</a>
<a name="ln739">	</a>
<a name="ln740">	return B_OK;</a>
<a name="ln741">}</a>
<a name="ln742"> </a>
<a name="ln743">status_t MediaNodePanel::exportState(</a>
<a name="ln744">	BMessage*									archive) const {</a>
<a name="ln745"> </a>
<a name="ln746">	BPoint iconPos, miniIconPos;</a>
<a name="ln747">	</a>
<a name="ln748">	MediaRoutingView* v = dynamic_cast&lt;MediaRoutingView*&gt;(view());</a>
<a name="ln749">	ASSERT(v);</a>
<a name="ln750">	MediaRoutingView::layout_t layoutMode = v-&gt;getLayout();</a>
<a name="ln751">	switch(layoutMode) {</a>
<a name="ln752">		case MediaRoutingView::M_ICON_VIEW:</a>
<a name="ln753">			iconPos = Frame().LeftTop();</a>
<a name="ln754">			miniIconPos = m_alternatePosition;</a>
<a name="ln755">			break;</a>
<a name="ln756"> </a>
<a name="ln757">		case MediaRoutingView::M_MINI_ICON_VIEW:</a>
<a name="ln758">			miniIconPos = Frame().LeftTop();</a>
<a name="ln759">			iconPos = m_alternatePosition;</a>
<a name="ln760">			break;</a>
<a name="ln761">	}</a>
<a name="ln762"> </a>
<a name="ln763">	if(iconPos != s_invalidPosition)</a>
<a name="ln764">		archive-&gt;AddPoint(&quot;iconPos&quot;, iconPos);</a>
<a name="ln765">	if(miniIconPos != s_invalidPosition)</a>
<a name="ln766">		archive-&gt;AddPoint(&quot;miniIconPos&quot;, miniIconPos);</a>
<a name="ln767">		</a>
<a name="ln768">	// determine if I'm a 'system' node</a>
<a name="ln769">	port_info portInfo;</a>
<a name="ln770">	app_info appInfo;</a>
<a name="ln771"> </a>
<a name="ln772">	if ((get_port_info(ref-&gt;node().port, &amp;portInfo) == B_OK)</a>
<a name="ln773">		&amp;&amp; (be_roster-&gt;GetRunningAppInfo(portInfo.team, &amp;appInfo) == B_OK)) {</a>
<a name="ln774">		BEntry appEntry(&amp;appInfo.ref);</a>
<a name="ln775">		char appName[B_FILE_NAME_LENGTH];</a>
<a name="ln776">		if(</a>
<a name="ln777">			appEntry.InitCheck() == B_OK &amp;&amp;</a>
<a name="ln778">			appEntry.GetName(appName) == B_OK &amp;&amp;</a>
<a name="ln779">			(!strcmp(appName, &quot;media_addon_server&quot;) ||</a>
<a name="ln780">			 !strcmp(appName, &quot;audio_server&quot;))) {</a>
<a name="ln781">		</a>
<a name="ln782">			archive-&gt;AddBool(&quot;sysOwned&quot;, true);	 </a>
<a name="ln783">		}</a>
<a name="ln784">	}</a>
<a name="ln785">	</a>
<a name="ln786">	return B_OK;	</a>
<a name="ln787">}</a>
<a name="ln788"> </a>
<a name="ln789">// ---------------------------------------------------------------- //</a>
<a name="ln790">// *** internal operations</a>
<a name="ln791">// ---------------------------------------------------------------- //</a>
<a name="ln792"> </a>
<a name="ln793">void MediaNodePanel::_prepareLabel()</a>
<a name="ln794">{</a>
<a name="ln795">	// find out if its a file node first</a>
<a name="ln796">	if (ref-&gt;kind() &amp; B_FILE_INTERFACE)</a>
<a name="ln797">	{</a>
<a name="ln798">		entry_ref nodeFile;</a>
<a name="ln799">		status_t error = BMediaRoster::Roster()-&gt;GetRefFor(ref-&gt;node(),	&amp;nodeFile);</a>
<a name="ln800">		if (error)</a>
<a name="ln801">		{</a>
<a name="ln802">			m_fullLabel = ref-&gt;name();</a>
<a name="ln803">			m_fullLabel += &quot; (no file)&quot;;</a>
<a name="ln804">		}</a>
<a name="ln805">		else</a>
<a name="ln806">		{</a>
<a name="ln807">			BEntry entry(&amp;nodeFile);</a>
<a name="ln808">			char fileName[B_FILE_NAME_LENGTH];</a>
<a name="ln809">			entry.GetName(fileName);</a>
<a name="ln810">			m_fullLabel = fileName;</a>
<a name="ln811">		}</a>
<a name="ln812">	} </a>
<a name="ln813">	else</a>
<a name="ln814">	{</a>
<a name="ln815">		m_fullLabel = ref-&gt;name();</a>
<a name="ln816">	}</a>
<a name="ln817"> </a>
<a name="ln818">	int32 layout = dynamic_cast&lt;MediaRoutingView *&gt;(view())-&gt;getLayout();</a>
<a name="ln819"> </a>
<a name="ln820">	// Construct labelRect</a>
<a name="ln821">	font_height fh;</a>
<a name="ln822">	be_plain_font-&gt;GetHeight(&amp;fh);</a>
<a name="ln823">	switch (layout)</a>
<a name="ln824">	{</a>
<a name="ln825">		case MediaRoutingView::M_ICON_VIEW:</a>
<a name="ln826">		{</a>
<a name="ln827">			m_labelRect = Frame();</a>
<a name="ln828">			m_labelRect.OffsetTo(0.0, 0.0);</a>
<a name="ln829">			m_labelRect.bottom = 2 * M_LABEL_V_MARGIN + (fh.ascent + fh.descent + fh.leading) + 1.0;</a>
<a name="ln830">			break;</a>
<a name="ln831">		}</a>
<a name="ln832">		case MediaRoutingView::M_MINI_ICON_VIEW:</a>
<a name="ln833">		{</a>
<a name="ln834">			m_labelRect = Frame();</a>
<a name="ln835">			m_labelRect.OffsetTo(0.0, 0.0);</a>
<a name="ln836">			m_labelRect.left = M_BODY_H_MARGIN + B_MINI_ICON;</a>
<a name="ln837">			m_labelRect.top += MediaJack::M_DEFAULT_HEIGHT;</a>
<a name="ln838">			m_labelRect.bottom -= MediaJack::M_DEFAULT_HEIGHT;</a>
<a name="ln839">			break;</a>
<a name="ln840">		}</a>
<a name="ln841">	}</a>
<a name="ln842"> </a>
<a name="ln843">	// truncate the label to fit in the panel</a>
<a name="ln844">	float maxWidth = m_labelRect.Width() - (2.0 * M_LABEL_H_MARGIN) - 2.0;</a>
<a name="ln845">	if (be_plain_font-&gt;StringWidth(m_fullLabel.String()) &gt; maxWidth)</a>
<a name="ln846">	{</a>
<a name="ln847">		char *truncatedLabel[1];</a>
<a name="ln848">		truncatedLabel[0] = new char[B_MEDIA_NAME_LENGTH];</a>
<a name="ln849">		const char *originalLabel[1];</a>
<a name="ln850">		originalLabel[0] = new char[B_MEDIA_NAME_LENGTH];</a>
<a name="ln851">		m_fullLabel.CopyInto(const_cast&lt;char *&gt;(originalLabel[0]), 0, B_MEDIA_NAME_LENGTH);</a>
<a name="ln852">		be_plain_font-&gt;GetTruncatedStrings(originalLabel, 1, B_TRUNCATE_END, maxWidth, (char **) truncatedLabel);</a>
<a name="ln853">		m_label = truncatedLabel[0];</a>
<a name="ln854">		m_labelTruncated = true;</a>
<a name="ln855">		delete [] originalLabel[0];</a>
<a name="ln856">		delete [] truncatedLabel[0];</a>
<a name="ln857">	}</a>
<a name="ln858">	else</a>
<a name="ln859">	{</a>
<a name="ln860">		m_label = m_fullLabel;</a>
<a name="ln861">		m_labelTruncated = false;</a>
<a name="ln862">	}</a>
<a name="ln863"> </a>
<a name="ln864">	// Construct labelOffset</a>
<a name="ln865">	float fw = be_plain_font-&gt;StringWidth(m_label.String());</a>
<a name="ln866">	m_labelOffset.x = m_labelRect.left + m_labelRect.Width() / 2.0 - fw / 2.0;</a>
<a name="ln867">	m_labelOffset.y = m_labelRect.bottom - M_LABEL_V_MARGIN - fh.descent - (fh.leading / 2.0) - 1.0;</a>
<a name="ln868"> </a>
<a name="ln869">	// Construct bodyRect</a>
<a name="ln870">	switch (layout)</a>
<a name="ln871">	{</a>
<a name="ln872">		case MediaRoutingView::M_ICON_VIEW:</a>
<a name="ln873">		{</a>
<a name="ln874">			m_bodyRect = Frame();</a>
<a name="ln875">			m_bodyRect.OffsetTo(0.0, 0.0);</a>
<a name="ln876">			m_bodyRect.top = m_labelRect.bottom;</a>
<a name="ln877">			break;</a>
<a name="ln878">		}</a>
<a name="ln879">		case MediaRoutingView::M_MINI_ICON_VIEW:</a>
<a name="ln880">		{</a>
<a name="ln881">			m_bodyRect = Frame();</a>
<a name="ln882">			m_bodyRect.OffsetTo(0.0, 0.0);</a>
<a name="ln883">			m_bodyRect.right = m_labelRect.left;</a>
<a name="ln884">			break;</a>
<a name="ln885">		}</a>
<a name="ln886">	}</a>
<a name="ln887">}</a>
<a name="ln888"> </a>
<a name="ln889">void MediaNodePanel::_updateBitmap()</a>
<a name="ln890">{</a>
<a name="ln891">	if (m_bitmap)</a>
<a name="ln892">	{</a>
<a name="ln893">		delete m_bitmap;</a>
<a name="ln894">	}</a>
<a name="ln895">	BBitmap *tempBitmap = new BBitmap(Frame().OffsetToCopy(0.0, 0.0), B_CMAP8, true);</a>
<a name="ln896">	tempBitmap-&gt;Lock();</a>
<a name="ln897">	{</a>
<a name="ln898">		BView *tempView = new BView(tempBitmap-&gt;Bounds(), &quot;&quot;, B_FOLLOW_NONE, 0);</a>
<a name="ln899">		tempBitmap-&gt;AddChild(tempView);</a>
<a name="ln900">		tempView-&gt;SetOrigin(0.0, 0.0);</a>
<a name="ln901">	</a>
<a name="ln902">		int32 layout = dynamic_cast&lt;MediaRoutingView *&gt;(view())-&gt;getLayout();	</a>
<a name="ln903">		_drawInto(tempView, tempView-&gt;Bounds(), layout);</a>
<a name="ln904"> </a>
<a name="ln905">		tempView-&gt;Sync();</a>
<a name="ln906">		tempBitmap-&gt;RemoveChild(tempView);</a>
<a name="ln907">		delete tempView;</a>
<a name="ln908">	}</a>
<a name="ln909">	tempBitmap-&gt;Unlock();</a>
<a name="ln910">	m_bitmap = new BBitmap(tempBitmap);</a>
<a name="ln911">	delete tempBitmap;</a>
<a name="ln912">}</a>
<a name="ln913"> </a>
<a name="ln914">void MediaNodePanel::_drawInto(</a>
<a name="ln915">	BView *target,</a>
<a name="ln916">	BRect targetRect,</a>
<a name="ln917">	int32 layout)</a>
<a name="ln918">{</a>
<a name="ln919">	switch (layout)</a>
<a name="ln920">	{</a>
<a name="ln921">		case MediaRoutingView::M_ICON_VIEW:</a>
<a name="ln922">		{</a>
<a name="ln923">			BRect r;</a>
<a name="ln924">			BPoint p;</a>
<a name="ln925"> </a>
<a name="ln926">			// Draw borders</a>
<a name="ln927">			r = targetRect;</a>
<a name="ln928">			target-&gt;BeginLineArray(16);</a>
<a name="ln929">				target-&gt;AddLine(r.LeftTop(), r.RightTop(), M_DARK_GRAY_COLOR);</a>
<a name="ln930">				target-&gt;AddLine(r.RightTop(), r.RightBottom(), M_DARK_GRAY_COLOR);</a>
<a name="ln931">				target-&gt;AddLine(r.RightBottom(), r.LeftBottom(), M_DARK_GRAY_COLOR);</a>
<a name="ln932">				target-&gt;AddLine(r.LeftBottom(), r.LeftTop(), M_DARK_GRAY_COLOR);</a>
<a name="ln933">				r.InsetBy(1.0, 1.0);</a>
<a name="ln934">				target-&gt;AddLine(r.LeftTop(), r.RightTop(), M_LIGHT_GRAY_COLOR);</a>
<a name="ln935">				target-&gt;AddLine(r.RightTop(), r.RightBottom(), M_MED_GRAY_COLOR);</a>
<a name="ln936">				target-&gt;AddLine(r.RightBottom(), r.LeftBottom(), M_MED_GRAY_COLOR);</a>
<a name="ln937">				target-&gt;AddLine(r.LeftBottom(), r.LeftTop(), M_LIGHT_GRAY_COLOR);</a>
<a name="ln938">			target-&gt;EndLineArray();</a>
<a name="ln939">		</a>
<a name="ln940">			// Fill background</a>
<a name="ln941">			r.InsetBy(1.0, 1.0);</a>
<a name="ln942">			target-&gt;SetLowColor(M_GRAY_COLOR);</a>
<a name="ln943">			target-&gt;FillRect(r, B_SOLID_LOW);</a>
<a name="ln944">		</a>
<a name="ln945">			// Draw icon</a>
<a name="ln946">			if (m_icon)</a>
<a name="ln947">			{</a>
<a name="ln948">				p.x = m_bodyRect.left + m_bodyRect.Width() / 2.0 - B_LARGE_ICON / 2.0;</a>
<a name="ln949">				p.y = m_labelRect.bottom + m_bodyRect.Height() / 2.0 - B_LARGE_ICON / 2.0;</a>
<a name="ln950">				if (isSelected())</a>
<a name="ln951">				{</a>
<a name="ln952">					target-&gt;SetDrawingMode(B_OP_INVERT);</a>
<a name="ln953">					target-&gt;DrawBitmapAsync(m_icon, p);</a>
<a name="ln954">					target-&gt;SetDrawingMode(B_OP_ALPHA); </a>
<a name="ln955">					target-&gt;SetHighColor(0, 0, 0, 180);       </a>
<a name="ln956">					target-&gt;SetBlendingMode(B_CONSTANT_ALPHA, B_ALPHA_COMPOSITE);</a>
<a name="ln957">					target-&gt;DrawBitmapAsync(m_icon, p);</a>
<a name="ln958">					target-&gt;SetDrawingMode(B_OP_OVER);</a>
<a name="ln959">				}</a>
<a name="ln960">				else</a>
<a name="ln961">				{</a>
<a name="ln962">					target-&gt;SetDrawingMode(B_OP_OVER);</a>
<a name="ln963">					target-&gt;DrawBitmapAsync(m_icon, p);</a>
<a name="ln964">				}</a>
<a name="ln965">			}</a>
<a name="ln966">		</a>
<a name="ln967">			// Draw label</a>
<a name="ln968">			if (isSelected())</a>
<a name="ln969">			{</a>
<a name="ln970">				r = m_labelRect;</a>
<a name="ln971">				r.InsetBy(M_LABEL_H_MARGIN, M_LABEL_V_MARGIN);</a>
<a name="ln972">				target-&gt;BeginLineArray(4);</a>
<a name="ln973">					target-&gt;AddLine(r.LeftTop(), r.RightTop(), M_LIGHT_BLUE_COLOR);</a>
<a name="ln974">					target-&gt;AddLine(r.RightTop(), r.RightBottom(), M_LIGHT_BLUE_COLOR);</a>
<a name="ln975">					target-&gt;AddLine(r.RightBottom(), r.LeftBottom(), M_LIGHT_BLUE_COLOR);</a>
<a name="ln976">					target-&gt;AddLine(r.LeftBottom(), r.LeftTop(), M_LIGHT_BLUE_COLOR);</a>
<a name="ln977">				target-&gt;EndLineArray();</a>
<a name="ln978">				r.InsetBy(1.0, 1.0);</a>
<a name="ln979">				target-&gt;SetHighColor(M_DARK_BLUE_COLOR);</a>
<a name="ln980">				target-&gt;FillRect(r, B_SOLID_HIGH);</a>
<a name="ln981">			}</a>
<a name="ln982">			target-&gt;SetDrawingMode(B_OP_OVER);</a>
<a name="ln983">			target-&gt;SetHighColor(isSelected() ? M_WHITE_COLOR : M_BLACK_COLOR);</a>
<a name="ln984">			target-&gt;DrawString(m_label.String(), m_labelOffset);</a>
<a name="ln985">			break;</a>
<a name="ln986">		}</a>
<a name="ln987">		case MediaRoutingView::M_MINI_ICON_VIEW:</a>
<a name="ln988">		{</a>
<a name="ln989">			BRect r;</a>
<a name="ln990">			BPoint p;</a>
<a name="ln991"> </a>
<a name="ln992">			// Draw borders</a>
<a name="ln993">			r = targetRect;</a>
<a name="ln994">			target-&gt;BeginLineArray(16);</a>
<a name="ln995">				target-&gt;AddLine(r.LeftTop(), r.RightTop(), M_DARK_GRAY_COLOR);</a>
<a name="ln996">				target-&gt;AddLine(r.RightTop(), r.RightBottom(), M_DARK_GRAY_COLOR);</a>
<a name="ln997">				target-&gt;AddLine(r.RightBottom(), r.LeftBottom(), M_DARK_GRAY_COLOR);</a>
<a name="ln998">				target-&gt;AddLine(r.LeftBottom(), r.LeftTop(), M_DARK_GRAY_COLOR);</a>
<a name="ln999">				r.InsetBy(1.0, 1.0);</a>
<a name="ln1000">				target-&gt;AddLine(r.LeftTop(), r.RightTop(), M_LIGHT_GRAY_COLOR);</a>
<a name="ln1001">				target-&gt;AddLine(r.RightTop(), r.RightBottom(), M_MED_GRAY_COLOR);</a>
<a name="ln1002">				target-&gt;AddLine(r.RightBottom(), r.LeftBottom(), M_MED_GRAY_COLOR);</a>
<a name="ln1003">				target-&gt;AddLine(r.LeftBottom(), r.LeftTop(), M_LIGHT_GRAY_COLOR);</a>
<a name="ln1004">			target-&gt;EndLineArray();</a>
<a name="ln1005">		</a>
<a name="ln1006">			// Fill background</a>
<a name="ln1007">			r.InsetBy(1.0, 1.0);</a>
<a name="ln1008">			target-&gt;SetLowColor(M_GRAY_COLOR);</a>
<a name="ln1009">			target-&gt;FillRect(r, B_SOLID_LOW);</a>
<a name="ln1010">		</a>
<a name="ln1011">			// Draw icon</a>
<a name="ln1012">			if (m_icon)</a>
<a name="ln1013">			{</a>
<a name="ln1014">				p.x = m_bodyRect.left + M_BODY_H_MARGIN;</a>
<a name="ln1015">				p.y = m_bodyRect.top + (m_bodyRect.Height() / 2.0) - (B_MINI_ICON / 2.0);</a>
<a name="ln1016">				if (isSelected())</a>
<a name="ln1017">				{</a>
<a name="ln1018">					target-&gt;SetDrawingMode(B_OP_INVERT);</a>
<a name="ln1019">					target-&gt;DrawBitmapAsync(m_icon, p);</a>
<a name="ln1020">					target-&gt;SetDrawingMode(B_OP_ALPHA); </a>
<a name="ln1021">					target-&gt;SetHighColor(0, 0, 0, 180);       </a>
<a name="ln1022">					target-&gt;SetBlendingMode(B_CONSTANT_ALPHA, B_ALPHA_COMPOSITE);</a>
<a name="ln1023">					target-&gt;DrawBitmapAsync(m_icon, p);</a>
<a name="ln1024">					target-&gt;SetDrawingMode(B_OP_OVER);</a>
<a name="ln1025">				}</a>
<a name="ln1026">				else</a>
<a name="ln1027">				{</a>
<a name="ln1028">					target-&gt;SetDrawingMode(B_OP_OVER);</a>
<a name="ln1029">					target-&gt;DrawBitmapAsync(m_icon, p);</a>
<a name="ln1030">				}</a>
<a name="ln1031">			}</a>
<a name="ln1032">		</a>
<a name="ln1033">			// Draw label</a>
<a name="ln1034">			if (isSelected())</a>
<a name="ln1035">			{</a>
<a name="ln1036">				r = m_labelRect;</a>
<a name="ln1037">				r.InsetBy(M_LABEL_H_MARGIN, M_LABEL_V_MARGIN);</a>
<a name="ln1038">				target-&gt;BeginLineArray(4);</a>
<a name="ln1039">					target-&gt;AddLine(r.LeftTop(), r.RightTop(), M_LIGHT_BLUE_COLOR);</a>
<a name="ln1040">					target-&gt;AddLine(r.RightTop(), r.RightBottom(), M_LIGHT_BLUE_COLOR);</a>
<a name="ln1041">					target-&gt;AddLine(r.RightBottom(), r.LeftBottom(), M_LIGHT_BLUE_COLOR);</a>
<a name="ln1042">					target-&gt;AddLine(r.LeftBottom(), r.LeftTop(), M_LIGHT_BLUE_COLOR);</a>
<a name="ln1043">				target-&gt;EndLineArray();</a>
<a name="ln1044">				r.InsetBy(1.0, 1.0);</a>
<a name="ln1045">				target-&gt;SetHighColor(M_DARK_BLUE_COLOR);</a>
<a name="ln1046">				target-&gt;FillRect(r, B_SOLID_HIGH);</a>
<a name="ln1047">			}</a>
<a name="ln1048">			target-&gt;SetDrawingMode(B_OP_OVER);</a>
<a name="ln1049">			target-&gt;SetHighColor(isSelected() ? M_WHITE_COLOR : M_BLACK_COLOR);</a>
<a name="ln1050">			target-&gt;DrawString(m_label.String(), m_labelOffset);</a>
<a name="ln1051">			break;</a>
<a name="ln1052">		}</a>
<a name="ln1053">	}</a>
<a name="ln1054">}</a>
<a name="ln1055"> </a>
<a name="ln1056">void MediaNodePanel::_updateIcon(</a>
<a name="ln1057">	int32 layout)</a>
<a name="ln1058">{</a>
<a name="ln1059">	D_METHOD((&quot;MediaNodePanel::_updateIcon()\n&quot;));</a>
<a name="ln1060"> </a>
<a name="ln1061">	if (m_icon)</a>
<a name="ln1062">	{</a>
<a name="ln1063">		delete m_icon;</a>
<a name="ln1064">		m_icon = 0;</a>
<a name="ln1065">	}</a>
<a name="ln1066">	RouteAppNodeManager *manager;</a>
<a name="ln1067">	manager = dynamic_cast&lt;MediaRoutingView *&gt;(view())-&gt;manager;</a>
<a name="ln1068">	switch (layout)</a>
<a name="ln1069">	{</a>
<a name="ln1070">		case MediaRoutingView::M_ICON_VIEW:</a>
<a name="ln1071">		{</a>
<a name="ln1072">			const MediaIcon *icon = manager-&gt;mediaIconFor(ref-&gt;id(), B_LARGE_ICON);</a>
<a name="ln1073">			m_icon = new BBitmap(dynamic_cast&lt;const BBitmap *&gt;(icon));</a>
<a name="ln1074">			break;</a>
<a name="ln1075">		}</a>
<a name="ln1076">		case MediaRoutingView::M_MINI_ICON_VIEW:</a>
<a name="ln1077">		{</a>
<a name="ln1078">			const MediaIcon *icon = manager-&gt;mediaIconFor(ref-&gt;id(), B_MINI_ICON);</a>
<a name="ln1079">			m_icon = new BBitmap(dynamic_cast&lt;const BBitmap *&gt;(icon));</a>
<a name="ln1080">			break;</a>
<a name="ln1081">		}</a>
<a name="ln1082">	}</a>
<a name="ln1083">}</a>
<a name="ln1084"> </a>
<a name="ln1085">// -------------------------------------------------------- //</a>
<a name="ln1086">// *** sorting methods (friend)</a>
<a name="ln1087">// -------------------------------------------------------- //</a>
<a name="ln1088"> </a>
<a name="ln1089">int __CORTEX_NAMESPACE__ compareID(</a>
<a name="ln1090">	const void *lValue,</a>
<a name="ln1091">	const void *rValue)</a>
<a name="ln1092">{</a>
<a name="ln1093">	int retValue = 0;</a>
<a name="ln1094">	const MediaNodePanel *lPanel = *(reinterpret_cast&lt;MediaNodePanel * const*&gt;(reinterpret_cast&lt;void * const*&gt;(lValue)));</a>
<a name="ln1095">	const MediaNodePanel *rPanel = *(reinterpret_cast&lt;MediaNodePanel * const*&gt;(reinterpret_cast&lt;void * const*&gt;(rValue)));</a>
<a name="ln1096">	if (lPanel &amp;&amp; rPanel)</a>
<a name="ln1097">	{</a>
<a name="ln1098">		if (lPanel-&gt;ref-&gt;id() &lt; rPanel-&gt;ref-&gt;id())</a>
<a name="ln1099">		{</a>
<a name="ln1100">			retValue = -1;</a>
<a name="ln1101">		}</a>
<a name="ln1102">		else if (lPanel-&gt;ref-&gt;id() &gt; rPanel-&gt;ref-&gt;id())</a>
<a name="ln1103">		{</a>
<a name="ln1104">			retValue = 1;</a>
<a name="ln1105">		}</a>
<a name="ln1106">	}</a>
<a name="ln1107">	return retValue;</a>
<a name="ln1108">}</a>
<a name="ln1109"> </a>
<a name="ln1110">// END -- MediaNodePanel.cpp --</a>

</code></pre>
<div class="balloon" rel="93"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the constructor. Consider inspecting: m_labelTruncated, m_mouseOverLabel.</p></div>
<div class="balloon" rel="678"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v773/" target="_blank">V773</a> Visibility scope of the 'menu' pointer was exited without releasing the memory. A memory leak is possible.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
